<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChocoDrop Bookmarklet v2ï¼ˆä¿®æ­£ç‰ˆï¼‰</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
            background: #0a0a0a;
            color: #fff;
        }
        h1 {
            color: #ff6ad5;
        }
        .info {
            background: rgba(255, 106, 213, 0.1);
            border: 2px solid #ff6ad5;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .bookmarklet {
            background: rgba(255, 255, 255, 0.1);
            border: 2px dashed #ff6ad5;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
        }
        .bookmarklet-link {
            display: inline-block;
            background: #ff6ad5;
            color: #000;
            padding: 12px 24px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            margin: 10px 0;
        }
        .bookmarklet-link:hover {
            background: #ff4dc4;
        }
        code {
            background: rgba(255, 255, 255, 0.1);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
        }
        pre {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 11px;
            line-height: 1.4;
        }
        .step {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #ff6ad5;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>ğŸ« ChocoDrop Bookmarklet v2ï¼ˆä¿®æ­£ç‰ˆï¼‰</h1>

    <div class="info">
        <strong>âœ¨ ä¿®æ­£ç‚¹:</strong> ãƒ‡ãƒ¼ãƒ¢ãƒ³ãŒåœæ­¢ã—ã¦ã„ã¦ã‚‚ã€ãƒˆãƒ¼ã‚¹ãƒˆUIãŒæ­£å¸¸ã«è¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸï¼
    </div>

    <div class="bookmarklet">
        <h2>ğŸ“Œ ä½¿ã„æ–¹</h2>

        <div class="step">
            <strong>Step 1:</strong> ã“ã®ãƒªãƒ³ã‚¯ã‚’ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ãƒãƒ¼ã«ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—
            <div style="margin-top: 10px;">
                <a href="javascript:(async()=>{const b='http://127.0.0.1:43110';async function check(){try{const r=await fetch(b+'/v1/health');return r.ok}catch{return false}}async function showToast(){if(document.getElementById('__cd_toast__'))return;const t=document.createElement('div');t.id='__cd_toast__';Object.assign(t.style,{position:'fixed',right:'16px',bottom:'16px',zIndex:'2147483647',width:'min(380px,calc(100vw-32px))',fontFamily:'ui-sans-serif,system-ui,-apple-system,sans-serif'});t.innerHTML=`<div style='background:#18181c;color:#fff;padding:14px 16px;border-radius:14px;box-shadow:0 10px 30px rgba(0,0,0,.35)'><div style='font-weight:700;display:flex;gap:8px;align-items:center'><span>ğŸ« ChocoDrop ãŒèµ·å‹•ã—ã¦ã„ã¾ã›ã‚“</span><span id='cd-dot' style='margin-left:auto;width:8px;height:8px;border-radius:50%;background:#f43'></span></div><div style='font-size:12px;opacity:.85;margin-top:6px'>ãƒ­ãƒ¼ã‚«ãƒ«(127.0.0.1)ã®ã¿ã§å‹•ä½œãƒ»å¤–éƒ¨é€ä¿¡ãªã—ã€‚èµ·å‹•ã™ã‚‹ã¨è‡ªå‹•ã§æ¥ç¶šã—ã¾ã™ã€‚</div><div style='display:grid;gap:8px;margin-top:12px'><button id='cd-guide' style='padding:10px 12px;border:0;border-radius:10px;cursor:pointer;background:#fff;color:#111;font-weight:600'>èµ·å‹•ã‚¬ã‚¤ãƒ‰ã‚’é–‹ã</button><button id='cd-retry' style='padding:10px 12px;border:1px solid #444;border-radius:10px;cursor:pointer;background:transparent;color:#fff'>å†è©¦è¡Œ</button></div></div>`;document.body.appendChild(t);const d=t.querySelector('#cd-dot'),g=document.createElement('dialog');g.style.border='0';g.style.borderRadius='14px';g.style.padding='0';g.style.maxWidth='560px';g.style.width='calc(100vw-40px)';g.innerHTML=`<div style='background:#161618;color:#fff;padding:16px;border-radius:14px'><div style='font-weight:700;margin-bottom:8px'>èµ·å‹•ã‚¬ã‚¤ãƒ‰</div><pre id='cd-code' style='background:#0e0e10;color:#eaeaea;padding:12px;border-radius:10px;overflow:auto;margin:0;font-size:13px'>npx --yes @chocodrop/daemon@alpha</pre><div style='display:flex;gap:8px;justify-content:flex-end;margin-top:12px'><button id='cd-copy' style='padding:8px 10px;border-radius:8px;border:0;cursor:pointer;background:#444;color:#fff'>ã‚³ãƒ”ãƒ¼</button><button id='cd-done' style='padding:8px 10px;border-radius:8px;border:0;cursor:pointer;background:#fff;color:#111'>OK</button></div></div>`;document.body.appendChild(g);t.querySelector('#cd-guide').onclick=()=>g.showModal();g.querySelector('#cd-done').onclick=()=>g.close();g.querySelector('#cd-copy').onclick=async()=>{try{await navigator.clipboard.writeText('npx --yes @chocodrop/daemon@alpha');const btn=g.querySelector('#cd-copy');btn.textContent='ã‚³ãƒ”ãƒ¼å®Œäº†ï¼';setTimeout(()=>{btn.textContent='ã‚³ãƒ”ãƒ¼'},1000)}catch{}};t.querySelector('#cd-retry').onclick=poll;async function poll(){const ok=await check();d.style.background=ok?'#0f6':'#f43';if(ok){t.querySelector('span').textContent='ğŸ« æ¥ç¶šã§ãã¾ã—ãŸ';setTimeout(()=>{t.remove();loadSDK()},700)}else{setTimeout(poll,2500)}}poll()}function loadSDK(){if(document.getElementById('__chocodrop_sdk'))return;const s=document.createElement('script');s.id='__chocodrop_sdk';s.src=b+'/sdk.js';s.onload=()=>window.chocodrop?.ready?.().then(()=>window.chocodrop.attach(window.scene||null,{camera:window.camera,renderer:window.renderer})).catch(e=>console.warn('ChocoDrop:',e));document.head.appendChild(s)}const isRunning=await check();if(isRunning){loadSDK()}else{showToast()}})();" class="bookmarklet-link">
                    ğŸ« ChocoDrop v2
                </a>
            </div>
        </div>

        <div class="step">
            <strong>Step 2:</strong> Three.js ãƒšãƒ¼ã‚¸ã§ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯
            <ul>
                <li>ãƒ‡ãƒ¼ãƒ¢ãƒ³èµ·å‹•ä¸­ â†’ å³åº§ã« ChocoDrop UI ãŒè¡¨ç¤º</li>
                <li>ãƒ‡ãƒ¼ãƒ¢ãƒ³åœæ­¢ä¸­ â†’ ãƒˆãƒ¼ã‚¹ãƒˆUIãŒè¡¨ç¤ºã•ã‚Œã€èµ·å‹•ã‚’æ¡ˆå†…</li>
            </ul>
        </div>
    </div>

    <h2>ğŸ“ å‹•ä½œãƒ•ãƒ­ãƒ¼</h2>
    <pre><code>ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚¯ãƒªãƒƒã‚¯
    â†“
ãƒ‡ãƒ¼ãƒ¢ãƒ³èµ·å‹•ç¢ºèª
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ èµ·å‹•ã—ã¦ã„ã‚‹     â”‚ åœæ­¢ã—ã¦ã„ã‚‹     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ SDKèª­ã¿è¾¼ã¿      â”‚ ãƒˆãƒ¼ã‚¹ãƒˆUIè¡¨ç¤º   â”‚
â”‚ â†“               â”‚ â†“               â”‚
â”‚ UIè¡¨ç¤º          â”‚ èµ·å‹•æ¡ˆå†…         â”‚
â”‚                 â”‚ â†“               â”‚
â”‚                 â”‚ è‡ªå‹•ãƒãƒ¼ãƒªãƒ³ã‚°   â”‚
â”‚                 â”‚ â†“               â”‚
â”‚                 â”‚ æ¥ç¶šæˆåŠŸ         â”‚
â”‚                 â”‚ â†“               â”‚
â”‚                 â”‚ SDKèª­ã¿è¾¼ã¿      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>

    <h2>ğŸ”§ æŠ€è¡“è©³ç´°</h2>
    <ul>
        <li>ãƒˆãƒ¼ã‚¹ãƒˆUIã‚³ãƒ¼ãƒ‰ã‚’ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆå†…ã«åŸ‹ã‚è¾¼ã¿</li>
        <li>ãƒ‡ãƒ¼ãƒ¢ãƒ³ã®çŠ¶æ…‹ã‚’å…ˆã«ãƒã‚§ãƒƒã‚¯</li>
        <li>åœæ­¢æ™‚ã§ã‚‚ãƒˆãƒ¼ã‚¹ãƒˆUIãŒè¡¨ç¤ºå¯èƒ½</li>
        <li>æ¥ç¶šæˆåŠŸå¾Œã«è‡ªå‹•çš„ã«SDKã‚’èª­ã¿è¾¼ã¿</li>
    </ul>

    <h2>ğŸ“‹ ã‚³ãƒ¼ãƒ‰ï¼ˆæ‰‹å‹•å®Ÿè¡Œç”¨ï¼‰</h2>
    <p>æ‰‹å‹•ã§ä½¿ã†å ´åˆã¯ã€ã“ã®ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ï¼š</p>
    <pre><code>// èª­ã¿ã‚„ã™ã„æ•´å½¢ç‰ˆï¼ˆå®Ÿéš›ã«ã¯1è¡Œã«åœ§ç¸®ã•ã‚Œã¦ã„ã¾ã™ï¼‰
(async () => {
  const b = 'http://127.0.0.1:43110';

  async function check() {
    try {
      const r = await fetch(b + '/v1/health');
      return r.ok;
    } catch {
      return false;
    }
  }

  const isRunning = await check();

  if (isRunning) {
    // SDKã‚’ç›´æ¥èª­ã¿è¾¼ã¿
    loadSDK();
  } else {
    // ãƒˆãƒ¼ã‚¹ãƒˆUIã‚’è¡¨ç¤º
    showToast();
  }

  function loadSDK() { /* SDKèª­ã¿è¾¼ã¿ãƒ­ã‚¸ãƒƒã‚¯ */ }
  function showToast() { /* ãƒˆãƒ¼ã‚¹ãƒˆUIè¡¨ç¤ºãƒ­ã‚¸ãƒƒã‚¯ */ }
})();</code></pre>
</body>
</html>
