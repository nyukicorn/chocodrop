<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChocoDrop - Pixel RPG Kingdom</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: 'Courier New', 'Monaco', monospace;
            background: linear-gradient(180deg, #1a237e 0%, #3949ab 40%, #5c6bc0 100%);
            image-rendering: pixelated;
            image-rendering: crisp-edges;
        }

        #info {
            position: fixed;
            top: 16px;
            left: 16px;
            color: #fff;
            background: linear-gradient(135deg, #1565c0aa 0%, #0d47a1dd 100%);
            backdrop-filter: blur(8px);
            border: 2px solid #64b5f6;
            padding: 16px 20px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: bold;
            z-index: 100;
            max-width: 280px;
            text-align: center;
            line-height: 1.5;
            box-shadow: 0 0 20px rgba(100, 181, 246, 0.3);
        }

        #info strong {
            font-size: 16px;
            font-weight: 900;
            color: #bbdefb;
            display: block;
            margin-bottom: 12px;
            text-align: center;
            text-shadow: 0 0 10px #2196f3;
        }

        #info code {
            background: rgba(33, 150, 243, 0.3);
            color: #e3f2fd;
            padding: 3px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            font-weight: bold;
        }

        .rpg-icon {
            display: inline-block;
            animation: rpg-glow 2s ease-in-out infinite;
            cursor: pointer;
            transition: transform 0.2s ease;
            text-shadow: 0 0 8px currentColor;
        }

        .rpg-icon:hover {
            transform: scale(1.3);
            animation: rpg-glow-fast 0.6s ease-in-out infinite;
        }

        .rpg-title {
            display: inline-block;
            animation: rpg-title-pulse 3s ease-in-out infinite;
            text-shadow: 0 0 15px #2196f3, 0 0 25px #1976d2;
        }

        @keyframes rpg-title-pulse {
            0%, 100% {
                text-shadow: 0 0 15px #2196f3, 0 0 25px #1976d2;
                transform: scale(1);
            }
            50% {
                text-shadow: 0 0 20px #03a9f4, 0 0 35px #0288d1, 0 0 45px #0277bd;
                transform: scale(1.05);
            }
        }

        @keyframes rpg-glow {
            0%, 100% {
                filter: brightness(1) drop-shadow(0 0 5px currentColor);
                transform: scale(1) rotate(0deg);
            }
            25% {
                filter: brightness(1.4) drop-shadow(0 0 15px currentColor);
                transform: scale(1.1) rotate(3deg);
            }
            50% {
                filter: brightness(1.6) drop-shadow(0 0 20px currentColor) drop-shadow(0 0 10px #fff);
                transform: scale(1.15) rotate(0deg);
            }
            75% {
                filter: brightness(1.4) drop-shadow(0 0 15px currentColor);
                transform: scale(1.1) rotate(-3deg);
            }
        }

        @keyframes rpg-glow-fast {
            0%, 100% {
                filter: brightness(1.5) drop-shadow(0 0 12px currentColor);
                transform: rotate(0deg);
            }
            33% {
                filter: brightness(2) drop-shadow(0 0 25px currentColor) drop-shadow(0 0 15px #fff);
                transform: rotate(8deg);
            }
            66% {
                filter: brightness(2) drop-shadow(0 0 25px currentColor) drop-shadow(0 0 15px #fff);
                transform: rotate(-8deg);
            }
        }

        .highlight {
            color: #81d4fa;
            font-weight: bold;
            text-shadow: 0 0 8px #0288d1;
        }

        .subtitle {
            color: #b3e5fc;
            font-size: 12px;
            margin-top: 8px;
            opacity: 0.9;
        }

        .demo-links {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 12px;
            z-index: 100;
        }

        .demo-link {
            background: linear-gradient(135deg, #1565c0 0%, #0d47a1 100%);
            color: white;
            text-decoration: none;
            padding: 12px 16px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: bold;
            border: 2px solid #64b5f6;
            box-shadow: 0 0 15px rgba(100, 181, 246, 0.4);
            transition: all 0.3s ease;
        }

        .demo-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(100, 181, 246, 0.6);
            text-shadow: 0 0 10px #fff;
        }

        canvas {
            display: block;
        }
    </style>
</head>
<body>
    <div id="info">
        <strong><span class="rpg-title">ğŸ° RPGç‹å›½ãƒ‡ãƒ¢ç©ºé–“</span></strong>
        <div class="subtitle">8bitã®ä¸–ç•Œã§å†’é™ºã—ã‚ˆã†</div>

        <div style="margin: 16px 0 12px 0;">
            <code>@</code>ã‚­ãƒ¼ ã¾ãŸã¯ <span class="rpg-icon">ğŸ«</span> ã§èµ·å‹•<br>
            ç”»åƒã‚’ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ç‹å›½ã«é…ç½®
        </div>

        <div class="highlight">
            âœ¨ è©¦ã—ã¦ã¿ã¦:<br>
            ã€Œç”»åƒã‚’å³ä¸Šã«ã€ã€Œä¸­å¤®ã«é…ç½®ã€
        </div>
    </div>

    <div class="demo-links">
        <a href="../basic/index.html" class="demo-link">ğŸ« é­”æ³•ä¸–ç•Œ</a>
        <a href="../space/index.html" class="demo-link">ğŸŒŒ å®‡å®™ç©ºé–“</a>
        <a href="../pixel-ocean/index.html" class="demo-link">ğŸŒŠ æµ·åº•ä¸–ç•Œ</a>
    </div>

    <!-- Three.js -->
    <script src="https://cdn.jsdelivr.net/npm/three/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three/examples/js/controls/OrbitControls.js"></script>

    <!-- ChocoDrop Demo UMD -->
    <script src="../basic/chocodrop-demo.umd.min.js"></script>

    <script>
        console.log('ğŸ° RPG Kingdom Loading...');
        console.log('THREE loaded:', typeof THREE !== 'undefined');

        // Basic Three.js setup
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({
            antialias: false, // ãƒ”ã‚¯ã‚»ãƒ«ã‚¢ãƒ¼ãƒˆé¢¨ã«
            powerPreference: "high-performance"
        });

        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2)); // ãƒ”ã‚¯ã‚»ãƒ«æ„Ÿã‚’ä¿ã¤
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.BasicShadowMap; // ãƒãƒ¼ãƒ‰ã‚·ãƒ£ãƒ‰ã‚¦ã§ãƒ”ã‚¯ã‚»ãƒ«æ„Ÿ
        document.body.appendChild(renderer.domElement);

        // ğŸ° RPGç‹å›½ã®ç’°å¢ƒè¨­å®š
        scene.background = new THREE.Color(0x87ceeb); // ã‚¹ã‚«ã‚¤ãƒ–ãƒ«ãƒ¼
        scene.fog = new THREE.Fog(0x87ceeb, 15, 60);

        // ğŸŒ RPGãƒ©ã‚¤ãƒ†ã‚£ãƒ³ã‚° - æ˜ç¢ºãªã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆ
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.4);
        scene.add(ambientLight);

        // å¤ªé™½å…‰ï¼ˆä¸Šã‹ã‚‰ï¼‰
        const sunLight = new THREE.DirectionalLight(0xffd700, 1.2);
        sunLight.position.set(20, 30, 10);
        sunLight.castShadow = true;
        sunLight.shadow.mapSize.width = 512; // ä½è§£åƒåº¦ã§ãƒ”ã‚¯ã‚»ãƒ«æ„Ÿ
        sunLight.shadow.mapSize.height = 512;
        sunLight.shadow.camera.near = 0.5;
        sunLight.shadow.camera.far = 100;
        sunLight.shadow.camera.left = -30;
        sunLight.shadow.camera.right = 30;
        sunLight.shadow.camera.top = 30;
        sunLight.shadow.camera.bottom = -30;
        scene.add(sunLight);

        // ğŸŒ± RPGé¢¨åœ°é¢ï¼ˆç·‘ã®è‰åŸï¼‰
        const groundGeometry = new THREE.PlaneGeometry(80, 80, 16, 16);
        const groundMaterial = new THREE.MeshLambertMaterial({
            color: 0x228b22,
            flatShading: true // ãƒ”ã‚¯ã‚»ãƒ«ã‚¢ãƒ¼ãƒˆé¢¨ã®å¹³é¢ã‚·ã‚§ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°
        });
        const ground = new THREE.Mesh(groundGeometry, groundMaterial);
        ground.rotation.x = -Math.PI / 2;
        ground.receiveShadow = true;
        scene.add(ground);

        // ğŸ° 8bitã‚¹ã‚¿ã‚¤ãƒ«ã®åŸã‚’ä½œæˆ
        function createPixelCastle() {
            const castleGroup = new THREE.Group();

            // åŸã®æœ¬ä½“ï¼ˆç›´æ–¹ä½“ï¼‰
            const mainKeep = new THREE.Mesh(
                new THREE.BoxGeometry(8, 12, 8),
                new THREE.MeshLambertMaterial({
                    color: 0x708090,
                    flatShading: true
                })
            );
            mainKeep.position.set(0, 6, -15);
            mainKeep.castShadow = true;
            mainKeep.receiveShadow = true;
            castleGroup.add(mainKeep);

            // å¡”ï¼ˆ4ã¤ï¼‰
            const towerPositions = [
                [-3, 8, -11], [3, 8, -11], [-3, 8, -19], [3, 8, -19]
            ];

            towerPositions.forEach(pos => {
                const tower = new THREE.Mesh(
                    new THREE.BoxGeometry(2, 6, 2),
                    new THREE.MeshLambertMaterial({
                        color: 0x2f4f4f,
                        flatShading: true
                    })
                );
                tower.position.set(...pos);
                tower.castShadow = true;
                tower.receiveShadow = true;
                castleGroup.add(tower);

                // å¡”ã®å±‹æ ¹ï¼ˆå††éŒï¼‰
                const roof = new THREE.Mesh(
                    new THREE.ConeGeometry(1.5, 3, 8),
                    new THREE.MeshLambertMaterial({
                        color: 0x8b0000,
                        flatShading: true
                    })
                );
                roof.position.set(pos[0], pos[1] + 4.5, pos[2]);
                roof.castShadow = true;
                castleGroup.add(roof);
            });

            scene.add(castleGroup);
            return castleGroup;
        }

        // ğŸŒ² 8bité¢¨ã®æœ¨ã‚’ä½œæˆ
        function createPixelTree(x, z, scale = 1) {
            const treeGroup = new THREE.Group();

            // æœ¨ã®å¹¹
            const trunk = new THREE.Mesh(
                new THREE.BoxGeometry(0.8 * scale, 4 * scale, 0.8 * scale),
                new THREE.MeshLambertMaterial({
                    color: 0x8b4513,
                    flatShading: true
                })
            );
            trunk.position.set(x, 2 * scale, z);
            trunk.castShadow = true;
            trunk.receiveShadow = true;
            treeGroup.add(trunk);

            // è‘‰ã£ã±ï¼ˆç«‹æ–¹ä½“ã§8bité¢¨ï¼‰
            const leaves = new THREE.Mesh(
                new THREE.BoxGeometry(3 * scale, 3 * scale, 3 * scale),
                new THREE.MeshLambertMaterial({
                    color: 0x228b22,
                    flatShading: true
                })
            );
            leaves.position.set(x, 5 * scale, z);
            leaves.castShadow = true;
            leaves.receiveShadow = true;
            treeGroup.add(leaves);

            scene.add(treeGroup);
            return treeGroup;
        }

        // ğŸ˜ï¸ å°ã•ãªæ‘ã‚’ä½œæˆ
        function createPixelVillage() {
            const villageGroup = new THREE.Group();

            // å®¶1
            const house1 = new THREE.Mesh(
                new THREE.BoxGeometry(4, 3, 4),
                new THREE.MeshLambertMaterial({
                    color: 0xdaa520,
                    flatShading: true
                })
            );
            house1.position.set(-20, 1.5, 5);
            house1.castShadow = true;
            house1.receiveShadow = true;
            villageGroup.add(house1);

            // å±‹æ ¹1
            const roof1 = new THREE.Mesh(
                new THREE.BoxGeometry(5, 1, 5),
                new THREE.MeshLambertMaterial({
                    color: 0x8b4513,
                    flatShading: true
                })
            );
            roof1.position.set(-20, 3.5, 5);
            roof1.castShadow = true;
            villageGroup.add(roof1);

            // å®¶2
            const house2 = new THREE.Mesh(
                new THREE.BoxGeometry(3, 2.5, 3),
                new THREE.MeshLambertMaterial({
                    color: 0xcd853f,
                    flatShading: true
                })
            );
            house2.position.set(-15, 1.25, 8);
            house2.castShadow = true;
            house2.receiveShadow = true;
            villageGroup.add(house2);

            // å±‹æ ¹2
            const roof2 = new THREE.Mesh(
                new THREE.BoxGeometry(4, 0.8, 4),
                new THREE.MeshLambertMaterial({
                    color: 0x654321,
                    flatShading: true
                })
            );
            roof2.position.set(-15, 3, 8);
            roof2.castShadow = true;
            villageGroup.add(roof2);

            scene.add(villageGroup);
            return villageGroup;
        }

        // ğŸ’ å®çŸ³/ã‚¢ã‚¤ãƒ†ãƒ é…ç½®
        function createTreasure(x, y, z, color = 0xffd700) {
            const treasure = new THREE.Mesh(
                new THREE.BoxGeometry(0.8, 0.8, 0.8),
                new THREE.MeshLambertMaterial({
                    color: color,
                    flatShading: true,
                    emissive: color,
                    emissiveIntensity: 0.2
                })
            );
            treasure.position.set(x, y, z);
            treasure.castShadow = true;
            treasure.receiveShadow = true;

            // ã‚­ãƒ©ã‚­ãƒ©å›è»¢
            treasure.userData.rotationSpeed = Math.random() * 0.03 + 0.01;

            scene.add(treasure);
            return treasure;
        }

        // ğŸ° ç‹å›½ã‚’æ§‹ç¯‰
        const castle = createPixelCastle();
        const village = createPixelVillage();

        // ğŸŒ² æ£®ã‚’é…ç½®
        const trees = [];
        const forestPositions = [
            [15, -10], [18, -8], [12, -12], [20, -5],
            [-25, -5], [-22, -8], [-28, -2], [-30, -10],
            [8, 15], [12, 18], [5, 20], [15, 22]
        ];

        forestPositions.forEach(pos => {
            const scale = Math.random() * 0.5 + 0.8;
            trees.push(createPixelTree(pos[0], pos[1], scale));
        });

        // ğŸ’ å®ç‰©ã‚’é…ç½®
        const treasures = [];
        treasures.push(createTreasure(5, 0.5, -8, 0xffd700)); // é‡‘
        treasures.push(createTreasure(-8, 0.5, 3, 0x0000ff)); // é’å®çŸ³
        treasures.push(createTreasure(12, 0.5, 5, 0xff0000)); // èµ¤å®çŸ³
        treasures.push(createTreasure(-5, 0.5, -2, 0x00ff00)); // ç·‘å®çŸ³

        // ğŸ“· ã‚«ãƒ¡ãƒ©ä½ç½®
        camera.position.set(0, 8, 20);
        camera.lookAt(0, 0, -10);

        // ğŸ® ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«
        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.05;
        controls.minDistance = 5;
        controls.maxDistance = 40;
        controls.maxPolarAngle = Math.PI / 2.2;

        // ğŸ« ChocoDropåˆæœŸåŒ–
        let chocoDrop;

        function initChocoDrop() {
            try {
                chocoDrop = ChocoDrop.createChocoDrop(scene, {
                    camera: camera,
                    renderer: renderer,
                    // GitHub Pagesãªã®ã§ç”Ÿæˆæ©Ÿèƒ½ãªã—ã€ã‚¤ãƒ³ãƒãƒ¼ãƒˆã®ã¿
                    serverUrl: null,
                    sceneOptions: {
                        enableMouseInteraction: true
                    },
                    onControlsToggle: (disabled) => {
                        controls.enabled = !disabled;
                    }
                });

                console.log('ğŸ° RPG Kingdom ready! Press @ to start your adventure!');

                // RPGé¢¨ã®ãƒ’ãƒ³ãƒˆ
                window.addEventListener('keydown', (event) => {
                    if (event.code === 'Space' || event.key === '@') {
                        console.log('âš”ï¸  Try: "ç”»åƒã‚’å³ä¸Šã«", "ä¸­å¤®ã«é…ç½®", "ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ"');
                    }
                });

            } catch (error) {
                console.error('ChocoDrop initialization failed:', error);
            }
        }

        // åˆæœŸåŒ–
        setTimeout(initChocoDrop, 1000);

        // ğŸ¬ ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ—
        function animate() {
            requestAnimationFrame(animate);

            // å®ç‰©ã®å›è»¢
            treasures.forEach(treasure => {
                if (treasure.userData.rotationSpeed) {
                    treasure.rotation.y += treasure.userData.rotationSpeed;
                }
            });

            controls.update();
            renderer.render(scene, camera);
        }

        animate();

        // ğŸ“± ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

    </script>
</body>
</html>