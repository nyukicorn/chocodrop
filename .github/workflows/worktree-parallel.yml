name: Worktree Parallel Testing
# AI-powered parallel branch comparison workflow

on:
  workflow_dispatch:
    inputs:
      branches:
        description: 'Comma-separated branch names to test (e.g., task/feature-a,task/feature-b,task/feature-c)'
        required: true
        type: string
      run_build:
        description: 'Run build for each branch'
        required: false
        type: boolean
        default: true
      run_tests:
        description: 'Run tests for each branch'
        required: false
        type: boolean
        default: true
      compare_results:
        description: 'Generate comparison report'
        required: false
        type: boolean
        default: true

permissions:
  contents: read
  pull-requests: write
  issues: write

jobs:
  prepare:
    name: Prepare branch matrix
    runs-on: ubuntu-latest
    outputs:
      matrix: ${{ steps.set-matrix.outputs.matrix }}
      branch_count: ${{ steps.set-matrix.outputs.count }}

    steps:
      - name: Parse branches
        id: set-matrix
        run: |
          BRANCHES="${{ github.event.inputs.branches }}"
          # ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã‚’é…åˆ—ã«å¤‰æ›
          IFS=',' read -ra BRANCH_ARRAY <<< "$BRANCHES"

          # ã‚¹ãƒšãƒ¼ã‚¹ã‚’ãƒˆãƒªãƒ 
          CLEANED_BRANCHES=()
          for branch in "${BRANCH_ARRAY[@]}"; do
            trimmed=$(echo "$branch" | xargs)
            CLEANED_BRANCHES+=("\"$trimmed\"")
          done

          # JSONé…åˆ—ã‚’ä½œæˆ
          BRANCH_JSON="[${CLEANED_BRANCHES[*]}]"
          BRANCH_JSON="${BRANCH_JSON// /,}"

          echo "matrix=$BRANCH_JSON" >> $GITHUB_OUTPUT
          echo "count=${#BRANCH_ARRAY[@]}" >> $GITHUB_OUTPUT

          echo "ğŸŒ³ Testing ${#BRANCH_ARRAY[@]} branches:"
          for branch in "${BRANCH_ARRAY[@]}"; do
            echo "  - $(echo $branch | xargs)"
          done

  # å„ãƒ–ãƒ©ãƒ³ãƒã‚’ä¸¦è¡Œå®Ÿè¡Œ
  test-branch:
    name: Test ${{ matrix.branch }}
    runs-on: ubuntu-latest
    needs: prepare
    strategy:
      fail-fast: false
      matrix:
        branch: ${{ fromJson(needs.prepare.outputs.matrix) }}
        node: [20]

    steps:
      - name: Checkout branch ${{ matrix.branch }}
        uses: actions/checkout@v4
        with:
          ref: ${{ matrix.branch }}
          fetch-depth: 0

      - name: Setup Node.js ${{ matrix.node }}
        uses: actions/setup-node@v4
        with:
          node-version: ${{ matrix.node }}
          cache: 'npm'

      - name: Get branch info
        id: branch_info
        run: |
          BRANCH_NAME="${{ matrix.branch }}"
          COMMIT_SHA=$(git rev-parse --short HEAD)
          COMMIT_MSG=$(git log -1 --pretty=%s)
          BRANCH_SAFE=$(echo "$BRANCH_NAME" | sed 's/[^a-zA-Z0-9]/-/g')

          echo "branch_safe=$BRANCH_SAFE" >> $GITHUB_OUTPUT
          echo "commit_sha=$COMMIT_SHA" >> $GITHUB_OUTPUT
          echo "commit_msg=$COMMIT_MSG" >> $GITHUB_OUTPUT

          echo "ğŸ“‹ Branch: $BRANCH_NAME"
          echo "ğŸ“ Commit: $COMMIT_SHA - $COMMIT_MSG"

      - name: Install dependencies
        run: |
          echo "ğŸ“¦ Installing dependencies for ${{ matrix.branch }}..."
          npm ci

      - name: Run linting
        id: lint
        run: |
          echo "ğŸ” Running linting..."
          npm run lint > lint-output.txt 2>&1 || true
          cat lint-output.txt

          if grep -q "error" lint-output.txt; then
            echo "status=failed" >> $GITHUB_OUTPUT
          else
            echo "status=passed" >> $GITHUB_OUTPUT
          fi
        continue-on-error: true

      - name: Run build
        id: build
        if: github.event.inputs.run_build == 'true'
        run: |
          echo "ğŸ”¨ Building ${{ matrix.branch }}..."
          START_TIME=$(date +%s)

          npm run build > build-output.txt 2>&1 || BUILD_FAILED=1

          END_TIME=$(date +%s)
          BUILD_TIME=$((END_TIME - START_TIME))

          echo "duration=$BUILD_TIME" >> $GITHUB_OUTPUT

          if [ "$BUILD_FAILED" == "1" ]; then
            echo "status=failed" >> $GITHUB_OUTPUT
            cat build-output.txt
            exit 1
          else
            echo "status=passed" >> $GITHUB_OUTPUT
            echo "âœ… Build completed in ${BUILD_TIME}s"
          fi
        continue-on-error: true

      - name: Run tests
        id: test
        if: github.event.inputs.run_tests == 'true'
        run: |
          echo "ğŸ§ª Running tests for ${{ matrix.branch }}..."
          START_TIME=$(date +%s)

          npm test > test-output.txt 2>&1 || TEST_FAILED=1

          END_TIME=$(date +%s)
          TEST_TIME=$((END_TIME - START_TIME))

          echo "duration=$TEST_TIME" >> $GITHUB_OUTPUT

          if [ "$TEST_FAILED" == "1" ]; then
            echo "status=failed" >> $GITHUB_OUTPUT
            cat test-output.txt
          else
            echo "status=passed" >> $GITHUB_OUTPUT
            echo "âœ… Tests completed in ${TEST_TIME}s"
          fi

          # ãƒ†ã‚¹ãƒˆçµæœã‚’ã‚«ã‚¦ãƒ³ãƒˆ
          PASS_COUNT=$(grep -c "# pass" test-output.txt || echo "0")
          FAIL_COUNT=$(grep -c "# fail" test-output.txt || echo "0")

          echo "pass_count=$PASS_COUNT" >> $GITHUB_OUTPUT
          echo "fail_count=$FAIL_COUNT" >> $GITHUB_OUTPUT
        continue-on-error: true

      - name: Generate branch report
        run: |
          REPORT_DIR="reports/${{ steps.branch_info.outputs.branch_safe }}"
          mkdir -p "$REPORT_DIR"

          cat > "$REPORT_DIR/summary.json" << EOF
          {
            "branch": "${{ matrix.branch }}",
            "commit": "${{ steps.branch_info.outputs.commit_sha }}",
            "commit_message": "${{ steps.branch_info.outputs.commit_msg }}",
            "node_version": "${{ matrix.node }}",
            "lint_status": "${{ steps.lint.outputs.status }}",
            "build_status": "${{ steps.build.outputs.status }}",
            "build_duration": "${{ steps.build.outputs.duration }}",
            "test_status": "${{ steps.test.outputs.status }}",
            "test_duration": "${{ steps.test.outputs.duration }}",
            "test_pass": "${{ steps.test.outputs.pass_count }}",
            "test_fail": "${{ steps.test.outputs.fail_count }}",
            "timestamp": "$(date -u +%Y-%m-%dT%H:%M:%SZ)"
          }
          EOF

          # Markdown ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
          cat > "$REPORT_DIR/report.md" << EOF
          # Test Report: ${{ matrix.branch }}

          ## Branch Information
          - **Branch**: \`${{ matrix.branch }}\`
          - **Commit**: \`${{ steps.branch_info.outputs.commit_sha }}\`
          - **Message**: ${{ steps.branch_info.outputs.commit_msg }}
          - **Node.js**: ${{ matrix.node }}

          ## Results

          | Check | Status | Duration |
          |-------|--------|----------|
          | Lint | ${{ steps.lint.outputs.status == 'passed' && 'âœ… Passed' || 'âŒ Failed' }} | - |
          | Build | ${{ steps.build.outputs.status == 'passed' && 'âœ… Passed' || steps.build.outputs.status == 'failed' && 'âŒ Failed' || 'â­ï¸ Skipped' }} | ${{ steps.build.outputs.duration }}s |
          | Tests | ${{ steps.test.outputs.status == 'passed' && 'âœ… Passed' || steps.test.outputs.status == 'failed' && 'âŒ Failed' || 'â­ï¸ Skipped' }} | ${{ steps.test.outputs.duration }}s |

          ### Test Details
          - **Passed**: ${{ steps.test.outputs.pass_count }}
          - **Failed**: ${{ steps.test.outputs.fail_count }}
          EOF

          cat "$REPORT_DIR/report.md"

      - name: Upload branch artifacts
        uses: actions/upload-artifact@v4
        with:
          name: report-${{ steps.branch_info.outputs.branch_safe }}
          path: reports/
          retention-days: 30

  # å…¨ãƒ–ãƒ©ãƒ³ãƒã®çµæœã‚’æ¯”è¼ƒ
  compare:
    name: Compare results
    runs-on: ubuntu-latest
    needs: [prepare, test-branch]
    if: github.event.inputs.compare_results == 'true'
    permissions:
      contents: read

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Download all reports
        uses: actions/download-artifact@v4
        with:
          path: all-reports

      - name: Generate comparison report
        run: |
          mkdir -p comparison

          cat > comparison/README.md << 'EOF'
          # Worktree Parallel Testing - Comparison Report

          ## Overview
          This report compares the results of parallel testing across multiple branches.

          ## Tested Branches
          EOF

          echo "Testing ${{ needs.prepare.outputs.branch_count }} branches" >> comparison/README.md
          echo "" >> comparison/README.md

          # å„ãƒ–ãƒ©ãƒ³ãƒã®ãƒ¬ãƒãƒ¼ãƒˆã‚’çµ±åˆ
          cat >> comparison/README.md << 'EOF'
          ## Comparison Table

          | Branch | Commit | Lint | Build | Build Time | Tests | Test Time | Pass | Fail |
          |--------|--------|------|-------|------------|-------|-----------|------|------|
          EOF

          for report_dir in all-reports/report-*/; do
            if [ -f "$report_dir/*/summary.json" ]; then
              JSON_FILE=$(find "$report_dir" -name "summary.json" | head -1)

              BRANCH=$(jq -r '.branch' "$JSON_FILE")
              COMMIT=$(jq -r '.commit' "$JSON_FILE")
              LINT=$(jq -r '.lint_status' "$JSON_FILE")
              BUILD=$(jq -r '.build_status' "$JSON_FILE")
              BUILD_DUR=$(jq -r '.build_duration' "$JSON_FILE")
              TEST=$(jq -r '.test_status' "$JSON_FILE")
              TEST_DUR=$(jq -r '.test_duration' "$JSON_FILE")
              PASS=$(jq -r '.test_pass' "$JSON_FILE")
              FAIL=$(jq -r '.test_fail' "$JSON_FILE")

              LINT_ICON=$([[ "$LINT" == "passed" ]] && echo "âœ…" || echo "âŒ")
              BUILD_ICON=$([[ "$BUILD" == "passed" ]] && echo "âœ…" || [[ "$BUILD" == "failed" ]] && echo "âŒ" || echo "â­ï¸")
              TEST_ICON=$([[ "$TEST" == "passed" ]] && echo "âœ…" || [[ "$TEST" == "failed" ]] && echo "âŒ" || echo "â­ï¸")

              echo "| $BRANCH | \`$COMMIT\` | $LINT_ICON | $BUILD_ICON | ${BUILD_DUR}s | $TEST_ICON | ${TEST_DUR}s | $PASS | $FAIL |" >> comparison/README.md
            fi
          done

          cat >> comparison/README.md << 'EOF'

          ## Recommendations

          Based on the test results:
          1. âœ… Branches with all tests passing are ready for merge
          2. âš ï¸  Branches with build failures need attention
          3. âŒ Branches with test failures require fixes

          ## Next Steps
          1. Review failed branches
          2. Fix any issues
          3. Choose the best implementation
          4. Merge to main branch
          EOF

          cat comparison/README.md

      - name: ğŸ¤– AI Code Comparison with Claude
        uses: anthropics/claude-code-action@beta
        with:
          mode: agent
          direct_prompt: |
            # è¤‡æ•°ãƒ–ãƒ©ãƒ³ãƒã®å®Ÿè£…æ¯”è¼ƒè©•ä¾¡ã‚¿ã‚¹ã‚¯

            ã‚ãªãŸã¯çµŒé¨“è±Šå¯Œãªã‚·ãƒ‹ã‚¢ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã§ã™ã€‚è¤‡æ•°ã®å®Ÿè£…ã‚’æ·±ãåˆ†æã—ã€æœ€è‰¯ã®é¸æŠã‚’ææ¡ˆã—ã¦ãã ã•ã„ã€‚

            ## ğŸ“‹ ã‚¿ã‚¹ã‚¯æ¦‚è¦

            `all-reports/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«è¤‡æ•°ã®ãƒ–ãƒ©ãƒ³ãƒã®ãƒ†ã‚¹ãƒˆçµæœãŒä¿å­˜ã•ã‚Œã¦ã„ã¾ã™ã€‚
            **å¿…ãšå…¨ãƒ–ãƒ©ãƒ³ãƒã®å®Ÿè£…ã‚³ãƒ¼ãƒ‰ã‚’èª­ã¿è¾¼ã‚“ã§**ã€è©³ç´°ãªæ¯”è¼ƒè©•ä¾¡ã‚’è¡Œã£ã¦ãã ã•ã„ã€‚

            ## ğŸ” å®Ÿæ–½å†…å®¹

            ### Phase 1: ãƒ–ãƒ©ãƒ³ãƒã¨ã‚³ãƒ¼ãƒ‰ã®æŠŠæ¡

            1. `all-reports/` å†…ã®å„ãƒ¬ãƒãƒ¼ãƒˆã‹ã‚‰ `summary.json` ã‚’èª­ã¿è¾¼ã‚€
            2. **å„ãƒ–ãƒ©ãƒ³ãƒã®ãƒ¡ã‚¤ãƒ³ã‚³ãƒ¼ãƒ‰ã‚’å¿…ãšèª­ã¿è¾¼ã‚€**
               - `git show <branch>:<file-path>` ã¾ãŸã¯ checkout ã—ã¦èª­ã‚€
               - ä¸»è¦ãªå¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç‰¹å®šã—ã¦å…¨ã¦ç¢ºèª
               - å®Ÿè£…ã®å…¨ä½“åƒã‚’æŠŠæ¡ã™ã‚‹

            ### Phase 2: è©•ä¾¡è»¸ã®æ±ºå®š

            **ã‚³ãƒ¼ãƒ‰ã‚’èª­ã‚“ã ä¸Šã§**ã€ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«æœ€é©ãªè©•ä¾¡è»¸ã‚’è‡ªåˆ†ã§è€ƒãˆã¦ãã ã•ã„ã€‚

            ä¾‹ï¼ˆå‚è€ƒï¼‰ï¼š
            - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ï¼ˆå®Ÿè¡Œé€Ÿåº¦ã€ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ï¼‰
            - ã‚³ãƒ¼ãƒ‰å“è³ªï¼ˆå¯èª­æ€§ã€ä¿å®ˆæ€§ã€è¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰
            - ãƒ†ã‚¹ãƒˆå“è³ªï¼ˆã‚«ãƒãƒ¬ãƒƒã‚¸ã€ãƒ†ã‚¹ãƒˆã®è³ªï¼‰
            - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ï¼ˆè„†å¼±æ€§ã€å®‰å…¨æ€§ï¼‰
            - æ‹¡å¼µæ€§ï¼ˆå°†æ¥ã®æ©Ÿèƒ½è¿½åŠ ã®ã—ã‚„ã™ã•ï¼‰
            - æŠ€è¡“çš„è² å‚µï¼ˆãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã®å¿…è¦æ€§ï¼‰

            **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ç‰¹æ€§ã«å¿œã˜ã¦ã€ç‹¬è‡ªã®è©•ä¾¡è»¸ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚**

            ### Phase 3: è©³ç´°è©•ä¾¡

            å„ãƒ–ãƒ©ãƒ³ãƒã«ã¤ã„ã¦ã€Phase 2 ã§æ±ºå®šã—ãŸè©•ä¾¡è»¸ã§è©³ç´°ã«åˆ†æã—ã¦ãã ã•ã„ã€‚
            **å¿…ãšã‚³ãƒ¼ãƒ‰ã®å…·ä½“çš„ãªç®‡æ‰€ã‚’å¼•ç”¨**ã—ã¦æ ¹æ‹ ã‚’ç¤ºã—ã¦ãã ã•ã„ã€‚

            ### Phase 4: HTML ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ

            `comparison/ai-analysis.html` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚

            **å¿…é ˆæ§‹æˆ**ï¼š

            ```html
            <!DOCTYPE html>
            <html lang="ja">
            <head>
              <meta charset="UTF-8">
              <meta name="viewport" content="width=device-width, initial-scale=1.0">
              <title>AI Code Comparison Report</title>
              <style>
                body { font-family: system-ui, -apple-system, sans-serif; max-width: 1200px; margin: 0 auto; padding: 20px; line-height: 1.6; }
                h1 { color: #2563eb; border-bottom: 3px solid #2563eb; padding-bottom: 10px; }
                h2 { color: #1e40af; margin-top: 40px; }
                .executive-summary { background: #eff6ff; padding: 20px; border-left: 4px solid #2563eb; margin: 20px 0; }
                .ranking { display: flex; flex-direction: column; gap: 20px; margin: 20px 0; }
                .rank-item { background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 8px; padding: 20px; }
                .rank-1 { border-left: 6px solid #10b981; background: #f0fdf4; }
                .rank-2 { border-left: 6px solid #3b82f6; background: #eff6ff; }
                .rank-3 { border-left: 6px solid #f59e0b; background: #fffbeb; }
                .code-ref { background: #1e293b; color: #e2e8f0; padding: 2px 6px; border-radius: 4px; font-family: monospace; font-size: 0.9em; }
                table { width: 100%; border-collapse: collapse; margin: 20px 0; }
                th, td { border: 1px solid #e5e7eb; padding: 12px; text-align: left; }
                th { background: #f3f4f6; font-weight: 600; }
                .metric-good { color: #10b981; font-weight: 600; }
                .metric-warn { color: #f59e0b; font-weight: 600; }
                .metric-bad { color: #ef4444; font-weight: 600; }
              </style>
            </head>
            <body>
              <h1>ğŸ¤– AI Code Comparison Report</h1>

              <!-- 1. Executive Summaryï¼ˆå¿…é ˆï¼‰ -->
              <div class="executive-summary">
                <h2>ğŸ“Š Executive Summary</h2>
                <p><strong>è©•ä¾¡å¯¾è±¡</strong>: [ãƒ–ãƒ©ãƒ³ãƒæ•°] å€‹ã®ãƒ–ãƒ©ãƒ³ãƒ</p>
                <p><strong>æ¨å¥¨ãƒ–ãƒ©ãƒ³ãƒ</strong>: [æœ€ã‚‚å„ªã‚ŒãŸãƒ–ãƒ©ãƒ³ãƒå]</p>
                <p><strong>æ¨å¥¨ç†ç”±ï¼ˆè¦ç´„ï¼‰</strong>: [1-2æ–‡ã§ç°¡æ½”ã«]</p>
                <p><strong>ä¸»ãªç™ºè¦‹</strong>: [é‡è¦ãªãƒã‚¤ãƒ³ãƒˆã‚’3-5å€‹ç®‡æ¡æ›¸ã]</p>
              </div>

              <!-- 2. ãƒ©ãƒ³ã‚­ãƒ³ã‚°ï¼ˆå¿…é ˆï¼‰ -->
              <h2>ğŸ† ç·åˆãƒ©ãƒ³ã‚­ãƒ³ã‚°</h2>
              <div class="ranking">
                <div class="rank-item rank-1">
                  <h3>ğŸ¥‡ 1ä½: [ãƒ–ãƒ©ãƒ³ãƒå]</h3>
                  <p><strong>ç·åˆè©•ä¾¡</strong>: â­â­â­â­â­ (5/5)</p>
                  <p><strong>é¸å®šç†ç”±</strong>: ...</p>
                  <p><strong>å¼·ã¿</strong>: ...</p>
                  <p><strong>å¼±ã¿</strong>: ...</p>
                </div>
                <!-- 2ä½ã€3ä½... -->
              </div>

              <!-- 3. è©•ä¾¡è»¸ã®èª¬æ˜ -->
              <h2>ğŸ“ è©•ä¾¡è»¸</h2>
              <p>ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ç‰¹æ€§ã‚’è€ƒæ…®ã—ã€ä»¥ä¸‹ã®è©•ä¾¡è»¸ã‚’è¨­å®šã—ã¾ã—ãŸï¼š</p>
              <table>
                <tr><th>è©•ä¾¡è»¸</th><th>é‡è¦åº¦</th><th>èª¬æ˜</th></tr>
                <!-- AI ãŒæ±ºå®šã—ãŸè©•ä¾¡è»¸ã‚’ã“ã“ã«è¨˜è¼‰ -->
              </table>

              <!-- 4. è©³ç´°åˆ†æï¼ˆå„ãƒ–ãƒ©ãƒ³ãƒã”ã¨ï¼‰ -->
              <h2>ğŸ” è©³ç´°åˆ†æ</h2>

              <h3>[ãƒ–ãƒ©ãƒ³ãƒ1]</h3>
              <table>
                <tr><th>è©•ä¾¡é …ç›®</th><th>ã‚¹ã‚³ã‚¢</th><th>è©³ç´°</th></tr>
                <tr>
                  <td>ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹</td>
                  <td class="metric-good">90/100</td>
                  <td>ãƒ“ãƒ«ãƒ‰æ™‚é–“: 15sï¼ˆæœ€é€Ÿï¼‰<br>å…·ä½“çš„ãªã‚³ãƒ¼ãƒ‰: <code class="code-ref">src/main.js:45-67</code> ã§æœ€é©åŒ–ã•ã‚Œã¦ã„ã‚‹</td>
                </tr>
                <!-- ä»–ã®è©•ä¾¡é …ç›® -->
              </table>
              <p><strong>ã‚³ãƒ¼ãƒ‰ãƒã‚¤ãƒ©ã‚¤ãƒˆ</strong>:</p>
              <pre><code>// src/main.js:45-67
              [å®Ÿéš›ã®ã‚³ãƒ¼ãƒ‰ã‚’å¼•ç”¨]
              </code></pre>

              <!-- 5. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå›ºæœ‰ã®åˆ†æ -->
              <h2>ğŸ¯ [ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå›ºæœ‰ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³]</h2>
              <p>ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ç‰¹æ€§ã‚’è€ƒæ…®ã—ãŸè¿½åŠ åˆ†æ...</p>

              <!-- 6. æ¨å¥¨äº‹é … -->
              <h2>ğŸ’¡ æ¨å¥¨äº‹é …</h2>
              <ol>
                <li><strong>ä»Šã™ãå®Ÿæ–½</strong>: [æœ€å„ªå…ˆã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³]</li>
                <li><strong>æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—</strong>: [æ¬¡ã«å®Ÿæ–½ã™ã¹ãã“ã¨]</li>
                <li><strong>é•·æœŸçš„æ”¹å–„</strong>: [å°†æ¥çš„ãªæ”¹å–„æ¡ˆ]</li>
              </ol>

              <!-- 7. çµè«– -->
              <h2>ğŸ¯ çµè«–</h2>
              <p>ç·åˆçš„ã«åˆ¤æ–­ã—ã¦ã€<strong>[ãƒ–ãƒ©ãƒ³ãƒå]</strong> ã‚’ main ã«ãƒãƒ¼ã‚¸ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™ã€‚</p>
              <p><strong>æ ¹æ‹ </strong>: [è©³ç´°ãªç†ç”±ã‚’è¨˜è¼‰]</p>
            </body>
            </html>
            ```

            ## âš ï¸ é‡è¦ãªæŒ‡ç¤º

            1. **ã‚³ãƒ¼ãƒ‰ã¯å¿…ãšèª­ã‚€**: ã€Œå¯èƒ½ãªã‚‰ã€ã§ã¯ãªãã€å¿…é ˆã§ã™
            2. **è©•ä¾¡è»¸ã¯è‡ªåˆ†ã§è€ƒãˆã‚‹**: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«æœ€é©ãªè»¸ã‚’è¨­å®š
            3. **å…·ä½“çš„ãªã‚³ãƒ¼ãƒ‰å¼•ç”¨**: è©•ä¾¡ã®æ ¹æ‹ ã‚’ç¤ºã™
            4. **HTML å½¢å¼**: Markdown ã§ã¯ãªã HTML ã§ç”Ÿæˆ
            5. **æ§‹æˆå³å®ˆ**: Executive Summary â†’ ãƒ©ãƒ³ã‚­ãƒ³ã‚° â†’ è©³ç´°
            6. **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå›ºæœ‰**: ç”»ä¸€çš„ã§ã¯ãªãã€ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«åˆã£ãŸåˆ†æ
          claude_code_oauth_token: ${{ secrets.CLAUDE_ACCESS_TOKEN }}

      - name: Upload comparison report
        uses: actions/upload-artifact@v4
        with:
          name: comparison-report
          path: comparison/
          retention-days: 90

      - name: Comment on workflow
        run: |
          echo "ğŸ“Š Comparison report generated successfully"
          echo "ğŸ¤– AI analysis included"
          echo "Download artifacts to view detailed results"
