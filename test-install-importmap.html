<!DOCTYPE html>
<html>
<head>
    <title>ChocoDrop Import Map テスト</title>
    <style>
        body { margin: 0; background: #000; overflow: hidden; }
        #container { width: 100vw; height: 100vh; }
    </style>

    <!-- Import Map を使った現代的な方法 -->
    <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@latest/build/three.module.js",
            "three/": "https://unpkg.com/three@latest/"
        }
    }
    </script>
</head>
<body>
    <div id="container"></div>

    <script type="module">
        // Import Map を使ったクリーンなインポート
        import * as THREE from 'three';
        import { OrbitControls } from 'three/examples/jsm/controls/OrbitControls.js';

        // ChocoDrop ES Modules版を直接インポート
        import { createChocoDrop } from './src/index.js';
        
        // ソースコード直接使用（UMD版廃止により）

            // Scene setup
            const scene = new THREE.Scene();
            scene.background = new THREE.Color(0x1a1a2e);

            const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 2, 5);

            const renderer = new THREE.WebGLRenderer();
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.getElementById('container').appendChild(renderer.domElement);

            // Controls
            const controls = new OrbitControls(camera, renderer.domElement);

            // デバッグ用
            console.log('THREE available:', !!window.THREE);
            console.log('THREE.Group:', !!window.THREE?.Group);

            // ChocoDrop initialization - ローカルファイル用設定追加
            const chocoDrop = createChocoDrop(scene, {
                camera: camera,
                renderer: renderer,
                serverUrl: 'http://localhost:3011', // ローカルサーバーのデフォルト
                onControlsToggle: (disabled) => {
                    controls.enabled = !disabled;
                }
            });

            // Render loop
            function animate() {
                requestAnimationFrame(animate);
                controls.update();
                renderer.render(scene, camera);
            }
            animate();

            console.log('✅ ChocoDrop (import map) ready! Press @ key to start.');
        };
    </script>
</body>
</html>