{"version":3,"file":"chocodrop-demo.umd.min.js","sources":["../src/client/LiveCommandClient.js","../src/common/translation-dictionary.js","../src/client/SceneManager.js","../src/client/demo/CommandUIDemo.js","../src/client/CommandUI.js","../src/client/bootstrap.js","../src/client/demo/index.js"],"sourcesContent":["/**\n * ChocoDrop Client - ã‚µãƒ¼ãƒãƒ¼ã¨ã®é€šä¿¡ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ\n */\nexport class ChocoDropClient {\n  constructor(serverUrl = null) {\n    this.serverUrl = null;\n    this.initialized = false;\n    this.initPromise = null;\n\n    if (serverUrl) {\n      this.serverUrl = serverUrl;\n      this.initialized = true;\n      console.log('ğŸ« ChocoDropClient initialized:', serverUrl);\n    } else {\n      // è¨­å®šå–å¾—ã‚’é…å»¶å®Ÿè¡Œï¼ˆPromiseã‚’ä¿å­˜ï¼‰\n      this.initPromise = this.initializeWithConfig();\n    }\n  }\n\n  /**\n   * ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰è¨­å®šã‚’å–å¾—ã—ã¦åˆæœŸåŒ–\n   */\n  async initializeWithConfig() {\n    try {\n      // ç¾åœ¨ã®ãƒšãƒ¼ã‚¸ã®ãƒ›ã‚¹ãƒˆã¨ãƒãƒ¼ãƒˆã‚’åŸºæº–ã«è¨­å®šAPIå‘¼ã³å‡ºã—\n      const baseUrl = `${window.location.protocol}//${window.location.hostname}:${window.location.port}`;\n\n      const response = await fetch(`${baseUrl}/api/config`);\n      if (response.ok) {\n        const config = await response.json();\n        this.serverUrl = config.serverUrl;\n        console.log('ğŸ« ChocoDropClient initialized from config:', this.serverUrl);\n      } else {\n        // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼šãƒãƒ¼ãƒˆæ¨æ¸¬\n        this.serverUrl = this.detectServerUrl();\n        console.log('ğŸ« ChocoDropClient fallback to detected URL:', this.serverUrl);\n      }\n    } catch (error) {\n      console.warn('âš ï¸ ChocoDrop config fetch failed, using fallback:', error);\n      this.serverUrl = this.detectServerUrl();\n    }\n\n    this.initialized = true;\n  }\n\n  /**\n   * ã‚µãƒ¼ãƒãƒ¼URLè‡ªå‹•æ¤œå‡ºï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰\n   */\n  detectServerUrl() {\n    const currentPort = window.location.port;\n    const protocol = window.location.protocol;\n    const hostname = window.location.hostname;\n\n    // ãƒãƒ¼ãƒˆãŒæœªæŒ‡å®šã®å ´åˆï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ãƒ—ãƒ­ãƒˆã‚³ãƒ«ç­‰ï¼‰ã¯æ—¢å®šã® 3011 ã‚’ä½¿ç”¨\n    if (!currentPort) {\n      return `${protocol}//${hostname}:3011`;\n    }\n\n    return `${protocol}//${hostname}:${currentPort}`;\n  }\n\n  /**\n   * åˆæœŸåŒ–å®Œäº†ã‚’å¾…æ©Ÿ\n   */\n  async ensureInitialized() {\n    if (this.initialized) return;\n\n    // initPromiseãŒã‚ã‚Œã°å¾…æ©Ÿ\n    if (this.initPromise) {\n      await this.initPromise;\n      return;\n    }\n\n    // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼šåˆæœŸåŒ–ã•ã‚Œã¦ã„ãªã„å ´åˆã¯ã‚¨ãƒ©ãƒ¼\n    throw new Error('ChocoDropClient not initialized');\n  }\n\n  /**\n   * ç”»åƒç”Ÿæˆãƒªã‚¯ã‚¨ã‚¹ãƒˆ\n   */\n  async generateImage(prompt, options = {}) {\n    await this.ensureInitialized();\n    console.log(`ğŸ¨ Requesting image generation: \"${prompt}\"`);\n\n    try {\n      const payload = {\n        prompt,\n        width: options.width || 512,\n        height: options.height || 512\n      };\n\n      if (options.service) {\n        payload.service = options.service;\n      }\n\n      const response = await fetch(`${this.serverUrl}/api/generate`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(payload)\n      });\n\n      if (!response.ok) {\n        throw new Error(`Server error: ${response.status}`);\n      }\n\n      const result = await response.json();\n      console.log('âœ… Image generation result:', result);\n      \n      return result;\n\n    } catch (error) {\n      console.error('âŒ Image generation request failed:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * å‹•ç”»ç”Ÿæˆãƒªã‚¯ã‚¨ã‚¹ãƒˆ\n   */\n  async generateVideo(prompt, options = {}) {\n    await this.ensureInitialized();\n    console.log(`ğŸ¬ Requesting video generation: \"${prompt}\"`);\n\n    try {\n      const safeDefaults = {\n        // aspect_ratio: ã‚µãƒ¼ãƒãƒ¼å´ã§å„ãƒ¢ãƒ‡ãƒ«æœ€é©ãªæ¯”ç‡ã‚’è‡ªå‹•é¸æŠ\n        resolution: '720p',\n        enable_safety_checker: true,\n        enable_prompt_expansion: true\n      };\n\n      const payload = {\n        prompt,\n        duration: typeof options.duration === 'number' && options.duration > 0 ? options.duration : 3,\n        resolution: options.resolution || safeDefaults.resolution,\n        enable_safety_checker: options.enable_safety_checker ?? safeDefaults.enable_safety_checker,\n        enable_prompt_expansion: options.enable_prompt_expansion ?? safeDefaults.enable_prompt_expansion\n      };\n\n      // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ˜ç¤ºçš„ã«ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”ã‚’æŒ‡å®šã—ãŸå ´åˆã®ã¿è¿½åŠ \n      if (options.aspect_ratio) {\n        payload.aspect_ratio = options.aspect_ratio;\n      }\n      // ãã‚Œä»¥å¤–ã¯ã‚µãƒ¼ãƒãƒ¼å´ã§å„ãƒ¢ãƒ‡ãƒ«ã«æœ€é©ãªæ¯”ç‡ã‚’è‡ªå‹•é¸æŠ\n\n      if (options.model) {\n        payload.model = options.model;\n      }\n\n      if (typeof options.width === 'number' && options.width > 0) {\n        payload.width = options.width;\n      }\n\n      if (typeof options.height === 'number' && options.height > 0) {\n        payload.height = options.height;\n      }\n\n      if (typeof options.seed === 'number') {\n        payload.seed = options.seed;\n      }\n\n      if (options.negative_prompt) {\n        payload.negative_prompt = options.negative_prompt;\n      }\n\n      if (typeof options.frames_per_second === 'number' && options.frames_per_second > 0) {\n        payload.frames_per_second = options.frames_per_second;\n      }\n\n      if (typeof options.guidance_scale === 'number') {\n        payload.guidance_scale = options.guidance_scale;\n      }\n\n      const response = await fetch(`${this.serverUrl}/api/generate-video`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(payload)\n      });\n\n      if (!response.ok) {\n        throw new Error(`Server error: ${response.status}`);\n      }\n\n      const result = await response.json();\n      console.log('âœ… Video generation result:', result);\n      \n      return result;\n\n    } catch (error) {\n      console.error('âŒ Video generation request failed:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * è‡ªç„¶è¨€èªã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ\n   */\n  async executeCommand(command) {\n    await this.ensureInitialized();\n    console.log(`ğŸ¯ Executing command: \"${command}\"`);\n\n    try {\n      const response = await fetch(`${this.serverUrl}/api/command`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({ command })\n      });\n\n      if (!response.ok) {\n        throw new Error(`Server error: ${response.status}`);\n      }\n\n      const result = await response.json();\n      console.log('âœ… Command execution result:', result);\n      \n      return result;\n\n    } catch (error) {\n      console.error('âŒ Command execution failed:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * åˆ©ç”¨å¯èƒ½ãªã‚µãƒ¼ãƒ“ã‚¹ä¸€è¦§å–å¾—\n   */\n  async getAvailableServices() {\n    await this.ensureInitialized();\n    try {\n      const response = await fetch(`${this.serverUrl}/api/services`);\n      \n      if (!response.ok) {\n        throw new Error(`Server error: ${response.status}`);\n      }\n\n      return await response.json();\n\n    } catch (error) {\n      console.error('âŒ Failed to get services:', error);\n      return [];\n    }\n  }\n}\n\n// å¾Œæ–¹äº’æ›ã®ãŸã‚æ—§åç§°ã‚‚ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ\nexport const LiveCommandClient = ChocoDropClient;\nexport const ChocoDroClient = ChocoDropClient;\n","/**\n * ChocoDrop å…±é€šç¿»è¨³è¾æ›¸\n * ã‚µãƒ¼ãƒãƒ¼ãƒ»ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå…±é€šã§ä½¿ç”¨ã™ã‚‹æ—¥æœ¬èªâ†’è‹±èªç¿»è¨³è¾æ›¸\n */\n\nconst TRANSLATION_DICTIONARY = {\n  // ãƒ•ã‚¡ãƒ³ã‚¿ã‚¸ãƒ¼ãƒ»é­”æ³•ç³»\n  'ãƒ¦ãƒ‹ã‚³ãƒ¼ãƒ³': 'unicorn',\n  'ãƒ‰ãƒ©ã‚´ãƒ³': 'dragon',\n  'é¾': 'dragon',\n  'æ€ªç£': 'monster',\n  'ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼': 'monster',\n  'é­”æ³•ä½¿ã„': 'wizard',\n  'é­”è¡“å¸«': 'sorcerer',\n  'é­”å¥³': 'witch',\n  'å¦–ç²¾': 'fairy',\n  'ğŸ§š': 'fairy',\n  'ğŸ§™': 'wizard',\n  'é­”æ³•æ–': 'magic wand',\n  'æ–': 'wand',\n  'ã‚¹ã‚¿ãƒƒãƒ•': 'staff',\n  'é­”æ³•': 'magic',\n  'å‘ªæ–‡': 'spell',\n  'é­”æ³•é™£': 'magic circle',\n  'æ°´æ™¶ç‰': 'crystal ball',\n  'è–¬ç“¶': 'potion bottle',\n  'é­”å°æ›¸': 'grimoire',\n  'ãƒ•ã‚§ãƒ‹ãƒƒã‚¯ã‚¹': 'phoenix',\n  'ã‚°ãƒªãƒ•ã‚£ãƒ³': 'griffin',\n  'ãƒšã‚¬ã‚µã‚¹': 'pegasus',\n  'ã‚±ãƒ«ãƒ™ãƒ­ã‚¹': 'cerberus',\n\n  // å‹•ç‰©\n  'ç”»åƒ': 'image',\n  'å†™çœŸ': 'photo',\n  'ã‚¤ãƒ¡ãƒ¼ã‚¸': 'image',\n  'çµµ': 'picture',\n  'ãƒ•ã‚¡ã‚¤ãƒ«': 'file',\n  'ãƒ¡ãƒ‡ã‚£ã‚¢': 'media',\n  'ç´ æ': 'asset',\n  'å‹•ç”»': 'video',\n  'ãƒ“ãƒ‡ã‚ª': 'video',\n  'ãƒ ãƒ¼ãƒ“ãƒ¼': 'movie',\n  'æ˜ åƒ': 'video',\n  'ã‚¯ãƒªãƒƒãƒ—': 'clip',\n  'çŒ«': 'cat',\n  'ãƒã‚³': 'cat',\n  'ã­ã“': 'cat',\n  'çŠ¬': 'dog',\n  'ã‚¤ãƒŒ': 'dog',\n  'ã„ã¬': 'dog',\n  'ç‹¼': 'wolf',\n  'ç†Š': 'bear',\n  'ãƒ©ã‚¤ã‚ªãƒ³': 'lion',\n  'ãƒˆãƒ©': 'tiger',\n  'è±¡': 'elephant',\n  'ã‚­ãƒªãƒ³': 'giraffe',\n  'ã‚·ãƒã‚¦ãƒ': 'zebra',\n  'ãƒ‘ãƒ³ãƒ€': 'panda',\n  'ã‚¦ã‚µã‚®': 'rabbit',\n  'ãƒªã‚¹': 'squirrel',\n  'ãƒãƒ ã‚¹ã‚¿ãƒ¼': 'hamster',\n  'ãƒ•ã‚¯ãƒ­ã‚¦': 'owl',\n  'ãƒ¯ã‚·': 'eagle',\n  'ã‚«ãƒ©ã‚¹': 'crow',\n  'ãƒãƒˆ': 'dove',\n  'ãƒšãƒ³ã‚®ãƒ³': 'penguin',\n  'ã‚¤ãƒ«ã‚«': 'dolphin',\n  'ã‚¯ã‚¸ãƒ©': 'whale',\n  'ã‚µãƒ¡': 'shark',\n  'ã‚¿ã‚³': 'octopus',\n  'ã‚«ãƒ‹': 'crab',\n  'ã‚¨ãƒ“': 'shrimp',\n\n  // è‡ªç„¶ãƒ»é¢¨æ™¯\n  'èŠ±': 'flower',\n  'ã¯ãª': 'flower',\n  'ãƒãƒŠ': 'flower',\n  'æ¡œ': 'cherry blossom',\n  'ãƒãƒ©': 'rose',\n  'ã²ã¾ã‚ã‚Š': 'sunflower',\n  'ãƒãƒ¥ãƒ¼ãƒªãƒƒãƒ—': 'tulip',\n  'é›²': 'cloud',\n  'ç©º': 'sky',\n  'æµ·': 'ocean',\n  'æ¹–': 'lake',\n  'å·': 'river',\n  'å±±': 'mountain',\n  'ã‚„ã¾': 'mountain',\n  'ãƒ¤ãƒ': 'mountain',\n  'æ£®': 'forest',\n  'æœ¨': 'tree',\n  'ã': 'tree',\n  'ã‚­': 'tree',\n  'è‰åŸ': 'meadow',\n  'ç ‚æ¼ ': 'desert',\n  'æ»': 'waterfall',\n  'æ´çªŸ': 'cave',\n  'å³¶': 'island',\n  'æ˜Ÿåº§': 'constellation',\n  'éŠ€æ²³': 'galaxy',\n  'æƒ‘æ˜Ÿ': 'planet',\n\n  // å»ºç‰©ãƒ»å ´æ‰€\n  'åŸ': 'castle',\n  'ã—ã‚': 'castle',\n  'ã‚·ãƒ­': 'castle',\n  'å®®æ®¿': 'palace',\n  'å®¶': 'house',\n  'å¡”': 'tower',\n  'æ•™ä¼š': 'church',\n  'ç¥æ®¿': 'temple',\n  'å›³æ›¸é¤¨': 'library',\n  'å­¦æ ¡': 'school',\n  'ç—…é™¢': 'hospital',\n  'é§…': 'station',\n  'ç©ºæ¸¯': 'airport',\n  'æ¸¯': 'port',\n  'æ©‹': 'bridge',\n  'ç¯å°': 'lighthouse',\n  'é¢¨è»Š': 'windmill',\n  'åº­': 'garden',\n  'å…¬åœ’': 'park',\n  'éŠåœ’åœ°': 'amusement park',\n\n  // ä¹—ã‚Šç‰©\n  'è»Š': 'car',\n  'é›»è»Š': 'train',\n  'ãƒã‚¹': 'bus',\n  'é£›è¡Œæ©Ÿ': 'airplane',\n  'ãƒ˜ãƒªã‚³ãƒ—ã‚¿ãƒ¼': 'helicopter',\n  'èˆ¹': 'ship',\n  'ãƒ¨ãƒƒãƒˆ': 'yacht',\n  'è‡ªè»¢è»Š': 'bicycle',\n  'ãƒã‚¤ã‚¯': 'motorcycle',\n  'ãƒ­ã‚±ãƒƒãƒˆ': 'rocket',\n\n  // å¤©ä½“ãƒ»æ™‚é–“\n  'æœˆ': 'moon',\n  'å¤ªé™½': 'sun',\n  'æ˜Ÿ': 'star',\n  'å½—æ˜Ÿ': 'comet',\n  'æµã‚Œæ˜Ÿ': 'shooting star',\n  'è™¹': 'rainbow',\n  'é›·': 'lightning',\n  'é›ª': 'snow',\n  'é›¨': 'rain',\n  'åµ': 'storm',\n  'éœ§': 'fog',\n  'æ°·': 'ice',\n  'ç«': 'fire',\n  'æ°´': 'water',\n  'é¢¨': 'wind',\n  'å…‰': 'light',\n  'å½±': 'shadow',\n  'å¤œ': 'night',\n  'æœ': 'morning',\n  'å¤•æ–¹': 'evening',\n\n  // è‰²ãƒ»ç´ æ\n  'èµ¤': 'red',\n  'é’': 'blue',\n  'ç·‘': 'green',\n  'é»„è‰²': 'yellow',\n  'ç™½': 'white',\n  'é»’': 'black',\n  'ç´«': 'purple',\n  'ãƒ”ãƒ³ã‚¯': 'pink',\n  'ã‚ªãƒ¬ãƒ³ã‚¸': 'orange',\n  'èŒ¶è‰²': 'brown',\n  'ã‚°ãƒ¬ãƒ¼': 'gray',\n  'é‡‘': 'gold',\n  'éŠ€': 'silver',\n  'ãƒ—ãƒ©ãƒãƒŠ': 'platinum',\n  'éŠ…': 'copper',\n  'é‰„': 'iron',\n  'çŸ³': 'stone',\n  'æœ¨æ': 'wood',\n  'ã‚¬ãƒ©ã‚¹': 'glass',\n  'æ°´æ™¶': 'crystal',\n  'ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰': 'diamond',\n\n  // é³¥é¡\n  'é³¥': 'bird',\n  'ã¨ã‚Š': 'bird',\n  'ãƒˆãƒª': 'bird'\n};\n\n/**\n * ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆè­˜åˆ¥ç”¨ã®ã‚¨ã‚¤ãƒªã‚¢ã‚¹è¾æ›¸ï¼ˆæ‹¡å¼µç‰ˆï¼‰\n * ç¿»è¨³è¾æ›¸ã‹ã‚‰é€†ãƒãƒƒãƒ”ãƒ³ã‚°ã‚’ç”Ÿæˆã—ã€ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã‚‚å«ã‚ã‚‹\n */\nfunction createObjectKeywords() {\n  const keywords = {};\n\n  // ç¿»è¨³è¾æ›¸ã‹ã‚‰é€†ãƒãƒƒãƒ”ãƒ³ã‚°ã‚’ä½œæˆ\n  for (const [japanese, english] of Object.entries(TRANSLATION_DICTIONARY)) {\n    // è‹±èªã‚’ã‚­ãƒ¼ã¨ã—ã¦æ—¥æœ¬èªã¨ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã‚’æ ¼ç´\n    if (!keywords[japanese]) {\n      keywords[japanese] = [];\n    }\n\n    // è‹±èªã®ç¿»è¨³ã‚’è¿½åŠ \n    if (!keywords[japanese].includes(english)) {\n      keywords[japanese].push(english);\n    }\n  }\n\n  return keywords;\n}\n\n/**\n * æ—¥æœ¬èªã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’è‹±èªã«ç¿»è¨³\n */\nfunction translateKeyword(japanese) {\n  return TRANSLATION_DICTIONARY[japanese] || japanese;\n}\n\n/**\n * ãƒ•ã‚¡ã‚¤ãƒ«åã¨æ—¥æœ¬èªã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’ãƒãƒƒãƒãƒ³ã‚°\n */\nfunction matchKeywordWithFilename(keyword, filename, keywords) {\n  const lowerFilename = filename.toLowerCase();\n\n  // ç›´æ¥ãƒãƒƒãƒ\n  if (lowerFilename.includes(keyword.toLowerCase())) {\n    return true;\n  }\n\n  // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰è¾æ›¸ã§ã®ç›¸äº’ãƒãƒƒãƒ\n  for (const [jp, aliases] of Object.entries(keywords)) {\n    // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒæ—¥æœ¬èªã®å ´åˆã€å¯¾å¿œã™ã‚‹è‹±èªã‚¨ã‚¤ãƒªã‚¢ã‚¹ã‚’ãƒ•ã‚¡ã‚¤ãƒ«åã§æ¢ã™\n    if (keyword.includes(jp)) {\n      for (const alias of aliases) {\n        if (lowerFilename.includes(alias.toLowerCase())) {\n          return true;\n        }\n      }\n    }\n  }\n\n  // ç¿»è¨³è¾æ›¸ã§ã®ç›´æ¥ãƒãƒƒãƒ\n  const englishKeyword = translateKeyword(keyword);\n  if (englishKeyword !== keyword && lowerFilename.includes(englishKeyword.toLowerCase())) {\n    return true;\n  }\n\n  return false;\n}\n\n// ES6 Modules (ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç”¨)\nexport { TRANSLATION_DICTIONARY, createObjectKeywords, translateKeyword, matchKeywordWithFilename };\n\n// CommonJS (ã‚µãƒ¼ãƒãƒ¼ç”¨)\nif (typeof module !== 'undefined' && module.exports) {\n  module.exports = { TRANSLATION_DICTIONARY, createObjectKeywords, translateKeyword, matchKeywordWithFilename };\n}\n","import * as THREE from 'three';\nimport { ChocoDropClient, ChocoDroClient, LiveCommandClient } from './LiveCommandClient.js';\nimport { createObjectKeywords, matchKeywordWithFilename } from '../common/translation-dictionary.js';\n\n/**\n * Scene Manager - 3D scene integration for ChocoDrop System\n * Handles natural language parsing and 3D object management\n */\nexport class SceneManager {\n  constructor(scene, options = {}) {\n    if (!scene) {\n      throw new Error('THREE.Scene is required');\n    }\n    \n    this.scene = scene;\n    this.camera = options.camera || null;\n    this.renderer = options.renderer || null;\n    this.labelRenderer = null; // CSS2DRenderer for UI overlays like audio controls\n    // ChocoDrop Clientï¼ˆå…±é€šã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæ³¨å…¥ã‚’å„ªå…ˆï¼‰\n    // å¤–éƒ¨ãƒ•ã‚©ãƒ«ãƒ€ã‹ã‚‰å…±æœ‰ã™ã‚‹å ´åˆã¯ options.client ã§ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’å†åˆ©ç”¨\n    this.client = options.client || new ChocoDropClient(options.serverUrl);\n    \n    // å®Ÿé¨“ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†ç”¨ã‚°ãƒ«ãƒ¼ãƒ—\n    this.experimentGroup = new THREE.Group();\n    this.experimentGroup.name = 'LiveExperiments';\n    // ä¸€æ—¦ã‚·ãƒ¼ãƒ³ã«è¿½åŠ ï¼ˆå¾Œã§ã‚«ãƒ¡ãƒ©ã«ç§»å‹•ã™ã‚‹å¯èƒ½æ€§ã‚ã‚Šï¼‰\n    this.scene.add(this.experimentGroup);\n    \n    // ã‚³ãƒãƒ³ãƒ‰å±¥æ­´\n    this.commandHistory = [];\n    \n    // ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†\n    this.spawnedObjects = new Map();\n    this.objectCounter = 0;\n    this.selectedObject = null;\n    this.selectedImageService = options.selectedImageService || null;\n    this.selectedVideoService = options.selectedVideoService || null;\n    this.audioControls = new Map();\n    this.audioControlUpdateInterval = null;\n    this.audioControlUpdateListener = null;\n\n    // Animationç®¡ç†ï¼ˆUIè¦ç´ ç”¨ï¼‰\n    this.clock = new THREE.Clock();\n    \n    // ãƒ¬ã‚¤ã‚­ãƒ£ã‚¹ãƒ†ã‚£ãƒ³ã‚°ç”¨\n    this.raycaster = new THREE.Raycaster();\n    this.mouse = new THREE.Vector2();\n    this.lastHoveredObject = null;\n    \n    // è¨­å®š\n    this.config = {\n      showLocationIndicator: options.showLocationIndicator !== false,\n      indicatorDuration: options.indicatorDuration || 3000,\n      defaultObjectScale: options.defaultObjectScale || 1.0,\n      enableObjectSelection: options.enableObjectSelection !== false,\n      enableMouseInteraction: options.enableMouseInteraction,\n      enableDebugLogging: options.enableDebugLogging === true,\n      ...options.config\n    };\n    \n    // ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã®è¨­å®š\n    this.setupClickEvents();\n    \n    console.log('ğŸ§ª SceneManager initialized with click selection');\n\n    // ãƒ‡ãƒãƒƒã‚°ã‚„ã‚³ãƒ³ã‚½ãƒ¼ãƒ«æ“ä½œã‚’å®¹æ˜“ã«ã™ã‚‹ãŸã‚ã‚°ãƒ­ãƒ¼ãƒãƒ«å‚ç…§ã‚’ä¿æŒ\n    if (typeof globalThis !== 'undefined') {\n      globalThis.sceneManager = this;\n    }\n  }\n  /**\n   * ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã®è¨­å®š\n   */\n  setupClickEvents() {\n    // enableMouseInteractionãŒæ˜ç¤ºçš„ã«trueã®å ´åˆã®ã¿ãƒã‚¦ã‚¹æ“ä½œã‚’æœ‰åŠ¹åŒ–\n    if (this.config.enableMouseInteraction === true && this.renderer) {\n      this.setupObjectDragging();\n      console.log('ğŸ–±ï¸ Mouse interaction enabled - Click to select, Shift+drag to move objects');\n    } else if (this.config.enableMouseInteraction === true && !this.renderer) {\n      console.warn('âš ï¸ Mouse interaction requested but renderer not provided. Mouse interaction disabled.');\n    } else {\n      console.log('ğŸ–±ï¸ Mouse interaction disabled (safe mode). Set enableMouseInteraction: true to enable.');\n    }\n  }\n\n  // ãƒ‡ãƒãƒƒã‚°æƒ…å ±è¡¨ç¤ºãƒ¡ã‚½ãƒƒãƒ‰\n  debugSceneInfo() {\n    console.log('ğŸ” === SCENE DEBUG INFO ===');\n    \n    // ã‚«ãƒ¡ãƒ©æƒ…å ±\n    if (this.camera) {\n      console.log(`ğŸ“· Camera:\n        - Position: (${this.camera.position.x.toFixed(2)}, ${this.camera.position.y.toFixed(2)}, ${this.camera.position.z.toFixed(2)})\n        - Rotation: (${(this.camera.rotation.x * 180 / Math.PI).toFixed(1)}Â°, ${(this.camera.rotation.y * 180 / Math.PI).toFixed(1)}Â°, ${(this.camera.rotation.z * 180 / Math.PI).toFixed(1)}Â°)\n        - FOV: ${this.camera.fov || 'N/A'}\n        - Near/Far: ${this.camera.near || 'N/A'}/${this.camera.far || 'N/A'}`);\n    }\n    \n    // ã‚·ãƒ¼ãƒ³éšå±¤\n    console.log(`ğŸŒ³ Scene hierarchy:\n      - Total objects in scene: ${this.scene.children.length}\n      - experimentGroup exists: ${this.scene.getObjectByName('LiveExperiments') ? 'Yes' : 'No'}\n      - experimentGroup children: ${this.experimentGroup.children.length}`);\n    \n    // ç”Ÿæˆã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ\n    console.log(`ğŸ“¦ Spawned objects: ${this.spawnedObjects.size}`);\n    this.spawnedObjects.forEach((obj, id) => {\n      const worldPos = new THREE.Vector3();\n      obj.getWorldPosition(worldPos);\n      console.log(`  - ${id} (${obj.userData.type}): \n        Local: (${obj.position.x.toFixed(2)}, ${obj.position.y.toFixed(2)}, ${obj.position.z.toFixed(2)})\n        World: (${worldPos.x.toFixed(2)}, ${worldPos.y.toFixed(2)}, ${worldPos.z.toFixed(2)})\n        Visible: ${obj.visible}, Scale: ${obj.scale.x.toFixed(2)}`);\n      \n      // 3Dãƒ¢ãƒ‡ãƒ«ã®è©³ç´°æƒ…å ±\n      if (obj.userData.type === 'generated_3d_model') {\n        const box = new THREE.Box3().setFromObject(obj);\n        const size = box.getSize(new THREE.Vector3());\n        const center = box.getCenter(new THREE.Vector3());\n        console.log(`    ğŸ“ Bounding box - Center: (${center.x.toFixed(2)}, ${center.y.toFixed(2)}, ${center.z.toFixed(2)}), Size: (${size.x.toFixed(2)}, ${size.y.toFixed(2)}, ${size.z.toFixed(2)})`);\n        \n        // ãƒ¡ãƒƒã‚·ãƒ¥æ•°\n        let meshCount = 0;\n        obj.traverse((child) => {\n          if (child.isMesh) meshCount++;\n        });\n        console.log(`    ğŸ­ Meshes: ${meshCount}`);\n      }\n    });\n    \n    // ã‚«ãƒ¡ãƒ©ã‹ã‚‰ã®è·é›¢è¨ˆç®—\n    if (this.camera && this.spawnedObjects.size > 0) {\n      console.log(`ğŸ“ Distances from camera:`);\n      this.spawnedObjects.forEach((obj, id) => {\n        const distance = this.camera.position.distanceTo(obj.position);\n        console.log(`  - ${id}: ${distance.toFixed(2)} units`);\n      });\n    }\n    \n    console.log('=========================');\n  }\n  \n\n  \n  /**\n   * ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆé¸æŠ\n   */\n  selectObject(object) {\n    // æ—¢ã«åŒã˜ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒé¸æŠã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ä½•ã‚‚ã—ãªã„\n    if (this.selectedObject === object) {\n      return;\n    }\n\n    // å‰ã®é¸æŠã‚’è§£é™¤\n    this.deselectObject();\n\n    this.selectedObject = object;\n\n    this.createModernSelectionIndicator(object);\n\n    console.log(`âœ… Selected object: ${object.name}`);\n    \n    // CommandUIã«é¸æŠæƒ…å ±ã‚’è¡¨ç¤º\n    if (this.commandUI) {\n      const objectInfo = object.userData || {};\n      this.commandUI.addOutput(`ğŸ“ é¸æŠ: ${object.name}`, 'info');\n      if (objectInfo.prompt) {\n        this.commandUI.addOutput(`   ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ: ${objectInfo.prompt}`, 'hint');\n      }\n      if (objectInfo.modelName) {\n        this.commandUI.addOutput(`   ãƒ¢ãƒ‡ãƒ«: ${objectInfo.modelName}`, 'hint');\n      }\n\n      // å‰Šé™¤ãƒ¢ãƒ¼ãƒ‰ãŒå¾…æ©Ÿä¸­ã®å ´åˆã€å‰Šé™¤ã‚³ãƒãƒ³ãƒ‰ã‚’è‡ªå‹•å…¥åŠ›\n      if (this.commandUI.currentMode === 'delete') {\n        const objectName = objectInfo.originalPrompt || object.name || 'é¸æŠã—ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ';\n        this.commandUI.input.value = `${objectName}ã‚’å‰Šé™¤`;\n        this.commandUI.input.focus();\n        // ã‚«ãƒ¼ã‚½ãƒ«ã‚’æ–‡æœ«ã«ç§»å‹•ï¼ˆé¸æŠçŠ¶æ…‹ã‚’è§£é™¤ï¼‰\n        this.commandUI.input.setSelectionRange(this.commandUI.input.value.length, this.commandUI.input.value.length);\n        this.commandUI.addOutput(`ğŸ¯ å‰Šé™¤å¯¾è±¡è¨­å®š: ${objectName}`, 'system');\n      }\n    }\n  }\n\n  createModernSelectionIndicator(object) {\n    // ã‚·ãƒ³ãƒ—ãƒ«ã§ç¢ºå®Ÿãªé¸æŠã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼\n    // æ—¢å­˜ã®ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã‚’å‰Šé™¤ï¼ˆé‡è¤‡é˜²æ­¢ï¼‰\n    const existingIndicator = object.getObjectByName('selectionIndicator');\n    if (existingIndicator) {\n      object.remove(existingIndicator);\n    }\n\n    const indicatorGroup = new THREE.Group();\n    indicatorGroup.name = 'selectionIndicator';\n\n    // ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹ã‚’æ­£ç¢ºã«å–å¾—\n    const box = new THREE.Box3().setFromObject(object);\n    const size = box.getSize(new THREE.Vector3());\n    const center = box.getCenter(new THREE.Vector3());\n\n    // å°ã•ãªãƒãƒ¼ã‚¸ãƒ³ã‚’è¿½åŠ ã—ã¦æ ãŒè¦‹ãˆã‚„ã™ãã™ã‚‹\n    const margin = 0.1;\n    const adjustedSize = new THREE.Vector3(\n      size.x + margin,\n      size.y + margin, \n      size.z + margin\n    );\n\n    // ã‚·ãƒ³ãƒ—ãƒ«ãªé»„è‰²ã„æ ç·š\n    // PlaneGeometryã®å ´åˆã¯å¹³é¢çš„ãªæ ã‚’ä½œæˆ\n    if (object.geometry && object.geometry.type === 'PlaneGeometry') {\n      // ã‚¹ã‚±ãƒ¼ãƒ«ã¯æ—¢ã«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«é©ç”¨ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€ã‚¸ã‚ªãƒ¡ãƒˆãƒªã®ã‚µã‚¤ã‚ºã®ã¿ä½¿ç”¨\n      const width = object.geometry.parameters.width;\n      const height = object.geometry.parameters.height;\n      \n      // å¹³é¢ã®å‘¨ã‚Šã«æ ç·šã‚’ä½œæˆ\n      const shape = new THREE.Shape();\n      shape.moveTo(-width/2, -height/2);\n      shape.lineTo(width/2, -height/2);\n      shape.lineTo(width/2, height/2);\n      shape.lineTo(-width/2, height/2);\n      shape.lineTo(-width/2, -height/2);\n      \n      const points = shape.getPoints();\n      const geometryLine = new THREE.BufferGeometry().setFromPoints(points);\n      // 2025å¹´ãƒˆãƒ¬ãƒ³ãƒ‰: ã‚¢ãƒ€ãƒ—ãƒ†ã‚£ãƒ–é¸æŠã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼\n      const adaptiveColor = this.getAdaptiveSelectionColor();\n      const materialLine = new THREE.LineBasicMaterial({\n        color: adaptiveColor,\n        linewidth: 2,\n        transparent: true,\n        opacity: 0.9\n      });\n      \n      const line = new THREE.Line(geometryLine, materialLine);\n      line.position.set(0, 0, 0.01); // å°‘ã—å‰ã«å‡ºã—ã¦è¦‹ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹\n      indicatorGroup.add(line);\n    } else {\n      // ãã®ä»–ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯é€šå¸¸ã®3Dãƒœãƒƒã‚¯ã‚¹æ \n      const edgesGeometry = new THREE.EdgesGeometry(\n        new THREE.BoxGeometry(adjustedSize.x, adjustedSize.y, adjustedSize.z)\n      );\n      // 2025å¹´ãƒˆãƒ¬ãƒ³ãƒ‰: ã‚¢ãƒ€ãƒ—ãƒ†ã‚£ãƒ–é¸æŠã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼\n      const adaptiveColor = this.getAdaptiveSelectionColor();\n      const edgesMaterial = new THREE.LineBasicMaterial({\n        color: adaptiveColor,\n        linewidth: 2,\n        transparent: true,\n        opacity: 0.9\n      });\n      \n      const edges = new THREE.LineSegments(edgesGeometry, edgesMaterial);\n      edges.position.copy(center);\n      indicatorGroup.add(edges);\n    }\n\n    // ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã‚’ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å­ã¨ã—ã¦è¿½åŠ ï¼ˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ä¸€ç·’ã«å‹•ãï¼‰\n    object.add(indicatorGroup);\n    indicatorGroup.position.set(0, 0, 0); // è¦ªã‹ã‚‰ã®ç›¸å¯¾ä½ç½®ã¯0\n\n    // ãƒªã‚µã‚¤ã‚ºãƒãƒ³ãƒ‰ãƒ«ã‚’è¿½åŠ ï¼ˆè¦ªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç›´æ¥æ¸¡ã™ï¼‰\n    this.addResizeHandles(indicatorGroup, adjustedSize, center, object);\n  }\n\n  /**\n   * ãƒªã‚µã‚¤ã‚ºãƒãƒ³ãƒ‰ãƒ«ã‚’è¿½åŠ \n   */\n  addResizeHandles(indicatorGroup, size, center, parentObject) {\n    // PlaneGeometryã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç”¨ã®ãƒªã‚µã‚¤ã‚ºãƒãƒ³ãƒ‰ãƒ«\n    console.log('ğŸ”§ addResizeHandles called');\n\n    if (!parentObject) {\n      console.log('âŒ No parent object provided');\n      return;\n    }\n\n    if (!parentObject.geometry) {\n      console.log('âŒ Parent has no geometry');\n      return;\n    }\n\n    if (parentObject.geometry.type !== 'PlaneGeometry') {\n      console.log(`âŒ Geometry type is ${parentObject.geometry.type}, not PlaneGeometry`);\n      return;\n    }\n\n    console.log('âœ… PlaneGeometry detected, creating handles');\n\n    const handleSize = 0.15; // 2025å¹´ãƒˆãƒ¬ãƒ³ãƒ‰: ã‚ˆã‚Šå°ã•ãæ´—ç·´ã•ã‚ŒãŸ\n    const handleGeometry = new THREE.BoxGeometry(handleSize, handleSize, handleSize);\n    // è§’ã‚’ä¸¸ãã™ã‚‹ãŸã‚ã€å¾Œã§roundedBoxã‚’ä½¿ç”¨\n\n    // å¸¸ã«å‰é¢ã«è¡¨ç¤ºã•ã‚Œã‚‹ãƒãƒ†ãƒªã‚¢ãƒ«\n    // 2025å¹´ãƒˆãƒ¬ãƒ³ãƒ‰: ã‚¢ãƒ€ãƒ—ãƒ†ã‚£ãƒ–ãƒªã‚µã‚¤ã‚ºãƒãƒ³ãƒ‰ãƒ«\n    const adaptiveColor = this.getAdaptiveSelectionColor();\n    const handleMaterial = new THREE.MeshBasicMaterial({\n      color: adaptiveColor,\n      transparent: true,\n      opacity: 0.8,\n      depthTest: false,\n      depthWrite: false\n    });\n\n    const handleHoverMaterial = new THREE.MeshBasicMaterial({\n      color: this.getAdaptiveHoverColor(),\n      transparent: true,\n      opacity: 1.0,\n      depthTest: false,\n      depthWrite: false\n    });\n\n    // å››éš…ã®ä½ç½®ã‚’è¨ˆç®—ï¼ˆè¦ªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã‚¸ã‚ªãƒ¡ãƒˆãƒªã‚µã‚¤ã‚ºã«åŸºã¥ãï¼‰\n    const width = parentObject.geometry.parameters.width;\n    const height = parentObject.geometry.parameters.height;\n\n    const positions = [\n      { x: width/2, y: height/2, z: 0.1, corner: 'top-right' },\n      { x: -width/2, y: height/2, z: 0.1, corner: 'top-left' },\n      { x: width/2, y: -height/2, z: 0.1, corner: 'bottom-right' },\n      { x: -width/2, y: -height/2, z: 0.1, corner: 'bottom-left' }\n    ];\n\n    positions.forEach((pos, index) => {\n      const handle = new THREE.Mesh(handleGeometry, handleMaterial.clone());\n      handle.position.set(pos.x, pos.y, pos.z); // è¦ªã‹ã‚‰ã®ç›¸å¯¾ä½ç½®\n      handle.userData = { \n        isResizeHandle: true, \n        handleIndex: index,\n        corner: pos.corner,\n        defaultMaterial: handle.material,\n        hoverMaterial: handleHoverMaterial.clone()\n      };\n      \n      // ãƒ›ãƒãƒ¼ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’è¿½åŠ \n      // ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°é †åºã‚’é«˜ãè¨­å®šï¼ˆå¸¸ã«å‰é¢ï¼‰\n      handle.renderOrder = 1001;\n\n      handle.onHover = () => {\n        handle.material = handle.userData.hoverMaterial;\n        handle.scale.setScalar(1.5);\n        document.body.style.cursor = 'nw-resize';\n      };\n\n      handle.onHoverExit = () => {\n        handle.material = handle.userData.defaultMaterial;\n        handle.scale.setScalar(1.0);\n        document.body.style.cursor = 'default';\n      };\n\n      indicatorGroup.add(handle);\n\n      // ãƒ‡ãƒãƒƒã‚°ç”¨ã«ãƒãƒ³ãƒ‰ãƒ«ãŒè¦‹ãˆã‚‹ã“ã¨ã‚’ç¢ºèª\n      console.log(`ğŸ”´ Added resize handle at ${pos.corner}`);\n    });\n  }\n\n  /**\n   * é¸æŠã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã®ã‚¹ã‚±ãƒ¼ãƒ«ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°ï¼ˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ç‰ˆï¼‰\n   */\n  updateSelectionIndicatorScale(object) {\n    // ãƒªã‚µã‚¤ã‚ºä¸­ã¯ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã®æ›´æ–°ã‚’ã‚¹ã‚­ãƒƒãƒ—ï¼ˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ï¼‰\n    // æ ç·šã¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ä¸€ç·’ã«ã‚¹ã‚±ãƒ¼ãƒ«ã•ã‚Œã‚‹ã®ã§ã€ç‰¹åˆ¥ãªæ›´æ–°ã¯ä¸è¦\n\n    // ãƒãƒ³ãƒ‰ãƒ«ä½ç½®ã®ã¿æ›´æ–°ãŒå¿…è¦ãªå ´åˆã¯ã€ã“ã“ã§å‡¦ç†\n    // ç¾åœ¨ã¯è‡ªå‹•çš„ã«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ä¸€ç·’ã«ã‚¹ã‚±ãƒ¼ãƒ«ã•ã‚Œã‚‹ã®ã§å‡¦ç†ä¸è¦\n  }\n\n  /**\n   * ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆé¸æŠè§£é™¤\n   */\n  deselectObject() {\n    // ã‚·ãƒ³ãƒ—ãƒ«ã§ç¢ºå®Ÿãªé¸æŠè§£é™¤\n    if (this.selectedObject) {\n      // é¸æŠã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã‚’å‰Šé™¤ï¼ˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å­ã‹ã‚‰æ¢ã™ï¼‰\n      const indicator = this.selectedObject.getObjectByName('selectionIndicator');\n      if (indicator) {\n        this.selectedObject.remove(indicator);\n        \n        // ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯ã‚’é˜²ããŸã‚ã«ãƒªã‚½ãƒ¼ã‚¹ã‚’ç ´æ£„\n        indicator.traverse((child) => {\n          if (child.geometry) child.geometry.dispose();\n          if (child.material) {\n            if (Array.isArray(child.material)) {\n              child.material.forEach(material => material.dispose());\n            } else {\n              child.material.dispose();\n            }\n          }\n        });\n      }\n\n      console.log(`âœ… Deselected: ${this.selectedObject.name}`);\n      this.selectedObject = null;\n    }\n  }\n\n  /**\n   * ãƒã‚¦ã‚¹ãƒ‰ãƒ©ãƒƒã‚°ã«ã‚ˆã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç§»å‹•æ©Ÿèƒ½\n   */\n  setupObjectDragging() {\n    if (!this.renderer) return;\n    \n    const canvas = this.renderer.domElement;\n    let isDragging = false;\n    let dragObject = null;\n    let dragOffset = new THREE.Vector3();\n    let mouseStart = new THREE.Vector2();\n    let dragMode = 'move'; // 'move', 'resize', 'rotate'\n    let originalScale = new THREE.Vector3();\n    \n    canvas.addEventListener('mousedown', (event) => {\n      if (event.button !== 0) return; // å·¦ã‚¯ãƒªãƒƒã‚¯ã®ã¿\n      \n      // ãƒ¬ã‚¤ã‚­ãƒ£ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã§ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæ¤œå‡º\n      const rect = canvas.getBoundingClientRect();\n      this.mouse.x = ((event.clientX - rect.left) / rect.width) * 2 - 1;\n      this.mouse.y = -((event.clientY - rect.top) / rect.height) * 2 + 1;\n      \n      this.raycaster.setFromCamera(this.mouse, this.camera);\n      // ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ãã®å­ï¼ˆé¸æŠã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼å«ã‚€ï¼‰ã‚’æ¤œå‡ºå¯¾è±¡ã«\n      const intersects = this.raycaster.intersectObjects(this.experimentGroup.children, true);\n      \n      if (intersects.length > 0) {\n        const object = intersects[0].object;\n\n        // ãƒªã‚µã‚¤ã‚ºãƒãƒ³ãƒ‰ãƒ«ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸå ´åˆ - Shiftã‚­ãƒ¼ä¸è¦\n        if (object.userData && object.userData.isResizeHandle) {\n          // ãƒªã‚µã‚¤ã‚ºãƒ¢ãƒ¼ãƒ‰é–‹å§‹\n          isDragging = true;\n          dragObject = this.selectedObject; // ãƒªã‚µã‚¤ã‚ºã™ã‚‹å®Ÿéš›ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ\n          dragMode = 'resize';\n          \n          // ãƒãƒ³ãƒ‰ãƒ«æƒ…å ±ã‚’ä¿å­˜\n          this.resizeHandleInfo = {\n            corner: object.userData.corner,\n            handleIndex: object.userData.handleIndex\n          };\n          \n          originalScale.copy(dragObject.scale);\n          mouseStart.set(event.clientX, event.clientY);\n          canvas.style.cursor = 'nw-resize';\n          console.log(`ğŸ”„ Started resizing: ${dragObject.name} from ${object.userData.corner}`);\n          return;\n        }\n\n        // å›è»¢ãƒãƒ³ãƒ‰ãƒ«ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸå ´åˆ\n        if (object.userData && object.userData.isRotateHandle) {\n          // å›è»¢ãƒ¢ãƒ¼ãƒ‰é–‹å§‹ï¼ˆä»Šå¾Œå®Ÿè£…ï¼‰\n          console.log(`ğŸ”„ Rotation handle clicked for: ${this.selectedObject.name}`);\n          return;\n        }\n\n        // ç”Ÿæˆã•ã‚ŒãŸç”»åƒãƒ»å‹•ç”»ãƒ»3Dãƒ¢ãƒ‡ãƒ«å¯¾è±¡ï¼ˆShiftä¸è¦ã®ç›´æ„Ÿçš„æ“ä½œï¼‰\n        if (object.userData && (object.userData.type === 'generated_image' || object.userData.type === 'generated_video' || object.userData.type === 'generated_3d_model' || object.userData.source === 'imported_file')) {\n          \n          // ğŸ—‘ï¸ Deleteãƒ¢ãƒ¼ãƒ‰ã§ã®ã‚¯ãƒªãƒƒã‚¯å‡¦ç†\n          if (this.commandUI && this.commandUI.currentMode === 'delete') {\n            // å‰Šé™¤ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤ºã—ã¦ç›´æ¥å‰Šé™¤\n            const objectName = object.name;\n            console.log(`ğŸ—‘ï¸ Delete mode: clicked on ${objectName}`);\n            \n            this.commandUI.showDeleteConfirmation(`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã€Œ${objectName}ã€ã‚’å‰Šé™¤`)\n              .then(confirmed => {\n                if (confirmed) {\n                  this.removeObject(objectName);\n                  this.commandUI.addOutput(`ğŸ—‘ï¸ å‰Šé™¤å®Œäº†: ${objectName}`, 'success');\n                } else {\n                  this.commandUI.addOutput(`âŒ å‰Šé™¤ã‚­ãƒ£ãƒ³ã‚»ãƒ«: ${objectName}`, 'info');\n                }\n              })\n              .catch(error => {\n                console.error('Delete confirmation error:', error);\n                this.commandUI.addOutput(`âŒ å‰Šé™¤ã‚¨ãƒ©ãƒ¼: ${objectName}`, 'error');\n              });\n            return; // å‰Šé™¤ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã¯ç§»å‹•å‡¦ç†ã‚’ã‚¹ã‚­ãƒƒãƒ—\n          }\n          \n          // ç§»å‹•ãƒ¢ãƒ¼ãƒ‰é–‹å§‹ï¼ˆShiftã‚­ãƒ¼ä¸è¦ï¼‰\n          isDragging = true;\n          dragObject = object;\n          dragMode = 'move';\n          dragOffset.copy(intersects[0].point).sub(object.position);\n          mouseStart.set(event.clientX, event.clientY);\n\n          // é«˜å“è³ªãªè¦–è¦šãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯\n          if (object.material) {\n            // ç§»å‹•ä¸­ã®é€æ˜åº¦å¤‰æ›´ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰\n            // object.material.opacity = 0.8;\n            // object.material.transparent = true;\n          }\n          // ã‚¹ã‚±ãƒ¼ãƒ«å¤‰æ›´ã‚’å‰Šé™¤ï¼ˆå¤§ãããªã‚‹åŸå› ï¼‰\n\n          canvas.style.cursor = 'move';\n          console.log(`ğŸ”„ Started moving: ${object.name} (Shift-free interaction)`);\n\n          // é¸æŠçŠ¶æ…‹ã‚‚æ›´æ–°\n          this.selectObject(object);\n        } else {\n          // é€šå¸¸ã‚¯ãƒªãƒƒã‚¯: é¸æŠã®ã¿\n          this.selectObject(object);\n        }\n      } else {\n        this.deselectObject();\n      }\n    });\n    \n    canvas.addEventListener('mousemove', (event) => {\n      // ãƒ‰ãƒ©ãƒƒã‚°ä¸­ã§ãªã„å ´åˆã¯ãƒ›ãƒãƒ¼ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’å‡¦ç†\n      if (!isDragging) {\n        this.handleHoverEffects(event, canvas);\n        return;\n      }\n      \n      // ãƒ‰ãƒ©ãƒƒã‚°ä¸­ã®å‡¦ç†\n      if (!dragObject) return;\n      \n      // ãƒã‚¦ã‚¹ã®ç§»å‹•é‡ã‚’è¨ˆç®—\n      const deltaX = event.clientX - mouseStart.x;\n      const deltaY = event.clientY - mouseStart.y;\n\n      if (dragMode === 'resize') {\n        // ãƒªã‚µã‚¤ã‚ºãƒ¢ãƒ¼ãƒ‰: ã‚ˆã‚Šç›´æ„Ÿçš„ãªæ–¹å‘è¨ˆç®—\n        if (!this.resizeHandleInfo) {\n          console.error('âŒ Resize handle info missing');\n          return;\n        }\n        \n        const corner = this.resizeHandleInfo.corner;\n        let scaleMultiplier = 1;\n        \n        // å„ãƒãƒ³ãƒ‰ãƒ«ã®ä½ç½®ã«å¿œã˜ãŸç›´æ„Ÿçš„ãªæ–¹å‘è¨ˆç®—\n        switch(corner) {\n          case 'top-right': \n            // å³ä¸Šãƒãƒ³ãƒ‰ãƒ«: å³ä¸Šæ–¹å‘ã«å¼•ã£å¼µã‚‹ã¨æ‹¡å¤§\n            scaleMultiplier = (deltaX > 0 && deltaY < 0) ? 1 + (Math.abs(deltaX) + Math.abs(deltaY)) * 0.001 : 1 - (Math.abs(deltaX) + Math.abs(deltaY)) * 0.001;\n            break;\n          case 'top-left':\n            // å·¦ä¸Šãƒãƒ³ãƒ‰ãƒ«: å·¦ä¸Šæ–¹å‘ã«å¼•ã£å¼µã‚‹ã¨æ‹¡å¤§\n            scaleMultiplier = (deltaX < 0 && deltaY < 0) ? 1 + (Math.abs(deltaX) + Math.abs(deltaY)) * 0.001 : 1 - (Math.abs(deltaX) + Math.abs(deltaY)) * 0.001;\n            break;\n          case 'bottom-right':\n            // å³ä¸‹ãƒãƒ³ãƒ‰ãƒ«: å³ä¸‹æ–¹å‘ã«å¼•ã£å¼µã‚‹ã¨æ‹¡å¤§\n            scaleMultiplier = (deltaX > 0 && deltaY > 0) ? 1 + (Math.abs(deltaX) + Math.abs(deltaY)) * 0.001 : 1 - (Math.abs(deltaX) + Math.abs(deltaY)) * 0.001;\n            break;\n          case 'bottom-left':\n            // å·¦ä¸‹ãƒãƒ³ãƒ‰ãƒ«: å·¦ä¸‹æ–¹å‘ã«å¼•ã£å¼µã‚‹ã¨æ‹¡å¤§\n            scaleMultiplier = (deltaX < 0 && deltaY > 0) ? 1 + (Math.abs(deltaX) + Math.abs(deltaY)) * 0.001 : 1 - (Math.abs(deltaX) + Math.abs(deltaY)) * 0.001;\n            break;\n          default:\n            scaleMultiplier = 1 + (deltaX + deltaY) * 0.001; // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯\n        }\n        \n        const newScale = Math.max(0.1, Math.min(5.0, originalScale.x * scaleMultiplier));\n        dragObject.scale.setScalar(newScale);\n\n        // é¸æŠã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã‚‚æ›´æ–°ï¼ˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ï¼‰\n        this.updateSelectionIndicatorScale(dragObject);\n\n      } else if (dragMode === 'move') {\n        // ç§»å‹•ãƒ¢ãƒ¼ãƒ‰ï¼ˆå¾“æ¥ã®å‡¦ç†ï¼‰\n        const cameraRight = new THREE.Vector3();\n        const cameraUp = new THREE.Vector3();\n        this.camera.getWorldDirection(new THREE.Vector3()); // dummy call to update matrix\n        cameraRight.setFromMatrixColumn(this.camera.matrixWorld, 0).normalize();\n        cameraUp.setFromMatrixColumn(this.camera.matrixWorld, 1).normalize();\n\n        // ãƒã‚¦ã‚¹ç§»å‹•ã‚’ãƒ¯ãƒ¼ãƒ«ãƒ‰åº§æ¨™ã«å¤‰æ›\n        const moveScale = 0.01;\n        const worldMove = new THREE.Vector3()\n          .add(cameraRight.clone().multiplyScalar(deltaX * moveScale))\n          .add(cameraUp.clone().multiplyScalar(-deltaY * moveScale));\n\n        dragObject.position.add(worldMove);\n        mouseStart.set(event.clientX, event.clientY);\n      }\n    });\n    \n    canvas.addEventListener('mouseup', () => {\n      if (isDragging && dragObject) {\n        // ãƒ‰ãƒ©ãƒƒã‚°çµ‚äº†ã®å‡¦ç†\n        if (dragObject.material) {\n          dragObject.material.opacity = 1.0;\n          dragObject.material.transparent = false;\n        }\n\n        // ã‚¹ã‚±ãƒ¼ãƒ«ã‚’å…ƒã«æˆ»ã™ï¼ˆç§»å‹•é–‹å§‹æ™‚ã«å¤‰æ›´ã—ãŸå ´åˆï¼‰\n        // ç¾åœ¨ã¯ç§»å‹•é–‹å§‹æ™‚ã®ã‚¹ã‚±ãƒ¼ãƒ«å¤‰æ›´ã‚’å‰Šé™¤ã—ãŸã®ã§ã€ã“ã®å‡¦ç†ã¯ä¸è¦\n\n        console.log(`âœ… Finished dragging: ${dragObject.name} to (${dragObject.position.x.toFixed(1)}, ${dragObject.position.y.toFixed(1)}, ${dragObject.position.z.toFixed(1)})`);\n\n        isDragging = false;\n        dragObject = null;\n        dragMode = 'move'; // ãƒªã‚»ãƒƒãƒˆ\n        this.resizeHandleInfo = null; // ãƒªã‚µã‚¤ã‚ºãƒãƒ³ãƒ‰ãƒ«æƒ…å ±ã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—\n        canvas.style.cursor = 'default';\n      }\n    });\n    \n    // Shift+ãƒ›ã‚¤ãƒ¼ãƒ«ã§ãƒªã‚µã‚¤ã‚ºæ©Ÿèƒ½ã‚’è¿½åŠ \n    canvas.addEventListener('wheel', (event) => {\n      event.preventDefault();\n      \n      const rect = canvas.getBoundingClientRect();\n      const mouse = new THREE.Vector2();\n      mouse.x = ((event.clientX - rect.left) / rect.width) * 2 - 1;\n      mouse.y = -((event.clientY - rect.top) / rect.height) * 2 + 1;\n      \n      this.raycaster.setFromCamera(mouse, this.camera);\n      const intersects = this.raycaster.intersectObjects(this.experimentGroup.children, true);\n      \n      if (intersects.length > 0) {\n        const obj = intersects[0].object;\n        // ç”Ÿæˆã•ã‚ŒãŸç”»åƒãƒ»å‹•ç”»ãƒ»3Dãƒ¢ãƒ‡ãƒ«å¯¾è±¡ï¼ˆShiftä¸è¦ã®ç›´æ„Ÿçš„æ“ä½œï¼‰\n        if (obj.userData && (obj.userData.type === 'generated_image' || obj.userData.type === 'generated_video' || obj.userData.type === 'generated_3d_model')) {\n          const scaleFactor = event.deltaY > 0 ? 0.9 : 1.1;\n          const newScale = obj.scale.x * scaleFactor;\n          \n          // æœ€å°ãƒ»æœ€å¤§ã‚µã‚¤ã‚ºåˆ¶é™\n          if (newScale >= 0.2 && newScale <= 5.0) {\n            obj.scale.setScalar(newScale);\n            \n            // é«˜å“è³ªãªè¦–è¦šãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯\n            if (obj.material) {\n              obj.material.emissive.setHex(0x333333);\n              setTimeout(() => {\n                if (obj.material) {\n                  obj.material.emissive.setHex(0x000000);\n                }\n              }, 150);\n            }\n            \n            console.log(`ğŸ”„ Resized ${obj.userData.type}: ${obj.name} to scale ${newScale.toFixed(2)} (Shift-free interaction)`);\n          }\n        }\n      }\n    });\n\n    // é¸æŠã—ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®è§’åº¦èª¿æ•´ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«\n    document.addEventListener('keydown', (event) => {\n      const activeEl = document.activeElement;\n      if (activeEl && (activeEl.tagName === 'INPUT' || activeEl.tagName === 'TEXTAREA' || activeEl.isContentEditable)) {\n        return;\n      }\n      if (!this.selectedObject) return;\n      \n      const object = this.selectedObject;\n      // ç”Ÿæˆã•ã‚ŒãŸç”»åƒãƒ»å‹•ç”»ã®ã¿è§’åº¦èª¿æ•´å¯èƒ½\n      if (!object.userData || (object.userData.type !== 'generated_image' && object.userData.type !== 'generated_video')) {\n        return;\n      }\n      \n      const rotationStep = Math.PI / 36; // 5åº¦ãšã¤å›è»¢\n      let rotated = false;\n      \n      switch (event.key) {\n        case 'ArrowLeft':\n          object.rotation.y -= rotationStep;\n          rotated = true;\n          break;\n        case 'ArrowRight':\n          object.rotation.y += rotationStep;\n          rotated = true;\n          break;\n        case 'ArrowUp':\n          // Xè»¸å›è»¢ã¯åˆ¶é™ï¼ˆ-30åº¦ã‹ã‚‰+30åº¦ã¾ã§ï¼‰\n          const newRotationX = object.rotation.x - rotationStep;\n          if (newRotationX >= -Math.PI/6 && newRotationX <= Math.PI/6) {\n            object.rotation.x = newRotationX;\n            rotated = true;\n          }\n          break;\n        case 'ArrowDown':\n          // Xè»¸å›è»¢ã¯åˆ¶é™ï¼ˆ-30åº¦ã‹ã‚‰+30åº¦ã¾ã§ï¼‰\n          const newRotationXDown = object.rotation.x + rotationStep;\n          if (newRotationXDown >= -Math.PI/6 && newRotationXDown <= Math.PI/6) {\n            object.rotation.x = newRotationXDown;\n            rotated = true;\n          }\n          break;\n        case 'r':\n        case 'R':\n          // ãƒªã‚»ãƒƒãƒˆï¼šæ­£é¢å‘ãã«æˆ»ã™\n          object.rotation.x = 0;\n          // ã‚«ãƒ¡ãƒ©ã®è¦–ç·šæ–¹å‘ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ¢ãƒ‹ã‚¿ãƒ¼ã§è¦‹ã¦ã„ã‚‹æ–¹å‘ï¼‰ã«å‘ã‘ã‚‹\n          const cameraDirection = new THREE.Vector3();\n          this.camera.getWorldDirection(cameraDirection);\n          const targetPoint = object.position.clone().add(cameraDirection.multiplyScalar(-1));\n          object.lookAt(targetPoint);\n          object.rotation.x = 0; // ãŠè¾å„€é˜²æ­¢\n          rotated = true;\n          console.log(`ğŸ”„ Reset rotation for: ${object.name}`);\n          break;\n\n        case 'i':\n        case 'I':\n          // ãƒ‡ãƒãƒƒã‚°æƒ…å ±è¡¨ç¤º\n          this.debugSceneInfo();\n          event.preventDefault();\n          break;\n      }\n      \n      if (rotated) {\n        event.preventDefault();\n        const angles = {\n          x: (object.rotation.x * 180 / Math.PI).toFixed(1),\n          y: (object.rotation.y * 180 / Math.PI).toFixed(1),\n          z: (object.rotation.z * 180 / Math.PI).toFixed(1)\n        };\n        console.log(`ğŸ”„ Rotated ${object.userData.type}: ${object.name} to (${angles.x}Â°, ${angles.y}Â°, ${angles.z}Â°)`);\n      }\n    });\n\n    console.log('ğŸ–±ï¸ Object dragging system enabled (Drag to move objects - Shift-free interaction)');\n    console.log('ğŸ”„ Object resizing system enabled (Scroll to resize images/videos - Shift-free interaction)');\n    console.log('ğŸ¯ Angle adjustment enabled (Select object + Arrow keys to rotate, R to reset)');\n  }\n\n  handleHoverEffects(event, canvas) {\n    // ãƒ¬ã‚¤ã‚­ãƒ£ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã§ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæ¤œå‡º\n    const rect = canvas.getBoundingClientRect();\n    this.mouse.x = ((event.clientX - rect.left) / rect.width) * 2 - 1;\n    this.mouse.y = -((event.clientY - rect.top) / rect.height) * 2 + 1;\n    \n    this.raycaster.setFromCamera(this.mouse, this.camera);\n\n    // ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ãã®å­ï¼ˆé¸æŠã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼å«ã‚€ï¼‰ã‚’æ¤œå‡ºå¯¾è±¡ã«\n    const intersects = this.raycaster.intersectObjects(this.experimentGroup.children, true);\n    \n    // å‰å›ãƒ›ãƒãƒ¼ã—ã¦ã„ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’ãƒªã‚»ãƒƒãƒˆ\n    if (this.lastHoveredObject && this.lastHoveredObject.onHoverExit) {\n      this.lastHoveredObject.onHoverExit();\n      this.lastHoveredObject = null;\n    }\n    \n    // æ–°ã—ã„ãƒ›ãƒãƒ¼å¯¾è±¡ã‚’æ¤œå‡º\n    if (intersects.length > 0) {\n      const object = intersects[0].object;\n      \n      // ãƒªã‚µã‚¤ã‚ºãƒãƒ³ãƒ‰ãƒ«ã«ãƒ›ãƒãƒ¼ã—ãŸå ´åˆ\n      if (object.userData && object.userData.isResizeHandle && object.onHover) {\n        object.onHover();\n        this.lastHoveredObject = object;\n        return;\n      }\n      \n      // é€šå¸¸ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ãƒ›ãƒãƒ¼ã—ãŸå ´åˆ\n      if (object.userData && (object.userData.type === 'generated_image' || object.userData.type === 'generated_video')) {\n        // ç§»å‹•å¯èƒ½ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å ´åˆã¯ã‚«ãƒ¼ã‚½ãƒ«ã‚’å¤‰æ›´\n        canvas.style.cursor = 'move';\n\n        this.lastHoveredObject = { onHoverExit: () => { canvas.style.cursor = 'default'; } };\n        return;\n      }\n    }\n    \n    // ãƒ›ãƒãƒ¼å¯¾è±¡ãŒãªã„å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚«ãƒ¼ã‚½ãƒ«\n    canvas.style.cursor = 'default';\n  }\n\n  /**\n   * ãƒ¡ã‚¤ãƒ³ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ\n   * @param {string} command - è‡ªç„¶è¨€èªã‚³ãƒãƒ³ãƒ‰\n   */\n  async executeCommand(command) {\n    const timestamp = Date.now();\n    console.log(`ğŸ¯ Executing: \"${command}\"`);\n    \n    try {\n      // ã‚³ãƒãƒ³ãƒ‰è§£æ\n      const parsed = this.parseCommand(command);\n      console.log('ğŸ“ Parsed:', parsed);\n      \n      // ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ\n      const result = await this.dispatchCommand(parsed);\n      \n      // å±¥æ­´ã«è¨˜éŒ²\n      this.commandHistory.push({\n        timestamp,\n        command,\n        parsed,\n        result,\n        status: 'success'\n      });\n      \n      return result;\n      \n    } catch (error) {\n      console.error('âŒ Command execution failed:', error);\n      \n      this.commandHistory.push({\n        timestamp,\n        command,\n        error: error.message,\n        status: 'error'\n      });\n      \n      throw error;\n    }\n  }\n\n  /**\n   * è‡ªç„¶è¨€èªã‚³ãƒãƒ³ãƒ‰è§£æ\n   * @param {string} command \n   * @returns {object} è§£æçµæœ\n   */\n  parseCommand(command) {\n    // ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã§ãƒ¢ãƒ¼ãƒ‰ã‚’åˆ¤å®š\n    if (command.startsWith('[å¤‰æ›´] ')) {\n      const actualCommand = command.replace('[å¤‰æ›´] ', '');\n      return this.parseObjectModificationCommand(actualCommand.toLowerCase().trim());\n    }\n    \n    if (command.startsWith('[å‰Šé™¤] ')) {\n      const actualCommand = command.replace('[å‰Šé™¤] ', '');\n      return this.parseDeleteCommand(actualCommand.toLowerCase().trim());\n    }\n    \n    // å‹•ç”»ç”Ÿæˆã®åˆ¤å®šï¼ˆãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ãªã— = ç”Ÿæˆãƒ¢ãƒ¼ãƒ‰ï¼‰\n    const cmd = command.toLowerCase().trim();\n    \n    // è‡ªç„¶è¨€èªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæ“ä½œã®åˆ¤å®šï¼ˆã€Œã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå + å‹•ä½œã€ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰\n    const naturalLanguagePattern = this.parseNaturalLanguageCommand(cmd);\n    if (naturalLanguagePattern) {\n      return naturalLanguagePattern;\n    }\n    \n    // å‹•ç”»é–¢é€£ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆæ–‡è„ˆã‚’è€ƒæ…®ï¼‰\n    const videoKeywords = ['å‹•ç”»', 'ãƒ“ãƒ‡ã‚ª', 'ãƒ ãƒ¼ãƒ“ãƒ¼', 'æ˜ åƒ', 'å‹•ã',\n                          'video', 'movie', 'motion', 'moving', 'clip'];\n\n    // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã¯æ–‡è„ˆã§åˆ¤å®š\n    const isAnimationForVideo = cmd.includes('ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³') &&\n      (cmd.includes('ä½œã£ã¦') || cmd.includes('ç”Ÿæˆ') || cmd.includes('ã‚’') ||\n       cmd.includes('create') || cmd.includes('make') || cmd.includes('generate'));\n\n    const isVideoRequest = videoKeywords.some(keyword => cmd.includes(keyword)) ||\n      (cmd.includes('animate') && !cmd.includes('ã‚’')) || // \"animate a cat\"ã¯å‹•ç”»ã€\"çŒ«ã‚’animate\"ã¯æ“ä½œ\n      isAnimationForVideo;\n    \n    if (isVideoRequest) {\n      return {\n        type: 'video_generation',\n        prompt: command,\n        position: this.parsePosition(cmd),\n        size: this.parseSize(cmd)\n      };\n    }\n    \n    // ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆé¸æŠé–¢é€£ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’ãƒã‚§ãƒƒã‚¯\n    const selectKeywords = ['é¸æŠ', 'select', 'ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆé¸æŠ', 'æ—¢å­˜', 'existing'];\n    const isSelectRequest = selectKeywords.some(keyword => cmd.includes(keyword));\n    \n    if (isSelectRequest) {\n      return {\n        type: 'object_selection',\n        position: this.parsePosition(cmd)\n      };\n    }\n    \n    // ãƒ•ã‚¡ã‚¤ãƒ«ã‚¤ãƒ³ãƒãƒ¼ãƒˆé–¢é€£ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’ãƒã‚§ãƒƒã‚¯\n    const importKeywords = ['ã‚¤ãƒ³ãƒãƒ¼ãƒˆ', 'import', 'èª­ã¿è¾¼', 'èª­è¾¼', 'ãƒ•ã‚¡ã‚¤ãƒ«', 'file', 'ç”»åƒã‚’é¸æŠ', 'å‹•ç”»ã‚’é¸æŠ', 'é¸æŠã—ã¦é…ç½®'];\n    const isImportRequest = importKeywords.some(keyword => cmd.includes(keyword));\n    \n    if (isImportRequest) {\n      const isVideoImport = cmd.includes('å‹•ç”»') || cmd.includes('video') || cmd.includes('mp4');\n      return {\n        type: 'file_import',\n        fileType: isVideoImport ? 'video' : 'image',\n        position: this.parsePosition(cmd),\n        size: this.parseSize(cmd)\n      };\n    }\n    \n    // ç”»åƒç”Ÿæˆã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’ãƒã‚§ãƒƒã‚¯\n    const imageKeywords = ['ç”»åƒ', 'å†™çœŸ', 'ã‚¤ãƒ¡ãƒ¼ã‚¸', 'çµµ', 'ãƒ”ã‚¯ãƒãƒ£ãƒ¼', \n                          'image', 'picture', 'photo', 'generate', 'create', 'make', 'draw'];\n    const isImageRequest = imageKeywords.some(keyword => cmd.includes(keyword));\n    \n    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: ç”»åƒç”Ÿæˆã¨ã—ã¦å‡¦ç†\n    return {\n      type: 'image_generation',\n      prompt: command,\n      position: this.parsePosition(cmd),\n      size: this.parseSize(cmd)\n    };\n  }\n\n  /**\n   * ã‚³ãƒãƒ³ãƒ‰ã‹ã‚‰å¯¾è±¡ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç‰¹å®š\n   */\n  /**\n   * ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆè­˜åˆ¥ç”¨ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰è¾æ›¸ã‚’å–å¾—\n   */\n  getObjectKeywords() {\n    return createObjectKeywords();\n  }\n\n  normalizeTargetPhrase(phrase) {\n    if (!phrase) {\n      return '';\n    }\n\n    let result = `${phrase}`.trim();\n\n    result = result.replace(/[ã€‚ã€ï¼Œ,.!?ï¼ï¼Ÿ]/g, ' ').trim();\n\n    const referentialPattern = /^(ã•ã£ã|å…ˆã»ã©|ç›´å‰|æœ€è¿‘|ã“ã®å‰|ãã®|ã‚ã®|ã“ã®|å‰å›|å‰ã®|æœ€æ–°|æœ€å¾Œ|last|latest)\\s*(ã®)?/i;\n    while (referentialPattern.test(result)) {\n      result = result.replace(referentialPattern, '').trim();\n    }\n\n    const politePattern = /(ã—ã¦ãã ã•ã„|ã—ã¦ä¸‹ã•ã„|ã—ã¦ã­|ã—ã¦ã‚ˆ|ã—ã¦ãã‚Œ|ã—ã¦ãã‚Œã¾ã›ã‚“ã‹|ã—ã¦ãã ã•ã„ã­|ã—ã¦ãã ã•ã„ã‚ˆ|ãŠé¡˜ã„ã—ã¾ã™?|ãŠé¡˜ã„|é ¼ã‚€)$/i;\n    result = result.replace(politePattern, '').trim();\n\n    const trailingPatterns = [\n      /(ã‚’)?(å·¦å³åè»¢|åè»¢|å‰Šé™¤|æ¶ˆã—ã¦|æ¶ˆã™|å¤‰æ›´|å¤‰ãˆã¦|å¡—ã‚Šæ›¿ãˆã¦|å¡—ã£ã¦|å›è»¢|å›ã—ã¦|ç§»å‹•|å‹•ã‹ã—ã¦|æ‹¡å¤§|ç¸®å°|å¤§ãã|å°ã•ã|ä¸¦ã¹|å¯„ã›ã¦|æ•´åˆ—|é¸æŠ|é¸ã‚“ã§|æŒ‡å®š|ç”Ÿæˆ|ä½œã£ã¦|æã„ã¦|ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰|ã‚¢ãƒƒãƒ—ã—ã¦|èª­ã¿è¾¼ã‚“ã§|èª­ã¿è¾¼ã‚“ã |é–‹ã„ã¦|é–‰ã˜ã¦|ç½®ã„ã¦|é…ç½®ã—ã¦|è²¼ã‚Šä»˜ã‘ã¦|flip|delete|remove|change|make|turn|rotate|move|scale|resize|generate|create).*$/i,\n      /(ã‚’|ã«|ã¸|ã§|ã‹ã‚‰|ã¾ã§|ã¨|ã‚„|ã£ã¦)$/i\n    ];\n\n    for (const pattern of trailingPatterns) {\n      result = result.replace(pattern, '').trim();\n    }\n\n    result = result.replace(/(ã‚’|ã«|ã¸|ã§|ã‹ã‚‰|ã¾ã§|ã¨|ã‚„|ã£ã¦)$/i, '').trim();\n\n    if (!result) {\n      const englishLeadingPattern = /^(flip|delete|remove|change|make|turn|rotate|move|scale|resize|generate|create)\\s+/i;\n      if (englishLeadingPattern.test(phrase.trim())) {\n        result = phrase.trim().replace(englishLeadingPattern, '').trim();\n      }\n    }\n\n    result = result.replace(/(ã‚’|ã«|ã¸|ã§|ã‹ã‚‰|ã¾ã§|ã¨|ã‚„|ã£ã¦)$/i, '').trim();\n\n    return result;\n  }\n\n  isReferentialCommand(command) {\n    if (!command) {\n      return false;\n    }\n    return /(ã•ã£ã|å…ˆã»ã©|ç›´å‰|æœ€è¿‘|å‰å›|å‰ã®|æœ€å¾Œ|æœ€æ–°|last|previous|before)/i.test(command);\n  }\n\n  getObjectSourceType(object) {\n    if (!object || !object.userData) {\n      return null;\n    }\n    return object.userData.source || object.userData.type || null;\n  }\n\n  getRecentObjects(command) {\n    const objects = Array.from(this.spawnedObjects.values());\n    if (objects.length === 0) {\n      return [];\n    }\n\n    const importContext = /(ã‚¤ãƒ³ãƒãƒ¼ãƒˆ|å–ã‚Šè¾¼|ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰|èª­ã¿è¾¼)/.test(command);\n    const generatedContext = /(ç”Ÿæˆ|ä½œã£|æã„|create|generate)/.test(command);\n\n    let candidates = objects;\n    if (importContext) {\n      candidates = candidates.filter(obj => this.getObjectSourceType(obj) === 'imported_file');\n    } else if (generatedContext) {\n      candidates = candidates.filter(obj => {\n        const source = this.getObjectSourceType(obj);\n        return source === 'generated_image' || source === 'generated_video';\n      });\n    }\n\n    if (candidates.length === 0) {\n      candidates = objects;\n    }\n\n    return candidates.sort((a, b) => {\n      const aTime = a.userData?.lastModified || a.userData?.createdAt || 0;\n      const bTime = b.userData?.lastModified || b.userData?.createdAt || 0;\n      return bTime - aTime;\n    });\n  }\n\n  findRecentObjectByContext(command, normalizedTarget, objectKeywords) {\n    const candidates = this.getRecentObjects(command);\n    if (candidates.length === 0) {\n      return null;\n    }\n\n    if (normalizedTarget) {\n      for (const candidate of candidates) {\n        if (this.matchesObjectName(candidate, normalizedTarget, objectKeywords)) {\n          return candidate;\n        }\n      }\n    }\n\n    return candidates[0];\n  }\n\n  extractTextTokens(text) {\n    if (!text) {\n      return [];\n    }\n\n    return text\n      .replace(/[ã€‚ã€ï¼Œ,.!?ï¼ï¼Ÿ]/g, ' ')\n      .split(/[\\s_/\\-]+/)\n      .map(token => token.trim())\n      .filter(token => token.length > 1);\n  }\n\n  buildObjectKeywordHints({ prompt = '', fileName = '', baseType = null } = {}) {\n    const keywords = new Set();\n\n    if (prompt) {\n      keywords.add(prompt.toLowerCase());\n      for (const token of this.extractTextTokens(prompt)) {\n        keywords.add(token.toLowerCase());\n      }\n    }\n\n    if (fileName) {\n      const baseName = fileName.replace(/\\.[^/.]+$/, '');\n      keywords.add(baseName.toLowerCase());\n      for (const token of this.extractTextTokens(baseName)) {\n        keywords.add(token.toLowerCase());\n      }\n    }\n\n    if (baseType === 'image') {\n      ['image', 'photo', 'picture', 'ç”»åƒ', 'å†™çœŸ', 'ã‚¤ãƒ¡ãƒ¼ã‚¸'].forEach(keyword => keywords.add(keyword));\n    } else if (baseType === 'video') {\n      ['video', 'movie', 'clip', 'å‹•ç”»', 'ãƒ“ãƒ‡ã‚ª', 'ãƒ ãƒ¼ãƒ“ãƒ¼', 'æ˜ åƒ'].forEach(keyword => keywords.add(keyword));\n    }\n\n    return Array.from(keywords).filter(Boolean);\n  }\n\n  findObjectByKeyword(command) {\n    // å…±é€šç¿»è¨³è¾æ›¸ã‹ã‚‰æ‹¡å¼µã•ã‚ŒãŸã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰è¾æ›¸ã‚’ä½¿ç”¨\n    const objectKeywords = this.getObjectKeywords();\n    const normalizedCommand = this.normalizeTargetPhrase(command);\n\n    // ã‚¤ãƒ³ãƒãƒ¼ãƒˆé †åºã§ã®æŒ‡å®šã‚’è§£æï¼ˆä¾‹: \"2ç•ªç›®ã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ãŸçŒ«\", \"æœ€åˆã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ãŸãƒ¦ãƒ‹ã‚³ãƒ¼ãƒ³\"ï¼‰\n    const importOrderMatch = command.match(/((\\d+)ç•ªç›®|æœ€åˆ|åˆå›|1ç•ªç›®)ã«(ã‚¤ãƒ³ãƒãƒ¼ãƒˆ|å–ã‚Šè¾¼)ã—ãŸ(.+)/);\n    if (importOrderMatch) {\n      let orderNumber = 1; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯1ç•ªç›®\n      if (importOrderMatch[2]) {\n        // æ•°å­—ãŒæŒ‡å®šã•ã‚Œã¦ã„ã‚‹å ´åˆ\n        orderNumber = parseInt(importOrderMatch[2]);\n      } else if (importOrderMatch[1] === 'æœ€åˆ' || importOrderMatch[1] === 'åˆå›') {\n        orderNumber = 1;\n      } else if (importOrderMatch[1] === '1ç•ªç›®') {\n        orderNumber = 1;\n      }\n      const objectName = this.normalizeTargetPhrase(importOrderMatch[4]) || importOrderMatch[4].trim();\n      return this.findImportedObjectByOrder(objectName, orderNumber, objectKeywords);\n    }\n\n    // ã‚¤ãƒ³ãƒãƒ¼ãƒˆ vs ç”Ÿæˆã®åŒºåˆ¥ï¼ˆä¾‹: \"ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ãŸçŒ«\", \"ç”Ÿæˆã—ãŸçŠ¬\", \"ä½œã£ãŸç”»åƒ\"ï¼‰\n    const sourceMatch = command.match(/(ã‚¤ãƒ³ãƒãƒ¼ãƒˆ|å–ã‚Šè¾¼|ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰|èª­ã¿è¾¼|ç”Ÿæˆ|ä½œã£ãŸ)ã—ãŸ?(.+)/);\n    if (sourceMatch) {\n      const sourceType = sourceMatch[1];\n      const objectName = this.normalizeTargetPhrase(sourceMatch[2]) || sourceMatch[2].trim();\n      const isImported = sourceType === 'ã‚¤ãƒ³ãƒãƒ¼ãƒˆ' || sourceType === 'å–ã‚Šè¾¼';\n      return this.findObjectBySourceAndName(objectName, isImported, objectKeywords);\n    }\n\n    if (this.isReferentialCommand(command)) {\n      const recentObject = this.findRecentObjectByContext(command, normalizedCommand, objectKeywords);\n      if (recentObject) {\n        return recentObject;\n      }\n    }\n\n    // å¾“æ¥ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢ï¼ˆã™ã¹ã¦ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå¯¾è±¡ï¼‰\n    return this.findObjectByName(normalizedCommand || command, objectKeywords);\n  }\n\n  /**\n   * ã‚¤ãƒ³ãƒãƒ¼ãƒˆé †åºã§ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ¤œç´¢\n   */\n  findImportedObjectByOrder(objectName, orderNumber, objectKeywords) {\n    // ã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã¿ã‚’å–å¾—ã—ã¦importOrderé †ã§ã‚½ãƒ¼ãƒˆ\n    const importedObjects = [];\n    for (const child of this.spawnedObjects.values()) {\n      if (!child.userData || this.getObjectSourceType(child) !== 'imported_file') continue;\n      importedObjects.push(child);\n    }\n\n    // importOrderã§ã‚½ãƒ¼ãƒˆ\n    importedObjects.sort((a, b) => (a.userData.importOrder || 0) - (b.userData.importOrder || 0));\n\n    // ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆåã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°\n    const matchingObjects = objectName\n      ? importedObjects.filter(child => this.matchesObjectName(child, objectName, objectKeywords))\n      : importedObjects;\n\n    if (matchingObjects.length >= orderNumber) {\n      const foundObject = matchingObjects[orderNumber - 1]; // 1-based index\n      console.log(`ğŸ¯ Found ${orderNumber}ç•ªç›® imported object \"${objectName}\": ${foundObject.name}`);\n      return foundObject;\n    }\n\n    console.warn(`âš ï¸ ${orderNumber}ç•ªç›®ã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ãŸ\"${objectName}\"ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“`);\n    return null;\n  }\n\n  /**\n   * ã‚½ãƒ¼ã‚¹ï¼ˆã‚¤ãƒ³ãƒãƒ¼ãƒˆ/ç”Ÿæˆï¼‰ã¨åå‰ã§ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ¤œç´¢\n   */\n  findObjectBySourceAndName(objectName, isImported, objectKeywords) {\n    for (const child of this.spawnedObjects.values()) {\n      if (!child.userData) continue;\n\n      const childSource = this.getObjectSourceType(child);\n      const isChildImported = childSource === 'imported_file';\n      const isChildGenerated = childSource === 'generated_image' || childSource === 'generated_video';\n\n      if (isImported && !isChildImported) continue;\n      if (!isImported && !isChildGenerated) continue;\n\n      if (this.matchesObjectName(child, objectName, objectKeywords)) {\n        const sourceLabel = isImported ? 'ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ãŸ' : 'ç”Ÿæˆã—ãŸ';\n        console.log(`ğŸ¯ Found ${sourceLabel} object \"${objectName}\": ${child.name}`);\n        return child;\n      }\n    }\n\n    const sourceLabel = isImported ? 'ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ãŸ' : 'ç”Ÿæˆã—ãŸ';\n    console.warn(`âš ï¸ ${sourceLabel}\"${objectName}\"ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“`);\n    return null;\n  }\n\n  /**\n   * åå‰ã§ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ¤œç´¢ï¼ˆå¾“æ¥ã®æ–¹å¼ï¼‰\n   */\n  findObjectByName(command, objectKeywords) {\n    const target = command && command.trim();\n    if (!target) {\n      return null;\n    }\n\n    for (const child of this.spawnedObjects.values()) {\n      if (!child) continue;\n      if (this.matchesObjectName(child, target, objectKeywords)) {\n        return child;\n      }\n    }\n    return null;\n  }\n\n  /**\n   * ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒæŒ‡å®šã•ã‚ŒãŸåå‰ã«ãƒãƒƒãƒã™ã‚‹ã‹ãƒã‚§ãƒƒã‚¯\n   */\n  matchesObjectName(child, objectName, objectKeywords) {\n    if (!child || !objectName) {\n      return false;\n    }\n\n    const targetLower = objectName.toLowerCase();\n\n    if (child.userData && Array.isArray(child.userData.keywords)) {\n      for (const keyword of child.userData.keywords) {\n        if (!keyword) continue;\n        const keywordLower = keyword.toLowerCase();\n        if (targetLower.includes(keywordLower) || keywordLower.includes(targetLower)) {\n          return true;\n        }\n      }\n    }\n\n    for (const [keyword, aliases] of Object.entries(objectKeywords)) {\n      const keywordLower = keyword.toLowerCase();\n      if (targetLower.includes(keywordLower)) {\n        return true;\n      }\n\n      for (const alias of aliases) {\n        const aliasLower = alias.toLowerCase();\n        if (targetLower.includes(aliasLower)) {\n          return true;\n        }\n      }\n    }\n\n    if (child.userData && child.userData.prompt) {\n      const promptLower = child.userData.prompt.toLowerCase();\n      if (promptLower.includes(targetLower) || targetLower.includes(promptLower)) {\n        return true;\n      }\n    }\n\n    if (child.userData && child.userData.fileName) {\n      if (matchKeywordWithFilename(objectName, child.userData.fileName, objectKeywords)) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  /**\n   * ç”»åƒç”Ÿæˆã‚³ãƒãƒ³ãƒ‰è§£æ\n   */\n  parseImageGenerationCommand(command) {\n    // ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæŠ½å‡º (ã€Œã‚’ã€ã€Œã«ã€ã€Œã§ã€ãªã©ã§åŒºåˆ‡ã‚‹)\n    let prompt = command;\n    const particles = ['ã‚’', 'ã«', 'ã§', 'ã®'];\n    \n    for (const particle of particles) {\n      if (command.includes(particle)) {\n        const parts = command.split(particle);\n        if (parts[0]) {\n          prompt = parts[0].trim();\n          break;\n        }\n      }\n    }\n    \n    // ä¸è¦ãªèªå¥ã‚’é™¤å»\n    prompt = prompt\n      .replace(/(ç”»åƒ|ä½œã£ã¦|ç”Ÿæˆ|ã—ã¦|ãã ã•ã„)/g, '')\n      .trim();\n    \n    return {\n      type: 'image_generation',\n      prompt,\n      position: this.parsePosition(command),\n      size: this.parseSize(command)\n    };\n  }\n\n  /**\n   * ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå¤‰æ›´ã‚³ãƒãƒ³ãƒ‰è§£æ\n   */\n  parseObjectModificationCommand(command) {\n    const cmd = command.toLowerCase().trim();\n    \n    // è‰²å¤‰æ›´ã®è§£æ\n    let color = null;\n    const colorMap = {\n      'èµ¤': 0xff0000, 'èµ¤è‰²': 0xff0000,\n      'é’': 0x0000ff, 'é’è‰²': 0x0000ff,\n      'ç·‘': 0x00ff00, 'ç·‘è‰²': 0x00ff00,\n      'é»„': 0xffff00, 'é»„è‰²': 0xffff00, 'é»„è‰²ã„': 0xffff00,\n      'ç´«': 0xff00ff, 'ç´«è‰²': 0xff00ff,\n      'æ©™': 0xff8800, 'æ©™è‰²': 0xff8800, 'ã‚ªãƒ¬ãƒ³ã‚¸': 0xff8800, 'ã‚ªãƒ¬ãƒ³ã‚¸è‰²': 0xff8800,\n      'ç™½': 0xffffff, 'ç™½è‰²': 0xffffff,\n      'é»’': 0x000000, 'é»’è‰²': 0x000000,\n      'ç°': 0x808080, 'ç°è‰²': 0x808080, 'ã‚°ãƒ¬ãƒ¼': 0x808080, 'ã‚°ãƒ¬ãƒ¼è‰²': 0x808080,\n      'ãƒ”ãƒ³ã‚¯': 0xffc0cb, 'ãƒ”ãƒ³ã‚¯è‰²': 0xffc0cb,\n      'èŒ¶': 0x8b4513, 'èŒ¶è‰²': 0x8b4513,\n      'éŠ€': 0xc0c0c0, 'éŠ€è‰²': 0xc0c0c0,\n      'é‡‘': 0xffd700, 'é‡‘è‰²': 0xffd700\n    };\n    \n    for (const [colorName, colorValue] of Object.entries(colorMap)) {\n      if (cmd.includes(colorName)) {\n        color = colorValue;\n        break;\n      }\n    }\n\n    // ã‚¨ãƒ•ã‚§ã‚¯ãƒˆè§£æã®è¿½åŠ \n    const effects = this.parseEffects(cmd);\n    \n    // ã‚µã‚¤ã‚ºå¤‰æ›´ã®è§£æ\n    let scale = null;\n    if (cmd.includes('å¤§ãã') || cmd.includes('æ‹¡å¤§')) {\n      scale = 1.5;\n    } else if (cmd.includes('å°ã•ã') || cmd.includes('ç¸®å°')) {\n      scale = 0.7;\n    } else if (cmd.includes('å€')) {\n      const match = cmd.match(/(\\d+(?:\\.\\d+)?)\\s*å€/);\n      if (match) {\n        scale = parseFloat(match[1]);\n      }\n    }\n    \n    // ç§»å‹•ã‚³ãƒãƒ³ãƒ‰ã®è§£æ\n    let movement = null;\n    if (cmd.includes('ç§»å‹•') || cmd.includes('å‹•ã‹') || cmd.includes('ã¸')) {\n      movement = this.parsePositionFromPrompt(cmd);\n    }\n\n    // å›è»¢ã‚³ãƒãƒ³ãƒ‰ã®è§£æ\n    let rotation = null;\n    if (cmd.includes('å›è»¢') || cmd.includes('å›ã™') || cmd.includes('å›ã—ã¦') || cmd.includes('rotate')) {\n      // è§’åº¦æŒ‡å®šãŒã‚ã‚‹ã‹ãƒã‚§ãƒƒã‚¯\n      const degreeMatch = cmd.match(/(\\d+)\\s*åº¦/);\n      if (degreeMatch) {\n        rotation = parseFloat(degreeMatch[1]) * Math.PI / 180; // åº¦ã‚’ãƒ©ã‚¸ã‚¢ãƒ³ã«å¤‰æ›\n      } else {\n        rotation = Math.PI / 4; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯45åº¦\n      }\n    }\n\n    // é€æ˜åº¦ã‚³ãƒãƒ³ãƒ‰ã®è§£æ\n    let opacity = null;\n    if (cmd.includes('é€æ˜') || cmd.includes('transparent')) {\n      if (cmd.includes('åŠé€æ˜')) {\n        opacity = 0.5;\n      } else {\n        opacity = 0.3; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®é€æ˜åº¦\n      }\n    } else if (cmd.includes('ä¸é€æ˜') || cmd.includes('opaque')) {\n      opacity = 1.0;\n    }\n\n    // åè»¢ã‚³ãƒãƒ³ãƒ‰ã®è§£æ\n    let flip = null;\n    if (cmd.includes('å·¦å³åè»¢') || cmd.includes('åè»¢') || cmd.includes('ã²ã£ãã‚Šè¿”') || cmd.includes('flip')) {\n      flip = true;\n    }\n\n    return {\n      type: 'object_modification',\n      command: command,\n      color: color,\n      scale: scale,\n      movement: movement,\n      rotation: rotation,\n      opacity: opacity,\n      flip: flip,\n      effects: effects,\n      requiresSelection: true\n    };\n  }\n\n  /**\n   * ã‚¨ãƒ•ã‚§ã‚¯ãƒˆè§£æ - Phase 2 ç·åˆã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚·ã‚¹ãƒ†ãƒ \n   */\n  parseEffects(cmd) {\n    const effects = [];\n\n    // ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰è¾æ›¸\n    const effectKeywords = {\n      // é€æ˜åº¦ç³»\n      'é€æ˜': { type: 'opacity', value: 0.0, name: 'transparent' },\n      'åŠé€æ˜': { type: 'opacity', value: 0.5, name: 'semi_transparent' },\n      'ä¸é€æ˜': { type: 'opacity', value: 1.0, name: 'opaque' },\n      'æ¿ƒã': { type: 'opacity', value: 1.0, name: 'solid' },\n\n      // ç™ºå…‰ç³»\n      'å…‰ã‚‰ã›': { type: 'glow', color: 0xffffff, intensity: 0.5, name: 'glow_white' },\n      'å…‰ã‚‹': { type: 'glow', color: 0xffffff, intensity: 0.5, name: 'glow_white' },\n      'ãƒã‚ªãƒ³': { type: 'glow', color: 0x00ffff, intensity: 0.8, name: 'neon_cyan' },\n      'ãƒ›ãƒ­ã‚°ãƒ©ãƒ ': { type: 'glow', color: 0x00ffff, intensity: 0.6, name: 'hologram' },\n\n      // æè³ªç³»\n      'ãƒ¡ã‚¿ãƒªãƒƒã‚¯': { type: 'material', metalness: 0.8, roughness: 0.2, name: 'metallic' },\n      'é‡‘å±è³ª': { type: 'material', metalness: 0.9, roughness: 0.1, name: 'metallic_shiny' },\n      'ã‚¬ãƒ©ã‚¹': { type: 'material', metalness: 0.0, roughness: 0.0, name: 'glass' },\n      'ãƒãƒƒãƒˆ': { type: 'material', metalness: 0.0, roughness: 1.0, name: 'matte' },\n\n      // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç³»\n      'ãµã‚ãµã‚': { type: 'animation', animation: 'float', speed: 0.002, amplitude: 0.5, name: 'float_gentle' },\n      'æµ®ã': { type: 'animation', animation: 'float', speed: 0.003, amplitude: 0.8, name: 'float_strong' },\n      'æ¼‚ã†': { type: 'animation', animation: 'float', speed: 0.001, amplitude: 0.3, name: 'float_slow' },\n\n      'ãƒ‰ã‚¯ãƒ‰ã‚¯': { type: 'animation', animation: 'pulse', speed: 0.003, amplitude: 0.15, name: 'pulse_heartbeat' },\n      'é¼“å‹•': { type: 'animation', animation: 'pulse', speed: 0.0025, amplitude: 0.1, name: 'pulse_heart' },\n      'è„ˆå‹•': { type: 'animation', animation: 'pulse', speed: 0.004, amplitude: 0.2, name: 'pulse_throb' },\n\n      'ãã‚‹ãã‚‹': { type: 'animation', animation: 'spin', speed: 0.02, axis: 'y', name: 'spin_y' },\n      'ã‚¹ãƒ”ãƒ³': { type: 'animation', animation: 'spin', speed: 0.03, axis: 'y', name: 'spin_fast' },\n      'å›ã‚‹': { type: 'animation', animation: 'spin', speed: 0.015, axis: 'y', name: 'spin_slow' },\n\n      'ãã‚‰ã‚': { type: 'animation', animation: 'sparkle', intensity: 0.8, name: 'sparkle' },\n      'è¼': { type: 'animation', animation: 'sparkle', intensity: 1.0, name: 'shine' },\n      'ã‚­ãƒ©ã‚­ãƒ©': { type: 'animation', animation: 'sparkle', intensity: 0.9, name: 'twinkle' },\n\n      // å®‡å®™çš„ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ\n      'å®‡å®™': { type: 'cosmic', colors: [0x4444ff, 0xff4488, 0x44ffaa], intensity: 0.9, name: 'cosmic' },\n      'ã‚ªãƒ¼ãƒ­ãƒ©': { type: 'aurora', colors: [0x00ffaa, 0x4488ff, 0xff88aa], intensity: 0.8, name: 'aurora' },\n      'æ˜Ÿé›²': { type: 'nebula', colors: [0x8844ff, 0xff8844, 0x44aaff], intensity: 1.0, name: 'nebula' },\n      'ã‚¨ãƒãƒ«ã‚®ãƒ¼': { type: 'energy', colors: [0xffaa00, 0x00aaff, 0xaa00ff], intensity: 0.7, name: 'energy' },\n      'ç¥ç§˜çš„': { type: 'mystic', colors: [0xaa44ff, 0xff44aa, 0x44ffff], intensity: 0.6, name: 'mystic' },\n\n      // ã‚¢ãƒ¼ãƒˆç³»ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ\n      'æ°´å½©': { type: 'watercolor_art', colors: [0xff6b9d, 0x4ecdc4, 0xffe66d, 0x95e1d3], opacity: 0.6, name: 'watercolor' },\n      'æ°´å½©ç”»': { type: 'watercolor_art', colors: [0xff6b9d, 0x4ecdc4, 0xffe66d, 0x95e1d3], opacity: 0.6, name: 'watercolor' },\n      'ãƒ‘ã‚¹ãƒ†ãƒ«': { type: 'pastel_art', colors: [0xffb3ba, 0xffdfba, 0xffffba, 0xbaffc9, 0xbae1ff], opacity: 0.7, name: 'pastel' },\n      'è™¹è‰²': { type: 'rainbow_glow', colors: [0xff0000, 0xff8800, 0xffff00, 0x00ff00, 0x0088ff, 0x0000ff, 0x8800ff], intensity: 0.5, name: 'rainbow_glow' }\n    };\n\n    // ãƒ—ãƒªã‚»ãƒƒãƒˆåŠ¹æœ\n    const presetEffects = {\n      'é­”æ³•ã£ã½ã': [\n        { type: 'glow', color: 0xcc44ff, intensity: 0.7, name: 'magic_glow' },\n        { type: 'animation', animation: 'pulse', speed: 0.003, amplitude: 0.1, name: 'magic_pulse' },\n        { type: 'animation', animation: 'sparkle', intensity: 0.6, name: 'magic_sparkle' }\n      ],\n      'å¹½éœŠ': [\n        { type: 'opacity', value: 0.6, name: 'ghost_transparent' },\n        { type: 'animation', animation: 'float', speed: 0.002, amplitude: 0.4, name: 'ghost_float' },\n        { type: 'glow', color: 0xffffff, intensity: 0.3, name: 'ghost_aura' }\n      ],\n      'ã‚µã‚¤ãƒãƒ¼': [\n        { type: 'glow', color: 0x00ffaa, intensity: 0.8, name: 'cyber_glow' },\n        { type: 'material', metalness: 0.8, roughness: 0.1, name: 'cyber_metal' },\n        { type: 'animation', animation: 'glitch', intensity: 0.1, name: 'cyber_glitch' }\n      ],\n      'å¤¢ã¿ãŸã„': [\n        { type: 'opacity', value: 0.7, name: 'dream_soft' },\n        { type: 'animation', animation: 'float', speed: 0.0015, amplitude: 0.3, name: 'dream_float' },\n        { type: 'animation', animation: 'rainbow', speed: 0.001, name: 'dream_rainbow' }\n      ]\n    };\n\n    // ãƒ—ãƒªã‚»ãƒƒãƒˆåŠ¹æœã‚’ãƒã‚§ãƒƒã‚¯\n    for (const [presetName, presetEffectList] of Object.entries(presetEffects)) {\n      if (cmd.includes(presetName)) {\n        effects.push(...presetEffectList);\n        console.log(`âœ¨ Preset effect applied: ${presetName}`);\n        continue;\n      }\n    }\n\n    const chromaRequested = this.requiresChromaKey(cmd);\n    const chromaConfig = chromaRequested ? this.detectChromaKeyConfig(cmd) : null;\n    const canApplyChroma = chromaConfig !== null;\n\n    // å€‹åˆ¥åŠ¹æœã‚’ãƒã‚§ãƒƒã‚¯\n    for (const [keyword, effect] of Object.entries(effectKeywords)) {\n      if (canApplyChroma && keyword === 'é€æ˜') {\n        continue;\n      }\n      if (cmd.includes(keyword)) {\n        effects.push(effect);\n        console.log(`ğŸ­ Effect detected: ${keyword} -> ${effect.name}`);\n      }\n    }\n\n    if (chromaRequested) {\n      if (canApplyChroma) {\n        effects.push({\n          type: 'chroma_key',\n          color: chromaConfig.color,\n          threshold: chromaConfig.threshold,\n          smoothing: chromaConfig.smoothing,\n          name: 'chroma_key'\n        });\n        console.log(`ğŸª„ Chroma key requested (color: #${chromaConfig.color.toString(16)}, threshold: ${chromaConfig.threshold})`);\n      } else if (this.commandUI) {\n        this.commandUI.showInputFeedback('èƒŒæ™¯ã‚’é€éã™ã‚‹ã«ã¯èƒŒæ™¯è‰²ã‚’æŒ‡å®šã—ã¦ãã ã•ã„ï¼ˆä¾‹ï¼šã€ŒèƒŒæ™¯ã®ç™½ã‚’é€éã—ã¦ã€ï¼‰', 'info');\n      }\n    }\n\n    return effects;\n  }\n\n  requiresChromaKey(cmd) {\n    if (!cmd) return false;\n    const chromaKeywords = ['ã‚¯ãƒ­ãƒã‚­ãƒ¼', 'ã‚°ãƒªãƒ¼ãƒ³ãƒãƒƒã‚¯', 'remove background', 'transparent background'];\n    if (chromaKeywords.some(keyword => cmd.includes(keyword))) {\n      return true;\n    }\n    const backgroundTerms = ['èƒŒæ™¯ã‚’', 'èƒŒæ™¯ã®', 'èƒŒæ™¯'];\n    const actionTerms = ['é€é', 'é€æ˜', 'æ¶ˆ', 'æŠœ', 'ãªãã—ã¦'];\n    if (backgroundTerms.some(term => cmd.includes(term)) && actionTerms.some(term => cmd.includes(term))) {\n      return true;\n    }\n    return false;\n  }\n\n  detectChromaKeyConfig(cmd) {\n    const color = this.detectChromaKeyColor(cmd);\n    if (color === null) {\n      return null;\n    }\n    let threshold;\n    switch (color) {\n      case 0xffffff:\n        threshold = 0.12;\n        break;\n      case 0x000000:\n        threshold = 0.14;\n        break;\n      case 0x00ff00:\n        threshold = 0.32;\n        break;\n      case 0x0000ff:\n        threshold = 0.3;\n        break;\n      default:\n        threshold = 0.2;\n    }\n    return {\n      color,\n      threshold,\n      smoothing: 0.1\n    };\n  }\n\n  detectChromaKeyColor(cmd) {\n    const hexMatch = cmd.match(/#([0-9a-fA-F]{6})/);\n    if (hexMatch) {\n      return parseInt(hexMatch[1], 16);\n    }\n\n    const colorKeywords = [\n      { tokens: ['ç™½', 'ãƒ›ãƒ¯ã‚¤ãƒˆ', 'ã—ã‚'], value: 0xffffff },\n      { tokens: ['é»’', 'ãƒ–ãƒ©ãƒƒã‚¯', 'ãã‚'], value: 0x000000 },\n      { tokens: ['ç·‘', 'ã‚°ãƒªãƒ¼ãƒ³', 'ã¿ã©ã‚Š'], value: 0x00ff00 },\n      { tokens: ['é’', 'ãƒ–ãƒ«ãƒ¼', 'ã‚ãŠ'], value: 0x0000ff },\n      { tokens: ['èµ¤', 'ãƒ¬ãƒƒãƒ‰', 'ã‚ã‹'], value: 0xff0000 },\n      { tokens: ['é»„', 'ã‚¤ã‚¨ãƒ­ãƒ¼', 'ãã„ã‚'], value: 0xffff00 },\n      { tokens: ['ãƒ”ãƒ³ã‚¯'], value: 0xffc0cb },\n      { tokens: ['ã‚ªãƒ¬ãƒ³ã‚¸'], value: 0xff8800 }\n    ];\n\n    for (const entry of colorKeywords) {\n      if (entry.tokens.some(token => cmd.includes(token))) {\n        return entry.value;\n      }\n    }\n\n    if (cmd.includes('ã‚°ãƒªãƒ¼ãƒ³ãƒãƒƒã‚¯')) {\n      return 0x00ff00;\n    }\n\n    return null;\n  }\n\n  /**\n   * ã‚¨ãƒ•ã‚§ã‚¯ãƒˆé©ç”¨ã‚·ã‚¹ãƒ†ãƒ  - Phase 2\n   */\n  applyEffects(targetObject, effects) {\n    let applied = false;\n\n    for (const effect of effects) {\n      console.log(`âœ¨ Applying effect: ${effect.name} (${effect.type})`);\n\n      switch (effect.type) {\n        case 'opacity':\n          applied = this.applyOpacityEffect(targetObject, effect) || applied;\n          break;\n        case 'glow':\n          applied = this.applyGlowEffect(targetObject, effect) || applied;\n          break;\n        case 'material':\n          applied = this.applyMaterialEffect(targetObject, effect) || applied;\n          break;\n        case 'animation':\n          applied = this.applyAnimationEffect(targetObject, effect) || applied;\n          break;\n        case 'cosmic':\n        case 'aurora':\n        case 'nebula':\n        case 'energy':\n        case 'mystic':\n        case 'rainbow_glow':\n          applied = this.applyCosmicEffect(targetObject, effect) || applied;\n          break;\n        case 'watercolor_art':\n        case 'pastel_art':\n          applied = this.applyWatercolorEffect(targetObject, effect) || applied;\n          break;\n        case 'chroma_key':\n          applied = this.applyChromaKeyEffect(targetObject, effect) || applied;\n          break;\n        default:\n          console.warn(`ğŸš« Unknown effect type: ${effect.type}`);\n      }\n    }\n\n    return applied;\n  }\n\n  /**\n   * é€æ˜åº¦ã‚¨ãƒ•ã‚§ã‚¯ãƒˆé©ç”¨\n   */\n  applyOpacityEffect(targetObject, effect) {\n    if (!targetObject.material) return false;\n\n    targetObject.material.transparent = true;\n    targetObject.material.opacity = effect.value;\n    targetObject.material.needsUpdate = true;\n\n    console.log(`ğŸ‘» Opacity set to: ${effect.value} (${effect.name})`);\n    return true;\n  }\n\n  /**\n   * ç™ºå…‰ã‚¨ãƒ•ã‚§ã‚¯ãƒˆé©ç”¨\n   */\n  applyGlowEffect(targetObject, effect) {\n    if (!targetObject.material) return false;\n\n    if (this.ensureEmissiveSupport(targetObject)) {\n      targetObject.material.emissive = new THREE.Color(effect.color);\n      targetObject.material.emissiveIntensity = effect.intensity;\n      targetObject.material.needsUpdate = true;\n      console.log(`ğŸ’¡ Glow applied: color=0x${effect.color.toString(16)}, intensity=${effect.intensity}`);\n      return true;\n    }\n\n    // Fallback: èª¿è‰²ã«ã‚ˆã‚‹ç°¡æ˜“ç™ºå…‰è¡¨ç¾\n    const fallbackColor = new THREE.Color(effect.color);\n    if (!targetObject.userData.originalColor) {\n      targetObject.userData.originalColor = targetObject.material.color ? targetObject.material.color.clone() : null;\n    }\n    if (targetObject.material.color) {\n      targetObject.material.color.lerp(fallbackColor, 0.4);\n      targetObject.material.needsUpdate = true;\n      console.log('ğŸ’¡ Glow fallback applied via color tint');\n      return true;\n    }\n\n    console.warn('ğŸš« Glow effect could not be applied');\n    return false;\n  }\n\n  ensureEmissiveSupport(targetObject) {\n    const material = targetObject.material;\n    if (!material) return false;\n    return 'emissive' in material && material.emissive !== undefined;\n  }\n\n  /**\n   * æè³ªã‚¨ãƒ•ã‚§ã‚¯ãƒˆé©ç”¨\n   */\n  applyMaterialEffect(targetObject, effect) {\n    if (!targetObject.material) return false;\n\n    // StandardMaterial ã®å ´åˆã®ã¿é©ç”¨\n    if (targetObject.material.type === 'MeshStandardMaterial') {\n      if (effect.metalness !== undefined) {\n        targetObject.material.metalness = effect.metalness;\n      }\n      if (effect.roughness !== undefined) {\n        targetObject.material.roughness = effect.roughness;\n      }\n      targetObject.material.needsUpdate = true;\n\n      console.log(`ğŸ”© Material updated: metalness=${effect.metalness}, roughness=${effect.roughness}`);\n      return true;\n    } else {\n      console.warn(`ğŸš« Material effect requires StandardMaterial, got: ${targetObject.material.type}`);\n      return false;\n    }\n  }\n\n  /**\n   * ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ•ã‚§ã‚¯ãƒˆé©ç”¨\n   */\n  applyAnimationEffect(targetObject, effect) {\n    // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç®¡ç†ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’åˆæœŸåŒ–\n    if (!this.animations) {\n      this.animations = new Map();\n      this.startAnimationLoop();\n    }\n\n    const animationId = `${targetObject.uuid}_${effect.animation}`;\n\n    // æ—¢å­˜ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãŒã‚ã‚Œã°åœæ­¢\n    if (this.animations.has(animationId)) {\n      this.animations.delete(animationId);\n    }\n\n    // æ–°ã—ã„ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ \n    const animationData = {\n      object: targetObject,\n      type: effect.animation,\n      speed: effect.speed,\n      amplitude: effect.amplitude || 1.0,\n      axis: effect.axis || 'y',\n      intensity: effect.intensity || 1.0,\n      startTime: Date.now(),\n      originalPosition: { ...targetObject.position },\n      originalScale: { ...targetObject.scale },\n      originalRotation: { ...targetObject.rotation }\n    };\n\n    this.animations.set(animationId, animationData);\n    console.log(`ğŸ¬ Animation started: ${effect.animation} for ${targetObject.name}`);\n    return true;\n  }\n\n  /**\n   * å®‡å®™çš„ã‚¨ãƒ•ã‚§ã‚¯ãƒˆé©ç”¨ï¼ˆã‚ªãƒ¼ãƒ­ãƒ©ã€æ˜Ÿé›²ã€ã‚¨ãƒãƒ«ã‚®ãƒ¼ï¼‰\n   */\n  applyCosmicEffect(targetObject, effect) {\n    if (!targetObject.material) return false;\n\n    const useColorFallback = !this.ensureEmissiveSupport(targetObject);\n\n    // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç®¡ç†ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’åˆæœŸåŒ–\n    if (!this.animations) {\n      this.animations = new Map();\n      this.startAnimationLoop();\n    }\n\n    // è¤‡æ•°è‰²ã®ç™ºå…‰ã¨è‰²å¤‰åŒ–ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’çµ„ã¿åˆã‚ã›\n    const cosmicAnimationId = `${targetObject.uuid}_${effect.type}`;\n\n    // æ—¢å­˜ã®ã‚³ã‚¹ãƒŸãƒƒã‚¯ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãŒã‚ã‚Œã°å‰Šé™¤\n    if (this.animations.has(cosmicAnimationId)) {\n      this.animations.delete(cosmicAnimationId);\n    }\n\n    if (useColorFallback) {\n      if (targetObject.material.color) {\n        if (!targetObject.userData.originalColor) {\n          targetObject.userData.originalColor = targetObject.material.color.clone();\n        }\n        targetObject.material.color.set(effect.colors[0]);\n        targetObject.material.needsUpdate = true;\n      } else {\n        console.warn('ğŸš« Cosmic fallback could not adjust color');\n      }\n    } else {\n      targetObject.material.emissive = new THREE.Color(effect.colors[0]);\n      targetObject.material.emissiveIntensity = effect.intensity;\n      targetObject.material.needsUpdate = true;\n    }\n\n    // ã‚³ã‚¹ãƒŸãƒƒã‚¯ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆ\n    const cosmicData = {\n      object: targetObject,\n      type: 'cosmic',\n      cosmicType: effect.type,\n      colors: effect.colors,\n      intensity: effect.intensity,\n      speed: this.getCosmicSpeed(effect.type),\n      startTime: Date.now(),\n      colorIndex: 0,\n      originalEmissive: !useColorFallback && targetObject.material.emissive ? targetObject.material.emissive.clone() : null,\n      originalEmissiveIntensity: !useColorFallback ? (targetObject.material.emissiveIntensity || 0) : 0,\n      useColorFallback\n    };\n\n    this.animations.set(cosmicAnimationId, cosmicData);\n    console.log(`ğŸŒŒ Cosmic effect started: ${effect.type} with ${effect.colors.length} colors`);\n    return true;\n  }\n\n  applyChromaKeyEffect(targetObject, effect) {\n    if (!targetObject.material) return false;\n    const material = targetObject.material;\n    const texture = material.map;\n\n    if (!texture) {\n      console.warn('ğŸš« Chroma key requires texture map');\n      return false;\n    }\n\n    if (material.userData && material.userData.isChromaKeyMaterial && material.uniforms) {\n      material.uniforms.keyColor.value.setHex(effect.color);\n      material.uniforms.threshold.value = effect.threshold;\n      material.uniforms.smoothing.value = effect.smoothing;\n      material.needsUpdate = true;\n      console.log('ğŸ¯ Updated existing chroma key material');\n      return true;\n    }\n\n    const shaderMaterial = new THREE.ShaderMaterial({\n      uniforms: {\n        map: { value: texture },\n        keyColor: { value: new THREE.Color(effect.color) },\n        threshold: { value: effect.threshold },\n        smoothing: { value: effect.smoothing }\n      },\n      vertexShader: `varying vec2 vUv;\\nvoid main() {\\n  vUv = uv;\\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\\n}`,\n      fragmentShader: `uniform sampler2D map;\\nuniform vec3 keyColor;\\nuniform float threshold;\\nuniform float smoothing;\\nvarying vec2 vUv;\\nvoid main() {\\n  vec4 color = texture2D(map, vUv);\\n  float dist = distance(color.rgb, keyColor);\\n  float alpha = smoothstep(threshold, threshold + smoothing, dist) * color.a;\\n  if (alpha <= 0.0) discard;\\n  gl_FragColor = vec4(color.rgb, alpha);\\n}`,\n      transparent: true,\n      side: THREE.DoubleSide,\n      depthTest: material.depthTest,\n      depthWrite: material.depthWrite,\n      toneMapped: material.toneMapped === true\n    });\n\n    shaderMaterial.userData.isChromaKeyMaterial = true;\n    targetObject.material = shaderMaterial;\n\n    if (typeof material.dispose === 'function') {\n      material.dispose();\n    }\n\n    console.log('ğŸª„ Applied chroma key shader material');\n    return true;\n  }\n\n  /**\n   * å®‡å®™çš„ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã®ã‚¹ãƒ”ãƒ¼ãƒ‰è¨­å®š\n   */\n  getCosmicSpeed(cosmicType) {\n    switch (cosmicType) {\n      case 'cosmic': return 0.0005;      // ã‚†ã£ãã‚Šã¨ç¥ç§˜çš„ã«\n      case 'aurora': return 0.0008;      // ã‚ªãƒ¼ãƒ­ãƒ©ã®ã‚ˆã†ãªæµã‚Œ\n      case 'nebula': return 0.0003;      // æ˜Ÿé›²ã®ã‚ˆã†ã«ã‚†ã£ãŸã‚Š\n      case 'energy': return 0.0015;      // ã‚¨ãƒãƒ«ã‚®ãƒƒã‚·ãƒ¥ã«\n      case 'mystic': return 0.0006;      // ç¥ç§˜çš„ã«ã‚†ã‚‰ã‚†ã‚‰\n      case 'rainbow_glow': return 0.001; // è™¹è‰²ã¯é©åº¦ãªã‚¹ãƒ”ãƒ¼ãƒ‰\n      default: return 0.0008;\n    }\n  }\n\n  /**\n   * æ°´å½©ç”»ãƒ»ãƒ‘ã‚¹ãƒ†ãƒ«ç³»ã‚¨ãƒ•ã‚§ã‚¯ãƒˆé©ç”¨\n   */\n  applyWatercolorEffect(targetObject, effect) {\n    if (!targetObject.material) return false;\n\n    // é€æ˜åº¦ã‚’è¨­å®š\n    targetObject.material.transparent = true;\n    targetObject.material.opacity = effect.opacity;\n\n    // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç®¡ç†ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’åˆæœŸåŒ–\n    if (!this.animations) {\n      this.animations = new Map();\n      this.startAnimationLoop();\n    }\n\n    // æ°´å½©ç”»ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ID\n    const watercolorAnimationId = `${targetObject.uuid}_${effect.type}`;\n\n    // æ—¢å­˜ã®æ°´å½©ç”»ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãŒã‚ã‚Œã°å‰Šé™¤\n    if (this.animations.has(watercolorAnimationId)) {\n      this.animations.delete(watercolorAnimationId);\n    }\n\n    // åˆæœŸè‰²ã‚’è¨­å®šï¼ˆç™ºå…‰ã§ã¯ãªãæ‹¡æ•£è‰²ï¼‰\n    targetObject.material.color = new THREE.Color(effect.colors[0]);\n    targetObject.material.needsUpdate = true;\n\n    // æ°´å½©ç”»ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆ\n    const watercolorData = {\n      object: targetObject,\n      type: 'watercolor',\n      artType: effect.type,\n      colors: effect.colors,\n      opacity: effect.opacity,\n      speed: this.getWatercolorSpeed(effect.type),\n      startTime: Date.now(),\n      colorIndex: 0,\n      originalColor: new THREE.Color(targetObject.material.color),\n      originalOpacity: targetObject.material.opacity\n    };\n\n    this.animations.set(watercolorAnimationId, watercolorData);\n    console.log(`ğŸ¨ Watercolor effect started: ${effect.type} with ${effect.colors.length} colors`);\n    return true;\n  }\n\n  /**\n   * æ°´å½©ç”»ç³»ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã®ã‚¹ãƒ”ãƒ¼ãƒ‰è¨­å®š\n   */\n  getWatercolorSpeed(artType) {\n    switch (artType) {\n      case 'watercolor_art': return 0.0003;  // æ°´å½©ç”»ã¯éå¸¸ã«ã‚†ã£ãã‚Š\n      case 'pastel_art': return 0.0002;      // ãƒ‘ã‚¹ãƒ†ãƒ«ã¯ã‚ˆã‚Šç©ã‚„ã‹\n      default: return 0.0003;\n    }\n  }\n\n  /**\n   * ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ—é–‹å§‹\n   */\n  startAnimationLoop() {\n    if (this.animationLoopRunning) return;\n\n    this.animationLoopRunning = true;\n\n    const animate = () => {\n      if (this.animations && this.animations.size > 0) {\n        this.updateAnimations();\n      }\n\n      if (this.animationLoopRunning) {\n        requestAnimationFrame(animate);\n      }\n    };\n\n    animate();\n    console.log(`ğŸ­ Animation loop started`);\n  }\n\n  /**\n   * ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³æ›´æ–°\n   */\n  updateAnimations() {\n    const currentTime = Date.now();\n\n    for (const [id, animation] of this.animations.entries()) {\n      const elapsed = (currentTime - animation.startTime) * 0.001; // ç§’ã«å¤‰æ›\n\n      switch (animation.type) {\n        case 'float':\n          this.updateFloatAnimation(animation, elapsed);\n          break;\n        case 'pulse':\n          this.updatePulseAnimation(animation, elapsed);\n          break;\n        case 'spin':\n          this.updateSpinAnimation(animation, elapsed);\n          break;\n        case 'sparkle':\n          this.updateSparkleAnimation(animation, elapsed);\n          break;\n        case 'rainbow':\n          this.updateRainbowAnimation(animation, elapsed);\n          break;\n        case 'glitch':\n          this.updateGlitchAnimation(animation, elapsed);\n          break;\n        case 'cosmic':\n          this.updateCosmicAnimation(animation, elapsed);\n          break;\n        case 'watercolor':\n          this.updateWatercolorAnimation(animation, elapsed);\n          break;\n      }\n    }\n  }\n\n  /**\n   * æµ®éŠã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³\n   */\n  updateFloatAnimation(animation, elapsed) {\n    const yOffset = Math.sin(elapsed * animation.speed * 2 * Math.PI) * animation.amplitude;\n    animation.object.position.y = animation.originalPosition.y + yOffset;\n  }\n\n  /**\n   * ãƒ‘ãƒ«ã‚¹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³\n   */\n  updatePulseAnimation(animation, elapsed) {\n    const scaleOffset = Math.sin(elapsed * animation.speed * 2 * Math.PI) * animation.amplitude;\n    const newScale = 1 + scaleOffset;\n    animation.object.scale.setScalar(animation.originalScale.x * newScale);\n  }\n\n  /**\n   * å›è»¢ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³\n   */\n  updateSpinAnimation(animation, elapsed) {\n    const rotationAmount = elapsed * animation.speed * 2 * Math.PI;\n    if (animation.axis === 'x') {\n      animation.object.rotation.x = animation.originalRotation.x + rotationAmount;\n    } else if (animation.axis === 'y') {\n      animation.object.rotation.y = animation.originalRotation.y + rotationAmount;\n    } else if (animation.axis === 'z') {\n      animation.object.rotation.z = animation.originalRotation.z + rotationAmount;\n    }\n  }\n\n  /**\n   * ã‚­ãƒ©ã‚­ãƒ©ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆç™ºå…‰ã®æ˜æ»…ï¼‰\n   */\n  updateSparkleAnimation(animation, elapsed) {\n    if (animation.object.material) {\n      const intensity = (Math.sin(elapsed * 3 * 2 * Math.PI) * 0.5 + 0.5) * animation.intensity;\n      animation.object.material.emissiveIntensity = intensity;\n      animation.object.material.needsUpdate = true;\n    }\n  }\n\n  /**\n   * è™¹è‰²ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³\n   */\n  updateRainbowAnimation(animation, elapsed) {\n    if (animation.object.material) {\n      const hue = (elapsed * animation.speed) % 1;\n      const color = new THREE.Color().setHSL(hue, 1, 0.5);\n      animation.object.material.color = color;\n      animation.object.material.needsUpdate = true;\n    }\n  }\n\n  /**\n   * ã‚°ãƒªãƒƒãƒã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³\n   */\n  updateGlitchAnimation(animation, elapsed) {\n    if (Math.random() < 0.1) { // 10%ã®ç¢ºç‡ã§ã‚°ãƒªãƒƒãƒ\n      const offset = (Math.random() - 0.5) * animation.intensity;\n      animation.object.position.x = animation.originalPosition.x + offset;\n      animation.object.position.z = animation.originalPosition.z + offset;\n    } else {\n      animation.object.position.x = animation.originalPosition.x;\n      animation.object.position.z = animation.originalPosition.z;\n    }\n  }\n\n  /**\n   * å®‡å®™çš„ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆã‚ªãƒ¼ãƒ­ãƒ©ã€æ˜Ÿé›²ã€ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚¨ãƒ•ã‚§ã‚¯ãƒˆï¼‰\n   */\n  updateCosmicAnimation(animation, elapsed) {\n    if (!animation.object.material) return;\n\n    // è‰²ã®å¾ªç’°ã‚¹ãƒ”ãƒ¼ãƒ‰ã‚’èª¿æ•´\n    const colorCycleSpeed = elapsed * animation.speed;\n    const numColors = animation.colors.length;\n\n    // æ»‘ã‚‰ã‹ãªè‰²ã®é·ç§»ã‚’å®Ÿç¾\n    const colorProgress = (colorCycleSpeed % numColors);\n    const currentColorIndex = Math.floor(colorProgress);\n    const nextColorIndex = (currentColorIndex + 1) % numColors;\n    const lerpFactor = colorProgress - currentColorIndex;\n\n    // ç¾åœ¨ã®è‰²ã¨æ¬¡ã®è‰²ã‚’ãƒ–ãƒ¬ãƒ³ãƒ‰\n    const currentColor = new THREE.Color(animation.colors[currentColorIndex]);\n    const nextColor = new THREE.Color(animation.colors[nextColorIndex]);\n    const blendedColor = currentColor.lerp(nextColor, lerpFactor);\n\n    // å®‡å®™çš„ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚¿ã‚¤ãƒ—ã”ã¨ã®ç‰¹åˆ¥ãªå‡¦ç†\n    let intensityMultiplier = 1.0;\n    switch (animation.cosmicType) {\n      case 'aurora':\n        // ã‚ªãƒ¼ãƒ­ãƒ©ã¯æ³¢ã®ã‚ˆã†ãªå¼·å¼±å¤‰åŒ–\n        intensityMultiplier = 0.7 + 0.3 * Math.sin(elapsed * 2.5);\n        break;\n      case 'nebula':\n        // æ˜Ÿé›²ã¯ã‚†ã£ãã‚Šã¨ã—ãŸè„ˆå‹•\n        intensityMultiplier = 0.8 + 0.2 * Math.sin(elapsed * 1.2);\n        break;\n      case 'energy':\n        // ã‚¨ãƒãƒ«ã‚®ãƒ¼ã¯æ¿€ã—ãå¤‰å‹•\n        intensityMultiplier = 0.6 + 0.4 * (Math.sin(elapsed * 4) * Math.cos(elapsed * 3));\n        break;\n      case 'cosmic':\n        // å®‡å®™ã¯ç¥ç§˜çš„ã«ã‚†ã‚‰ã‚†ã‚‰\n        intensityMultiplier = 0.8 + 0.2 * Math.sin(elapsed * 1.8);\n        break;\n      case 'mystic':\n        // ç¥ç§˜çš„ã¯è¤‡é›‘ãªå¤‰åŒ–\n        intensityMultiplier = 0.7 + 0.3 * Math.sin(elapsed * 1.5) * Math.cos(elapsed * 0.8);\n        break;\n      case 'rainbow_glow':\n        // è™¹è‰²ã¯é®®ã‚„ã‹ã«è¼ã\n        intensityMultiplier = 0.6 + 0.3 * Math.sin(elapsed * 2.0);\n        break;\n    }\n\n    if (animation.useColorFallback) {\n      if (animation.object.material.color) {\n        animation.object.material.color.copy(blendedColor);\n        animation.object.material.needsUpdate = true;\n      }\n    } else {\n      animation.object.material.emissive = blendedColor;\n      animation.object.material.emissiveIntensity = animation.intensity * intensityMultiplier;\n      animation.object.material.needsUpdate = true;\n    }\n  }\n\n  /**\n   * æ°´å½©ç”»ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆæ‹¡æ•£è‰²ã®æŸ”ã‚‰ã‹ãªå¤‰åŒ–ï¼‰\n   */\n  updateWatercolorAnimation(animation, elapsed) {\n    if (!animation.object.material) return;\n\n    // è‰²ã®å¾ªç’°ã‚¹ãƒ”ãƒ¼ãƒ‰ã‚’èª¿æ•´ï¼ˆå®‡å®™ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚ˆã‚Šé…ã„ï¼‰\n    const colorCycleSpeed = elapsed * animation.speed;\n    const numColors = animation.colors.length;\n\n    // æ»‘ã‚‰ã‹ãªè‰²ã®é·ç§»\n    const colorProgress = (colorCycleSpeed % numColors);\n    const currentColorIndex = Math.floor(colorProgress);\n    const nextColorIndex = (currentColorIndex + 1) % numColors;\n    const lerpFactor = colorProgress - currentColorIndex;\n\n    // ç¾åœ¨ã®è‰²ã¨æ¬¡ã®è‰²ã‚’ãƒ–ãƒ¬ãƒ³ãƒ‰\n    const currentColor = new THREE.Color(animation.colors[currentColorIndex]);\n    const nextColor = new THREE.Color(animation.colors[nextColorIndex]);\n    const blendedColor = currentColor.lerp(nextColor, lerpFactor);\n\n    // é€æ˜åº¦ã®æŸ”ã‚‰ã‹ãªå¤‰åŒ–\n    let opacityMultiplier = 1.0;\n    switch (animation.artType) {\n      case 'watercolor_art':\n        // æ°´å½©ç”»ã¯é€æ˜åº¦ã‚‚ã‚†ã£ãã‚Šå¤‰åŒ–\n        opacityMultiplier = 0.9 + 0.1 * Math.sin(elapsed * 0.5);\n        break;\n      case 'pastel_art':\n        // ãƒ‘ã‚¹ãƒ†ãƒ«ã¯é€æ˜åº¦ã‚’ã‚ˆã‚Šå®‰å®š\n        opacityMultiplier = 0.95 + 0.05 * Math.sin(elapsed * 0.3);\n        break;\n    }\n\n    // æ‹¡æ•£è‰²ã‚’è¨­å®šï¼ˆemissiveã§ã¯ãªãcolorï¼‰\n    animation.object.material.color = blendedColor;\n    animation.object.material.opacity = animation.opacity * opacityMultiplier;\n    animation.object.material.needsUpdate = true;\n  }\n\n  /**\n   * ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«åŸºã¥ã„ã¦è‡ªå‹•ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’æ±ºå®š\n   */\n  getAutoEffectsFromPrompt(prompt) {\n    if (!prompt) return null;\n\n    const lowerPrompt = prompt.toLowerCase();\n\n    // é­”æ³•ãƒ»ãƒ•ã‚¡ãƒ³ã‚¿ã‚¸ãƒ¼ç³»\n    if (lowerPrompt.includes('ãƒ¦ãƒ‹ã‚³ãƒ¼ãƒ³') || lowerPrompt.includes('unicorn') ||\n        lowerPrompt.includes('é­”æ³•') || lowerPrompt.includes('magic') ||\n        lowerPrompt.includes('é­”å¥³') || lowerPrompt.includes('wizard') ||\n        lowerPrompt.includes('fairy') || lowerPrompt.includes('å¦–ç²¾')) {\n      return ['é­”æ³•ã£ã½ã'];\n    }\n\n    // å®‡å®™ãƒ»ç¥ç§˜ç³»\n    if (lowerPrompt.includes('ãƒ‰ãƒ©ã‚´ãƒ³') || lowerPrompt.includes('dragon') ||\n        lowerPrompt.includes('å®‡å®™') || lowerPrompt.includes('space') ||\n        lowerPrompt.includes('æ˜Ÿ') || lowerPrompt.includes('star')) {\n      return ['å®‡å®™'];\n    }\n\n    // å¹½éœŠãƒ»é€æ˜ç³»\n    if (lowerPrompt.includes('å¹½éœŠ') || lowerPrompt.includes('ghost') ||\n        lowerPrompt.includes('ç²¾éœŠ') || lowerPrompt.includes('spirit')) {\n      return ['å¹½éœŠ'];\n    }\n\n    // ã‚µã‚¤ãƒãƒ¼ãƒ»æœªæ¥ç³»\n    if (lowerPrompt.includes('ãƒ­ãƒœãƒƒãƒˆ') || lowerPrompt.includes('robot') ||\n        lowerPrompt.includes('ã‚µã‚¤ãƒãƒ¼') || lowerPrompt.includes('cyber') ||\n        lowerPrompt.includes('æœªæ¥') || lowerPrompt.includes('future')) {\n      return ['ã‚µã‚¤ãƒãƒ¼'];\n    }\n\n    // å‹•ç‰©ç³» - è»½ã„ã‚­ãƒ©ã‚­ãƒ©ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ\n    if (lowerPrompt.includes('çŒ«') || lowerPrompt.includes('cat') ||\n        lowerPrompt.includes('çŠ¬') || lowerPrompt.includes('dog') ||\n        lowerPrompt.includes('é³¥') || lowerPrompt.includes('bird')) {\n      return ['ãã‚‰ã‚'];\n    }\n\n    // èŠ±ãƒ»è‡ªç„¶ç³» - ãƒ‘ã‚¹ãƒ†ãƒ«ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ\n    if (lowerPrompt.includes('èŠ±') || lowerPrompt.includes('flower') ||\n        lowerPrompt.includes('æ¡œ') || lowerPrompt.includes('cherry') ||\n        lowerPrompt.includes('è‡ªç„¶') || lowerPrompt.includes('nature')) {\n      return ['ãƒ‘ã‚¹ãƒ†ãƒ«'];\n    }\n\n    return null; // è©²å½“ãªã—ã®å ´åˆã¯ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãªã—\n  }\n\n  /**\n   * ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆèªè­˜æˆåŠŸæ™‚ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ\n   */\n  applyRecognitionFeedback(targetObject) {\n    console.log(`ğŸ¯ Object recognition successful: ${targetObject.name}`);\n\n    // çŸ­æ™‚é–“ã®ã‚­ãƒ©ã‚­ãƒ©ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã§èªè­˜æˆåŠŸã‚’è¦–è¦šçš„ã«ä¼ãˆã‚‹\n    const feedbackEffect = [{\n      type: 'animation',\n      animation: 'sparkle',\n      intensity: 0.8,\n      name: 'recognition_feedback'\n    }];\n\n    this.applyEffects(targetObject, feedbackEffect);\n\n    // 3ç§’å¾Œã«ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’åœæ­¢\n    setTimeout(() => {\n      this.stopRecognitionFeedback(targetObject);\n    }, 3000);\n  }\n\n  /**\n   * èªè­˜ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’åœæ­¢\n   */\n  stopRecognitionFeedback(targetObject) {\n    if (!this.animations) return;\n\n    const feedbackAnimationId = `${targetObject.uuid}_sparkle`;\n    if (this.animations.has(feedbackAnimationId)) {\n      this.animations.delete(feedbackAnimationId);\n\n      // ç™ºå…‰ã‚’å…ƒã«æˆ»ã™\n      if (targetObject.material) {\n        targetObject.material.emissiveIntensity = 0;\n        targetObject.material.needsUpdate = true;\n      }\n\n      console.log(`âœ¨ Recognition feedback stopped for: ${targetObject.name}`);\n    }\n  }\n\n  /**\n   * å‰Šé™¤ã‚³ãƒãƒ³ãƒ‰è§£æ\n   */\n  parseDeleteCommand(command) {\n    const cmd = command.toLowerCase().trim();\n    \n    // é¸æŠã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã¿ã‚’å‰Šé™¤ã™ã‚‹ã‹ã€å…¨å‰Šé™¤ã‹ã‚’åˆ¤å®š\n    if (cmd.includes('é¸æŠ') || cmd.includes('ã“ã‚Œ') || cmd.includes('ã“ã®')) {\n      return {\n        type: 'delete',\n        target: 'selected',\n        requiresSelection: true\n      };\n    }\n    \n    if (cmd.includes('å…¨éƒ¨') || cmd.includes('ã™ã¹ã¦') || cmd.includes('å…¨ã¦')) {\n      return {\n        type: 'delete',\n        target: 'all'\n      };\n    }\n    \n    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: é¸æŠã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å‰Šé™¤\n    return {\n      type: 'delete',\n      target: 'selected',\n      requiresSelection: true\n    };\n  }\n\n  /**\n   * è‡ªç„¶è¨€èªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæ“ä½œã‚³ãƒãƒ³ãƒ‰è§£æ\n   * ä¾‹: \"ãƒ¦ãƒ‹ã‚³ãƒ¼ãƒ³ã‚’å³ã«ç§»å‹•\", \"çŒ«ã®ç”»åƒã‚’ãƒ”ãƒ³ã‚¯ã«\", \"1ã¤ç›®ã®çŒ«ã‚’å·¦ã«\"\n   */\n  parseNaturalLanguageCommand(command) {\n    // ç§»å‹•ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ãƒã‚§ãƒƒã‚¯\n    const movePatterns = [\n      '(\\S+?)ã‚’(.+?)ã«ç§»å‹•', \n      '(\\S+?)ã‚’(.+?)ã¸ç§»å‹•',\n      '(\\S+?)ã‚’(.+?)ã«å‹•ã‹',\n      '(\\S+?)ã‚’(.+?)ã¸å‹•ã‹'\n    ];\n    \n    for (const pattern of movePatterns) {\n      const regex = new RegExp(pattern);\n      const match = command.match(regex);\n      if (match) {\n        const objectName = match[1];\n        const direction = match[2];\n        \n        console.log(`ğŸ¯ Natural language move detected: \"${objectName}\" to \"${direction}\"`);\n        \n        return {\n          type: 'natural_object_modification',\n          targetObjectName: objectName,\n          movement: this.parsePositionFromPrompt(direction),\n          requiresObjectSearch: true\n        };\n      }\n    }\n    \n    // è‰²å¤‰æ›´ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ãƒã‚§ãƒƒã‚¯\n    const colorPatterns = [\n      '(\\S+?)ã‚’(\\S+?)è‰²ã«',\n      '(\\S+?)ã‚’(\\S+?)ã«'\n    ];\n    \n    // è‰²å¤‰æ›´ã¯åŸºæœ¬çš„ãªè‰²ã®ã¿å¯¾å¿œ\n    const colorKeywords = ['èµ¤', 'èµ¤è‰²', 'é’', 'é’è‰²', 'ç·‘', 'ç·‘è‰²', 'é»„', 'é»„è‰²', 'é»„è‰²ã„', 'ç´«', 'ç´«è‰²',\n                          'æ©™', 'æ©™è‰²', 'ã‚ªãƒ¬ãƒ³ã‚¸', 'ã‚ªãƒ¬ãƒ³ã‚¸è‰²', 'ç™½', 'ç™½è‰²', 'é»’', 'é»’è‰²',\n                          'ç°', 'ç°è‰²', 'ã‚°ãƒ¬ãƒ¼', 'ã‚°ãƒ¬ãƒ¼è‰²', 'ãƒ”ãƒ³ã‚¯', 'ãƒ”ãƒ³ã‚¯è‰²', 'èŒ¶', 'èŒ¶è‰²', 'éŠ€', 'éŠ€è‰²', 'é‡‘', 'é‡‘è‰²'];\n    \n    for (const pattern of colorPatterns) {\n      const regex = new RegExp(pattern);\n      const match = command.match(regex);\n      if (match && colorKeywords.some(color => match[2].includes(color))) {\n        const objectName = match[1];\n        const colorName = match[2];\n        \n        console.log(`ğŸ¨ Natural language color change detected: \"${objectName}\" to \"${colorName}\"`);\n        \n        // è‰²å¤‰æ›´ã®è§£æï¼ˆæ—¢å­˜ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’æµç”¨ï¼‰\n        const colorMap = {\n          'èµ¤': 0xff0000, 'èµ¤è‰²': 0xff0000,\n          'é’': 0x0000ff, 'é’è‰²': 0x0000ff,\n          'ç·‘': 0x00ff00, 'ç·‘è‰²': 0x00ff00,\n          'é»„': 0xffff00, 'é»„è‰²': 0xffff00, 'é»„è‰²ã„': 0xffff00,\n          'ç´«': 0xff00ff, 'ç´«è‰²': 0xff00ff,\n          'æ©™': 0xff8800, 'æ©™è‰²': 0xff8800, 'ã‚ªãƒ¬ãƒ³ã‚¸': 0xff8800, 'ã‚ªãƒ¬ãƒ³ã‚¸è‰²': 0xff8800,\n          'ç™½': 0xffffff, 'ç™½è‰²': 0xffffff,\n          'é»’': 0x000000, 'é»’è‰²': 0x000000,\n          'ç°': 0x808080, 'ç°è‰²': 0x808080, 'ã‚°ãƒ¬ãƒ¼': 0x808080, 'ã‚°ãƒ¬ãƒ¼è‰²': 0x808080,\n          'ãƒ”ãƒ³ã‚¯': 0xffc0cb, 'ãƒ”ãƒ³ã‚¯è‰²': 0xffc0cb,\n          'èŒ¶': 0x8b4513, 'èŒ¶è‰²': 0x8b4513,\n          'éŠ€': 0xc0c0c0, 'éŠ€è‰²': 0xc0c0c0,\n          'é‡‘': 0xffd700, 'é‡‘è‰²': 0xffd700\n        };\n        \n        let colorValue = null;\n        for (const [colorKey, value] of Object.entries(colorMap)) {\n          if (colorName.includes(colorKey)) {\n            colorValue = value;\n            break;\n          }\n        }\n        \n        return {\n          type: 'natural_object_modification',\n          targetObjectName: objectName,\n          color: colorValue,\n          requiresObjectSearch: true\n        };\n      }\n    }\n\n    // å›è»¢ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ãƒã‚§ãƒƒã‚¯\n    const rotationPatterns = [\n      '(\\S+?)ã‚’å›è»¢',\n      '(\\S+?)ã‚’å›ã™',\n      '(\\S+?)ã‚’å›ã—ã¦',\n      '(\\S+?)å›è»¢',\n      'å›è»¢.*?(\\S+)'\n    ];\n\n    for (const pattern of rotationPatterns) {\n      const regex = new RegExp(pattern);\n      const match = command.match(regex);\n      if (match) {\n        const objectName = match[1];\n\n        console.log(`ğŸ”„ Natural language rotation detected: \"${objectName}\"`);\n\n        // è§’åº¦æŒ‡å®šãŒã‚ã‚‹ã‹ãƒã‚§ãƒƒã‚¯\n        const degreeMatch = command.match(/(\\d+)\\s*åº¦/);\n        const rotation = degreeMatch ?\n          parseFloat(degreeMatch[1]) * Math.PI / 180 :\n          Math.PI / 4; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ45åº¦\n\n        return {\n          type: 'natural_object_modification',\n          targetObjectName: objectName,\n          rotation: rotation,\n          requiresObjectSearch: true\n        };\n      }\n    }\n\n    // åè»¢ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ãƒã‚§ãƒƒã‚¯\n    const flipPatterns = [\n      '(\\S+?)ã‚’å·¦å³åè»¢',\n      '(\\S+?)ã‚’åè»¢',\n      '(\\S+?)åè»¢',\n      '(\\S+?)ã‚’ã²ã£ãã‚Šè¿”',\n      '(\\S+?)ã‚’flip'\n    ];\n\n    for (const pattern of flipPatterns) {\n      const regex = new RegExp(pattern);\n      const match = command.match(regex);\n      if (match) {\n        const objectName = match[1];\n\n        console.log(`ğŸ”„ Natural language flip detected: \"${objectName}\"`);\n\n        return {\n          type: 'natural_object_modification',\n          targetObjectName: objectName,\n          flip: true, // åè»¢ãƒ•ãƒ©ã‚°ã‚’è¿½åŠ \n          requiresObjectSearch: true\n        };\n      }\n    }\n\n    // ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆæ°´å½©ã€å®‡å®™ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãªã©ï¼‰\n    const effectPatterns = [\n      '(\\S+?)ã‚’(\\S+?)ã£ã½ã',\n      '(\\S+?)ã‚’(\\S+?)ã«',\n      '(\\S+?)ã‚’(\\S+?)é¢¨ã«',\n      '(\\S+?)ã‚’(\\S+?)ã¿ãŸã„'\n    ];\n\n    const effectKeywords = ['æ°´å½©', 'æ°´å½©ç”»', 'å®‡å®™', 'ã‚ªãƒ¼ãƒ­ãƒ©', 'æ˜Ÿé›²', 'ã‚¨ãƒãƒ«ã‚®ãƒ¼', 'ç¥ç§˜çš„',\n                            'ãƒ‘ã‚¹ãƒ†ãƒ«', 'é­”æ³•', 'å¹½éœŠ', 'ã‚µã‚¤ãƒãƒ¼', 'å¤¢', 'å…‰', 'ãƒã‚ªãƒ³',\n                            'ãƒ¡ã‚¿ãƒªãƒƒã‚¯', 'é‡‘å±', 'ã‚¬ãƒ©ã‚¹', 'ãƒãƒƒãƒˆ'];\n\n    for (const pattern of effectPatterns) {\n      const regex = new RegExp(pattern);\n      const match = command.match(regex);\n      if (match && effectKeywords.some(effect => match[2].includes(effect))) {\n        const objectName = match[1];\n        const effectName = match[2];\n\n        console.log(`âœ¨ Natural language effect detected: \"${objectName}\" with \"${effectName}\"`);\n\n        return {\n          type: 'natural_object_modification',\n          targetObjectName: objectName,\n          command: effectName, // ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã¯ã‚³ãƒãƒ³ãƒ‰ã¨ã—ã¦æ¸¡ã™\n          requiresObjectSearch: true\n        };\n      }\n    }\n\n    return null; // è‡ªç„¶è¨€èªãƒ‘ã‚¿ãƒ¼ãƒ³ã«ä¸€è‡´ã—ãªã„å ´åˆ\n  }\n\n  /**\n   * ç§»å‹•ã‚³ãƒãƒ³ãƒ‰ã‹ã‚‰ç›¸å¯¾ä½ç½®ã‚’è§£æï¼ˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç§»å‹•ç”¨ï¼‰\n   */\n  parsePositionFromPrompt(command) {\n    let x = 0, y = 0, z = 0;\n    \n    // å·¦å³ç§»å‹•ï¼ˆä¿®æ­£ï¼šå·¦å³ã‚’æ­£ã—ã„æ–¹å‘ã«ï¼‰\n    if (command.includes('å³ã¸') || command.includes('å³ã«') || command.includes('å³å´ã¸') || command.includes('å³å´ã«')) {\n      x = 5; // 5ãƒ¡ãƒ¼ãƒˆãƒ«å³ã¸ï¼ˆæ­£ã®å€¤ã§å³ã«ç§»å‹•ï¼‰\n    } else if (command.includes('å·¦ã¸') || command.includes('å·¦ã«') || command.includes('å·¦å´ã¸') || command.includes('å·¦å´ã«')) {\n      x = -5; // 5ãƒ¡ãƒ¼ãƒˆãƒ«å·¦ã¸ï¼ˆè² ã®å€¤ã§å·¦ã«ç§»å‹•ï¼‰\n    }\n    \n    // ä¸Šä¸‹ç§»å‹•\n    if (command.includes('ä¸Šã¸') || command.includes('ä¸Šã«') || command.includes('ä¸Šå´ã¸')) {\n      y = 3; // 3ãƒ¡ãƒ¼ãƒˆãƒ«ä¸Šã¸\n    } else if (command.includes('ä¸‹ã¸') || command.includes('ä¸‹ã«') || command.includes('ä¸‹å´ã¸')) {\n      y = -3; // 3ãƒ¡ãƒ¼ãƒˆãƒ«ä¸‹ã¸\n    }\n    \n    // å‰å¾Œç§»å‹•\n    if (command.includes('å‰ã¸') || command.includes('æ‰‹å‰ã¸') || command.includes('è¿‘ãã¸')) {\n      z = 3; // ã‚«ãƒ¡ãƒ©ã«è¿‘ã¥ã‘ã‚‹\n    } else if (command.includes('å¾Œã‚ã¸') || command.includes('å¥¥ã¸') || command.includes('é ãã¸')) {\n      z = -3; // ã‚«ãƒ¡ãƒ©ã‹ã‚‰é ã–ã‘ã‚‹\n    }\n    \n    // è·é›¢æŒ‡å®šã®è§£æ\n    const distanceMatch = command.match(/(\\d+(?:\\.\\d+)?)\\s*(?:ãƒ¡ãƒ¼ãƒˆãƒ«|m)/);\n    if (distanceMatch) {\n      const distance = parseFloat(distanceMatch[1]);\n      // æ–¹å‘ã«å¿œã˜ã¦è·é›¢ã‚’é©ç”¨\n      if (Math.abs(x) > 0) x = x > 0 ? distance : -distance;\n      if (Math.abs(y) > 0) y = y > 0 ? distance : -distance;\n      if (Math.abs(z) > 0) z = z > 0 ? distance : -distance;\n    }\n    \n    // ã€Œå°‘ã—ã€ã€Œå¤§ããã€ãªã©ã®ä¿®é£¾èª\n    if (command.includes('å°‘ã—') || command.includes('ã¡ã‚‡ã£ã¨')) {\n      x *= 0.5; y *= 0.5; z *= 0.5;\n    } else if (command.includes('å¤§ãã') || command.includes('ãŸãã•ã‚“')) {\n      x *= 2; y *= 2; z *= 2;\n    }\n    \n    console.log(`ğŸ“ Position movement parsed from \"${command}\": (${x}, ${y}, ${z})`);\n    \n    return { x, y, z };\n  }\n\n  /**\n   * ä½ç½®æƒ…å ±è§£æï¼ˆã‚«ãƒ¡ãƒ©ç›¸å¯¾ä½ç½®ï¼‰\n   */\n  parsePosition(command) {\n    const defaultPos = { x: 0, y: 5, z: 10 }; // ã‚«ãƒ¡ãƒ©å‰æ–¹10mã€å°‘ã—ä¸Š\n    \n    // åŸºæœ¬æ–¹å‘ã®è§£æï¼ˆã‚«ãƒ¡ãƒ©ç›¸å¯¾åº§æ¨™ç³»ï¼‰\n    let x = 0, y = 5, z = 10; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼ˆã‚«ãƒ¡ãƒ©ç›¸å¯¾ã€æ­£ã®zãŒå‰æ–¹ï¼‰\n    \n    // çµ„ã¿åˆã‚ã›ä½ç½®ã‚’æœ€åˆã«ãƒã‚§ãƒƒã‚¯ï¼ˆå„ªå…ˆåº¦æœ€é«˜ï¼‰\n    if (command.includes('å·¦ä¸‹')) {\n      x = -8; y = 0; z = 10;  // å·¦ä¸‹: å·¦å´ã§ä½ã„ä½ç½®\n      console.log(`ğŸ“ Position parsed from \"${command}\": å·¦ä¸‹ (${x}, ${y}, ${z})`);\n      return { x, y, z };\n    } else if (command.includes('å³ä¸Š')) {\n      x = 5; y = 4; z = 12;  // yåº§æ¨™ã‚’ä¸‹ã’ã¦ç”»é¢å†…ã«åã‚ã‚‹\n      console.log(`ğŸ“ Position parsed from \"${command}\": å³ä¸Š (${x}, ${y}, ${z})`);\n      return { x, y, z };\n    } else if (command.includes('å·¦ä¸Š')) {\n      x = -8; y = 4; z = 15; // yåº§æ¨™ã‚’ä¸‹ã’ã¦ç”»é¢å†…ã«åã‚ã‚‹\n      console.log(`ğŸ“ Position parsed from \"${command}\": å·¦ä¸Š (${x}, ${y}, ${z})`);\n      return { x, y, z };\n    } else if (command.includes('å³ä¸‹')) {\n      x = 8; y = 0; z = 10; // å³ä¸‹: å³å´ã§ä½ã„ä½ç½®\n      console.log(`ğŸ“ Position parsed from \"${command}\": å³ä¸‹ (${x}, ${y}, ${z})`);\n      return { x, y, z };\n    }\n    \n    // ç‰¹æ®Šä½ç½®\n    if (command.includes('ä¸­å¤®') || command.includes('çœŸã‚“ä¸­') || command.includes('æ­£é¢')) {\n      x = 0; y = 3; z = 12;  // y=3 ã§ç›®ç·šãƒ¬ãƒ™ãƒ«ã«\n      console.log(`ğŸ“ Position parsed from \"${command}\": ä¸­å¤® (${x}, ${y}, ${z})`);\n      return { x, y, z };\n    } else if (command.includes('ç©º') || command.includes('å¤©ç©º')) {\n      x = 0; y = 20; z = 10;\n      console.log(`ğŸ“ Position parsed from \"${command}\": ç©ºä¸­ (${x}, ${y}, ${z})`);\n      return { x, y, z };\n    } else if (command.includes('åœ°é¢') || command.includes('è¶³å…ƒ')) {\n      x = 0; y = 1; z = 8;\n      console.log(`ğŸ“ Position parsed from \"${command}\": åœ°é¢ (${x}, ${y}, ${z})`);\n      return { x, y, z };\n    }\n    \n    // å€‹åˆ¥æ–¹å‘ã®è§£æ\n    // å‰å¾Œæ–¹å‘\n    if (command.includes('å‰ã«') || command.includes('æ‰‹å‰ã«')) {\n      z = 5; // ã‚«ãƒ¡ãƒ©ã«è¿‘ã¥ã‘ã‚‹\n    } else if (command.includes('å¾Œã‚ã«') || command.includes('å¥¥ã«') || command.includes('é ãã«')) {\n      z = 20; // ã‚«ãƒ¡ãƒ©ã‹ã‚‰é ã–ã‘ã‚‹\n    }\n    \n    // å·¦å³æ–¹å‘\n    if (command.includes('å³ã«') || command.includes('å³å´') || command.includes('ç”»é¢ã®å³')) {\n      x = 8;\n    } else if (command.includes('å·¦ã«') || command.includes('å·¦å´') || command.includes('ç”»é¢ã®å·¦')) {\n      x = -8;\n    }\n    \n    // ä¸Šä¸‹æ–¹å‘ï¼ˆã‚«ãƒ¡ãƒ©ç›¸å¯¾ï¼‰\n    if (command.includes('ä¸Šã«') || command.includes('ä¸Šå´') || command.includes('ç”»é¢ã®ä¸Š') || command.includes('é«˜ã„ä½ç½®ã«') || command.includes('ç©ºä¸­ã«')) {\n      y = 8; // ã‚«ãƒ¡ãƒ©ã‹ã‚‰8ãƒ¡ãƒ¼ãƒˆãƒ«ä¸Š\n    } else if (command.includes('ä¸‹ã«') || command.includes('ä¸‹å´') || command.includes('ç”»é¢ã®ä¸‹') || command.includes('ä½ã„ä½ç½®ã«') || command.includes('åœ°é¢ã«')) {\n      y = -2; // ã‚«ãƒ¡ãƒ©ã‹ã‚‰2ãƒ¡ãƒ¼ãƒˆãƒ«ä¸‹\n    }\n    \n    // è·é›¢æŒ‡å®š\n    if (command.includes('è¿‘ãã«') || command.includes('ã™ãå‰ã«')) {\n      z = Math.min(z * 0.5, 3); // åŠåˆ†ã®è·é›¢ã€ãŸã ã—æœ€ä½3mï¼ˆæ­£ã®å€¤ãªã®ã§ min ã‚’ä½¿ç”¨ï¼‰\n    } else if (command.includes('é ãã«') || command.includes('å‘ã“ã†ã«')) {\n      z = z * 1.5; // 1.5å€ã®è·é›¢\n    }\n    \n    console.log(`ğŸ“ Position parsed from \"${command}\": (${x}, ${y}, ${z})`);\n    \n    return { x, y, z };\n  }\n\n  /**\n   * ã‚µã‚¤ã‚ºè§£æ\n   */\n  parseSize(command) {\n    if (command.includes('å¤§ããª') || command.includes('å¤§ãã„')) return { scale: 2.0 };\n    if (command.includes('å°ã•ãª') || command.includes('å°ã•ã„')) return { scale: 0.5 };\n    return { scale: this.config.defaultObjectScale };\n  }\n\n  /**\n   * ã‚³ãƒãƒ³ãƒ‰ç¨®åˆ¥åˆ¥å®Ÿè¡Œ\n   */\n  async dispatchCommand(parsed) {\n    switch (parsed.type) {\n      case 'image_generation':\n        // ã‚µãƒ¼ãƒãƒ¼ãªã—ã®å ´åˆã¯ç”Ÿæˆæ©Ÿèƒ½ã‚’ç„¡åŠ¹åŒ–\n        if (!this.client || !this.client.serverUrl) {\n          throw new Error('ç”»åƒç”Ÿæˆæ©Ÿèƒ½ã‚’ä½¿ç”¨ã™ã‚‹ã«ã¯ã‚µãƒ¼ãƒãƒ¼è¨­å®šãŒå¿…è¦ã§ã™ã€‚ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ©Ÿèƒ½ã®ã¿åˆ©ç”¨å¯èƒ½ã§ã™ã€‚');\n        }\n        return await this.executeImageGeneration(parsed);\n        \n      case 'video_generation':\n        // ã‚µãƒ¼ãƒãƒ¼ãªã—ã®å ´åˆã¯ç”Ÿæˆæ©Ÿèƒ½ã‚’ç„¡åŠ¹åŒ–\n        if (!this.client || !this.client.serverUrl) {\n          throw new Error('å‹•ç”»ç”Ÿæˆæ©Ÿèƒ½ã‚’ä½¿ç”¨ã™ã‚‹ã«ã¯ã‚µãƒ¼ãƒãƒ¼è¨­å®šãŒå¿…è¦ã§ã™ã€‚ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ©Ÿèƒ½ã®ã¿åˆ©ç”¨å¯èƒ½ã§ã™ã€‚');\n        }\n        return await this.executeVideoGeneration(parsed);\n        \n      case 'object_modification':\n        return await this.executeObjectModification(parsed);\n        \n      case 'natural_object_modification':\n        return await this.executeNaturalObjectModification(parsed);\n        \n      case 'delete':\n        return await this.executeDelete(parsed);\n        \n      case 'file_import':\n        return await this.executeFileImport(parsed);\n        \n      case 'object_selection':\n        return await this.executeObjectSelection(parsed);\n        \n      default:\n        throw new Error(`Unknown command type: ${parsed.type}`);\n    }\n  }\n\n  /**\n   * ç”»åƒç”Ÿæˆå®Ÿè¡Œ\n   */\n  async executeImageGeneration(parsed) {\n    try {\n      console.log(`ğŸ¨ Generating image: \"${parsed.prompt}\"`);\n      \n      // æ®µéšçš„ã«ã‚µã‚¤ã‚ºã‚’è©¦è¡Œï¼ˆã‚·ãƒ¼ãƒ³ã«é…ç½®ã—ã‚„ã™ã„ã‚µã‚¤ã‚ºã‚’å„ªå…ˆï¼‰\n      const fallbackSizes = [\n        { width: 512, height: 512 },    // 1:1 åŸºæœ¬ã‚µã‚¤ã‚ºï¼ˆäº’æ›æ€§æœ€é«˜ï¼‰\n        { width: 768, height: 432 },    // 16:9 ç¾ä»£çš„ã‚µã‚¤ã‚º\n        { width: 1024, height: 1024 },  // å¤§ãã‚1:1\n        { width: 640, height: 480 },    // 4:3 ã‚¯ãƒ©ã‚·ãƒƒã‚¯\n      ];\n      \n      let imageResult;\n      let lastError;\n      \n      for (let i = 0; i < fallbackSizes.length; i++) {\n        const dimensions = fallbackSizes[i];\n        try {\n          console.log(`ğŸ”„ Trying ${dimensions.width}x${dimensions.height}...`);\n          \n          imageResult = await this.client.generateImage(parsed.prompt, {\n            width: dimensions.width,\n            height: dimensions.height,\n            service: this.selectedImageService || undefined\n          });\n          \n          if (imageResult.success) {\n            console.log(`âœ… Success with ${dimensions.width}x${dimensions.height}`);\n            break;\n          }\n        } catch (error) {\n          lastError = error;\n          console.log(`âš ï¸ Failed with ${dimensions.width}x${dimensions.height}: ${error.message}`);\n          \n          // æœ€å¾Œã®è©¦è¡Œã§ãªã„å ´åˆã¯ç¶šè¡Œ\n          if (i < fallbackSizes.length - 1) {\n            console.log(`ğŸ”„ Retrying with next size...`);\n            continue;\n          }\n        }\n      }\n      \n      // çµæœã«ãƒ¢ãƒ‡ãƒ«æƒ…å ±ã‚’å«ã‚ã‚‹\n      if (imageResult && imageResult.modelName) {\n        console.log(`ğŸ“¡ Used model: ${imageResult.modelName}`);\n      }\n      \n      const loader = new THREE.TextureLoader();\n      let texture;\n      if (imageResult && imageResult.success && (imageResult.imageUrl || imageResult.localPath)) {\n        // æˆåŠŸ: ç”Ÿæˆã•ã‚ŒãŸç”»åƒã‚’ãƒ†ã‚¯ã‚¹ãƒãƒ£ã¨ã—ã¦ä½¿ç”¨\n        let imageUrl = imageResult.imageUrl;\n        \n        // localPathã®å ´åˆã¯Webã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ãªURLã«å¤‰æ›\n        if (!imageUrl && imageResult.localPath) {\n          const filename = imageResult.localPath.split('/').pop();\n          imageUrl = `${this.client.serverUrl}/generated/${filename}`;\n        }\n        \n        console.log(`âœ… Image generated successfully: ${imageUrl}`);\n        texture = await loader.loadAsync(imageUrl);\n\n        // ãƒ†ã‚¯ã‚¹ãƒãƒ£ã®è‰²å½©ã‚’æ­£ç¢ºã«è¡¨ç¤ºã™ã‚‹ãŸã‚ã®è¨­å®š\n        texture.colorSpace = THREE.SRGBColorSpace; // æ­£ã—ã„ã‚«ãƒ©ãƒ¼ã‚¹ãƒšãƒ¼ã‚¹\n      } else {\n        // å¤±æ•—: ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ç”»åƒã‚’ä½¿ç”¨\n        console.log(`âš ï¸ Using fallback image (last error: ${lastError?.message || 'unknown'})`);\n        texture = this.createFallbackTexture(parsed.prompt);\n      }\n\n      const sizeScale = parsed.size?.scale ?? this.config.defaultObjectScale ?? 1;\n      const baseSize = 6 * sizeScale;\n\n      const imageWidth = texture.image?.naturalWidth || texture.image?.width || texture.source?.data?.width || 1;\n      const imageHeight = texture.image?.naturalHeight || texture.image?.height || texture.source?.data?.height || 1;\n      const aspectRatio = imageWidth / imageHeight || 1;\n\n      let planeWidth = baseSize;\n      let planeHeight = baseSize;\n      if (aspectRatio >= 1) {\n        planeWidth = baseSize;\n        planeHeight = baseSize / aspectRatio;\n      } else {\n        planeWidth = baseSize * aspectRatio;\n        planeHeight = baseSize;\n      }\n\n      // ç”»åƒã‚’è¡¨ç¤ºã™ã‚‹å¹³é¢ã‚¸ã‚ªãƒ¡ãƒˆãƒªã‚’ä½œæˆ\n      const geometry = new THREE.PlaneGeometry(planeWidth, planeHeight);\n      const material = new THREE.MeshBasicMaterial({\n        map: texture,\n        transparent: true,\n        side: THREE.DoubleSide, // ä¸¡é¢è¡¨ç¤º\n        toneMapped: false    // ãƒˆãƒ¼ãƒ³ãƒãƒƒãƒ”ãƒ³ã‚°ã‚’ç„¡åŠ¹åŒ–ï¼ˆã‚ˆã‚Šé®®ã‚„ã‹ãªè‰²å½©ï¼‰\n      });\n      \n      const plane = new THREE.Mesh(geometry, material);\n      \n      // ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°é †åºã‚’è¨­å®šï¼ˆç”»åƒã‚‚å‰é¢ã«è¡¨ç¤ºï¼‰\n      plane.renderOrder = 1000;  // é«˜ã„å€¤ã§å‰é¢ã«è¡¨ç¤º\n      material.depthTest = true;  // æ·±åº¦ãƒ†ã‚¹ãƒˆã¯æœ‰åŠ¹ã«\n      material.depthWrite = true; // æ·±åº¦æ›¸ãè¾¼ã¿ã‚‚æœ‰åŠ¹ã«\n      material.alphaTest = 0.01;\n      material.needsUpdate = true;\n\n      // ã‚«ãƒ¡ãƒ©ç›¸å¯¾ä½ç½®ã§é…ç½®ï¼ˆã‚«ãƒ¡ãƒ©ã®å‘ãã‚‚è€ƒæ…®ï¼‰\n      if (this.camera) {\n        const finalPosition = this.calculateCameraRelativePosition(parsed.position);\n        plane.position.copy(finalPosition);\n        this.alignPlaneToCamera(plane);\n      } else {\n        // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: çµ¶å¯¾åº§æ¨™\n        plane.position.set(parsed.position.x, parsed.position.y, parsed.position.z);\n      }\n      \n      // ã‚¹ã‚±ãƒ¼ãƒ«ã¯å¹…è¨ˆç®—ã«å«ã‚ã¦ã„ã‚‹ã®ã§ã€ã“ã“ã§ã¯1.0ã«å›ºå®š\n      plane.scale.setScalar(1.0);\n      \n      // è­˜åˆ¥ç”¨ã®åå‰ã¨ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿\n      const objectId = `generated_${++this.objectCounter}`;\n      plane.name = objectId;\n      plane.userData = {\n        id: objectId,\n        prompt: parsed.prompt,\n        createdAt: Date.now(),\n        type: 'generated_image',\n        source: 'generated_image',\n        modelName: imageResult?.modelName || this.selectedImageService || null,\n        keywords: this.buildObjectKeywordHints({ prompt: parsed.prompt, baseType: 'image' })\n      };\n      \n      this.experimentGroup.add(plane);\n      this.spawnedObjects.set(objectId, plane);\n\n      console.log(`âœ… Created object: ${objectId} at (${parsed.position.x}, ${parsed.position.y}, ${parsed.position.z})`);\n\n      // ç”Ÿæˆä½ç½®ã«ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’è¿½åŠ ï¼ˆè¦–è¦šçš„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ï¼‰\n      if (this.config.showLocationIndicator) {\n        this.createLocationIndicator(parsed.position);\n      }\n      \n      return {\n        objectId,\n        position: parsed.position,\n        prompt: parsed.prompt,\n        modelName: imageResult?.modelName,\n        success: true\n      };\n      \n    } catch (error) {\n      console.error('ğŸ¨ Image generation failed:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * å‹•ç”»ç”Ÿæˆå®Ÿè¡Œ\n   */\n  async executeVideoGeneration(parsed) {\n    try {\n      console.log(`ğŸ¬ Generating video: \"${parsed.prompt}\"`);\n      console.log('ğŸ” Video generation - selectedVideoService:', this.selectedVideoService);\n      \n      // ChocoDro ClientçµŒç”±ã§å‹•ç”»ç”Ÿæˆ\n      // ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”ã¯å„ãƒ¢ãƒ‡ãƒ«ã®ã‚µãƒãƒ¼ãƒˆçŠ¶æ³ã«å¿œã˜ã¦ã‚µãƒ¼ãƒãƒ¼å´ã§æœ€é©åŒ–\n      const videoResult = await this.client.generateVideo(parsed.prompt, {\n        duration: 3,\n        model: this.selectedVideoService || undefined\n        // width, heightæŒ‡å®šã‚’å‰Šé™¤ã—ã¦ã‚µãƒ¼ãƒãƒ¼å´ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ(16:9)ã‚’ä½¿ç”¨\n      });\n      \n      // çµæœã«ãƒ¢ãƒ‡ãƒ«æƒ…å ±ã‚’å«ã‚ã‚‹\n      if (videoResult.modelName) {\n        console.log(`ğŸ“¡ Used model: ${videoResult.modelName}`);\n      }\n      \n      let videoTexture;\n      let video = null; // videoå¤‰æ•°ã‚’ã‚¹ã‚³ãƒ¼ãƒ—å¤–ã§å®šç¾©\n      \n      if (videoResult.success && videoResult.videoUrl) {\n        // æˆåŠŸ: ç”Ÿæˆã•ã‚ŒãŸå‹•ç”»ã‚’ãƒ†ã‚¯ã‚¹ãƒãƒ£ã¨ã—ã¦ä½¿ç”¨\n        console.log(`âœ… Video generated successfully: ${videoResult.videoUrl}`);\n        \n        // HTML5 videoè¦ç´ ã‚’ä½œæˆ\n        video = document.createElement('video');\n        video.src = videoResult.videoUrl;\n        video.crossOrigin = 'anonymous';\n        video.loop = true;\n        video.muted = true; // åˆæœŸã¯ãƒŸãƒ¥ãƒ¼ãƒˆï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ‰‹å‹•ã§éŸ³å£°åˆ¶å¾¡ï¼‰\n        video.playsInline = true;\n        \n        // å‹•ç”»ãƒ†ã‚¯ã‚¹ãƒãƒ£ã‚’ä½œæˆ\n        videoTexture = new THREE.VideoTexture(video);\n        videoTexture.colorSpace = THREE.SRGBColorSpace;\n        \n        // å‹•ç”»ã®è‡ªå‹•å†ç”Ÿã‚’é–‹å§‹\n        video.addEventListener('loadeddata', () => {\n          video.play().catch(console.error);\n        });\n        \n      } else {\n        // å¤±æ•—: ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼å‹•ç”»ãƒ†ã‚¯ã‚¹ãƒãƒ£ã‚’ä½¿ç”¨\n        console.log(`âš ï¸ Using fallback video texture`);\n        videoTexture = this.createFallbackVideoTexture(parsed.prompt);\n      }\n      \n      // å‹•ç”»ã‚’è¡¨ç¤ºã™ã‚‹å¹³é¢ã‚¸ã‚ªãƒ¡ãƒˆãƒªã‚’ä½œæˆï¼ˆã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”ã‚’è€ƒæ…®ï¼‰\n      const sizeScale = parsed.size?.scale ?? this.config.defaultObjectScale ?? 1;\n      const baseSize = 6 * sizeScale;\n\n      const requestedWidth = videoResult.metadata?.width || 512;\n      const requestedHeight = videoResult.metadata?.height || 512;\n      const planeAspect = requestedWidth && requestedHeight ? requestedWidth / requestedHeight : 1;\n\n      let planeWidth = baseSize;\n      let planeHeight = baseSize;\n\n      if (planeAspect >= 1) {\n        planeHeight = baseSize / planeAspect;\n      } else {\n        planeWidth = baseSize * planeAspect;\n      }\n\n      const geometry = new THREE.PlaneGeometry(planeWidth, planeHeight);\n      const material = new THREE.MeshBasicMaterial({\n        map: videoTexture,\n        transparent: false,\n        side: THREE.DoubleSide,\n        toneMapped: false\n      });\n      \n      const plane = new THREE.Mesh(geometry, material);\n      \n      // ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°é †åºã‚’è¨­å®šï¼ˆå‹•ç”»ã‚’å‰é¢ã«è¡¨ç¤ºï¼‰\n      plane.renderOrder = 1000;  // é«˜ã„å€¤ã§å‰é¢ã«è¡¨ç¤º\n      material.depthTest = true;  // æ·±åº¦ãƒ†ã‚¹ãƒˆã¯æœ‰åŠ¹ã«\n      material.depthWrite = true; // æ·±åº¦æ›¸ãè¾¼ã¿ã‚‚æœ‰åŠ¹ã«\n      \n      // ã‚«ãƒ¡ãƒ©ç›¸å¯¾ä½ç½®ã§é…ç½®\n      if (this.camera) {\n        const finalPosition = this.calculateCameraRelativePosition(parsed.position);\n        plane.position.copy(finalPosition);\n        this.alignPlaneToCamera(plane);\n      } else {\n        plane.position.set(parsed.position.x, parsed.position.y, parsed.position.z);\n      }\n\n      // ã‚¹ã‚±ãƒ¼ãƒ«ã¯å¹…è¨ˆç®—ã«å«ã‚ã¦ã„ã‚‹ã®ã§ã€ã“ã“ã§ã¯1.0ã«å›ºå®š\n      plane.scale.setScalar(1.0);\n\n      // è­˜åˆ¥ç”¨ã®åå‰ã¨ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿\n      const objectId = `generated_video_${++this.objectCounter}`;\n      plane.name = objectId;\n      plane.userData = {\n        id: objectId,\n        prompt: parsed.prompt,\n        createdAt: Date.now(),\n        type: 'generated_video',\n        source: 'generated_video',\n        videoUrl: videoResult.videoUrl,\n        modelName: videoResult.modelName || this.selectedVideoService || null,\n        width: requestedWidth,\n        height: requestedHeight,\n        videoElement: video,\n        keywords: this.buildObjectKeywordHints({ prompt: parsed.prompt, baseType: 'video' })\n      };\n\n      // éŸ³å£°åˆ¶å¾¡UIã‚’ä½œæˆ\n      this.createAudioControl(plane);\n      \n      this.experimentGroup.add(plane);\n      this.spawnedObjects.set(objectId, plane);\n      \n      console.log(`âœ… Created video object: ${objectId} at (${parsed.position.x}, ${parsed.position.y}, ${parsed.position.z})`);\n      \n      // ç”Ÿæˆä½ç½®ã«ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’è¿½åŠ \n      if (this.config.showLocationIndicator) {\n        this.createLocationIndicator(parsed.position);\n      }\n      \n      return {\n        objectId,\n        position: parsed.position,\n        prompt: parsed.prompt,\n        modelName: videoResult.modelName,\n        videoUrl: videoResult.videoUrl,\n        success: true\n      };\n      \n    } catch (error) {\n      console.error('ğŸ¬ Video generation failed:', error);\n      \n      // ã‚¨ãƒ©ãƒ¼æ™‚ã‚‚ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼å‹•ç”»ã‚’è¡¨ç¤º\n      console.log('ğŸ”„ Creating fallback video plane due to generation error');\n      const fallbackVideoTexture = this.createFallbackVideoTexture(parsed.prompt);\n      \n      // å‹•ç”»ã‚’è¡¨ç¤ºã™ã‚‹å¹³é¢ã‚¸ã‚ªãƒ¡ãƒˆãƒªã‚’ä½œæˆ\n      const sizeScale = parsed.size?.scale ?? this.config.defaultObjectScale ?? 1;\n      const baseSize = 6 * sizeScale;\n      const geometry = new THREE.PlaneGeometry(baseSize, baseSize);\n      const material = new THREE.MeshBasicMaterial({\n        map: fallbackVideoTexture,\n        transparent: false,\n        side: THREE.DoubleSide,\n        toneMapped: false\n      });\n      \n      const plane = new THREE.Mesh(geometry, material);\n      \n      // ã‚«ãƒ¡ãƒ©ç›¸å¯¾ä½ç½®ã§é…ç½®\n      if (this.camera) {\n        const finalPosition = this.calculateCameraRelativePosition(parsed.position);\n        plane.position.copy(finalPosition);\n        this.alignPlaneToCamera(plane);\n      } else {\n        plane.position.set(parsed.position.x, parsed.position.y, parsed.position.z);\n      }\n\n      plane.scale.setScalar(1.0);\n\n      // è­˜åˆ¥ç”¨ã®åå‰ã¨ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿\n      const objectId = `generated_video_${++this.objectCounter}`;\n      plane.name = objectId;\n      plane.userData = {\n        id: objectId,\n        prompt: parsed.prompt,\n        createdAt: Date.now(),\n        type: 'generated_video',\n        source: 'generated_video',\n        videoUrl: null, // ã‚¨ãƒ©ãƒ¼æ™‚ã¯null\n        modelName: 'Error Fallback',\n        width: 512,\n        height: 512,\n        videoElement: null,\n        error: error.message,\n        keywords: this.buildObjectKeywordHints({ prompt: parsed.prompt, baseType: 'video' })\n      };\n\n      // ã‚·ãƒ¼ãƒ³ã«è¿½åŠ \n      this.scene.add(plane);\n      console.log('ğŸ“ Fallback video plane added to scene');\n\n      return {\n        success: false,\n        error: error.message,\n        object: plane,\n        prompt: parsed.prompt\n      };\n    }\n  }\n\n  async loadImageFile(fileUrl, options = {}) {\n    try {\n      const { position = { x: 0, y: 5, z: -10 }, fileName = null } = options;\n      \n      console.log(`ğŸ“ Loading image file: ${fileUrl}`);\n      \n      // ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ãƒ†ã‚¯ã‚¹ãƒãƒ£ã‚’èª­ã¿è¾¼ã¿\n      const loader = new THREE.TextureLoader();\n      const texture = await loader.loadAsync(fileUrl);\n\n      // ãƒ†ã‚¯ã‚¹ãƒãƒ£ã®è‰²å½©ã‚’æ­£ç¢ºã«è¡¨ç¤ºã™ã‚‹ãŸã‚ã®è¨­å®š\n      texture.colorSpace = THREE.SRGBColorSpace;\n\n      // ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”ã‚’ç®—å‡ºï¼ˆfallback: 1ï¼‰\n      const imageWidth = texture.image?.naturalWidth || texture.image?.width || texture.source?.data?.width || 1;\n      const imageHeight = texture.image?.naturalHeight || texture.image?.height || texture.source?.data?.height || 1;\n      const aspectRatio = imageWidth / imageHeight || 1;\n      \n      const baseSize = 6;\n      let width = baseSize;\n      let height = baseSize;\n      if (aspectRatio >= 1) {\n        width = baseSize;\n        height = baseSize / aspectRatio;\n      } else {\n        width = baseSize * aspectRatio;\n        height = baseSize;\n      }\n\n      // ç”»åƒã‚’è¡¨ç¤ºã™ã‚‹å¹³é¢ã‚¸ã‚ªãƒ¡ãƒˆãƒªã‚’ä½œæˆï¼ˆç¸¦æ¨ªæ¯”ã‚’ç¶­æŒï¼‰\n      const geometry = new THREE.PlaneGeometry(width, height);\n      const material = new THREE.MeshBasicMaterial({\n        map: texture,\n        transparent: true,\n        side: THREE.DoubleSide,\n        toneMapped: false\n      });\n      material.alphaTest = 0.01;\n      material.needsUpdate = true;\n      \n      const plane = new THREE.Mesh(geometry, material);\n\n      // ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°é †åºã‚’è¨­å®š\n      plane.renderOrder = 1000;\n      material.depthTest = true;\n      material.depthWrite = true;\n      \n      // ã‚«ãƒ¡ãƒ©ç›¸å¯¾ä½ç½®ã§é…ç½®\n      if (this.camera) {\n        const finalPosition = this.calculateCameraRelativePosition(position);\n        plane.position.copy(finalPosition);\n        this.alignPlaneToCamera(plane);\n      } else {\n        plane.position.set(position.x, position.y, position.z);\n      }\n      \n      plane.scale.setScalar(1.0);\n      \n      // ãƒ•ã‚¡ã‚¤ãƒ«åã‹ã‚‰promptã‚’ä½œæˆï¼ˆæ‹¡å¼µå­ã‚’é™¤å»ï¼‰\n      const prompt = fileName ? fileName.replace(/\\.[^/.]+$/, '') : 'imported_image';\n\n      // è­˜åˆ¥ç”¨ã®åå‰ã¨ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿\n      const objectId = `imported_image_${++this.objectCounter}`;\n      plane.name = objectId;\n      plane.userData = {\n        id: objectId,\n        source: 'imported_file',\n        createdAt: Date.now(),\n        type: 'generated_image',\n        prompt: prompt, // ãƒ•ã‚¡ã‚¤ãƒ«åã‚’promptã¨ã—ã¦è¨­å®š\n        fileName: fileName, // å…ƒã®ãƒ•ã‚¡ã‚¤ãƒ«åã‚‚ä¿å­˜\n        importOrder: this.objectCounter, // ã‚¤ãƒ³ãƒãƒ¼ãƒˆé †åºã‚’è¨˜éŒ²\n        keywords: this.buildObjectKeywordHints({ prompt, fileName, baseType: 'image' })\n      };\n      \n      this.experimentGroup.add(plane);\n      this.spawnedObjects.set(objectId, plane);\n\n      console.log(`âœ… Created imported image: ${objectId} at (${position.x}, ${position.y}, ${position.z})`);\n\n      // ç”Ÿæˆä½ç½®ã«ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’è¿½åŠ \n      if (this.config.showLocationIndicator) {\n        this.createLocationIndicator(position);\n      }\n      \n      return {\n        objectId,\n        position: position,\n        success: true\n      };\n      \n    } catch (error) {\n      console.error('ğŸ“ Image file loading failed:', error);\n      throw error;\n    }\n  }\n\n  async loadVideoFile(fileUrl, options = {}) {\n    try {\n      const { position = { x: 0, y: 5, z: -10 }, fileName = null } = options;\n      \n      console.log(`ğŸ¬ Loading video file: ${fileUrl}`);\n      \n      // HTMLVideoElementã‚’ä½œæˆ\n      const video = document.createElement('video');\n      video.src = fileUrl;\n      video.loop = true;\n      video.muted = true;\n      video.playsInline = true;\n      video.autoplay = true;\n      video.preload = 'auto';\n\n      // VideoTextureã‚’ä½œæˆ\n      const videoTexture = new THREE.VideoTexture(video);\n      videoTexture.colorSpace = THREE.SRGBColorSpace;\n\n      // ãƒ“ãƒ‡ã‚ªã®èª­ã¿è¾¼ã¿ã¨ã‚µã‚¤ã‚ºå–å¾—\n      await new Promise((resolve, reject) => {\n        const handleLoaded = () => {\n          console.log(`ğŸ¬ Video loaded: ${video.videoWidth}x${video.videoHeight}`);\n          resolve();\n        };\n        const handleError = (event) => {\n          reject(event?.error || new Error('Video failed to load'));\n        };\n\n        video.addEventListener('loadedmetadata', handleLoaded, { once: true });\n        video.addEventListener('error', handleError, { once: true });\n        video.load();\n      });\n\n      try {\n        await video.play();\n      } catch (playError) {\n        console.warn('ğŸ¬ Video autoplay could not start automatically. Playback will require user interaction.', playError);\n      }\n      \n      // ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”ã‚’è¨ˆç®—ã—ã¦ã‚µã‚¤ã‚ºèª¿æ•´\n      const aspectRatio = video.videoWidth / video.videoHeight;\n      const baseSize = 6;\n      let width = baseSize;\n      let height = baseSize;\n      \n      if (aspectRatio > 1) {\n        height = baseSize / aspectRatio;\n      } else {\n        width = baseSize * aspectRatio;\n      }\n      \n      // å‹•ç”»ã‚’è¡¨ç¤ºã™ã‚‹å¹³é¢ã‚¸ã‚ªãƒ¡ãƒˆãƒªã‚’ä½œæˆ\n      const geometry = new THREE.PlaneGeometry(width, height);\n      const material = new THREE.MeshBasicMaterial({\n        map: videoTexture,\n        transparent: true,\n        side: THREE.DoubleSide,\n        toneMapped: false\n      });\n      material.alphaTest = 0.01;\n      material.needsUpdate = true;\n      \n      const plane = new THREE.Mesh(geometry, material);\n      \n      // ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°é †åºã‚’è¨­å®š\n      plane.renderOrder = 1000;\n      material.depthTest = true;\n      material.depthWrite = true;\n      \n      // ã‚«ãƒ¡ãƒ©ç›¸å¯¾ä½ç½®ã§é…ç½®\n      if (this.camera) {\n        const finalPosition = this.calculateCameraRelativePosition(position);\n        plane.position.copy(finalPosition);\n        this.alignPlaneToCamera(plane);\n      } else {\n        plane.position.set(position.x, position.y, position.z);\n      }\n      \n      plane.scale.setScalar(1.0);\n      \n      // ãƒ•ã‚¡ã‚¤ãƒ«åã‹ã‚‰promptã‚’ä½œæˆï¼ˆæ‹¡å¼µå­ã‚’é™¤å»ï¼‰\n      const prompt = fileName ? fileName.replace(/\\.[^/.]+$/, '') : 'imported_video';\n\n      // è­˜åˆ¥ç”¨ã®åå‰ã¨ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿\n      const objectId = `imported_video_${++this.objectCounter}`;\n      plane.name = objectId;\n      plane.userData = {\n        id: objectId,\n        source: 'imported_file',\n        createdAt: Date.now(),\n        type: 'generated_video',\n        videoElement: video,\n        objectUrl: fileUrl,\n        prompt: prompt, // ãƒ•ã‚¡ã‚¤ãƒ«åã‚’promptã¨ã—ã¦è¨­å®š\n        fileName: fileName, // å…ƒã®ãƒ•ã‚¡ã‚¤ãƒ«åã‚‚ä¿å­˜\n        importOrder: this.objectCounter, // ã‚¤ãƒ³ãƒãƒ¼ãƒˆé †åºã‚’è¨˜éŒ²\n        keywords: this.buildObjectKeywordHints({ prompt, fileName, baseType: 'video' })\n      };\n\n      // éŸ³å£°åˆ¶å¾¡UIã‚’ä½œæˆ\n      this.createAudioControl(plane);\n\n      this.experimentGroup.add(plane);\n      this.spawnedObjects.set(objectId, plane);\n      \n      console.log(`âœ… Created imported video: ${objectId} at (${position.x}, ${position.y}, ${position.z})`);\n      \n      // ç”Ÿæˆä½ç½®ã«ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’è¿½åŠ \n      if (this.config.showLocationIndicator) {\n        this.createLocationIndicator(position);\n      }\n      \n      return {\n        objectId,\n        position: position,\n        success: true\n      };\n      \n    } catch (error) {\n      console.error('ğŸ¬ Video file loading failed:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * è‡ªç„¶è¨€èªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæ“ä½œå®Ÿè¡Œ\n   */\n  async executeNaturalObjectModification(parsed) {\n    // ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’åå‰ã§æ¤œç´¢\n    const targetObjects = this.findObjectsByName(parsed.targetObjectName);\n    \n    if (targetObjects.length === 0) {\n      return {\n        success: false,\n        message: `ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã€Œ${parsed.targetObjectName}ã€ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ`\n      };\n    }\n    \n    console.log(`ğŸ” Found ${targetObjects.length} object(s) matching \"${parsed.targetObjectName}\"`);\n    \n    // è¤‡æ•°ã®å ´åˆã¯åºæ•°è©ã§é¸æŠã€ãªã‘ã‚Œã°æœ€åˆã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ\n    const targetObject = this.selectObjectFromMultiple(targetObjects, parsed.targetObjectName);\n    console.log(`ğŸ¯ Operating on object: ${targetObject.name}`);\n    \n    let modified = false;\n    \n    // è‰²å¤‰æ›´\n    if (parsed.color !== null && targetObject.material) {\n      if (targetObject.material.map) {\n        targetObject.material.color.setHex(parsed.color);\n        targetObject.material.needsUpdate = true;\n        console.log(`ğŸ¨ Texture color tint changed to: #${parsed.color.toString(16)}`);\n      } else {\n        targetObject.material.color.setHex(parsed.color);\n        targetObject.material.needsUpdate = true;\n        console.log(`ğŸ¨ Material color changed to: #${parsed.color.toString(16)}`);\n      }\n      modified = true;\n    }\n\n    // Phase 2: ã‚¨ãƒ•ã‚§ã‚¯ãƒˆé©ç”¨\n    if (parsed.effects && parsed.effects.length > 0) {\n      const effectsApplied = this.applyEffects(targetObject, parsed.effects);\n      if (effectsApplied) {\n        modified = true;\n      }\n    }\n    \n    // ä½ç½®ç§»å‹•\n    if (parsed.movement !== null) {\n      const currentPos = targetObject.position;\n      const newPos = {\n        x: currentPos.x + parsed.movement.x,\n        y: currentPos.y + parsed.movement.y,\n        z: currentPos.z + parsed.movement.z\n      };\n      \n      targetObject.position.set(newPos.x, newPos.y, newPos.z);\n      console.log(`ğŸ“ Position moved from (${currentPos.x.toFixed(1)}, ${currentPos.y.toFixed(1)}, ${currentPos.z.toFixed(1)}) to (${newPos.x.toFixed(1)}, ${newPos.y.toFixed(1)}, ${newPos.z.toFixed(1)})`);\n      modified = true;\n    }\n    \n    if (modified) {\n      // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æ›´æ–°\n      targetObject.userData.lastModified = Date.now();\n      targetObject.userData.modifications = targetObject.userData.modifications || [];\n      targetObject.userData.modifications.push({\n        timestamp: Date.now(),\n        color: parsed.color,\n        movement: parsed.movement,\n        command: `Natural language: ${parsed.targetObjectName}`\n      });\n      \n      return {\n        success: true,\n        message: `ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã€Œ${targetObject.name}ã€ã‚’å¤‰æ›´ã—ã¾ã—ãŸ`,\n        objectId: targetObject.name,\n        modifications: {\n          color: parsed.color,\n          movement: parsed.movement\n        }\n      };\n    } else {\n      return {\n        success: false,\n        message: 'å¤‰æ›´å¯èƒ½ãªå±æ€§ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ'\n      };\n    }\n  }\n  \n  /**\n   * åå‰ã§ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ¤œç´¢\n   */\n  findObjectsByName(searchName) {\n    const results = [];\n    const searchLower = searchName.toLowerCase();\n    \n    // ç”Ÿæˆã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰æ¤œç´¢\n    for (const [objectId, object] of this.spawnedObjects) {\n      // ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæƒ…å ±ã‹ã‚‰æ¤œç´¢\n      if (object.userData.prompt) {\n        const promptLower = object.userData.prompt.toLowerCase();\n        \n        // éƒ¨åˆ†ä¸€è‡´ã§æ¤œç´¢ï¼ˆã€Œãƒ¦ãƒ‹ã‚³ãƒ¼ãƒ³ã€ãŒã€Œãƒ¦ãƒ‹ã‚³ãƒ¼ãƒ³ã®ç”»åƒã€ã«ãƒãƒƒãƒï¼‰\n        if (promptLower.includes(searchLower)) {\n          results.push(object);\n          console.log(`âœ… Object match found: ${objectId} (prompt: \"${object.userData.prompt}\")`);\n        }\n      }\n      \n      // ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆåã‹ã‚‰ã‚‚æ¤œç´¢\n      if (object.name && object.name.toLowerCase().includes(searchLower)) {\n        results.push(object);\n        console.log(`âœ… Object match found: ${objectId} (name: \"${object.name}\")`);\n      }\n    }\n    \n    return results;\n  }\n  \n  /**\n   * è¤‡æ•°ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰åºæ•°è©ã§é¸æŠ\n   */\n  selectObjectFromMultiple(objects, originalCommand) {\n    // åºæ•°è©ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ãƒã‚§ãƒƒã‚¯\n    const ordinalPatterns = [\n      /(\\d+)ã¤ç›®ã®/, /(\\d+)ç•ªç›®ã®/, /(\\d+)å€‹ç›®ã®/,\n      /æœ€åˆã®|1ã¤ç›®ã®|1ç•ªç›®ã®|1å€‹ç›®ã®/,\n      /æœ€å¾Œã®|æœ€çµ‚ã®/,\n      /2ã¤ç›®ã®|2ç•ªç›®ã®|2å€‹ç›®ã®/,\n      /3ã¤ç›®ã®|3ç•ªç›®ã®|3å€‹ç›®ã®/\n    ];\n    \n    for (const pattern of ordinalPatterns) {\n      const match = originalCommand.match(pattern);\n      if (match) {\n        let index;\n        \n        if (match[1]) {\n          // æ•°å­—ãŒè¦‹ã¤ã‹ã£ãŸå ´åˆ\n          index = parseInt(match[1]) - 1; // 1ãƒ™ãƒ¼ã‚¹ã‹ã‚‰0ãƒ™ãƒ¼ã‚¹ã«å¤‰æ›\n        } else {\n          // ç‰¹åˆ¥ãªè¡¨ç¾ã®å ´åˆ\n          const matchedText = match[0];\n          if (matchedText.includes('æœ€åˆ') || matchedText.includes('1ã¤ç›®') || \n              matchedText.includes('1ç•ªç›®') || matchedText.includes('1å€‹ç›®')) {\n            index = 0;\n          } else if (matchedText.includes('æœ€å¾Œ') || matchedText.includes('æœ€çµ‚')) {\n            index = objects.length - 1;\n          } else if (matchedText.includes('2ã¤ç›®') || matchedText.includes('2ç•ªç›®') || matchedText.includes('2å€‹ç›®')) {\n            index = 1;\n          } else if (matchedText.includes('3ã¤ç›®') || matchedText.includes('3ç•ªç›®') || matchedText.includes('3å€‹ç›®')) {\n            index = 2;\n          }\n        }\n        \n        if (index >= 0 && index < objects.length) {\n          console.log(`ğŸ”¢ Selected object by ordinal: index ${index + 1} of ${objects.length}`);\n          return objects[index];\n        } else {\n          console.warn(`âš ï¸ Invalid ordinal index: ${index + 1} (available: 1-${objects.length})`);\n        }\n      }\n    }\n    \n    // åºæ•°è©ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§æœ€åˆã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ\n    console.log(`ğŸ”¢ No ordinal specified, using first object`);\n    return objects[0];\n  }\n\n  /**\n   * ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå¤‰æ›´å®Ÿè¡Œ\n   */\n  async executeObjectModification(parsed) {\n    // ã‚³ãƒãƒ³ãƒ‰ã‹ã‚‰å¯¾è±¡ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç‰¹å®š\n    let targetObject = this.findObjectByKeyword(parsed.command);\n    \n    // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§è¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã€é¸æŠã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½¿ç”¨\n    if (!targetObject) {\n      if (!this.selectedObject) {\n        return { \n          success: false, \n          message: 'ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’é¸æŠã™ã‚‹ã‹ã€å¯¾è±¡ã‚’æŒ‡å®šã—ã¦ãã ã•ã„ï¼ˆä¾‹ï¼šã€ŒçŒ«ã‚’èµ¤ãã—ã¦ã€ï¼‰' \n        };\n      }\n      targetObject = this.selectedObject;\n    } else {\n      // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§è¦‹ã¤ã‘ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’é¸æŠçŠ¶æ…‹ã«ã™ã‚‹\n      this.selectObject(targetObject);\n\n      // ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆèªè­˜æˆåŠŸã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ\n      this.applyRecognitionFeedback(targetObject);\n    }\n    console.log(`ğŸ”§ Modifying object: ${targetObject.name}`);\n    console.log(`ğŸ” Debug - parsed.movement:`, parsed.movement);\n    \n    let modified = false;\n    \n    // è‰²å¤‰æ›´\n    if (parsed.color !== null && targetObject.material) {\n      if (targetObject.material.map) {\n        // ãƒ†ã‚¯ã‚¹ãƒãƒ£ãŒã‚ã‚‹å ´åˆã¯è‰²èª¿å¤‰æ›´\n        targetObject.material.color.setHex(parsed.color);\n        targetObject.material.needsUpdate = true;\n        console.log(`ğŸ¨ Texture color tint changed to: #${parsed.color.toString(16)}`);\n      } else {\n        // ãƒ†ã‚¯ã‚¹ãƒãƒ£ãŒãªã„å ´åˆã¯ç›´æ¥è‰²å¤‰æ›´\n        targetObject.material.color.setHex(parsed.color);\n        targetObject.material.needsUpdate = true;\n        console.log(`ğŸ¨ Material color changed to: #${parsed.color.toString(16)}`);\n      }\n      modified = true;\n    }\n\n    // Phase 2: ã‚¨ãƒ•ã‚§ã‚¯ãƒˆé©ç”¨\n    if (parsed.effects && parsed.effects.length > 0) {\n      const effectsApplied = this.applyEffects(targetObject, parsed.effects);\n      if (effectsApplied) {\n        modified = true;\n      }\n    }\n    \n    // ã‚µã‚¤ã‚ºå¤‰æ›´\n    if (parsed.scale !== null) {\n      const currentScale = targetObject.scale.x; // ç¾åœ¨ã®ã‚¹ã‚±ãƒ¼ãƒ«å–å¾—\n      const newScale = currentScale * parsed.scale;\n      targetObject.scale.setScalar(newScale);\n      console.log(`ğŸ“ Scale changed from ${currentScale} to ${newScale}`);\n      modified = true;\n    }\n    \n    // ä½ç½®ç§»å‹•\n    if (parsed.movement !== null) {\n      // ç¾åœ¨ä½ç½®ã‹ã‚‰ç›¸å¯¾ç§»å‹•\n      const currentPos = targetObject.position;\n      const newPos = {\n        x: currentPos.x + parsed.movement.x,\n        y: currentPos.y + parsed.movement.y,\n        z: currentPos.z + parsed.movement.z\n      };\n\n      targetObject.position.set(newPos.x, newPos.y, newPos.z);\n      console.log(`ğŸ“ Position moved from (${currentPos.x.toFixed(1)}, ${currentPos.y.toFixed(1)}, ${currentPos.z.toFixed(1)}) to (${newPos.x.toFixed(1)}, ${newPos.y.toFixed(1)}, ${newPos.z.toFixed(1)})`);\n      modified = true;\n    }\n\n    // å›è»¢\n    if (parsed.rotation !== null) {\n      const currentRotation = targetObject.rotation.y;\n      const newRotation = currentRotation + parsed.rotation;\n      targetObject.rotation.y = newRotation;\n      const degrees = (parsed.rotation * 180 / Math.PI).toFixed(1);\n      console.log(`ğŸ”„ Rotation changed by ${degrees}Â° (new Y rotation: ${(newRotation * 180 / Math.PI).toFixed(1)}Â°)`);\n      modified = true;\n    }\n\n    // é€æ˜åº¦\n    if (parsed.opacity !== null && targetObject.material) {\n      const currentOpacity = targetObject.material.opacity || 1.0;\n      targetObject.material.opacity = parsed.opacity;\n      targetObject.material.transparent = parsed.opacity < 1.0;\n      console.log(`ğŸ” Opacity changed from ${currentOpacity.toFixed(2)} to ${parsed.opacity.toFixed(2)}`);\n      modified = true;\n    }\n\n    // å·¦å³åè»¢\n    if (parsed.flip) {\n      const currentScaleX = targetObject.scale.x;\n      targetObject.scale.x = -currentScaleX; // Xè»¸ã‚’åè»¢\n      console.log(`â†”ï¸ Object flipped horizontally (scale.x: ${currentScaleX} â†’ ${targetObject.scale.x})`);\n      modified = true;\n    }\n    \n    if (modified) {\n      // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æ›´æ–°\n      targetObject.userData.lastModified = Date.now();\n      targetObject.userData.modifications = targetObject.userData.modifications || [];\n      targetObject.userData.modifications.push({\n        timestamp: Date.now(),\n        color: parsed.color,\n        scale: parsed.scale,\n        movement: parsed.movement,\n        rotation: parsed.rotation,\n        opacity: parsed.opacity,\n        command: parsed.command\n      });\n\n      this.updateAllAudioControlPositions();\n\n      return {\n        success: true,\n        message: `ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã€Œ${targetObject.name}ã€ã‚’å¤‰æ›´ã—ã¾ã—ãŸ`,\n        objectId: targetObject.name,\n        modifications: {\n          color: parsed.color,\n          scale: parsed.scale,\n          movement: parsed.movement,\n          rotation: parsed.rotation,\n          opacity: parsed.opacity\n        }\n      };\n    } else {\n      return { \n        success: false, \n        message: 'å¤‰æ›´å¯èƒ½ãªå±æ€§ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ' \n      };\n    }\n  }\n\n  /**\n   * å‰Šé™¤å®Ÿè¡Œ\n   */\n  async executeDelete(parsed) {\n    // ã‚³ãƒãƒ³ãƒ‰ã®å®‰å…¨æ€§ãƒã‚§ãƒƒã‚¯\n    const command = parsed.command || '';\n    \n    // ã€Œã™ã¹ã¦ã€å‰Šé™¤ã®å ´åˆ\n    if (parsed.target === 'all' || command.includes('ã™ã¹ã¦') || command.includes('å…¨éƒ¨')) {\n      this.clearAll();\n      return { success: true, message: 'ã™ã¹ã¦ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å‰Šé™¤ã—ã¾ã—ãŸ' };\n    }\n    \n    // ã¾ãšã‚³ãƒãƒ³ãƒ‰ã‹ã‚‰å¯¾è±¡ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç‰¹å®š\n    const targetByKeyword = this.findObjectByKeyword(command);\n    \n    // å‰Šé™¤å¯¾è±¡ã®å„ªå…ˆé †ä½ï¼š\n    // 1. ã‚³ãƒãƒ³ãƒ‰ã§æŒ‡å®šã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ\n    // 2. é¸æŠã•ã‚Œã¦ã„ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ\n    // 3. ã‚³ãƒãƒ³ãƒ‰ãŒå˜ã«ã€Œå‰Šé™¤ã€ã ã‘ã®å ´åˆã¯é¸æŠã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å„ªå…ˆ\n    \n    let targetObject = null;\n    let deleteReason = '';\n    \n    // ã‚³ãƒãƒ³ãƒ‰ãŒå˜ç´”ãªå‰Šé™¤ã‚³ãƒãƒ³ãƒ‰ã‹åˆ¤å®š\n    const isSimpleDeleteCommand = command.match(/^(å‰Šé™¤|æ¶ˆã—ã¦|æ¶ˆã™|delete|remove)$/i);\n    \n    if (isSimpleDeleteCommand && this.selectedObject) {\n      // å˜ç´”ãªã€Œå‰Šé™¤ã€ã‚³ãƒãƒ³ãƒ‰ã§é¸æŠã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒã‚ã‚‹å ´åˆ\n      targetObject = this.selectedObject;\n      deleteReason = 'é¸æŠã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ';\n    } else if (targetByKeyword) {\n      // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§ç‰¹å®šã§ããŸå ´åˆ\n      targetObject = targetByKeyword;\n      deleteReason = 'ã‚³ãƒãƒ³ãƒ‰ã§æŒ‡å®šã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ';\n    } else if (this.selectedObject) {\n      // ãã®ä»–ã®å ´åˆã§é¸æŠã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒã‚ã‚‹å ´åˆ\n      targetObject = this.selectedObject;\n      deleteReason = 'é¸æŠã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ';\n    }\n    \n    if (targetObject) {\n      const objectId = targetObject.name;\n      console.log(`ğŸ—‘ï¸ Deleting ${deleteReason}: ${objectId}`);\n      \n      // é¸æŠçŠ¶æ…‹ã‚’è§£é™¤\n      if (targetObject === this.selectedObject) {\n        this.deselectObject();\n      }\n      \n      // ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å‰Šé™¤\n      const success = this.removeObject(objectId);\n      \n      if (success) {\n        return { \n          success: true, \n          message: `${deleteReason}ã€Œ${objectId}ã€ã‚’å‰Šé™¤ã—ã¾ã—ãŸ`,\n          deletedObjectId: objectId\n        };\n      } else {\n        return { \n          success: false, \n          message: 'ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ' \n        };\n      }\n    }\n    \n    return { \n      success: false, \n      message: 'å‰Šé™¤å¯¾è±¡ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’é¸æŠã™ã‚‹ã‹ã€å¯¾è±¡ã‚’æŒ‡å®šã—ã¦ãã ã•ã„' \n    };\n  }\n\n  async executeFileImport(parsed) {\n    try {\n      console.log('ğŸ« Starting file import process...');\n      \n      // ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤º\n      const input = document.createElement('input');\n      input.type = 'file';\n      input.style.display = 'none';\n      \n      if (parsed.fileType === 'video') {\n        input.accept = 'video/*';\n      } else {\n        input.accept = 'image/*';\n      }\n      \n      document.body.appendChild(input);\n      \n      return new Promise((resolve, reject) => {\n        input.onchange = async (event) => {\n          try {\n            const file = event.target.files[0];\n            if (!file) {\n              reject(new Error('ãƒ•ã‚¡ã‚¤ãƒ«ãŒé¸æŠã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ'));\n              return;\n            }\n            \n            console.log(`ğŸ“ Selected file: ${file.name}`);\n            \n            // ãƒ•ã‚¡ã‚¤ãƒ«ã®ObjectURLã‚’ä½œæˆ\n            const fileUrl = URL.createObjectURL(file);\n            \n            let result;\n            if (parsed.fileType === 'video' || file.type.startsWith('video/')) {\n              result = await this.loadVideoFile(fileUrl, { position: parsed.position });\n            } else {\n              result = await this.loadImageFile(fileUrl, { position: parsed.position });\n            }\n            \n            console.log('âœ… File import completed:', result);\n            resolve(result);\n            \n          } catch (error) {\n            console.error('âŒ File import failed:', error);\n            reject(error);\n          } finally {\n            document.body.removeChild(input);\n          }\n        };\n        \n        input.oncancel = () => {\n          document.body.removeChild(input);\n          reject(new Error('ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠãŒã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã¾ã—ãŸ'));\n        };\n        \n        input.click();\n      });\n      \n    } catch (error) {\n      console.error('âŒ File import execution failed:', error);\n      throw error;\n    }\n  }\n\n  async executeObjectSelection(parsed) {\n    try {\n      console.log('ğŸ¯ Starting object selection...');\n      \n      const objects = this.getSpawnedObjects();\n      if (objects.length === 0) {\n        throw new Error('é¸æŠå¯èƒ½ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒã‚ã‚Šã¾ã›ã‚“ã€‚ã¾ãšãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ãã ã•ã„ã€‚');\n      }\n      \n      console.log(`ğŸ“‹ Available objects: ${objects.length}`);\n      \n      // ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆé¸æŠUIã‚’ä½œæˆ\n      const modal = document.createElement('div');\n      modal.style.cssText = `\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background: rgba(0, 0, 0, 0.8);\n        z-index: 10000;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n      `;\n      \n      const container = document.createElement('div');\n      container.style.cssText = `\n        background: #1a1a2e;\n        border-radius: 12px;\n        padding: 24px;\n        max-width: 500px;\n        max-height: 70vh;\n        overflow-y: auto;\n        color: white;\n        font-family: Arial, sans-serif;\n      `;\n      \n      const title = document.createElement('h3');\n      title.textContent = 'ğŸ¯ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„';\n      title.style.cssText = 'margin: 0 0 16px 0; color: #ec4899;';\n      container.appendChild(title);\n      \n      const objectList = document.createElement('div');\n      objectList.style.cssText = 'margin-bottom: 16px;';\n      \n      objects.forEach((obj, index) => {\n        const item = document.createElement('div');\n        item.style.cssText = `\n          padding: 12px;\n          margin: 8px 0;\n          background: #2a2a3e;\n          border-radius: 8px;\n          cursor: pointer;\n          border: 2px solid transparent;\n          transition: all 0.3s ease;\n        `;\n        \n        const name = obj.userData?.type === 'generated_image' ? 'ğŸ–¼ï¸ ç”»åƒ' : \n                     obj.userData?.type === 'generated_video' ? 'ğŸ¬ å‹•ç”»' : 'ğŸ“„ ãƒ•ã‚¡ã‚¤ãƒ«';\n        const time = new Date(obj.userData?.createdAt).toLocaleTimeString();\n        \n        item.innerHTML = `\n          <div style=\"font-weight: bold;\">${name} #${index + 1}</div>\n          <div style=\"font-size: 12px; color: #94a3b8;\">ä½œæˆ: ${time}</div>\n          <div style=\"font-size: 12px; color: #94a3b8;\">ä½ç½®: (${Math.round(obj.position.x)}, ${Math.round(obj.position.y)}, ${Math.round(obj.position.z)})</div>\n        `;\n        \n        item.onmouseover = () => {\n          item.style.borderColor = '#ec4899';\n          item.style.background = '#3a3a4e';\n        };\n        \n        item.onmouseout = () => {\n          item.style.borderColor = 'transparent';\n          item.style.background = '#2a2a3e';\n        };\n        \n        item.onclick = () => {\n          resolve({ selectedObjectId: obj.id, selectedObject: obj });\n          document.body.removeChild(modal);\n        };\n        \n        objectList.appendChild(item);\n      });\n      \n      container.appendChild(objectList);\n      \n      const cancelBtn = document.createElement('button');\n      cancelBtn.textContent = 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«';\n      cancelBtn.style.cssText = `\n        background: #666;\n        color: white;\n        border: none;\n        padding: 8px 16px;\n        border-radius: 6px;\n        cursor: pointer;\n        font-size: 14px;\n      `;\n      \n      cancelBtn.onclick = () => {\n        document.body.removeChild(modal);\n        reject(new Error('ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆé¸æŠãŒã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã¾ã—ãŸ'));\n      };\n      \n      container.appendChild(cancelBtn);\n      modal.appendChild(container);\n      document.body.appendChild(modal);\n      \n      return new Promise((resolve, reject) => {\n        // Promise handlers are set up in the click events above\n      });\n      \n    } catch (error) {\n      console.error('âŒ Object selection failed:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç”¨ã®ãƒ†ã‚¯ã‚¹ãƒãƒ£ä½œæˆ\n   */\n  createFallbackTexture(prompt) {\n    const canvas = document.createElement('canvas');\n    canvas.width = 512;\n    canvas.height = 512;\n    const ctx = canvas.getContext('2d');\n    \n    // ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ™ãƒ¼ã‚¹ã®è‰²ã‚’ç”Ÿæˆ\n    const hash = this.hashString(prompt);\n    const hue = hash % 360;\n    \n    // ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³èƒŒæ™¯\n    const gradient = ctx.createLinearGradient(0, 0, 512, 512);\n    gradient.addColorStop(0, `hsl(${hue}, 70%, 60%)`);\n    gradient.addColorStop(1, `hsl(${(hue + 60) % 360}, 70%, 40%)`);\n    \n    ctx.fillStyle = gradient;\n    ctx.fillRect(0, 0, 512, 512);\n    \n    // ãƒ†ã‚­ã‚¹ãƒˆæç”»\n    ctx.fillStyle = 'white';\n    ctx.font = '24px Arial';\n    ctx.textAlign = 'center';\n    ctx.fillText('ğŸ¨', 256, 230);\n    \n    ctx.font = '16px Arial';\n    ctx.fillText(prompt.slice(0, 20), 256, 270);\n    \n    ctx.font = '14px Arial';\n    ctx.fillStyle = 'rgba(255,255,255,0.7)';\n    ctx.fillText('Placeholder Image', 256, 300);\n    \n    return new THREE.CanvasTexture(canvas);\n  }\n\n  /**\n   * ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç”¨ã®å‹•ç”»ãƒ†ã‚¯ã‚¹ãƒãƒ£ä½œæˆ\n   */\n  createFallbackVideoTexture(prompt) {\n    const canvas = document.createElement('canvas');\n    canvas.width = 512;\n    canvas.height = 512;\n    const ctx = canvas.getContext('2d');\n    \n    // ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ™ãƒ¼ã‚¹ã®è‰²ã‚’ç”Ÿæˆ\n    const hash = this.hashString(prompt);\n    const hue = hash % 360;\n    \n    // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã®å¤‰æ•°\n    let animationFrame = 0;\n    \n    const animate = () => {\n      // ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³èƒŒæ™¯ï¼ˆæ™‚é–“ã§å¤‰åŒ–ï¼‰\n      const gradient = ctx.createLinearGradient(0, 0, 512, 512);\n      const offset = (animationFrame * 2) % 360;\n      gradient.addColorStop(0, `hsl(${(hue + offset) % 360}, 70%, 60%)`);\n      gradient.addColorStop(1, `hsl(${(hue + offset + 60) % 360}, 70%, 40%)`);\n      \n      ctx.fillStyle = gradient;\n      ctx.fillRect(0, 0, 512, 512);\n      \n      // å‹•çš„ãƒ†ã‚­ã‚¹ãƒˆæç”»\n      ctx.fillStyle = 'white';\n      ctx.font = '24px Arial';\n      ctx.textAlign = 'center';\n      \n      // å‹•ç”»ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³\n      const icons = ['ğŸ¬', 'ğŸ¥', 'ğŸ“¹', 'ğŸï¸'];\n      const iconIndex = Math.floor(animationFrame / 10) % icons.length;\n      ctx.fillText(icons[iconIndex], 256, 230);\n      \n      ctx.font = '16px Arial';\n      ctx.fillText(prompt.slice(0, 20), 256, 270);\n      \n      ctx.font = '14px Arial';\n      ctx.fillStyle = 'rgba(255,255,255,0.7)';\n      ctx.fillText('Placeholder Video', 256, 300);\n      \n      animationFrame++;\n      \n      // 60FPSã§ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³\n      setTimeout(() => requestAnimationFrame(animate), 1000/60);\n    };\n    \n    // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹\n    animate();\n    \n    return new THREE.CanvasTexture(canvas);\n  }\n\n  /**\n   * æ–‡å­—åˆ—ã®ãƒãƒƒã‚·ãƒ¥å€¤ã‚’è¨ˆç®—\n   */\n  hashString(str) {\n    let hash = 0;\n    for (let i = 0; i < str.length; i++) {\n      const char = str.charCodeAt(i);\n      hash = ((hash << 5) - hash) + char;\n      hash = hash & hash; // 32bitæ•´æ•°ã«å¤‰æ›\n    }\n    return Math.abs(hash);\n  }\n\n  /**\n   * ç”Ÿæˆã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§å–å¾—\n   */\n  getSpawnedObjects() {\n    return Array.from(this.spawnedObjects.entries()).map(([id, object]) => ({\n      id,\n      name: object.name,\n      userData: object.userData,\n      position: object.position.clone()\n    }));\n  }\n\n  /**\n   * ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå‰Šé™¤\n   */\n  removeObject(objectId) {\n    const object = this.spawnedObjects.get(objectId);\n    if (object) {\n      if (object.userData?.videoElement) {\n        const videoElement = object.userData.videoElement;\n        try {\n          videoElement.pause();\n          if (typeof videoElement.removeAttribute === 'function') {\n            videoElement.removeAttribute('src');\n          } else {\n            videoElement.src = '';\n          }\n          if (typeof videoElement.load === 'function') {\n            videoElement.load();\n          }\n        } catch (error) {\n          console.warn('ğŸ¬ Failed to release video element resources:', error);\n        }\n      }\n\n      if (object.userData?.objectUrl) {\n        try {\n          URL.revokeObjectURL(object.userData.objectUrl);\n        } catch (error) {\n          console.warn('ğŸ¬ Failed to revoke object URL:', error);\n        }\n      }\n\n      if (object.userData?.cleanupCallbacks) {\n        try {\n          object.userData.cleanupCallbacks.forEach(cb => {\n            if (typeof cb === 'function') cb();\n          });\n        } catch (error) {\n          console.warn('ğŸ§¹ Cleanup callbacks failed:', error);\n        }\n      }\n\n      this.experimentGroup.remove(object);\n      this.spawnedObjects.delete(objectId);\n      \n      // ã‚¸ã‚ªãƒ¡ãƒˆãƒªã¨ãƒãƒ†ãƒªã‚¢ãƒ«ã®ãƒ¡ãƒ¢ãƒªè§£æ”¾\n      if (object.geometry) object.geometry.dispose();\n      if (object.material) {\n        const materials = Array.isArray(object.material) ? object.material : [object.material];\n        materials.forEach(mat => {\n          if (mat.map && typeof mat.map.dispose === 'function') {\n            mat.map.dispose();\n          }\n          mat.dispose();\n        });\n      }\n      \n      console.log(`ğŸ—‘ï¸ Removed object: ${objectId}`);\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * å…¨ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå‰Šé™¤\n   */\n  clearAll() {\n    const objectIds = Array.from(this.spawnedObjects.keys());\n    objectIds.forEach(id => this.removeObject(id));\n    console.log('ğŸ§¹ Cleared all experimental objects');\n  }\n\n  /**\n   * ã‚³ãƒãƒ³ãƒ‰å±¥æ­´å–å¾—\n   */\n  getCommandHistory() {\n    return [...this.commandHistory];\n  }\n\n  /**\n   * ç”Ÿæˆä½ç½®ã«ä¸€æ™‚çš„ãªè¦–è¦šã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã‚’è¡¨ç¤º\n   */\n  createLocationIndicator(relativePosition) {\n    // ç›®ç«‹ã¤å…‰ã‚‹çƒä½“ã‚’ä½œæˆ\n    const geometry = new THREE.SphereGeometry(1, 16, 16);\n    const material = new THREE.MeshBasicMaterial({\n      color: 0x00ff00,\n      transparent: true,\n      opacity: 0.9\n    });\n    \n    const indicator = new THREE.Mesh(geometry, material);\n    \n    // ã‚«ãƒ¡ãƒ©ç›¸å¯¾ä½ç½®ã§ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã‚‚é…ç½®\n    if (this.camera) {\n      const indicatorPos = this.calculateCameraRelativePosition({\n        x: relativePosition.x,\n        y: relativePosition.y + 2, // ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å°‘ã—ä¸Šã«è¡¨ç¤º\n        z: relativePosition.z\n      });\n      indicator.position.copy(indicatorPos);\n    } else {\n      indicator.position.set(relativePosition.x, relativePosition.y + 2, relativePosition.z);\n    }\n    \n    console.log(`ğŸŸ¢ ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼è¡¨ç¤º: (${indicator.position.x.toFixed(1)}, ${indicator.position.y.toFixed(1)}, ${indicator.position.z.toFixed(1)})`);\n    \n    this.scene.add(indicator);\n    \n    // è¨­å®šã•ã‚ŒãŸæ™‚é–“å¾Œã«è‡ªå‹•å‰Šé™¤\n    setTimeout(() => {\n      this.scene.remove(indicator);\n      geometry.dispose();\n      material.dispose();\n    }, this.config.indicatorDuration);\n    \n    // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆç‚¹æ»…åŠ¹æœï¼‰\n    let opacity = 0.8;\n    let direction = -1;\n    const animate = () => {\n      opacity += direction * 0.05;\n      if (opacity <= 0.3) direction = 1;\n      if (opacity >= 0.8) direction = -1;\n      \n      material.opacity = opacity;\n      \n      if (indicator.parent) {\n        requestAnimationFrame(animate);\n      }\n    };\n    animate();\n  }\n\n  /**\n   * ã‚«ãƒ¡ãƒ©ç›¸å¯¾ä½ç½®è¨ˆç®—ï¼ˆç”»é¢åº§æ¨™å¯¾å¿œï¼‰\n   */\n  calculateCameraRelativePosition(relativePosition) {\n    if (!this.camera) {\n      if (this.config.enableDebugLogging) {\n        console.warn('ğŸ“· Camera not available, using fallback positioning');\n      }\n      return new THREE.Vector3(relativePosition.x, relativePosition.y, relativePosition.z);\n    }\n\n    try {\n      // ã‚«ãƒ¡ãƒ©ã®ä½ç½®ã¨æ–¹å‘ã‚’å–å¾—\n      const cameraPos = this.camera.position.clone();\n      const cameraDirection = new THREE.Vector3();\n      this.camera.getWorldDirection(cameraDirection);\n      \n      // ã‚«ãƒ¡ãƒ©ã®å³æ–¹å‘ã¨ä¸Šæ–¹å‘ã‚’è¨ˆç®—\n      const cameraRight = new THREE.Vector3();\n      const cameraUp = new THREE.Vector3(0, 1, 0); // ãƒ¯ãƒ¼ãƒ«ãƒ‰ã®ä¸Šæ–¹å‘\n      cameraRight.crossVectors(cameraDirection, cameraUp).normalize();\n      const cameraUpActual = new THREE.Vector3();\n      cameraUpActual.crossVectors(cameraRight, cameraDirection).normalize();\n\n      // ç›¸å¯¾ä½ç½®ã‚’ã‚«ãƒ¡ãƒ©åº§æ¨™ç³»ã§è¨ˆç®—\n      const finalPosition = cameraPos.clone();\n      \n      // å‰å¾Œæ–¹å‘ï¼ˆZè»¸ï¼‰: ã‚«ãƒ¡ãƒ©ã®å‘ãã«æ²¿ã£ã¦ï¼ˆæ­£ã®å€¤ã§å‰æ–¹ã€è² ã®å€¤ã§å¾Œæ–¹ï¼‰\n      finalPosition.add(cameraDirection.clone().multiplyScalar(relativePosition.z));\n      \n      // å·¦å³æ–¹å‘ï¼ˆXè»¸ï¼‰: ã‚«ãƒ¡ãƒ©ã®å³æ–¹å‘ã«æ²¿ã£ã¦\n      finalPosition.add(cameraRight.clone().multiplyScalar(relativePosition.x));\n      \n      // ä¸Šä¸‹æ–¹å‘ï¼ˆYè»¸ï¼‰: ã‚«ãƒ¡ãƒ©ã®ä¸Šæ–¹å‘ã«æ²¿ã£ã¦\n      finalPosition.add(cameraUpActual.clone().multiplyScalar(relativePosition.y));\n\n      this.logDebug(\n        `ğŸ“ Camera relative position calculated: (${finalPosition.x.toFixed(1)}, ${finalPosition.y.toFixed(1)}, ${finalPosition.z.toFixed(1)})`\n      );\n      return finalPosition;\n      \n    } catch (error) {\n      console.error('âŒ Camera relative position calculation failed:', error);\n      return new THREE.Vector3(relativePosition.x, relativePosition.y, relativePosition.z);\n    }\n  }\n\n  /**\n   * ã‚«ãƒ¡ãƒ©ã‚’è¨­å®š\n   */\n  alignPlaneToCamera(plane) {\n    if (!this.camera) {\n      return;\n    }\n\n    const forward = new THREE.Vector3();\n    this.camera.getWorldDirection(forward); // ã‚«ãƒ¡ãƒ©ã®å‰æ–¹å‘ï¼ˆå‰æ–¹ãŒè² Zï¼‰\n    forward.negate(); // å¹³é¢ã®æ³•ç·šã‚’ã‚«ãƒ¡ãƒ©å´ã¸å‘ã‘ã‚‹\n\n    let up = new THREE.Vector3().copy(this.camera.up).applyQuaternion(this.camera.quaternion).normalize();\n    if (Math.abs(forward.dot(up)) > 0.999) {\n      up = new THREE.Vector3(0, 1, 0);\n      if (Math.abs(forward.dot(up)) > 0.999) {\n        up = new THREE.Vector3(0, 0, 1);\n      }\n    }\n\n    const right = new THREE.Vector3().crossVectors(up, forward).normalize();\n    up = new THREE.Vector3().crossVectors(forward, right).normalize();\n\n    const orientation = new THREE.Matrix4();\n    orientation.makeBasis(right, up, forward);\n    plane.quaternion.setFromRotationMatrix(orientation);\n  }\n\n  /**\n   * ã‚«ãƒ¡ãƒ©ã‚’è¨­å®š\n   */\n  setCamera(camera) {\n    this.camera = camera;\n  }\n\n  /**\n   * è¨­å®šã‚’æ›´æ–°\n   */\n  updateConfig(newConfig) {\n    this.config = { ...this.config, ...newConfig };\n  }\n\n  setImageService(serviceId) {\n    this.selectedImageService = serviceId || null;\n    this.logDebug('ğŸ¯ Updated image service:', this.selectedImageService);\n  }\n\n  getImageService() {\n    return this.selectedImageService;\n  }\n\n  setVideoService(serviceId) {\n    this.selectedVideoService = serviceId || null;\n    this.logDebug('ğŸ¬ Updated video service:', this.selectedVideoService);\n  }\n\n  getVideoService() {\n    return this.selectedVideoService;\n  }\n\n\n\n\n\n  /**\n   * éŸ³å£°åˆ¶å¾¡UIã‚’ä½œæˆ\n   */\n  createAudioControl(videoObject) {\n    const videoElement = videoObject.userData.videoElement;\n    if (!videoElement) return;\n\n    // éŸ³å£°åˆ¶å¾¡ãƒœã‚¿ãƒ³ã‚’ä½œæˆ\n    const audioButton = document.createElement('div');\n    audioButton.className = 'chocodrop-audio-control';\n    audioButton.innerHTML = 'â™ª'; // åˆæœŸçŠ¶æ…‹ï¼šéŸ³æ¥½è¨˜å·\n    // ã‚«ã‚¹ã‚¿ãƒ ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã‚’ä½œæˆï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ‡ã‚¶ã‚¤ãƒ³ã‚·ã‚¹ãƒ†ãƒ ã«åˆã‚ã›ã¦ï¼‰\n    const createTooltip = () => {\n      const tooltip = document.createElement('div');\n      tooltip.className = 'chocodrop-audio-tooltip';\n      tooltip.textContent = 'éŸ³å£°ã®ã‚ªãƒ³/ã‚ªãƒ•åˆ‡ã‚Šæ›¿ãˆ';\n      tooltip.style.cssText = `\n        position: absolute !important;\n        background: rgba(0, 0, 0, 0.85) !important;\n        backdrop-filter: blur(12px) !important;\n        -webkit-backdrop-filter: blur(12px) !important;\n        border: 1px solid rgba(255, 255, 255, 0.15) !important;\n        border-radius: 8px !important;\n        padding: 8px 12px !important;\n        color: white !important;\n        font-size: 11px !important;\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;\n        font-weight: 500 !important;\n        white-space: nowrap !important;\n        pointer-events: none !important;\n        z-index: 1000000 !important;\n        opacity: 0 !important;\n        transform: translateY(-100%) translateX(-50%) !important;\n        transition: opacity 0.2s ease !important;\n        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3) !important;\n        margin-bottom: 8px !important;\n      `;\n      return tooltip;\n    };\n\n    const tooltip = createTooltip();\n    document.body.appendChild(tooltip);\n\n    // ç¸¦å‹éŸ³é‡ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚’ä½œæˆ\n    const createVolumeSlider = () => {\n      const sliderContainer = document.createElement('div');\n      sliderContainer.className = 'chocodrop-volume-slider';\n      sliderContainer.style.cssText = `\n        position: absolute !important;\n        width: 30px !important;\n        height: 100px !important;\n        background: rgba(0, 0, 0, 0.85) !important;\n        backdrop-filter: blur(12px) !important;\n        -webkit-backdrop-filter: blur(12px) !important;\n        border: 1px solid rgba(255, 255, 255, 0.15) !important;\n        border-radius: 15px !important;\n        padding: 10px 8px !important;\n        z-index: 1000001 !important;\n        opacity: 0 !important;\n        pointer-events: none !important;\n        transition: opacity 0.2s ease !important;\n        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3) !important;\n        display: flex !important;\n        flex-direction: column !important;\n        align-items: center !important;\n        justify-content: center !important;\n      `;\n\n      const slider = document.createElement('input');\n      slider.type = 'range';\n      slider.min = '0';\n      slider.max = '100';\n      slider.value = '100';\n      slider.style.cssText = `\n        width: 80px !important;\n        height: 12px !important;\n        background: rgba(255, 255, 255, 0.2) !important;\n        border-radius: 6px !important;\n        outline: none !important;\n        cursor: pointer !important;\n        -webkit-appearance: none !important;\n        appearance: none !important;\n        transform: rotate(-90deg) !important;\n        transform-origin: center !important;\n      `;\n\n      // WebKitç”¨ã®ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ«\n      const style = document.createElement('style');\n      style.textContent = `\n        .chocodrop-volume-slider input[type=\"range\"]::-webkit-slider-track {\n          width: 6px;\n          height: 80px;\n          background: rgba(255, 255, 255, 0.2);\n          border-radius: 3px;\n        }\n        .chocodrop-volume-slider input[type=\"range\"]::-webkit-slider-thumb {\n          -webkit-appearance: none;\n          width: 14px;\n          height: 14px;\n          background: white;\n          border-radius: 50%;\n          cursor: pointer;\n          box-shadow: 0 2px 6px rgba(0,0,0,0.3);\n        }\n        .chocodrop-volume-slider input[type=\"range\"]::-moz-range-track {\n          width: 6px;\n          height: 80px;\n          background: rgba(255, 255, 255, 0.2);\n          border-radius: 3px;\n          border: none;\n        }\n        .chocodrop-volume-slider input[type=\"range\"]::-moz-range-thumb {\n          width: 14px;\n          height: 14px;\n          background: white;\n          border-radius: 50%;\n          cursor: pointer;\n          border: none;\n          box-shadow: 0 2px 6px rgba(0,0,0,0.3);\n        }\n      `;\n      document.head.appendChild(style);\n\n      // ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º\n      slider.addEventListener('input', (e) => {\n        const value = e.target.value;\n        videoElement.volume = value / 100;\n\n        // ã‚¢ã‚¤ã‚³ãƒ³ã‚’éŸ³é‡ã«å¿œã˜ã¦å¤‰æ›´\n        if (value == 0) {\n          audioButton.innerHTML = '<span style=\"position: relative;\">â™ª<span style=\"position: absolute; top: 0; left: 0; color: #8b5cf6; font-size: 14px;\">âƒ </span></span>';\n          audioButton.style.background = 'rgba(99, 102, 241, 0.6) !important';\n          audioButton.title = 'ãƒŸãƒ¥ãƒ¼ãƒˆä¸­';\n        } else {\n          audioButton.innerHTML = 'â™ª';\n          audioButton.style.background = 'rgba(0, 0, 0, 0.4) !important';\n          audioButton.style.color = 'white !important';\n          audioButton.title = 'éŸ³å£°ON';\n        }\n      });\n\n      sliderContainer.appendChild(slider);\n      return sliderContainer;\n    };\n\n    const volumeSlider = createVolumeSlider();\n    document.body.appendChild(volumeSlider);\n\n    audioButton.style.cssText = `\n      position: absolute !important;\n      width: 18px !important;\n      height: 18px !important;\n      background: rgba(0, 0, 0, 0.4) !important;\n      border: 1px solid rgba(255, 255, 255, 0.3) !important;\n      border-radius: 50% !important;\n      color: white !important;\n      font-size: 9px !important;\n      cursor: pointer !important;\n      display: flex !important;\n      align-items: center !important;\n      justify-content: center !important;\n      z-index: 999999 !important;\n      transition: all 0.2s ease !important;\n      user-select: none !important;\n      box-shadow: 0 1px 4px rgba(0,0,0,0.2) !important;\n      backdrop-filter: blur(8px) !important;\n      pointer-events: auto !important;\n      opacity: 1 !important;\n    `;\n\n    let isSliderVisible = false;\n\n    // ãƒ›ãƒãƒ¼åŠ¹æœã¨ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼è¡¨ç¤º\n    audioButton.addEventListener('mouseenter', () => {\n      audioButton.style.background = 'rgba(0, 0, 0, 0.7)';\n      audioButton.style.transform = 'scale(1.05)';\n      audioButton.style.borderColor = 'rgba(255, 255, 255, 0.5)';\n\n      if (!isSliderVisible) {\n        // ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã‚’è¡¨ç¤º\n        const buttonRect = audioButton.getBoundingClientRect();\n        tooltip.style.left = `${buttonRect.left + buttonRect.width / 2}px`;\n        tooltip.style.top = `${buttonRect.top - 8}px`;\n        tooltip.style.opacity = '1';\n      }\n    });\n\n    audioButton.addEventListener('mouseleave', () => {\n      audioButton.style.background = 'rgba(0, 0, 0, 0.5)';\n      audioButton.style.transform = 'scale(1.0)';\n      audioButton.style.borderColor = 'rgba(255, 255, 255, 0.4)';\n\n      // ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã‚’éè¡¨ç¤º\n      tooltip.style.opacity = '0';\n    });\n\n    // å·¦ã‚¯ãƒªãƒƒã‚¯ï¼šãƒŸãƒ¥ãƒ¼ãƒˆã®ã‚ªãƒ³/ã‚ªãƒ•åˆ‡ã‚Šæ›¿ãˆ\n    audioButton.addEventListener('click', (e) => {\n      e.stopPropagation();\n\n      // ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹å ´åˆã¯é–‰ã˜ã‚‹\n      if (isSliderVisible) {\n        isSliderVisible = false;\n        volumeSlider.style.opacity = '0';\n        volumeSlider.style.pointerEvents = 'none';\n        return;\n      }\n\n      // ãƒŸãƒ¥ãƒ¼ãƒˆåˆ‡ã‚Šæ›¿ãˆ\n      if (videoElement.muted || videoElement.volume === 0) {\n        videoElement.muted = false;\n        videoElement.volume = volumeSlider.querySelector('input').value / 100;\n        audioButton.innerHTML = 'â™ª';\n        audioButton.style.background = 'rgba(0, 0, 0, 0.4) !important';\n        audioButton.style.color = 'white !important';\n        audioButton.title = 'éŸ³å£°ON';\n      } else {\n        videoElement.muted = true;\n        audioButton.innerHTML = '<span style=\"position: relative;\">â™ª<span style=\"position: absolute; top: 0; left: 0; color: #8b5cf6; font-size: 14px;\">âƒ </span></span>';\n        audioButton.style.background = 'rgba(99, 102, 241, 0.6) !important';\n        audioButton.title = 'ãƒŸãƒ¥ãƒ¼ãƒˆä¸­';\n      }\n    });\n\n    // å³ã‚¯ãƒªãƒƒã‚¯ï¼šéŸ³é‡ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®è¡¨ç¤º/éè¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ\n    audioButton.addEventListener('contextmenu', (e) => {\n      e.preventDefault();\n      e.stopPropagation();\n\n      isSliderVisible = !isSliderVisible;\n\n      if (isSliderVisible) {\n        // ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚’è¡¨ç¤º\n        const buttonRect = audioButton.getBoundingClientRect();\n        volumeSlider.style.left = `${buttonRect.left + buttonRect.width / 2 - 15}px`;\n        volumeSlider.style.top = `${buttonRect.top - 110}px`;\n        volumeSlider.style.opacity = '1';\n        volumeSlider.style.pointerEvents = 'auto';\n\n        // ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã‚’éè¡¨ç¤º\n        tooltip.style.opacity = '0';\n      } else {\n        // ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚’éè¡¨ç¤º\n        volumeSlider.style.opacity = '0';\n        volumeSlider.style.pointerEvents = 'none';\n      }\n    });\n\n    // å¤–å´ã‚¯ãƒªãƒƒã‚¯ã§ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚’é–‰ã˜ã‚‹\n    document.addEventListener('click', (e) => {\n      if (isSliderVisible && !audioButton.contains(e.target) && !volumeSlider.contains(e.target)) {\n        isSliderVisible = false;\n        volumeSlider.style.opacity = '0';\n        volumeSlider.style.pointerEvents = 'none';\n      }\n    });\n\n    // ãƒšãƒ¼ã‚¸ã«è¿½åŠ \n    document.body.appendChild(audioButton);\n\n    // å‹•ç”»ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«éŸ³å£°åˆ¶å¾¡ãƒœã‚¿ãƒ³ã‚’é–¢é€£ä»˜ã‘\n    videoObject.userData.audioControlElement = audioButton;\n\n    // ä½ç½®æ›´æ–°é–¢æ•°ã‚’ä¿å­˜\n    videoObject.userData.updateAudioControlPosition = () => {\n      this.updateAudioControlPosition(videoObject, audioButton);\n    };\n\n    // åˆæœŸä½ç½®è¨­å®š\n    this.updateAudioControlPosition(videoObject, audioButton);\n\n    this.audioControls.set(videoObject.userData.id || videoObject.uuid, {\n      object: videoObject,\n      audioButton,\n      tooltip,\n      volumeSlider,\n      hideSlider: () => {\n        isSliderVisible = false;\n        volumeSlider.style.opacity = '0';\n        volumeSlider.style.pointerEvents = 'none';\n      }\n    });\n\n    // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒ»ãƒªã‚µã‚¤ã‚ºã§è¿½éš\n    if (!this.audioControlUpdateListener) {\n      this.audioControlUpdateListener = () => {\n        this.updateAllAudioControlPositions();\n      };\n      window.addEventListener('scroll', this.audioControlUpdateListener, { passive: true });\n      window.addEventListener('resize', this.audioControlUpdateListener, { passive: true });\n    }\n\n    if (!this.audioControlUpdateInterval) {\n      this.audioControlUpdateInterval = setInterval(() => {\n        this.updateAllAudioControlPositions();\n      }, 100);\n    }\n\n    const cleanup = () => {\n      document.removeEventListener('click', onDocumentClick, true);\n      if (audioButton.parentNode) audioButton.parentNode.removeChild(audioButton);\n      if (tooltip.parentNode) tooltip.parentNode.removeChild(tooltip);\n      if (volumeSlider.parentNode) volumeSlider.parentNode.removeChild(volumeSlider);\n      this.audioControls.delete(videoObject.userData.id || videoObject.uuid);\n\n      if (this.audioControls.size === 0) {\n        if (this.audioControlUpdateInterval) {\n          clearInterval(this.audioControlUpdateInterval);\n          this.audioControlUpdateInterval = null;\n        }\n        if (this.audioControlUpdateListener) {\n          window.removeEventListener('scroll', this.audioControlUpdateListener);\n          window.removeEventListener('resize', this.audioControlUpdateListener);\n          this.audioControlUpdateListener = null;\n        }\n      }\n    };\n\n    const onDocumentClick = (e) => {\n      if (isSliderVisible && !audioButton.contains(e.target) && !volumeSlider.contains(e.target)) {\n        isSliderVisible = false;\n        volumeSlider.style.opacity = '0';\n        volumeSlider.style.pointerEvents = 'none';\n      }\n    };\n\n    document.addEventListener('click', onDocumentClick, true);\n\n    videoObject.userData.cleanupCallbacks = videoObject.userData.cleanupCallbacks || [];\n    videoObject.userData.cleanupCallbacks.push(cleanup);\n\n    console.log('ğŸ”Š Audio control created for video:', videoObject.userData.id);\n  }\n\n  /**\n   * éŸ³å£°åˆ¶å¾¡ãƒœã‚¿ãƒ³ã®ä½ç½®ã‚’å‹•ç”»ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«åˆã‚ã›ã¦æ›´æ–°\n   */\n  updateAudioControlPosition(videoObject, audioButton) {\n    if (!this.camera || !this.renderer || !audioButton.parentNode) return;\n\n    // å‹•ç”»ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®3Dåº§æ¨™ã‚’ç”»é¢åº§æ¨™ã«å¤‰æ›\n    const vector = new THREE.Vector3();\n    videoObject.getWorldPosition(vector);\n    vector.project(this.camera);\n\n    // ç”»é¢åº§æ¨™ã«å¤‰æ›\n    const canvas = this.renderer.domElement;\n    const rect = canvas.getBoundingClientRect();\n\n    const x = (vector.x * 0.5 + 0.5) * rect.width + rect.left;\n    const y = -(vector.y * 0.5 - 0.5) * rect.height + rect.top;\n\n    // å‹•ç”»ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å³ä¸Šã«ãƒœã‚¿ãƒ³ã‚’é…ç½®\n    const geometry = videoObject.geometry;\n    if (geometry && geometry.parameters) {\n      const width = geometry.parameters.width * videoObject.scale.x;\n      const offsetX = 150; // å‹•ç”»ã®å³å´ã«å›ºå®šè·é›¢\n      const offsetY = -50; // å‹•ç”»ã®ä¸Šå´ã«å›ºå®šè·é›¢\n\n      audioButton.style.left = `${x + offsetX}px`;\n      audioButton.style.top = `${y + offsetY}px`;\n    } else {\n      // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: å‹•ç”»ä¸­å¿ƒã®å³ä¸Š\n      audioButton.style.left = `${x + 50}px`;\n      audioButton.style.top = `${y - 20}px`;\n    }\n  }\n\n  updateAllAudioControlPositions() {\n    if (!this.audioControls || this.audioControls.size === 0) {\n      return;\n    }\n\n    this.audioControls.forEach((entry) => {\n      const obj = entry.object;\n      if (obj && obj.userData && obj.userData.updateAudioControlPosition) {\n        obj.userData.updateAudioControlPosition();\n      }\n    });\n  }\n\n  /**\n   * å‹•ç”»éŸ³å£°ã®å†ç”Ÿ/åœæ­¢ã‚’åˆ‡ã‚Šæ›¿ãˆ\n   */\n  toggleVideoAudio(videoObject, audioButton) {\n    const videoElement = videoObject.userData.videoElement;\n    if (!videoElement) return;\n\n    if (videoElement.muted) {\n      // ãƒŸãƒ¥ãƒ¼ãƒˆè§£é™¤ï¼šéŸ³å£°å†ç”Ÿ\n      videoElement.muted = false;\n      audioButton.innerHTML = 'ğŸ”ˆ'; // éŸ³å£°å†ç”Ÿä¸­ãƒãƒ¼ã‚¯\n      console.log('ğŸ”Š Audio enabled for video:', videoObject.userData.id);\n    } else {\n      // ãƒŸãƒ¥ãƒ¼ãƒˆï¼šéŸ³å£°åœæ­¢\n      videoElement.muted = true;\n      audioButton.innerHTML = 'ğŸ”Š'; // éŸ³å£°ã‚ã‚Šãƒãƒ¼ã‚¯\n      console.log('ğŸ”‡ Audio muted for video:', videoObject.userData.id);\n    }\n  }\n\n  /**\n   * CSS2DRendereråˆæœŸåŒ–ï¼ˆéŸ³å£°åˆ¶å¾¡UIãªã©ã®è¡¨ç¤ºã«å¿…è¦ï¼‰\n   */\n  initializeLabelRenderer() {\n    if (this.labelRenderer) {\n      return; // æ—¢ã«åˆæœŸåŒ–æ¸ˆã¿\n    }\n\n    // CSS2DRendererã‚’å‹•çš„ã«èª­ã¿è¾¼ã‚“ã§åˆæœŸåŒ–\n    this.loadAndInitializeCSS2DRenderer();\n  }\n\n  /**\n   * CSS2DRendererã®æº–å‚™å®Œäº†ã‚’ä¿è¨¼\n   */\n  async ensureCSS2DRenderer() {\n    if (this.labelRenderer) {\n      return; // æ—¢ã«æº–å‚™å®Œäº†\n    }\n\n    // åˆæœŸåŒ–å‡¦ç†ãŒã¾ã ã®å ´åˆã¯é–‹å§‹\n    if (!this.css2dInitPromise) {\n      this.css2dInitPromise = this.loadAndInitializeCSS2DRenderer();\n    }\n\n    // åˆæœŸåŒ–å®Œäº†ã¾ã§å¾…æ©Ÿ\n    await this.css2dInitPromise;\n  }\n\n  /**\n   * CSS2DRendererã®å‹•çš„èª­ã¿è¾¼ã¿ã¨åˆæœŸåŒ–\n   */\n  async loadAndInitializeCSS2DRenderer() {\n    try {\n      // CSS2DRendererãŒæ—¢ã«åˆ©ç”¨å¯èƒ½ãªå ´åˆ\n      if (window.THREE && window.THREE.CSS2DRenderer) {\n        this.setupCSS2DRenderer();\n        return;\n      }\n\n      // Three.jsã®CSS2DRendererã‚’å‹•çš„ã«èª­ã¿è¾¼ã¿\n      console.log('ğŸ·ï¸ Loading CSS2DRenderer dynamically...');\n\n      // CDNã‹ã‚‰CSS2DRendererã‚’èª­ã¿è¾¼ã¿\n      const module = await import('https://cdn.skypack.dev/three@0.158.0/examples/jsm/renderers/CSS2DRenderer.js');\n\n      // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«è¨­å®š\n      if (!window.THREE) window.THREE = {};\n      window.THREE.CSS2DRenderer = module.CSS2DRenderer;\n      window.THREE.CSS2DObject = module.CSS2DObject;\n\n      console.log('âœ… CSS2DRenderer loaded successfully');\n      this.setupCSS2DRenderer();\n\n    } catch (error) {\n      console.warn('âš ï¸ Failed to load CSS2DRenderer:', error);\n      console.warn('ğŸ”§ Audio controls will not be visible. Please include CSS2DRenderer in your project.');\n    }\n  }\n\n  /**\n   * CSS2DRendererã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—\n   */\n  setupCSS2DRenderer() {\n    try {\n      this.labelRenderer = new window.THREE.CSS2DRenderer();\n      this.labelRenderer.setSize(window.innerWidth, window.innerHeight);\n      this.labelRenderer.domElement.style.position = 'absolute';\n      this.labelRenderer.domElement.style.top = '0px';\n      this.labelRenderer.domElement.style.pointerEvents = 'none';\n\n      // ãƒ¡ã‚¤ãƒ³ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ã®ã‚³ãƒ³ãƒ†ãƒŠã«è¿½åŠ \n      if (this.renderer && this.renderer.domElement.parentNode) {\n        this.renderer.domElement.parentNode.appendChild(this.labelRenderer.domElement);\n      } else {\n        document.body.appendChild(this.labelRenderer.domElement);\n      }\n\n      console.log('ğŸ·ï¸ CSS2DRenderer initialized for UI overlays');\n\n      // ãƒªã‚µã‚¤ã‚ºãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã‚’è¿½åŠ \n      this.addLabelRendererResizeHandler();\n\n    } catch (error) {\n      console.warn('âš ï¸ Failed to setup CSS2DRenderer:', error);\n    }\n  }\n\n  /**\n   * CSS2DRendererã®ãƒªã‚µã‚¤ã‚ºãƒãƒ³ãƒ‰ãƒ©ãƒ¼è¿½åŠ \n   */\n  addLabelRendererResizeHandler() {\n    if (!this.labelRendererResizeHandler) {\n      this.labelRendererResizeHandler = () => {\n        if (this.labelRenderer) {\n          this.labelRenderer.setSize(window.innerWidth, window.innerHeight);\n        }\n      };\n      window.addEventListener('resize', this.labelRendererResizeHandler);\n    }\n  }\n\n  /**\n   * ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æ›´æ–°ï¼ˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ—ã§å‘¼ã³å‡ºã—ï¼‰\n   */\n  updateRenderer() {\n    if (this.labelRenderer && this.scene && this.camera) {\n      this.labelRenderer.render(this.scene, this.camera);\n    }\n  }\n\n  logDebug(...args) {\n    if (!this.config.enableDebugLogging) {\n      return;\n    }\n    console.log(...args);\n  }\n\n  /**\n   * 2025å¹´ãƒˆãƒ¬ãƒ³ãƒ‰: ã‚¢ãƒ€ãƒ—ãƒ†ã‚£ãƒ–é¸æŠã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼è‰²è¨ˆç®—\n   * èƒŒæ™¯è‰²ã‚’è‡ªå‹•æ¤œå‡ºã—ã¦WCAG 2025åŸºæº–ã®ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆæ¯”ã‚’ä¿è¨¼\n   */\n  getAdaptiveSelectionColor() {\n    // ã‚·ãƒ¼ãƒ³ã®èƒŒæ™¯è‰²ã‚’å–å¾—\n    const backgroundColor = this.scene.background;\n    let bgColor = { r: 0.5, g: 0.5, b: 0.5 }; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆä¸­é–“è‰²\n    \n    if (backgroundColor) {\n      if (backgroundColor.isColor) {\n        bgColor = {\n          r: backgroundColor.r,\n          g: backgroundColor.g,\n          b: backgroundColor.b\n        };\n      }\n    }\n    \n    // æ˜åº¦è¨ˆç®—ï¼ˆç›¸å¯¾è¼åº¦ï¼‰\n    const getLuminance = (color) => {\n      const { r, g, b } = color;\n      const rs = r <= 0.03928 ? r / 12.92 : Math.pow((r + 0.055) / 1.055, 2.4);\n      const gs = g <= 0.03928 ? g / 12.92 : Math.pow((g + 0.055) / 1.055, 2.4);\n      const bs = b <= 0.03928 ? b / 12.92 : Math.pow((b + 0.055) / 1.055, 2.4);\n      return 0.2126 * rs + 0.7152 * gs + 0.0722 * bs;\n    };\n    \n    const bgLuminance = getLuminance(bgColor);\n    \n    // WCAG 2025æº–æ‹ : 4.5:1ä»¥ä¸Šã®ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆæ¯”ã‚’ç¢ºä¿\n    // èƒŒæ™¯ãŒæš—ã„å ´åˆã¯æ˜ã‚‹ã„è‰²ã€æ˜ã‚‹ã„å ´åˆã¯æš—ã„è‰²ã‚’é¸æŠ\n    if (bgLuminance < 0.5) {\n      // æš—ã„èƒŒæ™¯: æ˜ã‚‹ã„ã‚¢ã‚¯ã‚»ãƒ³ãƒˆè‰²\n      return 0x00ff88; // æ˜ã‚‹ã„ãƒ†ã‚£ãƒ¼ãƒ«\n    } else {\n      // æ˜ã‚‹ã„èƒŒæ™¯: æš—ã„ã‚¢ã‚¯ã‚»ãƒ³ãƒˆè‰²  \n      return 0x1a1a2e; // ãƒ€ãƒ¼ã‚¯ãƒã‚¤ãƒ“ãƒ¼\n    }\n  }\n  \n  /**\n   * ã‚¢ãƒ€ãƒ—ãƒ†ã‚£ãƒ–ãƒ›ãƒãƒ¼è‰²è¨ˆç®—\n   */\n  getAdaptiveHoverColor() {\n    const backgroundColor = this.scene.background;\n    let bgColor = { r: 0.5, g: 0.5, b: 0.5 };\n    \n    if (backgroundColor && backgroundColor.isColor) {\n      bgColor = {\n        r: backgroundColor.r,\n        g: backgroundColor.g,\n        b: backgroundColor.b\n      };\n    }\n    \n    const getLuminance = (color) => {\n      const { r, g, b } = color;\n      const rs = r <= 0.03928 ? r / 12.92 : Math.pow((r + 0.055) / 1.055, 2.4);\n      const gs = g <= 0.03928 ? g / 12.92 : Math.pow((g + 0.055) / 1.055, 2.4);\n      const bs = b <= 0.03928 ? b / 12.92 : Math.pow((b + 0.055) / 1.055, 2.4);\n      return 0.2126 * rs + 0.7152 * gs + 0.0722 * bs;\n    };\n    \n    const bgLuminance = getLuminance(bgColor);\n    \n    if (bgLuminance < 0.5) {\n      // æš—ã„èƒŒæ™¯: ã‚ˆã‚Šæ˜ã‚‹ã„ãƒ›ãƒãƒ¼è‰²\n      return 0x00ffff; // ã‚·ã‚¢ãƒ³\n    } else {\n      // æ˜ã‚‹ã„èƒŒæ™¯: ã‚ˆã‚Šæš—ã„ãƒ›ãƒãƒ¼è‰²\n      return 0xff3366; // ãƒ€ãƒ¼ã‚¯ãƒ”ãƒ³ã‚¯\n    }\n  }\n\n  /**\n   * ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—\n   */\n  dispose() {\n    this.clearAll();\n    if (this.experimentGroup.parent) {\n      this.experimentGroup.parent.remove(this.experimentGroup);\n    }\n  }\n}\n","const IMAGE_SERVICE_STORAGE_KEY = 'chocodrop-service-image';\nconst VIDEO_SERVICE_STORAGE_KEY = 'chocodrop-service-video';\n\n/**\n * Command UI Demo - Demo version with restricted functionality\n * For GitHub Pages demo - import functionality only\n */\nexport class CommandUIDemo {\n  constructor(options = {}) {\n    this.sceneManager = options.sceneManager || null;\n    this.client = options.client || null;\n    this.onControlsToggle = options.onControlsToggle || (() => {});\n    \n    this.isVisible = false;\n    this.container = null;\n    this.input = null;\n    this.output = null;\n    this.currentMode = 'generate';\n\n    // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€²æ—ç®¡ç†\n    this.activeConnections = new Map();\n    this.currentTaskId = null;\n    \n    // è¨­å®š\n    this.config = {\n      activationKey: options.activationKey || '@',\n      position: options.position || 'bottom-right',\n      width: options.width || 450,\n      maxHeight: options.maxHeight || 600,\n      theme: options.theme || 'dark',\n      showExamples: options.showExamples !== false,\n      autoScroll: options.autoScroll !== false,\n      enableDebugLogging: options.enableDebugLogging === true,\n      ...options.config\n    };\n\n    this.availableImageServices = [];\n    this.availableVideoServices = [];\n    this.selectedImageService = null;\n    this.selectedVideoService = null;\n    this.imageServiceSelect = null;\n    this.videoServiceSelect = null;\n    this.serviceSelectorContainer = null;\n    this.serviceSelectorStatus = null;\n    this.serviceSelectorContent = null;\n    this.serviceSelectorRetryButton = null;\n    this.serviceSelectorSaveButton = null;\n    this.serviceSelectorCancelButton = null;\n    this.serviceModalOverlay = null;\n    this.serviceModal = null;\n    this.servicesLoading = false;\n    this.isExpanded = false;\n    this.overlayTextarea = null;\n    this.pendingImageService = null;\n    this.pendingVideoService = null;\n\n    try {\n      const storedImage = localStorage.getItem(IMAGE_SERVICE_STORAGE_KEY);\n      const storedVideo = localStorage.getItem(VIDEO_SERVICE_STORAGE_KEY);\n      if (storedImage) {\n        this.selectedImageService = storedImage;\n      }\n      if (storedVideo) {\n        this.selectedVideoService = storedVideo;\n      }\n    } catch (error) {\n      console.warn('âš ï¸ Failed to load stored service selections:', error);\n    }\n\n    this.pendingImageService = this.selectedImageService;\n    this.pendingVideoService = this.selectedVideoService;\n\n    this.applyServiceSelectionToSceneManager();\n\n    // ãƒ†ãƒ¼ãƒãƒ¢ãƒ¼ãƒ‰çŠ¶æ…‹ç®¡ç† (light, dark, wabisabi)\n    this.currentTheme = localStorage.getItem('live-command-theme') || 'light';\n    this.isDarkMode = this.currentTheme === 'dark';\n    this.isWabiSabiMode = this.currentTheme === 'wabisabi';\n    \n    // Undo/Redo ã‚·ã‚¹ãƒ†ãƒ \n    this.commandHistory = [];\n    this.currentHistoryIndex = -1;\n    this.maxHistorySize = 50; // æœ€å¤§ã‚³ãƒãƒ³ãƒ‰ä¿å­˜æ•°\n    \n    this.initUI();\n    this.bindEvents();\n\n    if (!this.client && this.sceneManager && this.sceneManager.client) {\n      this.client = this.sceneManager.client;\n    }\n\n    this.createServiceModal();\n    this.createFloatingChocolateIcon();\n\n    // DOMèª­ã¿è¾¼ã¿å®Œäº†å¾Œã«ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ç¢ºå®Ÿã«é©ç”¨\n    document.addEventListener('DOMContentLoaded', () => {\n      this.refreshStyles();\n    });\n\n    this.logDebug('ğŸ® CommandUI initialized');\n\n    if (!this.selectedImageService || !this.selectedVideoService) {\n      this.openServiceModal(true);\n    }\n  }\n\n  logDebug(...args) {\n    if (!this.config.enableDebugLogging) {\n      return;\n    }\n    console.log(...args);\n  }\n\n  /**\n   * ãƒ‡ãƒ¢ãƒšãƒ¼ã‚¸ç”¨ã®ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆãƒˆãƒ¼ã‚¹ãƒˆè¡¨ç¤º\n   */\n  showDemoMessage() {\n    this.showCompactToast('ãƒ‡ãƒ¢ãƒšãƒ¼ã‚¸ã§ã¯åˆ©ç”¨ã§ãã¾ã›ã‚“');\n  }\n\n  /**\n   * ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥ã‚’è¡¨ç¤º\n   */\n  showCompactToast(message) {\n    // æ—¢å­˜ã®ãƒˆãƒ¼ã‚¹ãƒˆãŒã‚ã‚Œã°å‰Šé™¤\n    const existingToast = document.getElementById('demo-toast');\n    if (existingToast) {\n      existingToast.remove();\n    }\n\n    // ãƒœã‚¿ãƒ³ã‚³ãƒ³ãƒ†ãƒŠã®ä½ç½®ã‚’å–å¾—\n    const buttonContainer = this.radioModeContainer;\n    if (!buttonContainer) return;\n\n    const toast = document.createElement('div');\n    toast.id = 'demo-toast';\n    toast.textContent = message;\n    toast.style.cssText = `\n      position: absolute;\n      top: -35px;\n      left: 50%;\n      transform: translateX(-50%);\n      background: ${this.isDarkMode ? 'rgba(139, 92, 246, 0.9)' : 'rgba(139, 92, 246, 0.85)'};\n      color: white;\n      padding: 6px 12px;\n      border-radius: 6px;\n      font-size: 12px;\n      font-weight: 500;\n      white-space: nowrap;\n      z-index: 1000;\n      opacity: 0;\n      transition: opacity 0.3s ease;\n      box-shadow: 0 2px 8px rgba(139, 92, 246, 0.3);\n    `;\n\n    // ãƒœã‚¿ãƒ³ã‚³ãƒ³ãƒ†ãƒŠã«ç›¸å¯¾é…ç½®\n    buttonContainer.style.position = 'relative';\n    buttonContainer.appendChild(toast);\n\n    // ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³\n    setTimeout(() => {\n      toast.style.opacity = '1';\n    }, 10);\n\n    // 3ç§’å¾Œã«è‡ªå‹•å‰Šé™¤\n    setTimeout(() => {\n      if (toast.parentNode) {\n        toast.style.opacity = '0';\n        setTimeout(() => {\n          if (toast.parentNode) {\n            toast.remove();\n          }\n        }, 300);\n      }\n    }, 3000);\n  }\n\n  /**\n   * UIè¦ç´ ã®ä½œæˆã¨é…ç½®\n   */\n  initUI() {\n    // ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ\n    this.container = document.createElement('div');\n    this.container.id = 'live-command-ui';\n    this.container.style.cssText = this.getContainerStyles();\n\n    // 2025å¹´ãƒˆãƒ¬ãƒ³ãƒ‰ï¼šProgressive Disclosureï¼ˆãƒ›ãƒãƒ¼æ™‚ã®ã¿ãƒ–ãƒ©ãƒ³ãƒ‰è¡¨ç¤ºï¼‰\n    const brandIndicator = document.createElement('div');\n    brandIndicator.className = 'progressive-brand-indicator';\n    brandIndicator.style.cssText = `\n      position: absolute;\n      top: -8px;\n      right: 8px;\n      width: 8px;\n      height: 8px;\n      background: linear-gradient(135deg, #6366f1, #8b5cf6);\n      border-radius: 50%;\n      opacity: 0.7;\n      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n      z-index: 10;\n      cursor: pointer;\n    `;\n    \n    // Progressive Disclosure: ãƒ›ãƒãƒ¼/ã‚¯ãƒªãƒƒã‚¯ã§ãƒ–ãƒ©ãƒ³ãƒ‰åè¡¨ç¤º\n    const brandText = document.createElement('div');\n    brandText.className = 'progressive-brand-text';\n    brandText.style.cssText = `\n      position: absolute;\n      top: -35px;\n      right: -5px;\n      padding: 6px 12px;\n      background: rgba(255, 255, 255, 0.15);\n      border: 1px solid ${this.isDarkMode ? 'rgba(129, 140, 248, 0.3)' : 'rgba(99, 102, 241, 0.25)'};\n      border-radius: 12px;\n      box-shadow: 0 8px 24px rgba(99, 102, 241, 0.2), 0 4px 12px rgba(0, 0, 0, 0.1);\n      color: ${this.isWabiSabiMode ? '#F5F5F5' : (this.isDarkMode ? '#ffffff' : '#1f2937')};\n      font-size: 11px;\n      font-weight: 700;\n      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.4);\n      letter-spacing: 0.02em;\n      backdrop-filter: blur(20px);\n      -webkit-backdrop-filter: blur(20px);\n      opacity: 0;\n      transform: translateY(5px) scale(0.9);\n      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);\n      pointer-events: none;\n      z-index: 11;\n      white-space: nowrap;\n    `;\n    brandText.innerHTML = '<span style=\"filter: hue-rotate(240deg) saturate(0.8) brightness(1.1);\">ğŸ«</span> <span style=\"color: #6366f1;\">ChocoDrop</span>';\n    \n    // Progressive Disclosure ã‚¤ãƒ™ãƒ³ãƒˆ\n    brandIndicator.addEventListener('mouseenter', () => {\n      brandText.style.opacity = '1';\n      brandText.style.transform = 'translateY(0) scale(1)';\n      brandIndicator.style.transform = 'scale(1.2)';\n      brandIndicator.style.opacity = '1';\n    });\n    \n    brandIndicator.addEventListener('mouseleave', () => {\n      brandText.style.opacity = '0';\n      brandText.style.transform = 'translateY(5px) scale(0.9)';\n      brandIndicator.style.transform = 'scale(1)';\n      brandIndicator.style.opacity = '0.7';\n    });\n    \n    brandIndicator.appendChild(brandText);\n    this.container.appendChild(brandIndicator);\n\n    // å‡ºåŠ›ã‚¨ãƒªã‚¢ï¼ˆã‚¿ã‚¹ã‚¯ã‚«ãƒ¼ãƒ‰ã‚³ãƒ³ãƒ†ãƒŠï¼‰- éè¡¨ç¤ºã«å¤‰æ›´\n    this.output = document.createElement('div');\n    this.outputDiv = this.output; // ä¸¡æ–¹ã®å‚ç…§ã‚’ä¿æŒï¼ˆäº’æ›æ€§ã®ãŸã‚ï¼‰\n    this.output.id = 'command-output';\n    this.output.className = 'command-output';\n    this.output.style.cssText = this.getOutputStyles();\n    // ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚«ãƒ¼ãƒ‰ç”¨ã‚³ãƒ³ãƒ†ãƒŠ\n    this.floatingContainer = document.createElement('div');\n    this.floatingContainer.id = 'floating-cards-container';\n    this.floatingContainer.style.cssText = `\n      position: fixed;\n      top: var(--floating-top, 20px);\n      left: 50%;\n      transform: translateX(-50%);\n      z-index: 99999;\n      pointer-events: none;\n      display: none;\n      flex-direction: column-reverse;\n      gap: 8px;\n      width: 400px;\n      max-width: 90vw;\n      align-items: center;\n      justify-content: flex-end;\n    `;\n\n    // ã‚¿ã‚¹ã‚¯ã‚«ãƒ¼ãƒ‰ç®¡ç†ç”¨\n    this.taskCards = new Map();\n\n    // å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãƒ©ãƒƒãƒ‘ãƒ¼ï¼ˆå±•é–‹ãƒœã‚¿ãƒ³ç”¨ï¼‰\n    this.inputWrapper = document.createElement('div');\n    this.inputWrapper.style.cssText = `\n      position: relative;\n      width: 100%;\n      margin-bottom: 0;\n    `;\n\n    // Ultra-Simple å˜ä¸€å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆè‡ªå‹•ãƒªã‚µã‚¤ã‚ºå¯¾å¿œï¼‰\n    this.input = document.createElement('textarea');\n    this.input.rows = 1;\n    this.input.id = 'command-input';\n    this.input.placeholder = 'ã€Œå³ä¸Šã«ãƒ‰ãƒ©ã‚´ãƒ³ã‚’ã€ã€Œç¾ã—ã„æ¡œã®æ£®ã‚’ä¸­å¤®ã«ã€ãªã©... âœ¨';\n    this.input.style.cssText = this.getInputStyles();\n\n    // å±•é–‹ãƒœã‚¿ãƒ³ï¼ˆåˆæœŸçŠ¶æ…‹ã¯éè¡¨ç¤ºï¼‰\n    this.expandButton = document.createElement('div');\n    this.expandButton.innerHTML = 'â¤¢';\n    this.expandButton.title = 'ãƒ†ã‚­ã‚¹ãƒˆå…¨ä½“ã‚’è¡¨ç¤º';\n    this.expandButton.style.cssText = `\n      position: absolute;\n      bottom: 8px;\n      right: 8px;\n      width: 24px;\n      height: 24px;\n      display: none;\n      align-items: center;\n      justify-content: center;\n      background: ${this.isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)'};\n      border: 1px solid ${this.isDarkMode ? 'rgba(255, 255, 255, 0.2)' : 'rgba(0, 0, 0, 0.2)'};\n      border-radius: 6px;\n      color: ${this.isWabiSabiMode ? '#F5F5F5' : (this.isDarkMode ? '#ffffff' : '#1f2937')};\n      font-size: 16px;\n      cursor: pointer;\n      transition: all 0.2s ease;\n      z-index: 1;\n    `;\n\n    // å±•é–‹ãƒœã‚¿ãƒ³ã®ãƒ›ãƒãƒ¼åŠ¹æœ\n    this.expandButton.addEventListener('mouseenter', () => {\n      this.expandButton.style.background = this.isDarkMode ? 'rgba(255, 255, 255, 0.2)' : 'rgba(0, 0, 0, 0.2)';\n      this.expandButton.style.transform = 'scale(1.1)';\n    });\n\n    this.expandButton.addEventListener('mouseleave', () => {\n      this.expandButton.style.background = this.isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';\n      this.expandButton.style.transform = 'scale(1)';\n    });\n\n    // å±•é–‹ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯å‡¦ç†\n    this.expandButton.addEventListener('click', () => {\n      if (this.isExpanded) {\n        this.hideOverlayTextarea();\n      } else {\n        this.showOverlayTextarea();\n      }\n    });\n\n    // ãƒ©ãƒƒãƒ‘ãƒ¼ã«è¦ç´ ã‚’è¿½åŠ \n    this.inputWrapper.appendChild(this.input);\n    this.inputWrapper.appendChild(this.expandButton);\n\n    // æ—§ã‚³ãƒãƒ³ãƒ‰ã‚¿ã‚¤ãƒ—ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã¯å‰Šé™¤ï¼ˆãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³UIã«çµ±åˆï¼‰\n\n    // ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³é¢¨ãƒ¢ãƒ¼ãƒ‰ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼\n    const modeSelector = this.createRadioModeSelector();\n\n    // ãƒŸãƒ‹ãƒãƒ«ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³\n    const actionContainer = this.createMinimalActions();\n\n    // Ã—ã‚¯ãƒ­ãƒ¼ã‚ºãƒœã‚¿ãƒ³ã‚’ãƒ•ã‚©ãƒ¼ãƒ å³ä¸Šã«è¿½åŠ \n    const closeButton = document.createElement('div');\n    closeButton.innerHTML = 'Ã—';\n    closeButton.style.cssText = `\n      position: absolute;\n      top: 12px;\n      right: 12px;\n      width: 22px;\n      height: 22px;\n      border-radius: 50%;\n      background: ${this.isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)'};\n      color: ${this.isWabiSabiMode ? '#F5F5F5' : (this.isDarkMode ? '#ffffff' : '#1f2937')};\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      cursor: pointer;\n      font-size: 14px;\n      font-weight: normal;\n      transition: all 0.2s ease;\n      backdrop-filter: blur(8px);\n      z-index: 10;\n    `;\n\n    closeButton.addEventListener('mouseover', () => {\n      closeButton.style.background = this.isDarkMode ? 'rgba(255, 255, 255, 0.2)' : 'rgba(0, 0, 0, 0.2)';\n      closeButton.style.transform = 'scale(1.1)';\n    });\n\n    closeButton.addEventListener('mouseout', () => {\n      closeButton.style.background = this.isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';\n      closeButton.style.color = this.isDarkMode ? '#ffffff' : '#1f2937';\n      closeButton.style.transform = 'scale(1)';\n    });\n\n    closeButton.addEventListener('click', () => {\n      this.hide();\n    });\n\n    // çµ„ã¿ç«‹ã¦ï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼å‰Šé™¤ã€ãƒ–ãƒ©ãƒ³ãƒ‰ãƒãƒƒã‚¸ã¯æ—¢ã«è¿½åŠ æ¸ˆã¿ï¼‰\n    // this.container.appendChild(this.output); // å¤§ããªã‚¿ã‚¹ã‚¯è¡¨ç¤ºã‚¨ãƒªã‚¢ã‚’DOMã«è¿½åŠ ã—ãªã„\n    this.container.appendChild(closeButton);\n    this.container.appendChild(modeSelector);\n    this.container.appendChild(this.inputWrapper);\n    this.container.appendChild(actionContainer);\n\n    // ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚«ãƒ¼ãƒ‰ã‚³ãƒ³ãƒ†ãƒŠã‚’bodyã«ç›´æ¥è¿½åŠ \n    document.body.appendChild(this.floatingContainer);\n\n    // DOM ã«è¿½åŠ \n    document.body.appendChild(this.container);\n\n    // åˆå›ãƒ†ãƒ¼ãƒé©ç”¨\n    this.applyTheme();\n\n    // æ—¥æœ¬èªIMEå¯¾å¿œã®composition stateç®¡ç†\n    this.isComposing = false;\n    this.hasCompositionJustEnded = false;\n\n    // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å…¥åŠ›ç›£è¦–ã¨ã‚³ãƒãƒ³ãƒ‰æ¤œå‡ºï¼ˆIMEå¯¾å¿œï¼‰\n    this.input.addEventListener('input', () => {\n      // IMEå…¥åŠ›ä¸­ã¯ã‚³ãƒãƒ³ãƒ‰æ¤œå‡ºã‚’åœæ­¢\n      if (this.isComposing) {\n        return;\n      }\n      \n      // è‡ªå‹•ãƒªã‚µã‚¤ã‚ºå‡¦ç†\n      this.autoResizeTextarea();\n      \n      this.detectCommandType();\n    });\n    \n    // æ—¥æœ¬èªIME composition events\n    this.input.addEventListener('compositionstart', () => {\n      this.isComposing = true;\n    });\n    \n    this.input.addEventListener('compositionend', () => {\n      this.isComposing = false;\n      \n      // Safariã®ã¿ãƒ•ãƒ©ã‚°è¨­å®šï¼ˆä»–ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯ä¸è¦ï¼‰\n      const isSafari = /Safari/.test(navigator.userAgent) && /Version/.test(navigator.userAgent);\n      if (isSafari) {\n        this.hasCompositionJustEnded = true;\n      }\n      \n      // ç¢ºå®šå¾Œã®ã‚³ãƒãƒ³ãƒ‰æ¤œå‡ºã‚’å®Ÿè¡Œ\n      setTimeout(() => {\n        this.autoResizeTextarea();\n        this.detectCommandType();\n      }, 10);\n    });\n    \n    // Safariåˆ¤å®š\n    const isSafari = /Safari/.test(navigator.userAgent) && /Version/.test(navigator.userAgent);\n    \n    // æ—¥æœ¬èªIMEå¯¾å¿œEnterã‚­ãƒ¼å‡¦ç†ï¼ˆSafariå¯¾å¿œç‰ˆï¼‰\n    this.input.addEventListener('keydown', (e) => {\n      if (e.key === 'Enter') {\n        // Safari: compositionendç›´å¾Œã®Enterã‚’ã‚¹ã‚­ãƒƒãƒ—\n        if (isSafari && this.hasCompositionJustEnded) {\n          this.hasCompositionJustEnded = false;\n          return;\n        }\n\n        // ãã®ä»–ã®ãƒ–ãƒ©ã‚¦ã‚¶: isComposingãƒã‚§ãƒƒã‚¯\n        if (!isSafari && (e.isComposing || this.isComposing)) {\n          return;\n        }\n\n        // Generate ãƒ¢ãƒ¼ãƒ‰ã®ã¿ãƒ‡ãƒ¢åˆ¶é™ã‚’é©ç”¨\n        if (this.currentMode === 'generate') {\n          e.preventDefault();\n          this.showDemoMessage();\n          return;\n        }\n\n        e.preventDefault();\n        this.executeCommand();\n      }\n    });\n    \n    // åˆæœŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸\n    if (this.config.showExamples) {\n      // èµ·å‹•ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‰Šé™¤\n      // èµ·å‹•æ™‚ã¯é™ã‹ã«å¾…æ©Ÿ\n    }\n  }\n\n  /**\n   * ãƒ¢ãƒ¼ãƒ‰ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ä½œæˆ\n   */\n  createMinimalActions() {\n    const container = document.createElement('div');\n    container.style.cssText = `\n      display: flex;\n      margin-top: 8px;\n      margin-bottom: 0 !important;\n      gap: 8px;\n      justify-content: space-between;\n      align-items: center;\n    `;\n\n    // å·¦å´: Clear All ãƒœã‚¿ãƒ³ï¼ˆæ‰¿èªæ¸ˆã¿ã®Layout Bãƒ‡ã‚¶ã‚¤ãƒ³ï¼‰\n    const leftSection = document.createElement('div');\n    leftSection.style.cssText = 'display: flex; gap: 8px; align-items: center;';\n\n    const clearBtn = document.createElement('button');\n    clearBtn.innerHTML = '<span style=\"filter: hue-rotate(240deg) saturate(0.7) brightness(0.9);\">ğŸ§¹</span> Clear All';\n    clearBtn.style.cssText = this.getActionButtonStyles('secondary');\n    clearBtn.addEventListener('click', () => this.clearAllWithConfirmation());\n\n    // å±¥æ­´ãƒœã‚¿ãƒ³ï¼ˆå°†æ¥å®Ÿè£…ç”¨ã‚¹ãƒšãƒ¼ã‚¹ç¢ºä¿ï¼‰- æµ·å¤–UIæ¨™æº–å¯¾å¿œï¼šåŒä¸€å¹…\n    const historyBtn = document.createElement('button');\n    historyBtn.innerHTML = '<span style=\"filter: hue-rotate(240deg) saturate(0.7) brightness(0.9);\">ğŸ“š</span> History';\n    historyBtn.style.cssText = this.getActionButtonStyles('secondary');\n    historyBtn.style.opacity = '0.5';\n    historyBtn.disabled = true;\n    historyBtn.title = 'å±¥æ­´æ©Ÿèƒ½ï¼ˆé–‹ç™ºä¸­ï¼‰';\n\n    leftSection.appendChild(clearBtn);\n    leftSection.appendChild(historyBtn);\n\n    // å³å´: ãƒ†ãƒ¼ãƒãƒˆã‚°ãƒ«ã¨è¨­å®šï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼ã‹ã‚‰ç§»å‹•ï¼‰\n    const rightSection = document.createElement('div');\n    rightSection.style.cssText = 'display: flex; gap: 6px; align-items: center;';\n\n    const themeToggle = document.createElement('button');\n    const getThemeIcon = () => {\n      const themeConfig = {\n        light: 'ğŸŒ™',\n        dark: 'ğŸµ',\n        wabisabi: 'â˜€ï¸'\n      };\n      return themeConfig[this.currentTheme] || 'ğŸŒ™';\n    };\n\n    const getThemeTitle = () => {\n      const titleConfig = {\n        light: 'ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆ',\n        dark: 'ä¾˜ã³å¯‚ã³ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆ',\n        wabisabi: 'ãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆ'\n      };\n      return titleConfig[this.currentTheme] || 'ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆ';\n    };\n\n    const getThemeIconWithFilter = () => {\n      const icon = getThemeIcon();\n      // å¤ªé™½ã¯é»„è‰²ãã€ãŠèŒ¶ã¯ç·‘ç³»ã€æœˆã¯ç´«ç³»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼\n      if (icon === 'â˜€ï¸') {\n        return `<span style=\"filter: saturate(1.2) brightness(1.1);\">${icon}</span>`;\n      } else if (icon === 'ğŸµ') {\n        return `<span style=\"filter: hue-rotate(80deg) saturate(1.1) brightness(1.0);\">${icon}</span>`;\n      } else {\n        return `<span style=\"filter: hue-rotate(240deg) saturate(0.8) brightness(1.1);\">${icon}</span>`;\n      }\n    };\n\n    themeToggle.innerHTML = getThemeIconWithFilter();\n    themeToggle.style.cssText = this.getActionButtonStyles('icon');\n    themeToggle.title = getThemeTitle();\n    themeToggle.addEventListener('click', () => this.toggleTheme());\n\n    const settingsButton = document.createElement('button');\n    settingsButton.innerHTML = '<span style=\"filter: hue-rotate(240deg) saturate(0.8) brightness(1.1);\">âš™ï¸</span>';\n    settingsButton.style.cssText = this.getActionButtonStyles('icon');\n    settingsButton.title = 'ã‚µãƒ¼ãƒ“ã‚¹è¨­å®šã‚’é–‹ã';\n    settingsButton.addEventListener('click', () => this.openServiceModal());\n\n    rightSection.appendChild(themeToggle);\n    rightSection.appendChild(settingsButton);\n\n    container.appendChild(leftSection);\n    container.appendChild(rightSection);\n\n    // å‚ç…§ã‚’ä¿æŒ\n    this.clearBtn = clearBtn;\n    this.historyBtn = historyBtn;\n    this.themeToggle = themeToggle;\n    this.settingsButton = settingsButton;\n\n    return container;\n  }\n\n  createServiceSelectorSection() {\n    this.serviceSelectorContainer = document.createElement('div');\n    this.serviceSelectorContainer.id = 'service-selector';\n    this.serviceSelectorContainer.style.cssText = `\n      margin-bottom: 16px;\n      padding: 12px;\n      border-radius: 12px;\n      border: 1px solid transparent;\n      transition: background 0.3s ease, border 0.3s ease;\n    `;\n\n    this.serviceSelectorStatus = document.createElement('div');\n    this.serviceSelectorStatus.textContent = 'ã‚µãƒ¼ãƒ“ã‚¹æƒ…å ±ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...';\n    this.serviceSelectorStatus.style.fontSize = '12px';\n    this.serviceSelectorStatus.style.opacity = '0.8';\n    this.serviceSelectorStatus.style.marginBottom = '8px';\n    this.serviceSelectorContainer.appendChild(this.serviceSelectorStatus);\n\n    this.serviceSelectorContent = document.createElement('div');\n    this.serviceSelectorContainer.appendChild(this.serviceSelectorContent);\n\n    this.updateServiceSelectorTheme();\n    return this.serviceSelectorContainer;\n  }\n\n  createServiceModal() {\n    if (this.serviceModalOverlay) {\n      this.serviceModalOverlay.remove();\n      this.serviceModalOverlay = null;\n      this.serviceModal = null;\n    }\n\n    this.serviceModalOverlay = document.createElement('div');\n    this.serviceModalOverlay.id = 'chocodrop-service-modal-overlay';\n    this.serviceModalOverlay.style.cssText = `\n      position: fixed;\n      inset: 0;\n      display: none;\n      align-items: center;\n      justify-content: center;\n      backdrop-filter: blur(18px);\n      -webkit-backdrop-filter: blur(18px);\n      z-index: 2000;\n      padding: 16px !important;\n      opacity: 0;\n      transition: opacity 0.2s ease;\n    `;\n\n    this.serviceModalOverlay.addEventListener('click', (event) => {\n      if (event.target === this.serviceModalOverlay) {\n        this.closeServiceModal();\n      }\n    });\n\n    this.serviceModal = document.createElement('div');\n    this.serviceModal.className = 'chocodrop-service-modal';\n    this.serviceModal.style.cssText = `\n      width: min(420px, 90vw);\n      border-radius: 24px;\n      padding: 26px 28px;\n      backdrop-filter: blur(20px);\n      -webkit-backdrop-filter: blur(20px);\n      border: 1px solid rgba(255, 255, 255, 0.2);\n      box-shadow: 0 20px 40px rgba(15, 23, 42, 0.35);\n      display: flex;\n      flex-direction: column;\n      gap: 18px;\n      max-height: 90vh;\n      overflow-y: auto;\n      position: relative;\n    `;\n\n    const title = document.createElement('h2');\n    title.textContent = 'ã‚µãƒ¼ãƒ“ã‚¹è¨­å®š';\n    title.style.cssText = `\n      margin: 0;\n      font-size: 18px;\n      font-weight: 700;\n      letter-spacing: 0.03em;\n    `;\n\n    const subtitle = document.createElement('p');\n    subtitle.textContent = 'åˆ©ç”¨ã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚';\n    subtitle.style.cssText = `\n      margin: 0;\n      font-size: 12px;\n      opacity: 0.75;\n    `;\n\n    const selector = this.createServiceSelectorSection();\n\n    const actionRow = document.createElement('div');\n    actionRow.style.cssText = `\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      gap: 16px;\n    `;\n\n    this.serviceSelectorRetryButton = document.createElement('button');\n    this.serviceSelectorRetryButton.textContent = 'å†èª­ã¿è¾¼ã¿';\n    this.serviceSelectorRetryButton.style.cssText = `\n      font-size: 11px;\n      padding: 6px 14px;\n      border-radius: 10px;\n      border: 1px solid transparent;\n      cursor: pointer;\n      display: none;\n      transition: all 0.2s ease;\n    `;\n    this.serviceSelectorRetryButton.addEventListener('click', () => this.initializeServiceSelector(true));\n\n    const actionButtons = document.createElement('div');\n    actionButtons.style.cssText = 'display: flex; gap: 8px;';\n\n    this.serviceSelectorCancelButton = document.createElement('button');\n    this.serviceSelectorCancelButton.textContent = 'Cancel';\n    this.serviceSelectorCancelButton.style.cssText = `\n      font-size: 12px;\n      padding: 8px 16px;\n      border-radius: 10px;\n      border: 1px solid rgba(255, 255, 255, 0.35);\n      background: transparent;\n      cursor: pointer;\n      transition: all 0.2s ease;\n    `;\n    this.serviceSelectorCancelButton.addEventListener('click', () => this.closeServiceModal());\n\n    this.serviceSelectorSaveButton = document.createElement('button');\n    this.serviceSelectorSaveButton.textContent = 'Save';\n    this.serviceSelectorSaveButton.style.cssText = `\n      font-size: 12px;\n      padding: 8px 18px;\n      border-radius: 10px;\n      border: none;\n      cursor: pointer;\n      background: linear-gradient(135deg, #6366f1, #8b5cf6);\n      color: white;\n      font-weight: 600;\n      transition: all 0.2s ease;\n      box-shadow: 0 12px 24px rgba(99, 102, 241, 0.35);\n    `;\n    this.serviceSelectorSaveButton.addEventListener('click', () => this.handleServiceSave());\n\n    actionButtons.appendChild(this.serviceSelectorCancelButton);\n    actionButtons.appendChild(this.serviceSelectorSaveButton);\n\n    actionRow.appendChild(this.serviceSelectorRetryButton);\n    actionRow.appendChild(actionButtons);\n\n    this.serviceModal.appendChild(title);\n    this.serviceModal.appendChild(subtitle);\n    this.serviceModal.appendChild(selector);\n    this.serviceModal.appendChild(actionRow);\n\n    this.serviceModalOverlay.appendChild(this.serviceModal);\n    document.body.appendChild(this.serviceModalOverlay);\n\n    this.updateServiceSelectorTheme();\n    this.toggleServiceRetryButton(false);\n  }\n\n  openServiceModal(forceFetch = false) {\n    if (!this.serviceModalOverlay) {\n      this.createServiceModal();\n    }\n\n    this.serviceModalOverlay.style.display = 'flex';\n    requestAnimationFrame(() => {\n      if (this.serviceModalOverlay) {\n        this.serviceModalOverlay.style.opacity = '1';\n      }\n    });\n\n    this.resetPendingSelections();\n    this.initializeServiceSelector(forceFetch);\n  }\n\n  closeServiceModal() {\n    if (!this.serviceModalOverlay) {\n      return;\n    }\n\n    this.serviceModalOverlay.style.opacity = '0';\n    setTimeout(() => {\n      if (this.serviceModalOverlay) {\n        this.serviceModalOverlay.style.display = 'none';\n      }\n      this.resetPendingSelections();\n    }, 150);\n  }\n\n  async initializeServiceSelector(force = false) {\n    if (this.servicesLoading && !force) {\n      return;\n    }\n\n    if (!this.client || typeof this.client.getAvailableServices !== 'function') {\n      this.setServiceSelectorStatus('ã‚µãƒ¼ãƒ“ã‚¹æƒ…å ±ã‚’å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆåˆæœŸåŒ–å¾…ã¡ã§ã™ï¼‰ã€‚å³ä¸‹ã®ã€Œå†èª­ã¿è¾¼ã¿ã€ã§å†å–å¾—ã§ãã¾ã™ã€‚', 'error');\n      this.toggleServiceRetryButton(true);\n      this.setServiceButtonsEnabled(false);\n      return;\n    }\n\n    this.servicesLoading = true;\n    this.setServiceSelectorStatus('ã‚µãƒ¼ãƒ“ã‚¹æƒ…å ±ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...', 'info');\n    this.toggleServiceRetryButton(false);\n    this.setServiceButtonsEnabled(false);\n\n    try {\n      if (typeof this.client.ensureInitialized === 'function') {\n        await this.client.ensureInitialized();\n      }\n\n      const response = await this.client.getAvailableServices();\n      if (!response || response.success === false || !response.metadata) {\n        throw new Error(response?.error || 'ã‚µãƒ¼ãƒ“ã‚¹æƒ…å ±ãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ');\n      }\n\n      this.availableImageServices = Array.isArray(response.metadata?.image) ? response.metadata.image : [];\n      this.availableVideoServices = Array.isArray(response.metadata?.video) ? response.metadata.video : [];\n\n      this.selectedImageService = this.resolveServiceSelection(\n        'image',\n        this.availableImageServices,\n        response.default?.image\n      );\n\n      this.selectedVideoService = this.resolveServiceSelection(\n        'video',\n        this.availableVideoServices,\n        response.default?.video\n      );\n\n      this.pendingImageService = this.selectedImageService;\n      this.pendingVideoService = this.selectedVideoService;\n\n      this.populateServiceSelector();\n      this.applyServiceSelectionToSceneManager();\n      this.setServiceButtonsEnabled(true);\n    } catch (error) {\n      console.error('âŒ Failed to initialize service selector:', error);\n      this.setServiceSelectorStatus('ã‚µãƒ¼ãƒ“ã‚¹æƒ…å ±ã‚’å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚ã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ç¢ºèªã®ã†ãˆã€å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ã€‚', 'error');\n      this.toggleServiceRetryButton(true);\n      this.setServiceButtonsEnabled(false);\n    } finally {\n      this.servicesLoading = false;\n    }\n  }\n\n  setServiceSelectorStatus(message, type = 'info') {\n    if (!this.serviceSelectorStatus) {\n      return;\n    }\n    this.serviceSelectorStatus.textContent = message;\n    this.serviceSelectorStatus.dataset.statusType = type;\n    this.serviceSelectorStatus.classList.toggle('service-selector-helper', type !== 'error');\n    this.updateServiceSelectorTheme();\n  }\n\n  toggleServiceRetryButton(visible) {\n    if (!this.serviceSelectorRetryButton) {\n      return;\n    }\n    this.serviceSelectorRetryButton.style.display = visible ? 'inline-flex' : 'none';\n    this.updateServiceSelectorTheme();\n  }\n\n  resolveServiceSelection(type, services, defaultId) {\n    if (!services || services.length === 0) {\n      return null;\n    }\n\n    const storageKey = type === 'image' ? IMAGE_SERVICE_STORAGE_KEY : VIDEO_SERVICE_STORAGE_KEY;\n    let storedId = null;\n    try {\n      storedId = localStorage.getItem(storageKey);\n    } catch (error) {\n      console.warn('âš ï¸ Failed to access localStorage:', error);\n    }\n\n    const isStoredValid = storedId && services.some(service => service.id === storedId);\n    let resolvedId = isStoredValid ? storedId : null;\n\n    if (!resolvedId && defaultId && services.some(service => service.id === defaultId)) {\n      resolvedId = defaultId;\n    }\n\n    if (!resolvedId) {\n      resolvedId = services[0]?.id || null;\n    }\n\n    try {\n      if (resolvedId) {\n        localStorage.setItem(storageKey, resolvedId);\n      } else {\n        localStorage.removeItem(storageKey);\n      }\n    } catch (error) {\n      console.warn('âš ï¸ Failed to persist service selection:', error);\n    }\n\n    return resolvedId;\n  }\n\n  populateServiceSelector() {\n    if (!this.serviceSelectorContent) {\n      return;\n    }\n\n    this.serviceSelectorContent.innerHTML = '';\n\n    const hasImage = this.availableImageServices.length > 0;\n    const hasVideo = this.availableVideoServices.length > 0;\n\n    if (!hasImage && !hasVideo) {\n      this.setServiceSelectorStatus('åˆ©ç”¨å¯èƒ½ãªã‚µãƒ¼ãƒ“ã‚¹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚', 'error');\n      return;\n    }\n\n    this.setServiceSelectorStatus('åˆ©ç”¨ã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚', 'info');\n\n    if (hasImage) {\n      const imageRow = this.buildServiceRow('image', 'ç”»åƒ (T2I)', this.availableImageServices, this.pendingImageService || this.selectedImageService);\n      this.serviceSelectorContent.appendChild(imageRow);\n    }\n\n    if (hasVideo) {\n      const videoRow = this.buildServiceRow('video', 'å‹•ç”» (T2V)', this.availableVideoServices, this.pendingVideoService || this.selectedVideoService);\n      this.serviceSelectorContent.appendChild(videoRow);\n    }\n\n    this.updateServiceSelectorTheme();\n  }\n\n  buildServiceRow(type, labelText, services, selectedId) {\n    const row = document.createElement('div');\n    row.className = `service-row service-row-${type}`;\n    row.style.cssText = `\n      display: flex;\n      flex-direction: column;\n      gap: 6px;\n      margin-bottom: 12px;\n    `;\n\n    const label = document.createElement('label');\n    label.textContent = labelText;\n    label.style.fontSize = '13px';\n    label.style.fontWeight = '600';\n    row.appendChild(label);\n\n    const select = document.createElement('select');\n    select.dataset.serviceType = type;\n    select.style.fontFamily = 'inherit';\n    select.style.width = '100%';\n\n    services.forEach(service => {\n      const option = document.createElement('option');\n      option.value = service.id;\n      option.textContent = service.name || service.id;\n      if (service.description) {\n        option.title = service.description;\n      }\n      select.appendChild(option);\n    });\n\n    if (selectedId && services.some(service => service.id === selectedId)) {\n      select.value = selectedId;\n    }\n\n    select.addEventListener('change', (event) => {\n      this.onServiceSelectionChange(type, event.target.value);\n    });\n\n    row.appendChild(select);\n\n    const description = document.createElement('div');\n    description.className = 'service-description';\n    description.textContent = this.findServiceInfo(type, select.value)?.description || '';\n    description.style.fontSize = '11px';\n    description.style.opacity = '0.75';\n    description.style.lineHeight = '1.4';\n    description.style.minHeight = '14px';\n    row.appendChild(description);\n\n    select.addEventListener('change', () => {\n      description.textContent = this.findServiceInfo(type, select.value)?.description || '';\n    });\n\n    if (type === 'image') {\n      this.imageServiceSelect = select;\n    } else {\n      this.videoServiceSelect = select;\n    }\n\n    return row;\n  }\n\n  onServiceSelectionChange(type, serviceId) {\n    if (type === 'image') {\n      this.pendingImageService = serviceId;\n    } else {\n      this.pendingVideoService = serviceId;\n    }\n\n    const info = this.findServiceInfo(type, serviceId);\n    const description = type === 'image'\n      ? this.imageServiceSelect?.parentElement?.querySelector('.service-description')\n      : this.videoServiceSelect?.parentElement?.querySelector('.service-description');\n\n    if (description) {\n      description.textContent = info?.description || '';\n    }\n  }\n\n  handleServiceSave() {\n    const newImageId = this.pendingImageService || this.selectedImageService;\n    const newVideoId = this.pendingVideoService || this.selectedVideoService;\n\n    if (newImageId) {\n      try {\n        localStorage.setItem(IMAGE_SERVICE_STORAGE_KEY, newImageId);\n      } catch (error) {\n        console.warn('âš ï¸ Failed to persist image service selection:', error);\n      }\n      this.selectedImageService = newImageId;\n      this.sceneManager?.setImageService(newImageId);\n    }\n\n    if (newVideoId) {\n      try {\n        localStorage.setItem(VIDEO_SERVICE_STORAGE_KEY, newVideoId);\n      } catch (error) {\n        console.warn('âš ï¸ Failed to persist video service selection:', error);\n      }\n      this.selectedVideoService = newVideoId;\n      this.sceneManager?.setVideoService(newVideoId);\n    }\n\n    const imageInfo = this.findServiceInfo('image', newImageId);\n    const videoInfo = this.findServiceInfo('video', newVideoId);\n\n    if (imageInfo) {\n      this.addOutput(`ğŸ–¼ï¸ ç”»åƒã‚µãƒ¼ãƒ“ã‚¹ã‚’ã€Œ${imageInfo.name}ã€ã«è¨­å®šã—ã¾ã—ãŸ`, 'system');\n    }\n    if (videoInfo) {\n      this.addOutput(`ğŸ¬ å‹•ç”»ã‚µãƒ¼ãƒ“ã‚¹ã‚’ã€Œ${videoInfo.name}ã€ã«è¨­å®šã—ã¾ã—ãŸ`, 'system');\n    }\n\n    this.closeServiceModal();\n  }\n\n  setServiceButtonsEnabled(enabled) {\n    if (this.serviceSelectorSaveButton) {\n      this.serviceSelectorSaveButton.disabled = !enabled;\n      this.serviceSelectorSaveButton.style.opacity = enabled ? '1' : '0.6';\n      this.serviceSelectorSaveButton.style.cursor = enabled ? 'pointer' : 'not-allowed';\n    }\n  }\n\n  resetPendingSelections() {\n    this.pendingImageService = this.selectedImageService;\n    this.pendingVideoService = this.selectedVideoService;\n\n    if (this.imageServiceSelect && this.selectedImageService) {\n      this.imageServiceSelect.value = this.selectedImageService;\n    }\n    if (this.videoServiceSelect && this.selectedVideoService) {\n      this.videoServiceSelect.value = this.selectedVideoService;\n    }\n\n    if (this.serviceSelectorContent && this.serviceSelectorContent.childElementCount > 0) {\n      this.populateServiceSelector();\n    }\n  }\n\n  findServiceInfo(type, serviceId) {\n    const list = type === 'image' ? this.availableImageServices : this.availableVideoServices;\n    return list.find(service => service.id === serviceId) || null;\n  }\n\n  applyServiceSelectionToSceneManager() {\n    if (!this.sceneManager) {\n      return;\n    }\n    this.sceneManager.setImageService(this.selectedImageService);\n    this.sceneManager.setVideoService(this.selectedVideoService);\n  }\n\n  updateServiceSelectorTheme() {\n    if (this.serviceModalOverlay) {\n      this.serviceModalOverlay.style.background = this.isDarkMode\n        ? 'rgba(8, 11, 26, 0.55)'\n        : 'rgba(229, 231, 255, 0.45)';\n    }\n\n    if (this.serviceModal) {\n      this.serviceModal.style.background = this.isDarkMode\n        ? 'rgba(17, 24, 39, 0.15)'\n        : 'rgba(255, 255, 255, 0.15)';\n      this.serviceModal.style.border = this.isDarkMode\n        ? '1px solid rgba(129, 140, 248, 0.4)'\n        : '1px solid rgba(99, 102, 241, 0.25)';\n      this.serviceModal.style.color = this.isDarkMode ? '#e5e7ff' : '#1f2937';\n    }\n\n    if (this.serviceSelectorStatus) {\n      const type = this.serviceSelectorStatus.dataset?.statusType;\n      const statusColor = type === 'error'\n        ? (this.isDarkMode ? '#fca5a5' : '#b91c1c')\n        : (this.isDarkMode ? 'rgba(209, 213, 219, 0.8)' : 'rgba(55, 65, 81, 0.75)');\n      this.serviceSelectorStatus.style.color = statusColor;\n    }\n\n    if (this.serviceSelectorContainer) {\n      const labels = this.serviceSelectorContainer.querySelectorAll('label');\n      labels.forEach(label => {\n        label.style.color = this.isDarkMode ? 'rgba(255, 255, 255, 0.9)' : 'rgba(31, 41, 55, 0.9)';\n      });\n\n      const selects = this.serviceSelectorContainer.querySelectorAll('select');\n      selects.forEach(select => {\n        select.style.background = this.isDarkMode ? 'rgba(99, 102, 241, 0.18)' : 'rgba(99, 102, 241, 0.12)';\n        select.style.border = this.isDarkMode ? '1px solid rgba(129, 140, 248, 0.45)' : '1px solid rgba(99, 102, 241, 0.45)';\n        select.style.color = this.isDarkMode ? '#ffffff' : '#1f2937';\n        select.style.padding = '10px 12px';\n        select.style.borderRadius = '10px';\n        select.style.fontSize = '13px';\n        select.style.outline = 'none';\n        select.style.boxShadow = this.isDarkMode\n          ? '0 12px 28px rgba(15, 23, 42, 0.5)'\n          : '0 12px 24px rgba(99, 102, 241, 0.2)';\n      });\n\n      const descriptions = this.serviceSelectorContainer.querySelectorAll('.service-description');\n      descriptions.forEach(desc => {\n        desc.style.color = this.isDarkMode ? 'rgba(209, 213, 219, 0.8)' : 'rgba(55, 65, 81, 0.7)';\n      });\n    }\n\n    if (this.serviceSelectorRetryButton) {\n      this.serviceSelectorRetryButton.style.background = this.isDarkMode\n        ? 'rgba(129, 140, 248, 0.35)'\n        : 'rgba(99, 102, 241, 0.15)';\n      this.serviceSelectorRetryButton.style.border = this.isDarkMode\n        ? '1px solid rgba(129, 140, 248, 0.5)'\n        : '1px solid rgba(99, 102, 241, 0.45)';\n      this.serviceSelectorRetryButton.style.color = this.isDarkMode ? '#f9fafb' : '#1e1b4b';\n      this.serviceSelectorRetryButton.style.boxShadow = this.isDarkMode\n        ? '0 0 8px rgba(129, 140, 248, 0.45)'\n        : '0 0 8px rgba(99, 102, 241, 0.35)';\n    }\n\n    if (this.serviceSelectorCancelButton) {\n      this.serviceSelectorCancelButton.style.border = this.isDarkMode\n        ? '1px solid rgba(209, 213, 219, 0.3)'\n        : '1px solid rgba(148, 163, 184, 0.5)';\n      this.serviceSelectorCancelButton.style.color = this.isDarkMode ? 'rgba(226, 232, 240, 0.85)' : 'rgba(30, 41, 59, 0.85)';\n    }\n\n    if (this.serviceSelectorSaveButton) {\n      this.serviceSelectorSaveButton.style.background = this.isDarkMode\n        ? 'linear-gradient(135deg, #6366f1, #8b5cf6)'\n        : 'linear-gradient(135deg, #818cf8, #a855f7)';\n      this.serviceSelectorSaveButton.style.boxShadow = this.isDarkMode\n        ? '0 16px 28px rgba(99, 102, 241, 0.4)'\n        : '0 16px 28px rgba(129, 140, 248, 0.35)';\n    }\n  }\n\n  /**\n   * ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³é¢¨ãƒ¢ãƒ¼ãƒ‰ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ä½œæˆ\n   */\n  createRadioModeSelector() {\n    const container = document.createElement('div');\n    container.className = 'radio-mode-selector';\n    container.style.cssText = `\n      display: grid;\n      grid-template-columns: repeat(4, 1fr);\n      gap: 8px;\n      margin-bottom: 12px;\n      padding: 12px;\n      background: ${this.isWabiSabiMode\n        ? 'linear-gradient(135deg, rgba(158, 158, 158, 0.25), rgba(189, 189, 189, 0.2))'\n        : (this.isDarkMode\n          ? 'linear-gradient(135deg, rgba(30, 27, 75, 0.3), rgba(15, 23, 42, 0.4))'\n          : 'linear-gradient(135deg, rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.1))')};\n      border: 1px solid ${this.isWabiSabiMode\n        ? 'rgba(141, 110, 99, 0.4)'\n        : (this.isDarkMode ? 'rgba(99, 102, 241, 0.15)' : 'rgba(255, 255, 255, 0.25)')};\n      border-radius: 16px;\n      backdrop-filter: blur(12px);\n      transition: all 0.3s ease;\n      position: relative;\n    `;\n\n    const modes = [\n      { value: 'generate', label: 'Generate', icon: 'ğŸš«', disabled: true },\n      { value: 'import', label: 'Import', icon: 'ğŸ“¥' },\n      { value: 'modify', label: 'Modify', icon: 'ğŸ”§' },\n      { value: 'delete', label: 'Delete', icon: 'ğŸ—‘ï¸' }\n    ];\n\n    this.radioModeButtons = {};\n\n    modes.forEach(mode => {\n      const button = document.createElement('div');\n      button.className = `mode-option ${mode.value}`;\n      button.style.cssText = `\n        display: flex;\n        flex-direction: column;\n        align-items: center;\n        gap: 4px;\n        padding: 10px 8px;\n        border-radius: 12px;\n        cursor: ${mode.disabled ? 'not-allowed' : 'pointer'};\n        transition: all 0.2s ease;\n        font-size: 11px;\n        font-weight: 600;\n        text-align: center;\n        color: ${mode.disabled ? 'rgba(139, 92, 246, 0.6)' : this.isWabiSabiMode\n          ? '#F5F5F5'\n          : (this.isDarkMode ? 'rgba(255, 255, 255, 0.7)' : 'rgba(55, 65, 81, 0.8)')};\n        background: transparent;\n        border: 1px solid transparent;\n        position: relative;\n        opacity: ${mode.disabled ? '0.6' : '1'};\n      `;\n\n      const icon = document.createElement('div');\n      icon.textContent = mode.icon;\n      icon.style.cssText = `\n        font-size: 16px;\n        margin-bottom: 2px;\n        filter: ${mode.disabled ? 'hue-rotate(240deg) saturate(0.8) brightness(1.1)' : this.isDarkMode \n          ? 'hue-rotate(220deg) saturate(0.8) brightness(1.2)' \n          : 'hue-rotate(240deg) saturate(0.7) brightness(0.9)'};\n        transition: filter 0.2s ease;\n      `;\n\n      const label = document.createElement('span');\n      label.textContent = mode.label;\n\n      // AUTOãƒãƒƒã‚¸ã‚’ä½œæˆ\n      const autoBadge = document.createElement('div');\n      autoBadge.className = 'auto-badge';\n      autoBadge.textContent = 'AUTO';\n      autoBadge.style.cssText = `\n        position: absolute;\n        top: -4px;\n        right: -4px;\n        font-size: 7px;\n        font-weight: 700;\n        padding: 2px 4px;\n        background: linear-gradient(135deg, #10b981, #059669);\n        color: white;\n        border-radius: 6px;\n        opacity: 0;\n        transform: scale(0.8);\n        transition: all 0.2s ease;\n        display: none;\n      `;\n\n      button.appendChild(icon);\n      button.appendChild(label);\n      button.appendChild(autoBadge);\n\n      // ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†\n      if (mode.disabled) {\n        // ã‚¯ãƒªãƒƒã‚¯æ™‚ã®ã¿ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆãƒˆãƒ¼ã‚¹ãƒˆè¡¨ç¤º\n        button.addEventListener('click', (e) => {\n          e.preventDefault();\n          e.stopPropagation();\n          this.showDemoMessage();\n        });\n      } else {\n        // é€šå¸¸ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ\n        button.addEventListener('click', () => {\n          if (mode.value === 'import') {\n            this.triggerFileSelection();\n          } else {\n            this.selectMode(mode.value, true); // trueã¯æ‰‹å‹•é¸æŠã‚’ç¤ºã™\n          }\n        });\n      }\n\n      this.radioModeButtons[mode.value] = { button, autoBadge };\n      container.appendChild(button);\n    });\n\n\n    this.radioModeContainer = container;\n    // ãƒ‡ãƒ¢ãƒšãƒ¼ã‚¸ã§ã¯Importã‚’åˆæœŸé¸æŠ\n    this.selectMode('import', false);\n\n    return container;\n  }\n\n  /**\n   * ãƒ¢ãƒ¼ãƒ‰é¸æŠï¼ˆãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³UIæ›´æ–°ï¼‰\n   */\n  selectMode(mode, isManual = false, detectedKeyword = null) {\n    this.currentMode = mode;\n\n    // å…¨ãƒœã‚¿ãƒ³ã‚’ãƒªã‚»ãƒƒãƒˆ\n    Object.keys(this.radioModeButtons).forEach(key => {\n      const { button, autoBadge } = this.radioModeButtons[key];\n      button.style.color = this.isWabiSabiMode\n        ? '#F5F5F5'\n        : (this.isDarkMode ? 'rgba(255, 255, 255, 0.7)' : 'rgba(55, 65, 81, 0.8)');\n      button.style.background = 'transparent';\n      button.style.border = '1px solid transparent';\n      button.style.transform = 'scale(1)';\n      button.style.boxShadow = 'none';\n      // AUTOãƒãƒƒã‚¸ã‚’éè¡¨ç¤º\n      autoBadge.style.display = 'none';\n      autoBadge.style.opacity = '0';\n    });\n\n    // é¸æŠã•ã‚ŒãŸãƒœã‚¿ãƒ³ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆï¼ˆ2025å¹´ä»•æ§˜ï¼‰\n    const { button, autoBadge } = this.radioModeButtons[mode];\n    \n    // 2025 Glassmorphismé¸æŠçŠ¶æ…‹\n    const selectedGlass = this.isWabiSabiMode\n      ? {\n          background: 'linear-gradient(135deg, rgba(109, 76, 65, 0.2), rgba(141, 110, 99, 0.15))',\n          border: '1px solid rgba(109, 76, 65, 0.4)',\n          boxShadow: '0 4px 16px rgba(109, 76, 65, 0.25), inset 0 1px 0 rgba(245, 245, 220, 0.15)',\n          color: '#F5F5F5'\n        }\n      : (this.isDarkMode\n        ? {\n            background: 'linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(139, 92, 246, 0.15))',\n            border: '1px solid rgba(99, 102, 241, 0.4)',\n            boxShadow: '0 4px 16px rgba(99, 102, 241, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.1)',\n            color: '#a5b4fc'\n          }\n        : {\n            background: 'linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.08))',\n            border: '1px solid rgba(99, 102, 241, 0.3)',\n            boxShadow: '0 4px 16px rgba(99, 102, 241, 0.15), inset 0 1px 0 rgba(255, 255, 255, 0.2)',\n            color: '#6366f1'\n          });\n\n    button.style.color = selectedGlass.color;\n    button.style.background = selectedGlass.background;\n    button.style.border = selectedGlass.border;\n    button.style.boxShadow = selectedGlass.boxShadow;\n    button.style.transform = 'scale(1.02)';\n\n    // AUTOãƒãƒƒã‚¸ã®è¡¨ç¤ºåˆ¶å¾¡\n    if (!isManual && detectedKeyword) {\n      // è‡ªå‹•åˆ‡ã‚Šæ›¿ãˆã®å ´åˆã¯AUTOãƒãƒƒã‚¸ã‚’è¡¨ç¤º\n      autoBadge.style.display = 'inline-block';\n      setTimeout(() => {\n        autoBadge.style.opacity = '1';\n        autoBadge.style.transform = 'scale(1)';\n      }, 100);\n      \n      // 3ç§’å¾Œã«ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆ\n      setTimeout(() => {\n        autoBadge.style.opacity = '0';\n        autoBadge.style.transform = 'scale(0.8)';\n        setTimeout(() => {\n          autoBadge.style.display = 'none';\n        }, 200);\n      }, 3000);\n    }\n\n    // ãƒ‘ãƒ«ã‚¹åŠ¹æœã‚’è¿½åŠ \n    if (!isManual) {\n      this.addPulseEffect(button);\n      this.addContainerGlow(mode);\n    }\n\n    // ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼æ›´æ–°\n    this.input.placeholder = this.getPlaceholderForMode(mode);\n\n    // ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆæ™‚ã®å…¥åŠ›æ¬„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä¸Šæ›¸ãæ©Ÿèƒ½\n    if (isManual) {\n      this.clearInputOnModeSwitch(mode);\n    }\n\n    // Importãƒ¢ãƒ¼ãƒ‰å°‚ç”¨å‡¦ç†\n    if (mode === 'import' || this.selectedFile) {\n      this.showImportInterface();\n    } else {\n      this.hideImportInterface();\n    }\n\n    // Deleteãƒ¢ãƒ¼ãƒ‰å°‚ç”¨å‡¦ç†\n    if (mode === 'delete' && isManual) {\n      this.handleDeleteModeSelection();\n    }\n\n    // Modifyãƒ¢ãƒ¼ãƒ‰å°‚ç”¨å‡¦ç†\n    if (mode === 'modify' && isManual) {\n      this.handleModifyModeSelection();\n    }\n\n    // ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯è¡¨ç¤ºã—ãªã„ï¼ˆUIã§åˆ†ã‹ã‚‹ãŸã‚ï¼‰\n  }\n\n  /**\n   * ãƒ‘ãƒ«ã‚¹åŠ¹æœã‚’è¿½åŠ \n   */\n  addPulseEffect(element) {\n    // æ—¢å­˜ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒªã‚»ãƒƒãƒˆ\n    element.style.animation = 'none';\n    \n    // å°‘ã—é…ã‚‰ã›ã¦ã‹ã‚‰ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é©ç”¨ï¼ˆãƒªãƒ•ãƒ­ãƒ¼å¼·åˆ¶ï¼‰\n    setTimeout(() => {\n      element.style.animation = 'smartModePulse 0.6s ease-out';\n    }, 10);\n    \n    // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³çµ‚äº†å¾Œã«ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—\n    setTimeout(() => {\n      element.style.animation = '';\n    }, 610);\n    \n    // CSSã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å‹•çš„ã«è¿½åŠ ï¼ˆã¾ã å­˜åœ¨ã—ãªã„å ´åˆï¼‰\n    this.ensurePulseAnimation();\n  }\n\n  /**\n   * ãƒ‘ãƒ«ã‚¹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”¨CSSã‚’ç¢ºä¿\n   */\n  ensurePulseAnimation() {\n    if (document.getElementById('smart-mode-pulse-animation')) return;\n    \n    const style = document.createElement('style');\n    style.id = 'smart-mode-pulse-animation';\n    style.textContent = `\n      @keyframes smartModePulse {\n        0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(236, 72, 153, 0.7); }\n        70% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(236, 72, 153, 0); }\n        100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(236, 72, 153, 0); }\n      }\n    `;\n    document.head.appendChild(style);\n  }\n\n  /**\n   * ã‚³ãƒ³ãƒ†ãƒŠã‚°ãƒ­ãƒ¼åŠ¹æœ\n   */\n  addContainerGlow(mode) {\n    const container = this.radioModeContainer;\n    if (!container) return;\n\n    // ãƒ¢ãƒ¼ãƒ‰ã«å¿œã˜ã¦ã‚°ãƒ­ãƒ¼è‰²ã‚’è¨­å®š\n    const glowColors = this.isWabiSabiMode ? {\n      generate: 'rgba(139, 195, 74, 0.4)',  // ä¾˜ã³å¯‚ã³ãƒ¢ãƒ¼ãƒ‰ï¼šãƒãƒ£ãƒƒãƒˆæ¬„ã¨åŒã˜ç·‘\n      import: 'rgba(139, 195, 74, 0.4)',    // ä¾˜ã³å¯‚ã³ãƒ¢ãƒ¼ãƒ‰ï¼šãƒãƒ£ãƒƒãƒˆæ¬„ã¨åŒã˜ç·‘\n      modify: 'rgba(139, 195, 74, 0.4)',    // ä¾˜ã³å¯‚ã³ãƒ¢ãƒ¼ãƒ‰ï¼šãƒãƒ£ãƒƒãƒˆæ¬„ã¨åŒã˜ç·‘\n      delete: 'rgba(139, 195, 74, 0.4)'     // ä¾˜ã³å¯‚ã³ãƒ¢ãƒ¼ãƒ‰ï¼šãƒãƒ£ãƒƒãƒˆæ¬„ã¨åŒã˜ç·‘\n    } : {\n      generate: 'rgba(79, 70, 229, 0.4)',   // ãƒ©ã‚¤ãƒˆ/ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ï¼šå…ƒã®ç´«\n      import: 'rgba(34, 197, 94, 0.4)',     // ãƒ©ã‚¤ãƒˆ/ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ï¼šå…ƒã®ç·‘\n      modify: 'rgba(236, 72, 153, 0.4)',    // ãƒ©ã‚¤ãƒˆ/ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ï¼šå…ƒã®ãƒ”ãƒ³ã‚¯\n      delete: 'rgba(107, 114, 128, 0.3)'    // ãƒ©ã‚¤ãƒˆ/ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ï¼šå…ƒã®ã‚°ãƒ¬ãƒ¼\n    };\n\n    // ä¸€æ™‚çš„ã«ã‚°ãƒ­ãƒ¼åŠ¹æœã‚’é©ç”¨\n    const glowColor = glowColors[mode];\n    if (glowColor) {\n      container.style.boxShadow = `0 0 20px ${glowColor}, 0 0 40px ${glowColor}`;\n      container.style.borderColor = glowColor.replace('0.4', '0.6').replace('0.3', '0.5');\n    }\n    \n    // 1ç§’å¾Œã«ã‚°ãƒ­ãƒ¼åŠ¹æœã‚’é™¤å»\n    setTimeout(() => {\n      container.style.boxShadow = '';\n      container.style.borderColor = this.isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(255, 255, 255, 0.15)';\n    }, 1000);\n  }\n\n  getActionButtonStyles(variant = 'secondary') {\n    const baseStyles = `\n      border: none;\n      border-radius: 10px;\n      cursor: pointer;\n      transition: all 0.2s ease;\n      font-family: inherit;\n      outline: none;\n      font-weight: 500;\n      backdrop-filter: blur(8px);\n      -webkit-backdrop-filter: blur(8px);\n    `;\n\n    if (variant === 'secondary') {\n      // Clear All, History ãƒœã‚¿ãƒ³ç”¨ - ç¾ã—ã„é…ç½®ã¨çµ±ä¸€æ„Ÿ\n      return baseStyles + `\n        width: 90px;\n        height: 36px;\n        padding: 8px 12px;\n        font-size: 12px;\n        font-weight: 600;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        gap: 6px;\n        background: ${this.isWabiSabiMode\n          ? 'linear-gradient(135deg, rgba(141, 110, 99, 0.3), rgba(109, 76, 65, 0.2))'\n          : (this.isDarkMode\n            ? 'linear-gradient(135deg, rgba(55, 65, 81, 0.3), rgba(75, 85, 99, 0.2))'\n            : 'linear-gradient(135deg, rgba(255, 255, 255, 0.25), rgba(255, 255, 255, 0.15))')};\n        border: 1px solid ${this.isWabiSabiMode\n          ? 'rgba(93, 64, 55, 0.6)'\n          : (this.isDarkMode ? 'rgba(156, 163, 175, 0.2)' : 'rgba(255, 255, 255, 0.3)')};\n        color: ${this.isWabiSabiMode\n          ? '#F5F5F5'\n          : (this.isDarkMode ? '#d1d5db' : '#374151')};\n        text-align: center;\n        white-space: nowrap;\n      `;\n    } else if (variant === 'icon') {\n      // ãƒ†ãƒ¼ãƒãƒˆã‚°ãƒ«ã€è¨­å®šãƒœã‚¿ãƒ³ç”¨\n      return baseStyles + `\n        width: 32px;\n        height: 32px;\n        padding: 0;\n        font-size: 14px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        background: ${this.isDarkMode \n          ? 'linear-gradient(135deg, rgba(99, 102, 241, 0.15), rgba(139, 92, 246, 0.1))'\n          : 'linear-gradient(135deg, rgba(255, 255, 255, 0.3), rgba(255, 255, 255, 0.2))'};\n        border: 1px solid ${this.isDarkMode ? 'rgba(99, 102, 241, 0.2)' : 'rgba(255, 255, 255, 0.4)'};\n        color: ${this.isDarkMode ? '#a5b4fc' : '#6366f1'};\n      `;\n    }\n  }\n\n  /**\n   * ç ´å£Šçš„ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ç”¨ãƒœã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆèµ¤ç³»ã‚¬ãƒ©ã‚¹åŠ¹æœï¼‰\n   */\n  getDestructiveButtonStyles() {\n    return `\n      min-width: 50px;\n      height: 32px;\n      border: 1px solid ${this.isDarkMode ? 'rgba(220, 38, 127, 0.4)' : 'rgba(190, 24, 93, 0.35)'};\n      border-radius: 6px;\n      background: ${this.isDarkMode ? 'rgba(220, 38, 127, 0.3)' : 'rgba(190, 24, 93, 0.25)'};\n      color: ${this.isDarkMode ? '#fca5a5' : '#dc2626'};\n      cursor: pointer;\n      transition: all 0.2s ease;\n      font-family: inherit;\n      outline: none;\n      font-size: 11px;\n      font-weight: 500;\n      padding: 0 8px;\n      backdrop-filter: blur(10px);\n      -webkit-backdrop-filter: blur(10px);\n    `;\n  }\n\n  getCommandTypeIndicatorStyles() {\n    return `\n      padding: 4px 0;\n      margin-bottom: 0;\n      font-size: 11px;\n      font-weight: 400;\n      text-align: left;\n      color: ${this.isDarkMode ? 'rgba(255, 255, 255, 0.6)' : 'rgba(0, 0, 0, 0.6)'};\n      transition: all 0.3s ease;\n      border: none;\n      background: none;\n    `;\n  }\n\n  /**\n   * ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã®è‡ªå‹•ãƒªã‚µã‚¤ã‚ºå‡¦ç†ï¼ˆæœ€å¤§2è¡Œï¼‰\n   */\n  autoResizeTextarea() {\n    // é«˜ã•ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¦æ­£ç¢ºãª scrollHeight ã‚’å–å¾—\n    this.input.style.height = 'auto';\n    \n    // ç¾åœ¨ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã«åŸºã¥ã„ã¦é«˜ã•ã‚’è¨ˆç®—\n    const lineHeight = 22; // CSS ã§è¨­å®šã—ãŸ line-height\n    const padding = 28; // ä¸Šä¸‹ã®ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°åˆè¨ˆ (14px * 2)\n    const maxLines = 2;\n    const maxHeight = (lineHeight * maxLines) + padding;\n    \n    // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é«˜ã•ã«åŸºã¥ã„ã¦æ–°ã—ã„é«˜ã•ã‚’æ±ºå®š\n    const newHeight = Math.min(this.input.scrollHeight, maxHeight);\n    \n    // é«˜ã•ã‚’é©ç”¨\n    this.input.style.height = newHeight + 'px';\n    \n    // 2è¡Œã‚’è¶…ãˆã‚‹å ´åˆã¯ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’æœ‰åŠ¹åŒ–ã¨å±•é–‹ãƒœã‚¿ãƒ³è¡¨ç¤º\n    if (this.input.scrollHeight > maxHeight) {\n      this.input.style.overflowY = 'auto';\n      // å±•é–‹ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º\n      if (this.expandButton) {\n        this.expandButton.style.display = 'flex';\n      }\n    } else {\n      this.input.style.overflowY = 'hidden';\n      // å±•é–‹ãƒœã‚¿ãƒ³ã‚’éè¡¨ç¤º\n      if (this.expandButton) {\n        this.expandButton.style.display = 'none';\n      }\n    }\n  }\n\n  /**\n   * ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚³ãƒãƒ³ãƒ‰ã‚¿ã‚¤ãƒ—æ¤œå‡º\n   */\n  detectCommandType() {\n    const input = this.input.value.trim();\n    if (!input) {\n      this.selectMode('generate', false);\n      return;\n    }\n\n    const commandType = this.analyzeCommandType(input);\n\n    // Delete/Modifyã¯æ‰‹å‹•é¸æŠã‚’å„ªå…ˆã€è‡ªå‹•åˆ‡ã‚Šæ›¿ãˆã—ãªã„\n    if (this.currentMode === 'delete' || this.currentMode === 'modify') {\n      return; // ç¾åœ¨ã®ãƒ¢ãƒ¼ãƒ‰ã‚’ç¶­æŒ\n    }\n    // Generate/Importã®ã¿è‡ªå‹•åˆ‡ã‚Šæ›¿ãˆ\n    this.selectMode(commandType.type, false, commandType.detectedKeyword);\n  }\n\n  /**\n   * ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã‚³ãƒãƒ³ãƒ‰åˆ†æ\n   */\n  analyzeCommandType(text) {\n    this.logDebug(`ğŸ” Analyzing command: \"${text}\"`);\n\n    // ãƒ¡ãƒ‡ã‚£ã‚¢ã‚¿ã‚¤ãƒ—ã®æ¤œå‡º\n    const mediaInfo = this.detectMediaType(text);\n    \n    // å‰Šé™¤ã‚³ãƒãƒ³ãƒ‰ã®æ¤œå‡º\n    const deletePatterns = [\n      { pattern: /å‰Šé™¤/, keyword: 'å‰Šé™¤' },\n      { pattern: /æ¶ˆå»/, keyword: 'æ¶ˆå»' },\n      { pattern: /æ¶ˆã—ã¦/, keyword: 'æ¶ˆã—ã¦' },\n      { pattern: /æ¶ˆã™/, keyword: 'æ¶ˆã™' },\n      { pattern: /å–ã‚Šé™¤/, keyword: 'å–ã‚Šé™¤' },\n      { pattern: /é™¤å»/, keyword: 'é™¤å»' },\n      { pattern: /å‰Šé™¤ã—ã¦/, keyword: 'å‰Šé™¤ã—ã¦' },\n      { pattern: /delete/i, keyword: 'delete' },\n      { pattern: /remove/i, keyword: 'remove' },\n      { pattern: /clear/i, keyword: 'clear' },\n      { pattern: /erase/i, keyword: 'erase' }\n    ];\n    \n    // å¤‰æ›´ãƒ»ç§»å‹•ã‚³ãƒãƒ³ãƒ‰ã®æ¤œå‡º\n    const modifyPatterns = [\n      { pattern: /ç§»å‹•/, keyword: 'ç§»å‹•' },\n      { pattern: /å‹•ã‹ã—ã¦/, keyword: 'å‹•ã‹ã—ã¦' },\n      { pattern: /å¤‰æ›´/, keyword: 'å¤‰æ›´' },\n      { pattern: /å¤‰ãˆã¦/, keyword: 'å¤‰ãˆã¦' },\n      { pattern: /ä¿®æ­£/, keyword: 'ä¿®æ­£' },\n      { pattern: /èª¿æ•´/, keyword: 'èª¿æ•´' },\n      { pattern: /å›è»¢/, keyword: 'å›è»¢' },\n      { pattern: /åè»¢/, keyword: 'åè»¢' },\n      { pattern: /ãƒŸãƒ©ãƒ¼/, keyword: 'ãƒŸãƒ©ãƒ¼' },\n      { pattern: /å‚¾ã‘/, keyword: 'å‚¾ã‘' },\n      { pattern: /å‘ãã‚’å¤‰ãˆ/, keyword: 'å‘ãã‚’å¤‰ãˆ' },\n      { pattern: /å‘ãã‚’å¤‰æ›´/, keyword: 'å‘ãã‚’å¤‰æ›´' },\n      { pattern: /å·¦å³(é€†|åè»¢)/, keyword: 'å·¦å³åè»¢' },\n      { pattern: /ä¸Šä¸‹(é€†|åè»¢)/, keyword: 'ä¸Šä¸‹åè»¢' },\n      { pattern: /é€†ã•/, keyword: 'é€†ã•' },\n      { pattern: /ã²ã£ãã‚Šè¿”/, keyword: 'ã²ã£ãã‚Šè¿”ã™' },\n      { pattern: /.*ã‚’.*è‰²/, keyword: 'è‰²å¤‰æ›´' },\n      { pattern: /.*ã‚’.*ã‚µã‚¤ã‚º/, keyword: 'ã‚µã‚¤ã‚ºå¤‰æ›´' },\n      { pattern: /ã‚’.*ã«.*ã—ã¦/, keyword: 'å¤‰æ›´' },\n      { pattern: /move/i, keyword: 'move' },\n      { pattern: /change/i, keyword: 'change' },\n      { pattern: /modify/i, keyword: 'modify' },\n      { pattern: /edit/i, keyword: 'edit' }\n    ];\n    \n    // ç”Ÿæˆã‚³ãƒãƒ³ãƒ‰ã®æ¤œå‡ºï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰\n    const generatePatterns = [\n      { pattern: /ä½œã£ã¦/, keyword: 'ä½œã£ã¦' },\n      { pattern: /ç”Ÿæˆ/, keyword: 'ç”Ÿæˆ' },\n      { pattern: /ä½œæˆ/, keyword: 'ä½œæˆ' },\n      { pattern: /æã„ã¦/, keyword: 'æã„ã¦' },\n      { pattern: /æ›¸ã„ã¦/, keyword: 'æ›¸ã„ã¦' },\n      { pattern: /create/i, keyword: 'create' },\n      { pattern: /generate/i, keyword: 'generate' },\n      { pattern: /make/i, keyword: 'make' },\n      { pattern: /draw/i, keyword: 'draw' }\n    ];\n\n    // å‰Šé™¤ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒã‚§ãƒƒã‚¯\n    for (const { pattern, keyword } of deletePatterns) {\n      if (pattern.test(text)) {\n        this.logDebug(`âœ… Delete pattern matched: ${keyword}`);\n        return {\n          type: 'delete',\n          confidence: 0.9,\n          reason: 'å‰Šé™¤ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’æ¤œå‡º',\n          mediaType: mediaInfo.type,\n          requiresConfirmation: true,\n          detectedKeyword: keyword\n        };\n      }\n    }\n    \n    // å¤‰æ›´ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒã‚§ãƒƒã‚¯\n    for (const { pattern, keyword } of modifyPatterns) {\n      if (pattern.test(text)) {\n        this.logDebug(`âœ… Modify pattern matched: ${keyword}`);\n        return {\n          type: 'modify',\n          confidence: 0.8,\n          reason: 'å¤‰æ›´ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’æ¤œå‡º',\n          mediaType: mediaInfo.type,\n          requiresConfirmation: false,\n          detectedKeyword: keyword\n        };\n      }\n    }\n    \n    // ç”Ÿæˆãƒ‘ã‚¿ãƒ¼ãƒ³ãƒã‚§ãƒƒã‚¯\n    for (const { pattern, keyword } of generatePatterns) {\n      if (pattern.test(text)) {\n        return {\n          type: 'generate',\n          confidence: mediaInfo.confidence,\n          reason: mediaInfo.reason,\n          mediaType: mediaInfo.type,\n          requiresConfirmation: false,\n          detectedKeyword: keyword\n        };\n      }\n    }\n    \n    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼ˆç”Ÿæˆãƒ¢ãƒ¼ãƒ‰ï¼‰\n    this.logDebug(`â„¹ï¸ No specific pattern matched, defaulting to generate mode`);\n    return {\n      type: 'generate',\n      confidence: mediaInfo.confidence,\n      reason: mediaInfo.reason,\n      mediaType: mediaInfo.type,\n      requiresConfirmation: false,\n      detectedKeyword: null\n    };\n  }\n\n  /**\n   * ãƒ¡ãƒ‡ã‚£ã‚¢ã‚¿ã‚¤ãƒ—æ¤œå‡ºï¼ˆç”»åƒ/å‹•ç”»ï¼‰\n   */\n  detectMediaType(text) {\n    const videoPatterns = [\n      /å‹•ç”»|ãƒ“ãƒ‡ã‚ª|æ˜ åƒ|ãƒ ãƒ¼ãƒ“ãƒ¼/,\n      /video|movie|clip/i\n    ];\n    \n    const imagePatterns = [\n      /ç”»åƒ|å†™çœŸ|çµµ|ã‚¤ãƒ©ã‚¹ãƒˆ|ã‚¤ãƒ¡ãƒ¼ã‚¸/,\n      /image|picture|photo|illustration/i\n    ];\n    \n    if (videoPatterns.some(pattern => pattern.test(text))) {\n      return {\n        type: 'video',\n        confidence: 0.8,\n        reason: 'å‹•ç”»ç”Ÿæˆã‚³ãƒãƒ³ãƒ‰'\n      };\n    }\n    \n    if (imagePatterns.some(pattern => pattern.test(text))) {\n      return {\n        type: 'image',\n        confidence: 0.8,\n        reason: 'ç”»åƒç”Ÿæˆã‚³ãƒãƒ³ãƒ‰'\n      };\n    }\n    \n    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ç”»åƒ\n    return {\n      type: 'image',\n      confidence: 0.6,\n      reason: 'ç”Ÿæˆã‚³ãƒãƒ³ãƒ‰ï¼ˆç”»åƒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰'\n    };\n  }\n\n  /**\n   * ã‚³ãƒãƒ³ãƒ‰ã‚¿ã‚¤ãƒ—ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼è¡¨ç¤º\n   */\n  showCommandTypeIndicator(commandInfo) {\n    const { type, confidence, reason } = commandInfo;\n    \n    const typeLabels = {\n      generate: 'ğŸ¨ ç”Ÿæˆãƒ¢ãƒ¼ãƒ‰',\n      import: 'ğŸ“¥ ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ¢ãƒ¼ãƒ‰',\n      modify: 'âœï¸ å¤‰æ›´ãƒ¢ãƒ¼ãƒ‰',\n      delete: 'ğŸ—‘ï¸ å‰Šé™¤ãƒ¢ãƒ¼ãƒ‰'\n    };\n    \n    const typeColors = {\n      generate: 'linear-gradient(135deg, #4f46e5, #4338ca)',\n      import: 'linear-gradient(135deg, #22c55e, #16a34a)',\n      modify: 'linear-gradient(135deg, #ec4899, #be185d)',\n      delete: 'rgba(107, 114, 128, 0.15)'\n    };\n    \n    // Proactive UX: ä½ä¿¡é ¼åº¦æ™‚ã«ææ¡ˆè¡¨ç¤º\n    if (confidence < 0.7) {\n      this.showProactiveSuggestion(type, confidence);\n    } else {\n      this.hideProactiveSuggestion();\n    }\n    \n    // æ—§ã‚³ãƒãƒ³ãƒ‰ã‚¿ã‚¤ãƒ—ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã¯å‰Šé™¤ï¼ˆãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³UIã«çµ±åˆæ¸ˆã¿ï¼‰\n    // this.commandTypeIndicator.textContent = `â—¯ ${typeLabels[type].replace('ğŸ¨ ', '').replace('âœï¸ ', '').replace('ğŸ—‘ï¸ ', '')}`;\n    // this.commandTypeIndicator.style.display = 'block';\n    // this.commandTypeIndicator.style.cursor = 'default';\n    \n    // ã‚¹ãƒ¯ã‚¤ãƒ—ã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼å¯¾å¿œ\n    this.enableGestureControl();\n  }\n\n  /**\n   * Proactive UX: ä½ä¿¡é ¼åº¦æ™‚ã®ææ¡ˆè¡¨ç¤º\n   */\n  showProactiveSuggestion(detectedType, confidence) {\n    if (!this.proactiveSuggestion) {\n      this.proactiveSuggestion = document.createElement('div');\n      this.proactiveSuggestion.id = 'proactive-suggestion';\n      this.proactiveSuggestion.style.cssText = `\n        margin-bottom: 0;\n        padding: 10px;\n        background: rgba(255, 193, 7, 0.15);\n        border: 1px solid rgba(255, 193, 7, 0.3);\n        border-radius: 8px;\n        font-size: 12px;\n        color: #ffc107;\n        text-align: center;\n        cursor: pointer;\n        transition: all 0.2s ease;\n      `;\n      // æ—§ã‚³ãƒãƒ³ãƒ‰ã‚¿ã‚¤ãƒ—ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã¯å‰Šé™¤ï¼ˆãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³UIã«çµ±åˆæ¸ˆã¿ï¼‰\n      // ä»£ã‚ã‚Šã«å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å‰ã«æŒ¿å…¥\n      this.container.insertBefore(this.proactiveSuggestion, this.input);\n    }\n\n    const alternativeTypes = ['generate', 'modify', 'delete'].filter(t => t !== detectedType);\n    const suggestion = alternativeTypes[0]; // æœ€åˆã®ä»£æ›¿æ¡ˆ\n\n    const suggestionLabels = {\n      generate: 'ğŸ¨ ç”Ÿæˆ',\n      modify: 'âœï¸ å¤‰æ›´', \n      delete: 'ğŸ—‘ï¸ å‰Šé™¤'\n    };\n\n    this.proactiveSuggestion.innerHTML = `\n      ğŸ’¡ ã‚‚ã—ã‹ã—ã¦ã€Œ${suggestionLabels[suggestion]}ãƒ¢ãƒ¼ãƒ‰ã€ã§ã™ã‹ï¼Ÿ\n      <div style=\"margin-top: 4px; font-size: 10px; opacity: 0.8;\">\n        ã‚¯ãƒªãƒƒã‚¯ã§å¤‰æ›´ | ã‚¹ãƒ¯ã‚¤ãƒ—ã§é¸æŠ\n      </div>\n    `;\n    \n    this.proactiveSuggestion.style.display = 'block';\n    \n    // ã‚¯ãƒªãƒƒã‚¯ã§ææ¡ˆãƒ¢ãƒ¼ãƒ‰ã«å¤‰æ›´\n    this.proactiveSuggestion.onclick = () => {\n      this.currentMode = suggestion;\n      this.hideProactiveSuggestion();\n      this.updateIndicatorForMode(suggestion, 0.9);\n    };\n  }\n\n  /**\n   * Proactive UXææ¡ˆã‚’éè¡¨ç¤º\n   */\n  hideProactiveSuggestion() {\n    if (this.proactiveSuggestion) {\n      this.proactiveSuggestion.style.display = 'none';\n    }\n  }\n\n  /**\n   * æŒ‡å®šãƒ¢ãƒ¼ãƒ‰ã§ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼æ›´æ–°\n   */\n  updateIndicatorForMode(mode, confidence) {\n    const typeLabels = {\n      generate: 'ğŸ¨ ç”Ÿæˆãƒ¢ãƒ¼ãƒ‰',\n      import: 'ğŸ“¥ ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ¢ãƒ¼ãƒ‰',\n      modify: 'âœï¸ å¤‰æ›´ãƒ¢ãƒ¼ãƒ‰',\n      delete: 'ğŸ—‘ï¸ å‰Šé™¤ãƒ¢ãƒ¼ãƒ‰'\n    };\n    \n    const typeColors = {\n      generate: 'linear-gradient(135deg, #4f46e5, #4338ca)',\n      import: 'linear-gradient(135deg, #22c55e, #16a34a)',\n      modify: 'linear-gradient(135deg, #ec4899, #be185d)',\n      delete: 'rgba(107, 114, 128, 0.15)'\n    };\n\n    // æ—§ã‚³ãƒãƒ³ãƒ‰ã‚¿ã‚¤ãƒ—ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã¯å‰Šé™¤ï¼ˆãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³UIã«çµ±åˆæ¸ˆã¿ï¼‰\n    // this.commandTypeIndicator.textContent = `â—¯ ${typeLabels[mode].replace('ğŸ¨ ', '').replace('âœï¸ ', '').replace('ğŸ—‘ï¸ ', '')}`;\n  }\n\n  /**\n   * ã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«æœ‰åŠ¹åŒ–\n   */\n  enableGestureControl() {\n    // æ—§ã‚¹ãƒ¯ã‚¤ãƒ—ã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼æ©Ÿèƒ½ã¯å‰Šé™¤ï¼ˆãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³UIã«çµ±åˆæ¸ˆã¿ï¼‰\n    // ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ã§ç›´æ¥ãƒ¢ãƒ¼ãƒ‰é¸æŠå¯èƒ½ã«ãªã£ãŸãŸã‚ã€ã‚¹ãƒ¯ã‚¤ãƒ—æ“ä½œã¯ä¸è¦\n    this.gestureEnabled = true;\n  }\n\n  /**\n   * ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ä½œæˆ\n   */\n  createActionButtons() {\n    const container = document.createElement('div');\n    container.style.cssText = `\n      display: flex;\n      margin-top: 8px;\n      gap: 8px;\n    `;\n\n    // å±¥æ­´ãƒœã‚¿ãƒ³å‰Šé™¤ - ã‚¿ã‚¹ã‚¯é€²è¡ŒçŠ¶æ³ã«ç½®ãæ›ãˆæ¸ˆã¿\n\n    // ã‚¯ãƒªã‚¢ã‚ªãƒ¼ãƒ«ãƒœã‚¿ãƒ³\n    const clearBtn = document.createElement('button');\n    clearBtn.innerHTML = 'ğŸ§¹ å…¨å‰Šé™¤';\n    clearBtn.style.cssText = this.getModernButtonStyles('danger');\n    clearBtn.addEventListener('click', () => this.clearAll());\n\n    // historyBtnå‰Šé™¤æ¸ˆã¿\n    container.appendChild(clearBtn);\n\n    return container;\n  }\n\n  /**\n   * ã‚¹ã‚¿ã‚¤ãƒ«å®šç¾©\n   */\n  getContainerStyles() {\n    const positions = {\n      'bottom-right': 'bottom: 20px; right: 20px;',\n      'bottom-left': 'bottom: 20px; left: 20px;',\n      'top-right': 'top: 20px; right: 20px;',\n      'top-left': 'top: 20px; left: 20px;',\n      'center': 'top: 50%; left: 50%; transform: translate(-50%, -50%);'\n    };\n\n    // 2025 Glassmorphismä»•æ§˜ï¼šãƒ€ãƒ¼ã‚¯ãƒ»ãƒ©ã‚¤ãƒˆä¸¡å¯¾å¿œ\n    const glassmorphismDark = {\n      background: 'linear-gradient(135deg, rgba(15, 23, 42, 0.7), rgba(30, 27, 75, 0.65))',\n      backdropFilter: 'blur(24px) saturate(180%)',\n      border: '1px solid rgba(99, 102, 241, 0.2)',\n      boxShadow: '0 8px 32px rgba(15, 23, 42, 0.4), 0 0 0 1px rgba(99, 102, 241, 0.1), inset 0 1px 0 rgba(255, 255, 255, 0.1)'\n    };\n\n    const glassmorphismLight = {\n      background: 'linear-gradient(135deg, rgba(255, 255, 255, 0.25), rgba(255, 255, 255, 0.15))',\n      backdropFilter: 'blur(24px) saturate(180%)',\n      border: '1px solid rgba(255, 255, 255, 0.4)',\n      boxShadow: '0 8px 32px rgba(0, 0, 0, 0.1), 0 0 0 1px rgba(255, 255, 255, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.3)'\n    };\n\n    // ä¾˜ã³å¯‚ã³ãƒ¢ãƒ¼ãƒ‰ - æ¯å±±æ°´ã®é™å¯‚ï¼šç‹¬è‡ªã®ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£\n    const glassmorphismWabiSabi = {\n      background: 'linear-gradient(135deg, rgba(97, 97, 97, 0.7), rgba(66, 66, 66, 0.6))',\n      backdropFilter: 'blur(20px) saturate(120%)',\n      border: '1px solid rgba(93, 64, 55, 0.5)',\n      boxShadow: '0 8px 32px rgba(33, 33, 33, 0.4), 0 0 0 1px rgba(93, 64, 55, 0.4), inset 0 1px 0 rgba(189, 189, 189, 0.15)'\n    };\n\n    const theme = this.isWabiSabiMode ? glassmorphismWabiSabi : (this.isDarkMode ? glassmorphismDark : glassmorphismLight);\n\n    return `\n      position: fixed;\n      ${positions[this.config.position] || positions['bottom-right']}\n      width: 320px;\n      max-height: ${this.config.maxHeight}px;\n      background: ${theme.background};\n      border: ${theme.border};\n      border-radius: 20px;\n      color: ${this.isWabiSabiMode ? '#F5F5F5' : (this.isDarkMode ? '#ffffff' : '#1f2937')};\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Inter', sans-serif;\n      font-size: 14px;\n      z-index: 1000;\n      padding: 16px !important;\n      box-shadow: ${theme.boxShadow};\n      backdrop-filter: ${theme.backdropFilter};\n      -webkit-backdrop-filter: ${theme.backdropFilter};\n      display: none;\n      flex-direction: column;\n      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n    `;\n  }\n\n  getHeaderStyles() {\n    // ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ã¨åŒã˜ç´«ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã§çµ±ä¸€\n    const gradientColors = 'linear-gradient(135deg, #4f46e5, #7c3aed)';\n\n    return `\n      margin-bottom: 20px;\n      text-align: center;\n      background: ${gradientColors};\n      -webkit-background-clip: text;\n      -webkit-text-fill-color: transparent;\n      background-clip: text;\n      font-weight: 800;\n      font-size: 18px;\n      border-bottom: 1px solid rgba(79, 70, 229, 0.2);\n      padding-bottom: 12px;\n    `;\n  }\n\n  getOutputStyles() {\n    // ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã®CSSã‚’æ³¨å…¥\n    this.addScrollbarStyles();\n\n    return `\n      height: 200px;\n      overflow-y: auto;\n      background: ${this.isDarkMode ? 'rgba(255, 255, 255, 0.05)' : 'rgba(255, 255, 255, 0.1)'};\n      border: 1px solid ${this.isDarkMode ? 'rgba(255, 255, 255, 0.15)' : 'rgba(255, 255, 255, 0.2)'};\n      border-radius: 12px;\n      padding: 12px;\n      margin-bottom: 16px;\n      font-size: 12px;\n      line-height: 1.4;\n      backdrop-filter: blur(8px);\n\n      /* ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒ« */\n      scrollbar-width: thin;\n      scrollbar-color: ${this.isDarkMode ? 'rgba(255, 255, 255, 0.3) rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.3) rgba(0, 0, 0, 0.1)'};\n    `;\n  }\n\n  /**\n   * ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã®ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ãƒšãƒ¼ã‚¸ã«æ³¨å…¥\n   */\n  addScrollbarStyles() {\n    if (document.getElementById('custom-scrollbar-styles')) return;\n\n    const style = document.createElement('style');\n    style.id = 'custom-scrollbar-styles';\n    style.textContent = `\n      .command-output::-webkit-scrollbar {\n        width: 8px;\n      }\n\n      .command-output::-webkit-scrollbar-track {\n        background: ${this.isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)'};\n        border-radius: 4px;\n      }\n\n      .command-output::-webkit-scrollbar-thumb {\n        background: ${this.isDarkMode ? 'rgba(255, 255, 255, 0.3)' : 'rgba(0, 0, 0, 0.3)'};\n        border-radius: 4px;\n        transition: background 0.2s ease;\n      }\n\n      .command-output::-webkit-scrollbar-thumb:hover {\n        background: ${this.isDarkMode ? 'rgba(255, 255, 255, 0.5)' : 'rgba(0, 0, 0, 0.5)'};\n      }\n\n      /* ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ç”¨ */\n      .dark-mode .command-output::-webkit-scrollbar-track {\n        background: rgba(255, 255, 255, 0.1);\n      }\n\n      .dark-mode .command-output::-webkit-scrollbar-thumb {\n        background: rgba(255, 255, 255, 0.3);\n      }\n\n      .dark-mode .command-output::-webkit-scrollbar-thumb:hover {\n        background: rgba(255, 255, 255, 0.5);\n      }\n\n      /* ãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰ç”¨ */\n      .light-mode .command-output::-webkit-scrollbar-track {\n        background: rgba(0, 0, 0, 0.1);\n      }\n\n      .light-mode .command-output::-webkit-scrollbar-thumb {\n        background: rgba(0, 0, 0, 0.3);\n      }\n\n      .light-mode .command-output::-webkit-scrollbar-thumb:hover {\n        background: rgba(0, 0, 0, 0.5);\n      }\n\n      @keyframes shimmer {\n        0% { background-position: -200% 0; }\n        100% { background-position: 200% 0; }\n      }\n\n      /* ã‚¿ã‚¹ã‚¯ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ³ãƒ†ãƒŠã®ãƒ›ãƒãƒ¼åŠ¹æœ */\n      .task-status-container:hover .progress-bar {\n        box-shadow: 0 0 20px rgba(255,123,71,0.6) !important;\n        transform: scaleY(1.1);\n      }\n\n      /* ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã®å¾®ç´°ãªã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */\n      .progress-bar {\n        position: relative;\n      }\n\n      .progress-bar::after {\n        content: '';\n        position: absolute;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        background: linear-gradient(90deg, \n          transparent, \n          rgba(255,255,255,0.4), \n          transparent);\n        animation: progress-shine 2s ease-in-out infinite;\n      }\n\n      @keyframes progress-shine {\n        0% { transform: translateX(-100%); }\n        100% { transform: translateX(100%); }\n      }\n\n      /* wabi-sabiãƒ¢ãƒ¼ãƒ‰ç”¨ã®å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚¹ã‚¿ã‚¤ãƒ« */\n      .wabisabi-mode textarea:focus,\n      .wabisabi-mode input:focus {\n        background: linear-gradient(135deg, rgba(97, 97, 97, 0.4), rgba(66, 66, 66, 0.3)) !important;\n        border: 1px solid rgba(141, 110, 99, 0.6) !important;\n        box-shadow: 0 4px 16px rgba(66, 66, 66, 0.3), inset 0 1px 0 rgba(189, 189, 189, 0.2), 0 0 0 2px rgba(141, 110, 99, 0.2) !important;\n        color: #F5F5F5 !important;\n        outline: none !important;\n      }\n    `;\n\n    document.head.appendChild(style);\n  }\n\n  getInputStyles() {\n    // 2025 Glassmorphismä»•æ§˜ï¼šå…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰\n    const glassmorphismDark = {\n      background: 'linear-gradient(135deg, rgba(30, 27, 75, 0.4), rgba(15, 23, 42, 0.5))',\n      border: '1px solid rgba(99, 102, 241, 0.25)',\n      boxShadow: '0 4px 16px rgba(15, 23, 42, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.08)'\n    };\n\n    const glassmorphismLight = {\n      background: 'linear-gradient(135deg, rgba(255, 255, 255, 0.3), rgba(255, 255, 255, 0.2))',\n      border: '1px solid rgba(255, 255, 255, 0.5)',\n      boxShadow: '0 4px 16px rgba(0, 0, 0, 0.08), inset 0 1px 0 rgba(255, 255, 255, 0.4)'\n    };\n\n    const glassmorphismWabiSabi = {\n      background: 'linear-gradient(135deg, rgba(97, 97, 97, 0.4), rgba(66, 66, 66, 0.3))',\n      border: '1px solid rgba(97, 97, 97, 0.5)',\n      boxShadow: '0 4px 16px rgba(66, 66, 66, 0.3), inset 0 1px 0 rgba(189, 189, 189, 0.2)'\n    };\n\n    const theme = this.isWabiSabiMode ? glassmorphismWabiSabi : (this.isDarkMode ? glassmorphismDark : glassmorphismLight);\n\n    return `\n      width: 100%;\n      padding: 14px 16px;\n      background: ${theme.background};\n      border: ${theme.border};\n      border-radius: 14px;\n      color: ${this.isWabiSabiMode ? '#F5F5F5' : (this.isDarkMode ? '#ffffff' : '#1f2937')};\n      font-size: 14px;\n      outline: none;\n      box-sizing: border-box;\n      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n      font-family: inherit;\n      backdrop-filter: blur(16px);\n      -webkit-backdrop-filter: blur(16px);\n      box-shadow: ${theme.boxShadow};\n      placeholder-color: ${this.isDarkMode ? 'rgba(255, 255, 255, 0.5)' : 'rgba(55, 65, 81, 0.6)'};\n      resize: none;\n      overflow-y: hidden;\n      min-height: 22px;\n      max-height: 66px;\n      line-height: 22px;\n    `;\n  }\n\n  getModernButtonStyles(type) {\n    const styles = {\n      primary: this.isWabiSabiMode ? `\n        background: linear-gradient(135deg, #8D6E63, #6D4C41);\n        box-shadow: 0 4px 12px rgba(85, 139, 47, 0.4), inset 0 1px 0 rgba(184, 158, 135, 0.15);\n        width: 100%;\n        padding: 16px;\n        font-size: 14px;\n        font-weight: 600;\n      ` : `\n        background: linear-gradient(135deg, #4f46e5, #4338ca);\n        width: 100%;\n        padding: 16px;\n        font-size: 14px;\n        font-weight: 600;\n      `,\n      secondary: this.isWabiSabiMode ? `\n        background: rgba(158, 158, 158, 0.2);\n        border: 1px solid rgba(141, 110, 99, 0.4);\n        flex: 1;\n        padding: 12px;\n        font-size: 13px;\n        font-weight: 500;\n        backdrop-filter: blur(8px);\n        color: #F5F5F5;\n      ` : `\n        background: rgba(255, 255, 255, 0.08);\n        border: 1px solid rgba(255, 255, 255, 0.2);\n        flex: 1;\n        padding: 12px;\n        font-size: 13px;\n        font-weight: 500;\n        backdrop-filter: blur(8px);\n      `,\n      danger: this.isWabiSabiMode ? `\n        background: rgba(141, 110, 99, 0.3);\n        border: 1px solid rgba(93, 64, 55, 0.5);\n        flex: 1;\n        padding: 12px;\n        font-size: 13px;\n        font-weight: 500;\n        backdrop-filter: blur(8px);\n        color: #F5F5F5;\n      ` : `\n        background: rgba(255, 59, 48, 0.15);\n        border: 1px solid rgba(255, 59, 48, 0.3);\n        flex: 1;\n        padding: 12px;\n        font-size: 13px;\n        font-weight: 500;\n        backdrop-filter: blur(8px);\n        color: #ff453a;\n      `\n    };\n\n    return `\n      border: none;\n      border-radius: 12px;\n      color: white;\n      cursor: pointer;\n      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);\n      font-family: inherit;\n      outline: none;\n      ${styles[type]}\n    `;\n  }\n\n  getModeButtonStyles(isActive, mode) {\n    // ãƒ¢ãƒ¼ãƒ‰ã‚«ãƒ©ãƒ¼è¨­å®š\n    const modeColors = {\n      generate: 'linear-gradient(135deg, #22c55e, #16a34a)', // Green - ãƒãƒ£ãƒƒãƒˆæ¬„ã¨åŒã˜ç·‘è‰²\n      import: 'linear-gradient(135deg, #22c55e, #16a34a)',   // Green - ãƒãƒ£ãƒƒãƒˆæ¬„ã¨åŒã˜ç·‘è‰²\n      modify: 'linear-gradient(135deg, #22c55e, #16a34a)',    // Green - ãƒãƒ£ãƒƒãƒˆæ¬„ã¨åŒã˜ç·‘è‰²\n      delete: 'linear-gradient(135deg, #22c55e, #16a34a)'     // Green - ãƒãƒ£ãƒƒãƒˆæ¬„ã¨åŒã˜ç·‘è‰²\n    };\n    \n    return `\n      flex: 1;\n      padding: 12px 16px;\n      border: none;\n      border-radius: 8px;\n      color: ${isActive ? 'white' : (this.isWabiSabiMode ? '#F5F5F5' : 'rgba(255, 255, 255, 0.7)')};\n      background: ${isActive ? modeColors[mode] : 'transparent'};\n      font-size: 13px;\n      font-weight: 600;\n      cursor: pointer;\n      transition: all 0.2s ease;\n      font-family: inherit;\n      outline: none;\n    `;\n  }\n\n  /**\n   * ã‚¤ãƒ™ãƒ³ãƒˆãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°\n   */\n  bindEvents() {\n    // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ\n    document.addEventListener('keydown', (e) => {\n      // è¨­å®šã•ã‚ŒãŸã‚­ãƒ¼ã§UIè¡¨ç¤ºåˆ‡æ›¿\n      if (e.key === this.config.activationKey) {\n        e.preventDefault();\n        this.toggle();\n        return;\n      }\n      \n      // Enterã‚­ãƒ¼å‡¦ç†ã¯initUI()å†…ã§è¡Œã†ãŸã‚ã€ã“ã“ã§ã¯å‡¦ç†ã—ãªã„\n      // ï¼ˆIMEå¯¾å¿œã®ãŸã‚ï¼‰\n      \n      // Escapeã§éè¡¨ç¤º\n      if (this.isVisible && e.key === 'Escape') {\n        this.hide();\n      }\n      \n      // Ctrl+Z/Ctrl+Y ã§Undo/Redo\n      if (this.isVisible && e.ctrlKey) {\n        if (e.key === 'z' && !e.shiftKey) {\n          e.preventDefault();\n          this.undo();\n        } else if (e.key === 'y' || (e.key === 'z' && e.shiftKey)) {\n          e.preventDefault();\n          this.redo();\n        }\n      }\n    });\n\n    // å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ã‚¹ã‚¿ã‚¤ãƒ«èª¿æ•´\n    this.input.addEventListener('focus', () => {\n      this.input.style.borderColor = '#74b9ff';\n      this.input.style.boxShadow = '0 0 5px rgba(116, 185, 255, 0.5)';\n    });\n\n    this.input.addEventListener('blur', () => {\n      this.input.style.borderColor = '#4a90e2';\n      this.input.style.boxShadow = 'none';\n    });\n  }\n\n  /**\n   * UIè¡¨ç¤º/éè¡¨ç¤ºåˆ‡æ›¿\n   */\n  toggle() {\n    if (this.isVisible) {\n      this.hide();\n    } else {\n      this.show();\n    }\n  }\n\n  /**\n   * UIè¡¨ç¤º\n   */\n  show() {\n    this.container.style.display = 'flex';\n    this.container.style.flexDirection = 'column';\n    this.floatingContainer.style.display = 'flex';\n\n    // UIãƒ•ã‚©ãƒ¼ãƒ ã®ä½ç½®ã«åˆã‚ã›ã¦é…ç½®ï¼ˆå°‘ã—é…å»¶ã—ã¦æ­£ç¢ºãªä½ç½®ã‚’å–å¾—ï¼‰\n    setTimeout(() => {\n      const containerRect = this.container.getBoundingClientRect();\n      this.floatingContainer.style.left = containerRect.left + 'px';\n      this.floatingContainer.style.top = (containerRect.top - 80) + 'px';\n      this.floatingContainer.style.width = containerRect.width + 'px';\n      this.floatingContainer.style.transform = 'none';\n    }, 50);\n\n    this.isVisible = true;\n    this.input.focus();\n\n    // ãƒ•ã‚©ãƒ¼ãƒ è¡¨ç¤ºä¸­ã¯ãƒãƒ§ã‚³ã‚¢ã‚¤ã‚³ãƒ³ã‚’éš ã™\n    if (this.floatingChocolateIcon) {\n      this.floatingChocolateIcon.style.opacity = '0';\n      this.floatingChocolateIcon.style.pointerEvents = 'none';\n    }\n\n    // ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚’ç„¡åŠ¹åŒ–\n    this.onControlsToggle(true);\n    // ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«åœæ­¢æ™‚ã‚‚é™ã‹ã«\n  }\n\n  /**\n   * UIéè¡¨ç¤º\n   */\n  hide() {\n    this.container.style.display = 'none';\n    this.floatingContainer.style.display = 'none';\n    this.isVisible = false;\n\n    // ãƒ•ã‚©ãƒ¼ãƒ éè¡¨ç¤ºæ™‚ã¯ãƒãƒ§ã‚³ã‚¢ã‚¤ã‚³ãƒ³ã‚’å†è¡¨ç¤º\n    if (this.floatingChocolateIcon) {\n      this.floatingChocolateIcon.style.opacity = '0.8';\n      this.floatingChocolateIcon.style.pointerEvents = 'auto';\n    }\n\n    // ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚’å†æœ‰åŠ¹åŒ–\n    this.onControlsToggle(false);\n    this.logDebug('ğŸ® ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚’å†é–‹');\n  }\n\n  /**\n   * ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ\n   */\n  switchMode(mode) {\n    if (this.currentMode === mode) return;\n    \n    this.currentMode = mode;\n    \n    // ãƒ¢ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ«æ›´æ–°\n    this.container.querySelectorAll('[data-mode]').forEach(btn => {\n      const isActive = btn.dataset.mode === mode;\n      btn.style.cssText = this.getModeButtonStyles(isActive, btn.dataset.mode);\n    });\n    \n    // å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼æ›´æ–°\n    this.input.placeholder = this.getPlaceholderForMode(mode);\n    \n    // å®Ÿè¡Œãƒœã‚¿ãƒ³ã®ãƒ©ãƒ™ãƒ«ã¨è‰²æ›´æ–°\n    const executeBtn = this.container.querySelector('#execute-btn');\n    const labels = {\n      generate: 'ğŸ¨ Generate Object',\n      modify: 'âœï¸ Apply Changes', \n      delete: 'ğŸ—‘ï¸ Delete Objects'\n    };\n    \n    const buttonColors = {\n      generate: 'linear-gradient(135deg, #5b21b6, #4c1d95)',\n      modify: 'linear-gradient(135deg, #ec4899, #be185d)', \n      delete: 'rgba(107, 114, 128, 0.15)'\n    };\n    \n    executeBtn.innerHTML = `<span>${labels[mode]}</span>`;\n    executeBtn.style.background = buttonColors[mode];\n    \n    // ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆé€šçŸ¥ã¯ä¸è¦ï¼ˆãƒœã‚¿ãƒ³ã§åˆ†ã‹ã‚‹ãŸã‚ï¼‰\n  }\n  \n  /**\n   * ãƒ¢ãƒ¼ãƒ‰åˆ¥ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼\n   */\n  getPlaceholderForMode(mode) {\n    const placeholders = {\n      generate: 'ã€ŒçŒ«ã®ç”»åƒã‚’ä½œã£ã¦ã€ã¨è©±ã—ã‹ã‘ã¦ â âœ¨',\n      import: 'ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ â ğŸ“',\n      modify: 'é¸æŠå¾Œã€Œãƒ”ãƒ³ã‚¯ã«å¤‰æ›´ã€ã¨ä¼ãˆã¦ â âœï¸',\n      delete: 'é¸æŠå¾Œã€ã‚³ãƒãƒ³ãƒ‰ã‚’ãã®ã¾ã¾é€ã£ã¦ â ğŸ—‘ï¸'\n    };\n    return placeholders[mode] || placeholders.generate;\n  }\n\n  /**\n   * ãƒ‡ãƒ¢ç‰ˆå°‚ç”¨: å‘ããƒ»åè»¢ã‚³ãƒãƒ³ãƒ‰ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã§å‡¦ç†\n   */\n  handleDemoOrientationCommand(command) {\n    if (!this.sceneManager) {\n      return null;\n    }\n\n    const normalized = command.toLowerCase();\n    const wantsVerticalFlip = /ä¸Šä¸‹|é€†ã•|ã•ã‹ã•|ã²ã£ãã‚Šè¿”/.test(normalized);\n    const wantsHorizontalFlip = /å·¦å³|å‘ãã‚’å¤‰ãˆ|å‘ãã‚’å¤‰æ›´|æ¨ªå‘ã|ãƒŸãƒ©ãƒ¼|åè»¢/.test(normalized);\n    const wantsRotateRight = /å³å‘ã|å³ã‚’å‘|å³ã«å‘ã‘/.test(normalized);\n    const wantsRotateLeft = /å·¦å‘ã|å·¦ã‚’å‘|å·¦ã«å‘ã‘/.test(normalized);\n    const wantsRotateBack = /å¾Œã‚å‘ã|åå¯¾å‘ã|èƒŒä¸­|180åº¦|åŠå›è»¢/.test(normalized);\n\n    const hasOrientationKeyword = wantsVerticalFlip || wantsHorizontalFlip || wantsRotateRight || wantsRotateLeft || wantsRotateBack;\n    if (!hasOrientationKeyword) {\n      return null;\n    }\n\n    let targetObject = this.sceneManager.selectedObject;\n    if (!targetObject && typeof this.sceneManager.findObjectByKeyword === 'function') {\n      targetObject = this.sceneManager.findObjectByKeyword(normalized);\n      if (targetObject) {\n        this.sceneManager.selectObject(targetObject);\n      }\n    }\n\n    if (!targetObject) {\n      this.addOutput('âš ï¸ å¤‰æ›´ã—ãŸã„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å…ˆã«é¸æŠã—ã¦ãã ã•ã„ã€‚', 'warning');\n      return { handled: true, result: { success: false, message: 'å¯¾è±¡ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ' } };\n    }\n\n    const operations = [];\n\n    if (wantsHorizontalFlip) {\n      const currentX = targetObject.scale.x === 0 ? 1 : targetObject.scale.x;\n      targetObject.scale.x = -currentX;\n      operations.push('å·¦å³åè»¢');\n    }\n\n    if (wantsVerticalFlip) {\n      const currentY = targetObject.scale.y === 0 ? 1 : targetObject.scale.y;\n      targetObject.scale.y = -currentY;\n      operations.push('ä¸Šä¸‹åè»¢');\n    }\n\n    if (wantsRotateRight) {\n      targetObject.rotation.y = Math.PI / 2;\n      operations.push('å³å‘ã');\n    }\n\n    if (wantsRotateLeft) {\n      targetObject.rotation.y = -Math.PI / 2;\n      operations.push('å·¦å‘ã');\n    }\n\n    if (wantsRotateBack) {\n      targetObject.rotation.y = Math.PI;\n      operations.push('èƒŒé¢å‘ã');\n    }\n\n    if (operations.length === 0) {\n      // ã“ã“ã¾ã§æ¥ã¦æ“ä½œãŒç„¡ã‘ã‚Œã° SceneManager ã«å§”è­²\n      return { handled: false };\n    }\n\n    // å¤‰æ›´å±¥æ­´ã‚’è¿½åŠ \n    targetObject.userData = targetObject.userData || {};\n    targetObject.userData.modifications = targetObject.userData.modifications || [];\n    targetObject.userData.modifications.push({\n      timestamp: Date.now(),\n      type: 'orientation',\n      operations,\n      command\n    });\n\n    // é¸æŠè¡¨ç¤ºã‚’æ›´æ–°\n    if (typeof this.sceneManager.createModernSelectionIndicator === 'function') {\n      this.sceneManager.createModernSelectionIndicator(targetObject);\n    }\n\n    const message = `âœï¸ ${operations.join('ãƒ»')} ã‚’é©ç”¨ã—ã¾ã—ãŸ`;\n    this.addOutput(message, 'success');\n\n    return {\n      handled: true,\n      result: {\n        success: true,\n        message,\n        objectId: targetObject.name,\n        operations\n      }\n    };\n  }\n\n  /**\n   * ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ\n   */\n  async executeCommand() {\n    const command = this.input.value.trim();\n    if (!command) return;\n\n    // æœ€çµ‚çš„ãªã‚³ãƒãƒ³ãƒ‰ã‚¿ã‚¤ãƒ—åˆ¤å®š\n    const commandType = this.analyzeCommandType(command);\n\n    if (this.selectedFile) {\n      if (this.currentMode !== 'import') {\n        this.selectMode('import', false);\n      }\n      this.currentMode = 'import';\n    } else {\n      this.currentMode = commandType.type;\n    }\n\n    // å‰Šé™¤ã®å ´åˆã¯ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°\n    if (commandType.requiresConfirmation) {\n      const confirmed = await this.showDeleteConfirmation(command);\n      if (!confirmed) {\n        this.addOutput('âŒ å‰Šé™¤ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã—ãŸ', 'system');\n        return;\n      }\n    }\n\n    // å…¥åŠ›ã‚’ã‚¯ãƒªã‚¢\n    this.input.value = '';\n    // æ—§ã‚³ãƒãƒ³ãƒ‰ã‚¿ã‚¤ãƒ—ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã¯å‰Šé™¤ï¼ˆãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³UIã«çµ±åˆæ¸ˆã¿ï¼‰\n    // this.commandTypeIndicator.style.display = 'none';\n    this.hideProactiveSuggestion();\n\n    // ã‚³ãƒãƒ³ãƒ‰è¡¨ç¤ºï¼ˆãƒ¡ãƒ‡ã‚£ã‚¢ã‚¿ã‚¤ãƒ—ä»˜ãï¼‰\n    const mediaIcon = commandType.mediaType === 'video' ? 'ğŸ¬' : 'ğŸ–¼ï¸';\n    // ã‚¿ã‚¹ã‚¯ã‚«ãƒ¼ãƒ‰ä½œæˆ\n    const taskId = this.addTaskCard(command, { status: 'processing' });\n\n    // ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œå‰ã®çŠ¶æ…‹ã‚’å±¥æ­´ã«ä¿å­˜\n    this.saveCommandToHistory({\n      command: command,\n      mode: this.currentMode,\n      mediaType: commandType.mediaType,\n      timestamp: Date.now()\n    });\n\n    try {\n      // å‡¦ç†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º\n      // ã‚¿ã‚¹ã‚¯ã‚«ãƒ¼ãƒ‰ã¯æ—¢ã«1183è¡Œç›®ã§ä½œæˆæ¸ˆã¿ï¼ˆtaskIdå¤‰æ•°ï¼‰\n      // é‡è¤‡ã‚’é¿ã‘ã‚‹ãŸã‚ã€ã“ã“ã§ã¯ä½œæˆã—ãªã„\n\n      let result;\n      \n      // ãƒ¢ãƒ¼ãƒ‰ã«å¿œã˜ãŸã‚³ãƒãƒ³ãƒ‰å‡¦ç†\n      const modePrefix = this.getModePrefix(this.currentMode);\n      const fullCommand = `${modePrefix}${command}`;\n\n      // ãƒ¢ãƒ¼ãƒ‰åˆ¥ã®å®Ÿè¡Œå‡¦ç†\n      this.logDebug('ğŸ” Current mode check:', this.currentMode);\n      if (this.currentMode === 'import') {\n        this.logDebug('ğŸ“ Import mode detected - bypassing SceneManager');\n        // Importãƒ¢ãƒ¼ãƒ‰: ç›´æ¥å‡¦ç†ï¼ˆSceneManagerã‚’è¿‚å›ï¼‰\n        if (!this.selectedFile) {\n          throw new Error('ãƒ•ã‚¡ã‚¤ãƒ«ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ã¾ãšãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');\n        }\n        result = await this.handleImportCommand(command);\n      } else if (this.sceneManager) {\n        if (this.currentMode === 'modify') {\n          const orientationResult = this.handleDemoOrientationCommand(command);\n          if (orientationResult && orientationResult.handled) {\n            result = orientationResult.result;\n          } else {\n            result = await this.sceneManager.executeCommand(fullCommand);\n          }\n        } else {\n          result = await this.sceneManager.executeCommand(fullCommand);\n        }\n      } else if (this.client) {\n        // ãƒ¢ãƒ¼ãƒ‰ã«å¿œã˜ã¦APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’é¸æŠ\n        if (this.currentMode === 'generate') {\n          // ç”Ÿæˆãƒ¢ãƒ¼ãƒ‰: æ–°ã—ã„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ\n          if (commandType.mediaType === 'video') {\n            result = await this.client.generateVideo(command, {\n              model: this.selectedVideoService || undefined\n            });\n          } else {\n            result = await this.client.generateImage(command, {\n              service: this.selectedImageService || undefined\n            });\n          }\n        } else if (this.currentMode === 'modify') {\n          // å¤‰æ›´ãƒ¢ãƒ¼ãƒ‰: æ—¢å­˜ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å¤‰æ›´ï¼ˆé¸æŠãŒå¿…è¦ï¼‰\n          if (!this.selectedObject) {\n            throw new Error('å¤‰æ›´ã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ã¾ãšå¯¾è±¡ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');\n          }\n          result = await this.client.modifySelectedObject(this.selectedObject, command);\n        } else if (this.currentMode === 'delete') {\n          // å‰Šé™¤ãƒ¢ãƒ¼ãƒ‰: ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆé¸æŠãƒã‚§ãƒƒã‚¯\n          if (!this.selectedObject && !this.sceneManager?.getSelectedObjects()?.length) {\n            this.addOutput('âš ï¸ å‰Šé™¤ã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ã¾ãš3Dã‚·ãƒ¼ãƒ³å†…ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚¯ãƒªãƒƒã‚¯ã§é¸æŠã—ã¦ã‹ã‚‰ã€å†åº¦Deleteãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚', 'system');\n            return;\n          }\n          // å‰Šé™¤ãƒ¢ãƒ¼ãƒ‰: ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤ºã—ã¦ã‹ã‚‰å‰Šé™¤\n          const confirmMessage = `æœ¬å½“ã«ã€Œ${command}ã€ã‚’å®Ÿè¡Œã—ã¾ã™ã‹ï¼Ÿ\n\nã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚`;\n          if (!confirm(confirmMessage)) {\n            this.addOutput('âŒ å‰Šé™¤ãŒã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã¾ã—ãŸ', 'system');\n            return;\n          }\n          result = await this.client.deleteObjects(command);\n        } else {\n          // ãã®ä»–ã®ãƒ¢ãƒ¼ãƒ‰\n          result = await this.client.executeCommand(fullCommand);\n        }\n      } else {\n        throw new Error('SceneManager ã¾ãŸã¯ Client ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“');\n      }\n\n      // taskIdå–å¾—ã¨SSEæ¥ç¶šé–‹å§‹\n      if (result && result.taskId) {\n        this.connectToProgress(result.taskId, taskId);\n        this.currentTaskId = result.taskId;\n      }\n\n      // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸\n      const successMessages = {\n        generate: ``, // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‰Šé™¤ - çµæœã§ååˆ†\n        modify: 'âœ… å¤‰æ›´ã‚’é©ç”¨ã—ã¾ã—ãŸ',\n        delete: 'ğŸ—‘ï¸ å‰Šé™¤ã—ã¾ã—ãŸ'\n      };\n      \n      // ã‚¿ã‚¹ã‚¯ã‚«ãƒ¼ãƒ‰å®Œäº†\n      if (taskId) {\n        this.updateTaskCard(taskId, 'completed');\n      }\n      \n      // è©³ç´°æƒ…å ±è¡¨ç¤º\n      if (result.modelName) {\n        // ãƒ‡ãƒãƒƒã‚°æƒ…å ±å‰Šé™¤ - ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤ºç”¨ã«ä¿å­˜\n      }\n      \n      if (result.objectId) {\n        // ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆIDå‰Šé™¤\n      }\n      \n      if (result.position) {\n        // ä½ç½®æƒ…å ±å‰Šé™¤\n      }\n\n      if (commandType.mediaType) {\n        // ãƒ¡ãƒ‡ã‚£ã‚¢ã‚¿ã‚¤ãƒ—å‰Šé™¤\n      }\n\n    } catch (error) {\n      const errorMessages = {\n        generate: `âŒ ${commandType.mediaType === 'video' ? 'å‹•ç”»' : 'ç”»åƒ'}ç”Ÿæˆã‚¨ãƒ©ãƒ¼`,\n        modify: 'âŒ å¤‰æ›´ã‚¨ãƒ©ãƒ¼', \n        delete: 'âŒ å‰Šé™¤ã‚¨ãƒ©ãƒ¼'\n      };\n      // ã‚¿ã‚¹ã‚¯ã‚«ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼\n      if (taskId) {\n        this.updateTaskCard(taskId, 'error');\n      }\n\n      this.addOutput(`${errorMessages[this.currentMode]}: ${error.message}`, 'error');\n      console.error('Command execution error:', error);\n    }\n\n    // 2025å¹´UXãƒˆãƒ¬ãƒ³ãƒ‰: ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œå¾Œã®è‡ªå‹•é¸æŠè§£é™¤\n    if (this.sceneManager && this.sceneManager.selectedObject) {\n      // Modify/Deleteã‚³ãƒãƒ³ãƒ‰å¾Œã¯é¸æŠã‚’è‡ªå‹•è§£é™¤ã—ã¦ã‚¹ãƒˆãƒ¬ã‚¹è»½æ¸›\n      if (this.currentMode === 'modify' || this.currentMode === 'delete') {\n        setTimeout(() => {\n          this.sceneManager.deselectObject();\n        }, 500); // å°‘ã—é…å»¶ã•ã›ã¦æ“ä½œå®Œäº†ã‚’è¦–è¦šçš„ã«ç¢ºèª\n      }\n    }\n\n    // å‡ºåŠ›ã‚¨ãƒªã‚¢ã‚’æœ€ä¸‹éƒ¨ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«\n    if (this.config.autoScroll) {\n      this.scrollToBottom();\n    }\n  }\n\n  /**\n   * å‰Šé™¤ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°\n   */\n  async showConfirmationDialog(options) {\n    const {\n      icon = 'ğŸ—‘ï¸',\n      title = 'ç¢ºèª',\n      message = 'ã“ã®æ“ä½œã‚’å®Ÿè¡Œã—ã¾ã™ã‹ï¼Ÿ',\n      confirmText = 'å®Ÿè¡Œ',\n      cancelText = 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«',\n      confirmColor = '#ef4444'\n    } = options;\n\n    return new Promise((resolve) => {\n      const modal = document.createElement('div');\n      modal.style.cssText = `\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background: rgba(15, 23, 42, 0.6);\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        z-index: 2000;\n        backdrop-filter: blur(24px) saturate(180%);\n        -webkit-backdrop-filter: blur(24px) saturate(180%);\n      `;\n\n      const dialog = document.createElement('div');\n      dialog.style.cssText = `\n        background: ${this.isDarkMode \n          ? 'linear-gradient(135deg, rgba(15, 23, 42, 0.85), rgba(30, 27, 75, 0.8))'\n          : 'linear-gradient(135deg, rgba(255, 255, 255, 0.4), rgba(255, 255, 255, 0.3))'};\n        border: 1px solid ${this.isDarkMode ? 'rgba(99, 102, 241, 0.3)' : 'rgba(255, 255, 255, 0.5)'};\n        border-radius: 20px;\n        padding: 32px;\n        max-width: 420px;\n        text-align: center;\n        color: ${this.isWabiSabiMode ? '#F5F5F5' : (this.isDarkMode ? '#ffffff' : '#1f2937')};\n        font-family: inherit;\n        backdrop-filter: blur(24px) saturate(180%);\n        -webkit-backdrop-filter: blur(24px) saturate(180%);\n        box-shadow: ${this.isDarkMode \n          ? '0 8px 32px rgba(15, 23, 42, 0.4), 0 0 0 1px rgba(99, 102, 241, 0.1)'\n          : '0 8px 32px rgba(0, 0, 0, 0.1), 0 0 0 1px rgba(255, 255, 255, 0.2)'};\n        transform: scale(0.9);\n        opacity: 0;\n        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);\n      `;\n\n      dialog.innerHTML = `\n        <div style=\"font-size: 56px; margin-bottom: 20px;\">${icon}</div>\n        <h3 style=\"margin: 0 0 16px 0; color: ${this.isDarkMode ? '#a5b4fc' : '#6366f1'}; font-size: 20px; font-weight: 700; letter-spacing: 0.02em;\">\n          ${title}\n        </h3>\n        <p style=\"margin: 0 0 28px 0; color: ${this.isDarkMode ? '#d1d5db' : '#6b7280'}; line-height: 1.6; font-size: 16px;\">\n          ${message}\n        </p>\n        <div style=\"display: flex; gap: 8px; justify-content: center;\">\n          <button id=\"cancel-btn\" style=\"\n            padding: 14px 24px;\n            background: ${this.isDarkMode \n              ? 'linear-gradient(135deg, rgba(55, 65, 81, 0.3), rgba(75, 85, 99, 0.2))'\n              : 'linear-gradient(135deg, rgba(255, 255, 255, 0.25), rgba(255, 255, 255, 0.15))'};\n            border: 1px solid ${this.isDarkMode ? 'rgba(156, 163, 175, 0.2)' : 'rgba(255, 255, 255, 0.3)'};\n            border-radius: 12px;\n            color: ${this.isDarkMode ? '#d1d5db' : '#374151'};\n            cursor: pointer;\n            font-family: inherit;\n            font-size: 14px;\n            font-weight: 600;\n            transition: all 0.2s ease;\n            backdrop-filter: blur(16px);\n            -webkit-backdrop-filter: blur(16px);\n          \">${cancelText}</button>\n          <button id=\"confirm-btn\" style=\"\n            padding: 14px 24px;\n            background: ${confirmColor === '#6366f1' \n              ? 'linear-gradient(135deg, #6366f1, #8b5cf6)' \n              : confirmColor === '#ef4444'\n              ? 'linear-gradient(135deg, #ef4444, #dc2626)'\n              : 'linear-gradient(135deg, #ff7b47, #f97316)'};\n            border: none;\n            border-radius: 12px;\n            color: white;\n            cursor: pointer;\n            font-family: inherit;\n            font-size: 14px;\n            font-weight: 700;\n            transition: all 0.2s ease;\n            box-shadow: 0 4px 16px ${confirmColor === '#6366f1' \n              ? 'rgba(99, 102, 241, 0.3)' \n              : confirmColor === '#ef4444' \n              ? 'rgba(239, 68, 68, 0.3)' \n              : 'rgba(255, 123, 71, 0.3)'};\n            backdrop-filter: blur(8px);\n            -webkit-backdrop-filter: blur(8px);\n          \">${confirmText}</button>\n        </div>\n      `;\n\n      modal.appendChild(dialog);\n      document.body.appendChild(modal);\n\n      // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹\n      requestAnimationFrame(() => {\n        modal.style.opacity = '1';\n        dialog.style.transform = 'scale(1)';\n        dialog.style.opacity = '1';\n      });\n\n      // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼\n      dialog.querySelector('#cancel-btn').onclick = () => {\n        this.closeModalWithAnimation(modal);\n        resolve(false);\n      };\n\n      dialog.querySelector('#confirm-btn').onclick = () => {\n        this.closeModalWithAnimation(modal);\n        resolve(true);\n      };\n\n      // ESCã‚­ãƒ¼ã§ã‚­ãƒ£ãƒ³ã‚»ãƒ«\n      const escHandler = (e) => {\n        if (e.key === 'Escape') {\n          this.closeModalWithAnimation(modal);\n          document.removeEventListener('keydown', escHandler);\n          resolve(false);\n        }\n      };\n      document.addEventListener('keydown', escHandler);\n\n      // ãƒ¢ãƒ¼ãƒ€ãƒ«èƒŒæ™¯ã‚¯ãƒªãƒƒã‚¯ã§ã‚­ãƒ£ãƒ³ã‚»ãƒ«\n      modal.onclick = (e) => {\n        if (e.target === modal) {\n          this.closeModalWithAnimation(modal);\n          resolve(false);\n        }\n      };\n    });\n  }\n\n  async showDeleteConfirmation(command) {\n    return this.showConfirmationDialog({\n      icon: 'ğŸ—‘ï¸',\n      title: 'å‰Šé™¤ã®ç¢ºèª',\n      message: `ã€Œ${command}ã€ã‚’å®Ÿè¡Œã—ã¾ã™ã‹ï¼Ÿ<br>ã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã™ã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚`,\n      confirmText: 'å‰Šé™¤å®Ÿè¡Œ',\n      cancelText: 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«',\n      confirmColor: '#ff7b47'\n    });\n  }\n\n  /**\n   * å‡ºåŠ›ã‚¨ãƒªã‚¢ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¿½åŠ \n   */\n  /**\n   * ã‚¿ã‚¹ã‚¯ã‚«ãƒ¼ãƒ‰è¿½åŠ ï¼ˆå¾“æ¥ã®addOutputã‚’ç½®ãæ›ãˆï¼‰\n   */\n  addOutput(message, type = 'default', options = {}) {\n    // ã‚¿ã‚¹ã‚¯ã‚«ãƒ¼ãƒ‰å½¢å¼ã§å‡¦ç†\n    if (type === 'task' || type === 'progress') {\n      return this.addTaskCard(message, options);\n    }\n\n    // ã‚¨ãƒ©ãƒ¼ã¨ã‚·ã‚¹ãƒ†ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã¿è¡¨ç¤º\n    if (type === 'error' || type === 'system') {\n      this.addSystemMessage(message, type);\n    }\n  }\n\n  /**\n   * ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¿ã‚¹ã‚¯ã‚«ãƒ¼ãƒ‰è¿½åŠ \n   */\n  addTaskCard(taskInfo, options = {}) {\n    if (!this.taskCards) this.taskCards = new Map();\n\n    const taskId = options.taskId || `task_${Date.now()}_${Math.random().toString(36).substr(2, 5)}`;\n    const status = options.status || 'pending';\n    const prompt = taskInfo.prompt || taskInfo.command || taskInfo;\n\n    // ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚«ãƒ¼ãƒ‰ä½œæˆ\n    const card = document.createElement('div');\n    card.className = 'floating-task-card';\n    card.setAttribute('data-task-id', taskId);\n\n    // iOS 26 Liquid Glass + 2026å¹´ãƒˆãƒ¬ãƒ³ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ«\n    card.style.cssText = this.getFloatingCardStyles(status);\n    // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”¨åˆæœŸçŠ¶æ…‹ï¼ˆéè¡¨ç¤ºï¼‰- å¼·åˆ¶è¨­å®š\n    card.style.setProperty('opacity', '0', 'important');\n    card.style.setProperty('transform', 'translateY(20px) scale(0.95)', 'important');\n    card.style.setProperty('filter', 'blur(4px)', 'important');\n\n    const iconMap = {\n      pending: 'â³',\n      processing: 'ğŸ¨',\n      progress: 'âš¡',\n      completed: 'âœ…',\n      error: 'âŒ'\n    };\n\n    const statusText = {\n      pending: 'å¾…æ©Ÿä¸­',\n      processing: 'ç”Ÿæˆä¸­',\n      progress: 'é€²è¡Œä¸­',\n      completed: 'å®Œäº†',\n      error: 'ã‚¨ãƒ©ãƒ¼'\n    };\n\n    // æ¸©ã‹ã¿ã®ã‚ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º\n    const friendlyMessage = this.getFriendlyMessage(status, prompt);\n    card.innerHTML = `\n      <span style=\"font-size: 14px;\">${iconMap[status]}</span>\n      <span style=\"font-size: 13px; margin-left: 6px;\">${friendlyMessage}</span>\n    `;\n\n    // ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚³ãƒ³ãƒ†ãƒŠã«è¿½åŠ ï¼ˆæœ€æ–°ãŒä¸‹ã«æ¥ã‚‹ã‚ˆã†ã«ï¼‰\n    this.floatingContainer.appendChild(card);\n    \n    // ã‚«ãƒ¼ãƒ‰è¡¨ç¤ºåˆ¶é™ã‚’é©ç”¨ï¼ˆæœ€å¤§3å€‹ã¾ã§è¡¨ç¤ºï¼‰\n    this.updateCardDisplayLimit();\n\n    this.taskCards.set(taskId, {\n      element: card,\n      status: status,\n      prompt: prompt,\n      originalPrompt: prompt, // å…ƒã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ\n      startTime: Date.now(),\n      endTime: null,\n      error: null,\n      contentType: 'image', // 'image', 'video', etc.\n      model: null,\n      settings: null\n    });\n\n    // ã‚«ãƒ¼ãƒ‰è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ«ç”¨ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼\n    this.addCardDetailEvents(card, taskId);\n    \n    // å…¥å ´ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³\n    this.animateCardEntrance(card);\n    return taskId;\n  }\n\n  /**\n   * ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¿ã‚¹ã‚¯ã‚«ãƒ¼ãƒ‰æ›´æ–°\n   */\n  updateTaskCard(taskId, status, options = {}) {\n    if (!this.taskCards || !this.taskCards.has(taskId)) return;\n\n    const taskData = this.taskCards.get(taskId);\n    const card = taskData.element;\n\n    // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°\n    taskData.status = status;\n\n    const iconMap = {\n      pending: 'â³',\n      processing: 'ğŸ¨',\n      progress: 'âš¡',\n      completed: 'âœ…',\n      error: 'âŒ'\n    };\n\n    // æ¸©ã‹ã¿ã®ã‚ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ›´æ–°\n    const friendlyMessage = this.getFriendlyMessage(status, taskData.prompt);\n    card.innerHTML = `\n      <span style=\"font-size: 14px;\">${iconMap[status]}</span>\n      <span style=\"font-size: 13px; margin-left: 6px;\">${friendlyMessage}</span>\n    `;\n\n    // å®Œäº†æ™‚ã®è‡ªå‹•æ¶ˆå»ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³\n    if (status === 'completed') {\n      this.animateCardSuccess(card, taskId);\n    } else if (status === 'error') {\n      this.animateCardError(card, taskId);\n    }\n  }\n\n  /**\n   * ã‚·ã‚¹ãƒ†ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º\n   */\n  addSystemMessage(message, type) {\n    const entry = document.createElement('div');\n    entry.className = `system-message ${type}`;\n    entry.style.cssText = `\n      padding: 8px 12px;\n      margin: 4px 0;\n      border-radius: 8px;\n      font-size: 12px;\n      line-height: 1.4;\n      animation: slideIn 0.3s ease-out;\n      background: ${type === 'error' ? 'rgba(239, 68, 68, 0.1)' : 'rgba(107, 114, 128, 0.1)'};\n      border: 1px solid ${type === 'error' ? 'rgba(239, 68, 68, 0.3)' : 'rgba(107, 114, 128, 0.3)'};\n      color: ${type === 'error' ? '#fca5a5' : (this.isDarkMode ? '#d1d5db' : '#6b7280')};\n    `;\n    entry.textContent = message;\n    this.outputDiv.appendChild(entry);\n    this.scrollToBottom();\n  }\n\n  /**\n   * ã‚¿ã‚¹ã‚¯ã‚«ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ«å–å¾—\n   */\n  getTaskCardStyles(status) {\n    const baseStyles = `\n      background: ${this.isDarkMode ? 'rgba(255, 255, 255, 0.08)' : 'rgba(255, 255, 255, 0.15)'};\n      border: 1px solid ${this.isDarkMode ? 'rgba(255, 255, 255, 0.15)' : 'rgba(255, 255, 255, 0.25)'};\n      border-radius: 12px;\n      padding: 16px;\n      margin-bottom: 12px;\n      backdrop-filter: blur(12px);\n      transition: all 0.3s ease;\n      animation: slideInUp 0.3s ease-out;\n    `;\n\n    const statusBorders = {\n      pending: 'rgba(167, 139, 250, 0.3)',     // è–„ç´«\n      processing: 'rgba(192, 132, 252, 0.5)',  // ç´«ï¼ˆå¼·èª¿ï¼‰\n      progress: 'rgba(236, 72, 153, 0.4)',     // ãƒ”ãƒ³ã‚¯\n      completed: 'rgba(167, 139, 250, 0.4)',   // ç´«\n      error: 'rgba(239, 68, 68, 0.4)'          // èµ¤\n    };\n\n    return baseStyles + `border-left: 3px solid ${statusBorders[status] || statusBorders.pending};`;\n  }\n\n  /**\n   * ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚«ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆiOS 26 Liquid Glass + 2026å¹´ãƒˆãƒ¬ãƒ³ãƒ‰ï¼‰\n   */\n  getFloatingCardStyles(status) {\n    // 2025å¹´Glassmorphismä»•æ§˜ï¼šãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¿ã‚¹ã‚¯ã‚«ãƒ¼ãƒ‰\n    const glassmorphismDark = {\n      background: 'linear-gradient(135deg, rgba(15, 23, 42, 0.75), rgba(30, 27, 75, 0.7))',\n      border: '1px solid rgba(99, 102, 241, 0.25)',\n      boxShadow: '0 8px 32px rgba(15, 23, 42, 0.3), 0 0 0 1px rgba(99, 102, 241, 0.1)',\n      color: '#ffffff'\n    };\n\n    const glassmorphismLight = {\n      background: 'linear-gradient(135deg, rgba(255, 255, 255, 0.35), rgba(255, 255, 255, 0.25))',\n      border: '1px solid rgba(255, 255, 255, 0.4)',\n      boxShadow: '0 8px 32px rgba(0, 0, 0, 0.08), 0 0 0 1px rgba(255, 255, 255, 0.2)',\n      color: '#1f2937'\n    };\n\n    const theme = this.isDarkMode ? glassmorphismDark : glassmorphismLight;\n\n    return `\n      height: 36px;\n      padding: 0 18px;\n      display: inline-flex;\n      align-items: center;\n      gap: 8px;\n      background: ${theme.background};\n      backdrop-filter: blur(24px) saturate(180%);\n      -webkit-backdrop-filter: blur(24px) saturate(180%);\n      border: ${theme.border};\n      border-radius: 18px;\n      color: ${theme.color};\n      pointer-events: auto;\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Inter', sans-serif;\n      font-weight: 600;\n      font-size: 13px;\n      letter-spacing: 0.01em;\n      box-shadow: ${theme.boxShadow};\n      transform: translateY(10px);\n      opacity: 0;\n      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n    `;\n  }\n\n  /**\n   * ã‚«ãƒ¼ãƒ‰è¡¨ç¤ºåˆ¶é™ã‚’é©ç”¨ï¼ˆæœ€å¤§3å€‹ã¾ã§è¡¨ç¤ºã€ãã‚Œä»¥ä¸Šã¯ã€Œ+ Nã€ã§è¡¨ç¤ºï¼‰\n   */\n  updateCardDisplayLimit() {\n    const maxVisibleCards = 3;\n    const allCards = Array.from(this.floatingContainer.children).filter(child => \n      !child.classList.contains('overflow-counter')\n    );\n    \n    // æ—¢å­˜ã®ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚’å‰Šé™¤\n    const existingCounter = this.floatingContainer.querySelector('.overflow-counter');\n    if (existingCounter) {\n      existingCounter.remove();\n    }\n    \n    if (allCards.length <= maxVisibleCards) {\n      // ã‚«ãƒ¼ãƒ‰ãŒ3å€‹ä»¥ä¸‹ã®å ´åˆã€ã™ã¹ã¦è¡¨ç¤º\n      allCards.forEach(card => {\n        card.style.display = 'flex';\n      });\n    } else {\n      // ã‚«ãƒ¼ãƒ‰ãŒ4å€‹ä»¥ä¸Šã®å ´åˆã€æœ€æ–°3å€‹ã®ã¿è¡¨ç¤ºã—ã€æ®‹ã‚Šã¯ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼è¡¨ç¤º\n      const visibleCards = allCards.slice(-maxVisibleCards); // æœ€æ–°3å€‹\n      const hiddenCount = allCards.length - maxVisibleCards;\n      \n      // å¤ã„ã‚«ãƒ¼ãƒ‰ã‚’éè¡¨ç¤º\n      allCards.forEach((card, index) => {\n        if (index < allCards.length - maxVisibleCards) {\n          card.style.display = 'none';\n        } else {\n          card.style.display = 'flex';\n        }\n      });\n      \n      // ã€Œ+ Nã€ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚’ä½œæˆ\n      const counter = document.createElement('div');\n      counter.className = 'overflow-counter';\n      // ãƒ†ãƒ¼ãƒã«å¿œã˜ãŸã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ«\n      const counterBaseColor = this.isDarkMode ? 'rgba(255, 255, 255, 0.08)' : 'rgba(0, 0, 0, 0.12)';\n      const counterBorderColor = this.isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.15)';\n      const counterTextColor = this.isDarkMode ? 'rgba(255, 255, 255, 0.7)' : 'rgba(0, 0, 0, 0.6)';\n      \n      counter.style.cssText = `\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        padding: 8px 12px;\n        margin: 4px 0;\n        background: ${counterBaseColor};\n        backdrop-filter: blur(20px);\n        border-radius: 12px;\n        border: 1px solid ${counterBorderColor};\n        font-size: 12px;\n        color: ${counterTextColor};\n        font-weight: 500;\n        min-height: 32px;\n        transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);\n        cursor: pointer;\n      `;\n      counter.innerHTML = `+ ${hiddenCount}`;\n      \n      // ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚’æœ€åˆã«æŒ¿å…¥ï¼ˆæœ€ä¸Šéƒ¨ã«é…ç½®ï¼‰\n      this.floatingContainer.insertBefore(counter, this.floatingContainer.firstChild);\n      \n      // ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã®ãƒ›ãƒãƒ¼åŠ¹æœï¼ˆãƒ†ãƒ¼ãƒå¯¾å¿œï¼‰\n      const counterHoverColor = this.isDarkMode ? 'rgba(255, 255, 255, 0.12)' : 'rgba(0, 0, 0, 0.18)';\n      \n      counter.addEventListener('mouseenter', () => {\n        counter.style.background = counterHoverColor;\n        counter.style.transform = 'scale(1.05)';\n      });\n      \n      counter.addEventListener('mouseleave', () => {\n        counter.style.background = counterBaseColor;\n        counter.style.transform = 'scale(1)';\n      });\n    }\n  }\n\n  /**\n   * ã‚«ãƒ¼ãƒ‰ã«è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ«ç”¨ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ \n   */\n  addCardDetailEvents(card, taskId) {\n    // ã‚¿ãƒƒãƒãƒ‡ãƒã‚¤ã‚¹æ¤œå‡º\n    const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;\n    \n    if (isTouchDevice) {\n      // ãƒ¢ãƒã‚¤ãƒ«/ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆ: ã‚¿ãƒƒãƒ—ã§è©³ç´°è¡¨ç¤º\n      card.addEventListener('click', (e) => {\n        e.preventDefault();\n        e.stopPropagation();\n        this.showTaskDetailModal(taskId);\n      });\n    } else {\n      // ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—: ãƒ›ãƒãƒ¼ã§è©³ç´°è¡¨ç¤º\n      let hoverTimeout;\n      \n      card.addEventListener('mouseenter', () => {\n        hoverTimeout = setTimeout(() => {\n          this.showTaskDetailModal(taskId);\n        }, 800); // 0.8ç§’ãƒ›ãƒãƒ¼ã§è¡¨ç¤º\n      });\n      \n      card.addEventListener('mouseleave', () => {\n        if (hoverTimeout) {\n          clearTimeout(hoverTimeout);\n        }\n      });\n      \n      // ã‚¯ãƒªãƒƒã‚¯ã§ã‚‚è¡¨ç¤ºï¼ˆãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã§ã‚‚ä½¿ã„ã‚„ã™ãï¼‰\n      card.addEventListener('click', (e) => {\n        e.preventDefault();\n        e.stopPropagation();\n        this.showTaskDetailModal(taskId);\n      });\n    }\n  }\n\n  /**\n   * ã‚¿ã‚¹ã‚¯è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º\n   */\n  showTaskDetailModal(taskId) {\n    const taskData = this.taskCards.get(taskId);\n    if (!taskData) return;\n    \n    // æ—¢å­˜ã®ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’å‰Šé™¤\n    const existingModal = document.querySelector('.task-detail-modal');\n    if (existingModal) {\n      existingModal.remove();\n    }\n    \n    // ãƒ¢ãƒ¼ãƒ€ãƒ«ä½œæˆ\n    const modal = this.createTaskDetailModal(taskData);\n    document.body.appendChild(modal);\n    \n    // å…¥å ´ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³\n    requestAnimationFrame(() => {\n      modal.style.opacity = '1';\n      modal.querySelector('.modal-content').style.transform = 'translateY(0) scale(1)';\n    });\n  }\n\n  /**\n   * ã‚¿ã‚¹ã‚¯è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ«ã®HTMLè¦ç´ ã‚’ä½œæˆ\n   */\n  createTaskDetailModal(taskData) {\n    const modal = document.createElement('div');\n    modal.className = 'task-detail-modal';\n    \n    // ãƒ†ãƒ¼ãƒã«å¿œã˜ãŸã‚¹ã‚¿ã‚¤ãƒ«\n    const overlayColor = this.isDarkMode ? 'rgba(0, 0, 0, 0.6)' : 'rgba(0, 0, 0, 0.4)';\n    const modalBg = this.isDarkMode ? 'rgba(20, 20, 20, 0.95)' : 'rgba(255, 255, 255, 0.95)';\n    const modalBorder = this.isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';\n    const textColor = this.isDarkMode ? 'rgba(255, 255, 255, 0.9)' : 'rgba(0, 0, 0, 0.9)';\n    const labelColor = this.isDarkMode ? 'rgba(255, 255, 255, 0.6)' : 'rgba(0, 0, 0, 0.6)';\n    \n    modal.style.cssText = `\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      background: ${overlayColor};\n      backdrop-filter: blur(10px);\n      z-index: 100000;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      opacity: 0;\n      transition: opacity 0.3s cubic-bezier(0.16, 1, 0.3, 1);\n      cursor: pointer;\n    `;\n    \n    // å®Ÿè¡Œæ™‚é–“è¨ˆç®—\n    const duration = taskData.endTime \n      ? ((taskData.endTime - taskData.startTime) / 1000).toFixed(1)\n      : ((Date.now() - taskData.startTime) / 1000).toFixed(1);\n    \n    // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º\n    const statusText = taskData.status === 'pending' ? 'å¾…æ©Ÿä¸­' \n                    : taskData.status === 'in-progress' ? 'å®Ÿè¡Œä¸­' \n                    : taskData.status === 'completed' ? 'å®Œäº†' \n                    : 'ã‚¨ãƒ©ãƒ¼';\n    \n    const modalContent = document.createElement('div');\n    modalContent.className = 'modal-content';\n    modalContent.style.cssText = `\n      background: ${modalBg};\n      backdrop-filter: blur(30px);\n      border: 1px solid ${modalBorder};\n      border-radius: 16px;\n      padding: 16px !important;\n      max-width: 400px;\n      width: 90%;\n      max-height: 80vh;\n      overflow-y: auto;\n      transform: translateY(20px) scale(0.95);\n      transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);\n      cursor: default;\n      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n    `;\n    \n    modalContent.innerHTML = `\n      <div style=\"display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px;\">\n        <h3 style=\"margin: 0; color: ${textColor}; font-size: 18px; font-weight: 600;\">ã‚¿ã‚¹ã‚¯è©³ç´°</h3>\n        <button class=\"close-btn\" style=\"\n          background: none;\n          border: none;\n          font-size: 24px;\n          color: ${labelColor};\n          cursor: pointer;\n          padding: 0;\n          line-height: 1;\n          transition: color 0.2s;\n        \">Ã—</button>\n      </div>\n      \n      <div style=\"space-y: 16px;\">\n        <div>\n          <div style=\"color: ${labelColor}; font-size: 12px; font-weight: 500; margin-bottom: 0;\">ğŸ“ å…ƒã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ</div>\n          <div style=\"color: ${textColor}; font-size: 14px; line-height: 1.4;\">${taskData.originalPrompt}</div>\n        </div>\n        \n        <div>\n          <div style=\"color: ${labelColor}; font-size: 12px; font-weight: 500; margin-bottom: 0;\">ğŸ“Š ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</div>\n          <div style=\"color: ${textColor}; font-size: 14px;\">${statusText}</div>\n        </div>\n        \n        <div>\n          <div style=\"color: ${labelColor}; font-size: 12px; font-weight: 500; margin-bottom: 0;\">â±ï¸ å®Ÿè¡Œæ™‚é–“</div>\n          <div style=\"color: ${textColor}; font-size: 14px;\">${duration}ç§’</div>\n        </div>\n        \n        ${taskData.error ? `\n        <div>\n          <div style=\"color: ${labelColor}; font-size: 12px; font-weight: 500; margin-bottom: 0;\">âŒ ã‚¨ãƒ©ãƒ¼è©³ç´°</div>\n          <div style=\"color: #ef4444; font-size: 14px; line-height: 1.4;\">${taskData.error}</div>\n        </div>\n        ` : ''}\n        \n        <div>\n          <div style=\"color: ${labelColor}; font-size: 12px; font-weight: 500; margin-bottom: 0;\">ğŸ¨ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¿ã‚¤ãƒ—</div>\n          <div style=\"color: ${textColor}; font-size: 14px;\">${taskData.contentType || 'ç”»åƒ'}</div>\n        </div>\n      </div>\n    `;\n    \n    // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼\n    modalContent.addEventListener('click', (e) => {\n      e.stopPropagation();\n    });\n    \n    const closeBtn = modalContent.querySelector('.close-btn');\n    closeBtn.addEventListener('click', () => {\n      this.closeTaskDetailModal(modal);\n    });\n    \n    closeBtn.addEventListener('mouseenter', () => {\n      closeBtn.style.color = textColor;\n    });\n    \n    closeBtn.addEventListener('mouseleave', () => {\n      closeBtn.style.color = labelColor;\n    });\n    \n    modal.addEventListener('click', () => {\n      this.closeTaskDetailModal(modal);\n    });\n    \n    modal.appendChild(modalContent);\n    return modal;\n  }\n\n  /**\n   * ã‚¿ã‚¹ã‚¯è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹\n   */\n  closeTaskDetailModal(modal) {\n    modal.style.opacity = '0';\n    modal.querySelector('.modal-content').style.transform = 'translateY(20px) scale(0.95)';\n    \n    setTimeout(() => {\n      if (modal.parentNode) {\n        modal.parentNode.removeChild(modal);\n      }\n    }, 300);\n  }\n\n  /**\n   * ã‚«ãƒ¼ãƒ‰å…¥å ´ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆ2026å¹´ãƒˆãƒ¬ãƒ³ãƒ‰ + iOS 26 Liquid Glassï¼‰\n   */\n  animateCardEntrance(card) {\n    // iOS 26 Liquid Glass å…¥å ´ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ\n    card.style.transform = 'translateY(20px) scale(0.95)';\n    card.style.opacity = '0';\n    card.style.filter = 'blur(4px)';\n\n    requestAnimationFrame(() => {\n      card.style.transition = 'all 0.6s cubic-bezier(0.16, 1, 0.3, 1)';\n      card.style.transform = 'translateY(0) scale(1)';\n      card.style.opacity = '1';\n      card.style.filter = 'blur(0px)';\n\n      // 2026å¹´ãƒˆãƒ¬ãƒ³ãƒ‰: å¾®ç´°ãªå…‰ã‚‹åŠ¹æœ\n      card.style.boxShadow = '0 4px 20px rgba(255, 255, 255, 0.1), 0 0 40px rgba(255, 255, 255, 0.05)';\n    });\n  }\n\n  /**\n   * æˆåŠŸæ™‚ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ + è‡ªå‹•æ¶ˆå»ï¼ˆiOS 26 Liquid Glassï¼‰\n   */\n  animateCardSuccess(card, taskId) {\n    // iOS 26 Liquid Glass æˆåŠŸã‚¨ãƒ•ã‚§ã‚¯ãƒˆ\n    card.style.transition = 'all 0.3s cubic-bezier(0.16, 1, 0.3, 1)';\n    card.style.borderColor = 'rgba(76, 175, 80, 0.6)';\n    card.style.transform = 'scale(1.08)';\n    card.style.boxShadow = '0 8px 32px rgba(76, 175, 80, 0.4), 0 0 60px rgba(76, 175, 80, 0.2)';\n    card.style.filter = 'brightness(1.1) saturate(1.2)';\n\n    // 2026å¹´ãƒˆãƒ¬ãƒ³ãƒ‰: æµä½“çš„ãªæˆ»ã‚Šã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³\n    setTimeout(() => {\n      card.style.transform = 'scale(1.02)';\n      card.style.filter = 'brightness(1.05) saturate(1.1)';\n    }, 150);\n\n    // Liquid Glassé¢¨ã®ã‚¹ãƒ ãƒ¼ã‚ºãªãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆï¼ˆ2ç§’å¾Œã«è‡ªå‹•å‰Šé™¤ï¼‰\n    setTimeout(() => {\n      this.animateCardExit(card, taskId);\n    }, 2000);\n  }\n\n  /**\n   * ã‚¨ãƒ©ãƒ¼æ™‚ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆ2026å¹´ãƒˆãƒ¬ãƒ³ãƒ‰ UXï¼‰\n   */\n  animateCardError(card, taskId) {\n    // iOS 26 Liquid Glass ã‚¨ãƒ©ãƒ¼ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ\n    card.style.transition = 'all 0.3s cubic-bezier(0.16, 1, 0.3, 1)';\n    card.style.borderColor = 'rgba(244, 67, 54, 0.7)';\n    card.style.boxShadow = '0 8px 32px rgba(244, 67, 54, 0.3), 0 0 60px rgba(244, 67, 54, 0.15)';\n    card.style.filter = 'saturate(1.3) brightness(1.1)';\n\n    // 2026å¹´ãƒˆãƒ¬ãƒ³ãƒ‰: ã‚ˆã‚Šè‡ªç„¶ãªpulseã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆshakeã‚ˆã‚Šæ´—ç·´ï¼‰\n    card.style.animation = 'errorPulse 0.6s cubic-bezier(0.16, 1, 0.3, 1) 2';\n\n    // UXæ”¹å–„: ã‚¨ãƒ©ãƒ¼å†…å®¹ã‚’è¡¨ç¤ºã™ã‚‹ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—é¢¨UI\n    this.addErrorTooltip(card, taskId);\n\n    // ã‚¨ãƒ©ãƒ¼ã¯æ‰‹å‹•ã§æ¶ˆã™ã¾ã§è¡¨ç¤ºç¶™ç¶šï¼ˆã‚¯ãƒªãƒƒã‚¯ã§æ¶ˆå»ï¼‰\n    card.style.cursor = 'pointer';\n    card.onclick = () => this.animateCardExit(card, taskId);\n\n    // 5ç§’å¾Œã«è‡ªå‹•ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆï¼ˆUXæ”¹å–„ï¼‰\n    setTimeout(() => {\n      if (this.taskCards.has(taskId)) {\n        this.animateCardExit(card, taskId);\n      }\n    }, 5000);\n  }\n\n  /**\n   * ã‚¨ãƒ©ãƒ¼æ™‚ã®ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—è¡¨ç¤ºï¼ˆUXæ”¹å–„ï¼‰\n   */\n  addErrorTooltip(card, taskId) {\n    const taskData = this.taskCards.get(taskId);\n    if (!taskData || !taskData.error) return;\n\n    // ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—è¦ç´ ä½œæˆ\n    const tooltip = document.createElement('div');\n    tooltip.style.cssText = `\n      position: absolute;\n      bottom: 100%;\n      left: 50%;\n      transform: translateX(-50%);\n      background: rgba(244, 67, 54, 0.95);\n      color: white;\n      padding: 8px 12px;\n      border-radius: 8px;\n      font-size: 11px;\n      white-space: nowrap;\n      pointer-events: none;\n      z-index: 1001;\n      backdrop-filter: blur(10px);\n      margin-bottom: 0;\n      opacity: 0;\n      transition: opacity 0.3s ease;\n    `;\n    tooltip.textContent = taskData.error;\n\n    card.style.position = 'relative';\n    card.appendChild(tooltip);\n\n    // ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³\n    requestAnimationFrame(() => {\n      tooltip.style.opacity = '1';\n    });\n\n    // 3ç§’å¾Œã«ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆ\n    setTimeout(() => {\n      if (tooltip.parentNode) {\n        tooltip.style.opacity = '0';\n        setTimeout(() => {\n          if (tooltip.parentNode) {\n            tooltip.parentNode.removeChild(tooltip);\n          }\n        }, 300);\n      }\n    }, 3000);\n  }\n\n  /**\n   * ã‚«ãƒ¼ãƒ‰é€€å ´ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆ2026å¹´ãƒˆãƒ¬ãƒ³ãƒ‰ + iOS 26 Liquid Glassï¼‰\n   */\n  animateCardExit(card, taskId) {\n    // iOS 26 Liquid Glass é€€å ´ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ - 2026å¹´ãƒˆãƒ¬ãƒ³ãƒ‰ã®ã€Œã‚¹ãƒƒã¨æ¶ˆãˆã‚‹ã€\n    card.style.transition = 'all 0.28s cubic-bezier(0.4, 0, 0.2, 1)';\n    card.style.transform = 'translateY(-12px) scale(0.92)';\n    card.style.opacity = '0';\n    card.style.filter = 'blur(6px) brightness(1.2)';\n\n    // 2026å¹´ãƒˆãƒ¬ãƒ³ãƒ‰: æ¶ˆå»æ™‚ã®å¾®ç´°ãªå…‰ã®æ‹¡æ•£åŠ¹æœ\n    card.style.boxShadow = '0 0 40px rgba(255, 255, 255, 0.3), 0 0 80px rgba(255, 255, 255, 0.1)';\n\n    setTimeout(() => {\n      if (card.parentNode) {\n        card.parentNode.removeChild(card);\n      }\n      this.taskCards.delete(taskId);\n      // ã‚«ãƒ¼ãƒ‰å‰Šé™¤å¾Œã«è¡¨ç¤ºåˆ¶é™ã‚’å†é©ç”¨\n      this.updateCardDisplayLimit();\n    }, 280);\n  }\n\n  /**\n   * ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¡¨ç¾ã‚¹ã‚¿ã‚¤ãƒ«ã‚’è‡ªç„¶ã«æ„ŸçŸ¥\n   */\n  getResponseType(prompt) {\n    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¡¨ç¾ã‚¹ã‚¿ã‚¤ãƒ«ã‚’è‡ªç„¶ã«æ„ŸçŸ¥\n    if (/ã¡ã‚‡ã“ã£ã¨|ã¡ã‚‡ã“ã‚“|å°‘ã—|è»½ã/.test(prompt) || prompt.length < 15) {\n      return 'casual';\n    }\n    if (/ç¾ã—ã„|å¹»æƒ³|ç´ æ•µ|é­”æ³•|ä¸–ç•Œ|ç¶ºéº—/.test(prompt)) {\n      return 'magical';\n    }\n    return 'balanced'; // 80%ãŒã“ã“ã«è©²å½“\n  }\n\n  /**\n   * æ¸©ã‹ã¿ã®ã‚ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç”Ÿæˆï¼ˆãƒãƒ¼ã‚±ææ¡ˆãƒ™ãƒ¼ã‚¹ï¼‰\n   */\n  getFriendlyMessage(status, prompt, errorMessage = null) {\n    const shortPrompt = prompt.length > 15 ? prompt.substring(0, 15) + '...' : prompt;\n\n    // è‡ªç„¶ãªå¿œç­”ã‚·ã‚¹ãƒ†ãƒ é©ç”¨\n    const responseType = this.getResponseType(prompt);\n\n    switch (status) {\n      case 'pending':\n        return responseType === 'casual' ? 'ã¡ã‚‡ã“ã£ã¨æº–å‚™ä¸­ã§ã™...' :\n               responseType === 'magical' ? 'é­”æ³•ã‚’ã‹ã‘ã‚ˆã†ã¨ã—ã¦ã„ã¾ã™...' :\n               'ã¡ã‚‡ã“ã£ã¨é­”æ³•ã®æº–å‚™ä¸­...';\n      case 'processing':\n      case 'in-progress':\n      case 'progress':\n        // Modify mode specific messages for processing\n        if (this.currentMode === 'modify') {\n          return responseType === 'casual' ? 'ã¡ã‚‡ã“ã£ã¨èª¿æ•´ä¸­ã§ã™...' :\n                 responseType === 'magical' ? 'ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’å¤‰åŒ–ã•ã›ã¦ã„ã¾ã™...' :\n                 'ã¡ã‚‡ã“ã‚“ã¨ç·¨é›†ä¸­ã§ã™...';\n        }\n        return responseType === 'casual' ? 'ã¡ã‚‡ã“ã‚“ã¨é…ç½®ä¸­ã§ã™...' :\n               responseType === 'magical' ? 'ã‚ãªãŸã®æƒ³ã„ã‚’å½¢ã«ã—ã¦ã„ã¾ã™...' :\n               'ã¡ã‚‡ã“ã£ã¨é­”æ³•ã‚’ã‹ã‘ã¦ã„ã¾ã™...';\n      case 'completed':\n        // Delete mode specific messages\n        if (this.currentMode === 'delete') {\n          return responseType === 'casual' ? 'ã¡ã‚‡ã“ã£ã¨å‰Šé™¤ã—ã¾ã—ãŸï¼' :\n                 responseType === 'magical' ? 'ã™ã£ãã‚Šã¨ç‰‡ä»˜ãã¾ã—ãŸï¼' :\n                 'ã¡ã‚‡ã“ã‚“ã¨å‰Šé™¤å®Œäº†ï¼ã™ã£ãã‚Šã§ã™ã­ï¼';\n        }\n        // Modify mode specific messages\n        if (this.currentMode === 'modify') {\n          return responseType === 'casual' ? 'ã¡ã‚‡ã“ã£ã¨èª¿æ•´ã—ã¾ã—ãŸï¼' :\n                 responseType === 'magical' ? 'ç´ æ•µã«å¤‰èº«ã—ã¾ã—ãŸï¼' :\n                 'ã¡ã‚‡ã“ã‚“ã¨ç·¨é›†å®Œäº†ï¼ã„ã„æ„Ÿã˜ã§ã™ã­ï¼';\n        }\n        // Default completion messages for other modes\n        return responseType === 'casual' ? 'ã¡ã‚‡ã“ã£ã¨ãƒ‰ãƒ­ãƒƒãƒ—ã—ã¾ã—ãŸï¼' :\n               responseType === 'magical' ? 'ç´ æ•µãªä¸–ç•ŒãŒå®Œæˆã—ã¾ã—ãŸï¼' :\n               'ã¡ã‚‡ã“ã‚“ã¨é…ç½®å®Œäº†ï¼ç´ æ•µã§ã™ã­ï¼';\n      case 'error':\n        // ã‚¨ãƒ©ãƒ¼ç†ç”±ãŒã‚ã‚Œã°å«ã‚ã‚‹\n        if (errorMessage) {\n          const shortError = errorMessage.length > 30 ? errorMessage.substring(0, 30) + '...' : errorMessage;\n          return `âŒ ${shortError}`;\n        }\n        return responseType === 'casual' ? 'ãŠã£ã¨ã€ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ' :\n               responseType === 'magical' ? 'ç”³ã—è¨³ã”ã–ã„ã¾ã›ã‚“ã€å‡¦ç†ã«å¤±æ•—ã—ã¾ã—ãŸ' :\n               'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„';\n      default:\n        return shortPrompt;\n    }\n  }\n\n  /**\n   * ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è‰²å–å¾—\n   */\n  getStatusColor(status) {\n    // ãƒã‚ªãƒ³ãƒ‘ãƒ¼ãƒ—ãƒ«/ãƒ”ãƒ³ã‚¯ç³»ã§çµ±ä¸€ï¼ˆ2025ãƒˆãƒ¬ãƒ³ãƒ‰ï¼‰\n    const colors = {\n      pending: this.isDarkMode ? '#a78bfa' : '#7c3aed',        // è–„ç´«\n      processing: this.isDarkMode ? '#c084fc' : '#9333ea',     // ç´«ï¼ˆç”Ÿæˆä¸­ï¼‰\n      progress: this.isDarkMode ? '#ec4899' : '#be185d',       // ãƒ”ãƒ³ã‚¯\n      completed: this.isDarkMode ? '#a78bfa' : '#7c3aed',      // ç´«ï¼ˆå®Œäº†ã‚‚çµ±ä¸€ï¼‰\n      error: this.isDarkMode ? '#f87171' : '#dc2626'           // èµ¤ï¼ˆã‚¨ãƒ©ãƒ¼ã®ã¿ï¼‰\n    };\n    return colors[status] || colors.pending;\n  }\n\n  /**\n   * ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ä½œæˆï¼ˆãƒ‘ãƒ¼ã‚»ãƒ³ãƒˆè¡¨ç¤ºãªã—ï¼‰\n   */\n  createStatusIndicator(status) {\n    if (status === 'processing' || status === 'progress') {\n      return `\n        <div class=\"status-indicator\" style=\"\n          background: ${this.isDarkMode ? 'rgba(255, 255, 255, 0.08)' : 'rgba(0, 0, 0, 0.08)'};\n          border-radius: 8px;\n          height: 4px;\n          overflow: hidden;\n          margin-top: 8px;\n          position: relative;\n        \">\n          <div class=\"status-pulse\" style=\"\n            background: linear-gradient(90deg, transparent, #6366f1, #8b5cf6, transparent);\n            height: 100%;\n            width: 30%;\n            border-radius: 8px;\n            animation: statusPulse 1.8s ease-in-out infinite;\n          \"></div>\n        </div>\n        <div style=\"display: flex; align-items: center; gap: 4px; margin-top: 8px;\">\n          <div class=\"status-dots\" style=\"font-size: 10px; color: ${this.isDarkMode ? '#c084fc' : '#9333ea'};\">\n            å‡¦ç†ä¸­<span style=\"animation: dots 1.5s infinite;\">...</span>\n          </div>\n        </div>\n      `;\n    }\n    return '';\n  }\n\n  /**\n   * ã‚¿ã‚¹ã‚¯å®Œäº†ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³\n   */\n  animateTaskCompletion(card) {\n    // æ§ãˆã‚ãªã‚µã‚¯ã‚»ã‚¹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³\n    card.style.animation = 'taskComplete 0.8s ease-out';\n\n    // å¾®å¦™ãªãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«åŠ¹æœã‚’è¿½åŠ ï¼ˆæ§ãˆã‚ï¼‰\n    this.addSubtleParticleEffect(card);\n\n    setTimeout(() => {\n      card.style.animation = '';\n    }, 800);\n\n    this.ensureTaskAnimations();\n  }\n\n  /**\n   * æ§ãˆã‚ãªãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«åŠ¹æœ\n   */\n  addSubtleParticleEffect(card) {\n    const particles = 3; // å°‘ãªã„æ•°ã®ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«\n    const rect = card.getBoundingClientRect();\n\n    for (let i = 0; i < particles; i++) {\n      const particle = document.createElement('div');\n      particle.style.cssText = `\n        position: fixed;\n        width: 4px;\n        height: 4px;\n        background: linear-gradient(45deg, #a78bfa, #c084fc);\n        border-radius: 50%;\n        pointer-events: none;\n        z-index: 9999;\n        left: ${rect.right - 20}px;\n        top: ${rect.top + 10}px;\n        opacity: 0.8;\n        transform: scale(0);\n        animation: subtleParticle 1.2s ease-out forwards;\n      `;\n\n      // ãƒ©ãƒ³ãƒ€ãƒ ãªæ–¹å‘ã«å°‘ã—ç§»å‹•\n      const angle = (i / particles) * Math.PI * 2;\n      const distance = 15; // æ§ãˆã‚ãªè·é›¢\n      particle.style.setProperty('--move-x', `${Math.cos(angle) * distance}px`);\n      particle.style.setProperty('--move-y', `${Math.sin(angle) * distance}px`);\n\n      document.body.appendChild(particle);\n\n      // è‡ªå‹•å‰Šé™¤\n      setTimeout(() => particle.remove(), 1200);\n    }\n  }\n\n  /**\n   * ã‚¿ã‚¹ã‚¯ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”¨CSSç¢ºä¿\n   */\n  ensureTaskAnimations() {\n    if (document.getElementById('task-animations')) return;\n\n    const style = document.createElement('style');\n    style.id = 'task-animations';\n    style.textContent = `\n      @keyframes slideInUp {\n        from { opacity: 0; transform: translateY(20px); }\n        to { opacity: 1; transform: translateY(0); }\n      }\n\n      @keyframes taskComplete {\n        0% {\n          transform: scale(1);\n          border-left-color: rgba(192, 132, 252, 0.5);\n        }\n        30% {\n          transform: scale(1.01);\n          background: rgba(167, 139, 250, 0.08);\n          border-left-color: rgba(167, 139, 250, 0.6);\n        }\n        60% {\n          background: rgba(167, 139, 250, 0.05);\n        }\n        100% {\n          transform: scale(1);\n          background: rgba(167, 139, 250, 0.02);\n          border-left-color: rgba(167, 139, 250, 0.4);\n        }\n      }\n\n      @keyframes subtleParticle {\n        0% {\n          transform: scale(0) translate(0, 0);\n          opacity: 0.8;\n        }\n        20% {\n          transform: scale(1) translate(0, 0);\n          opacity: 1;\n        }\n        100% {\n          transform: scale(0.3) translate(var(--move-x, 0), var(--move-y, 0));\n          opacity: 0;\n        }\n      }\n\n      @keyframes shimmer {\n        0% { transform: translateX(-100%); }\n        100% { transform: translateX(100%); }\n      }\n\n      @keyframes slideIn {\n        from { opacity: 0; transform: translateX(-20px); }\n        to { opacity: 1; transform: translateX(0); }\n      }\n\n      @keyframes statusPulse {\n        0% { transform: translateX(-100%); }\n        50% { transform: translateX(300%); }\n        100% { transform: translateX(-100%); }\n      }\n\n      @keyframes dots {\n        0%, 20% { opacity: 0; }\n        50% { opacity: 1; }\n        100% { opacity: 0; }\n      }\n\n      @keyframes errorPulse {\n        0% {\n          transform: scale(1);\n          filter: saturate(1.3) brightness(1.1);\n        }\n        50% {\n          transform: scale(1.03);\n          filter: saturate(1.5) brightness(1.2);\n          box-shadow: 0 12px 40px rgba(244, 67, 54, 0.4), 0 0 80px rgba(244, 67, 54, 0.2);\n        }\n        100% {\n          transform: scale(1);\n          filter: saturate(1.3) brightness(1.1);\n        }\n      }\n    `;\n    document.head.appendChild(style);\n  }\n\n  /**\n   * ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ä»˜ãã‚¿ã‚¹ã‚¯ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤ºï¼ˆäº’æ›æ€§ã®ãŸã‚ï¼‰\n   */\n  addTaskStatus(message, percent = 0, taskId = null) {\n    const id = taskId || `task_${Date.now()}`;\n    return this.addTaskCard(message, {\n      percent: Math.min(Math.max(percent, 0), 100),\n      taskId: id,\n      status: percent > 0 ? 'progress' : 'pending'\n    });\n  }\n\n  /**\n   * ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹æ›´æ–°\n   */\n  updateTaskProgress(taskId, percent, newMessage = null) {\n    const existingTask = this.output.querySelector(`[data-task-id=\"${taskId}\"]`);\n    if (existingTask && newMessage) {\n      // æ—¢å­˜ã‚¿ã‚¹ã‚¯ã‚’æ›´æ–°\n      this.addOutput(newMessage, 'progress', { \n        percent: Math.min(Math.max(percent, 0), 100),\n        taskId\n      });\n    }\n  }\n\n  /**\n   * ã‚¿ã‚¹ã‚¯å®Œäº†ï¼ˆãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼å‰Šé™¤ï¼‰\n   */\n  completeTask(taskId) {\n    const existingTask = this.output.querySelector(`[data-task-id=\"${taskId}\"]`);\n    if (existingTask) {\n      // å®Œäº†ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³\n      existingTask.style.transition = 'opacity 0.5s ease, transform 0.5s ease';\n      existingTask.style.opacity = '0';\n      existingTask.style.transform = 'translateX(20px)';\n      \n      setTimeout(() => {\n        if (existingTask.parentNode) {\n          existingTask.remove();\n        }\n      }, 500);\n    }\n  }\n\n  /**\n   * SSEæ¥ç¶šé–‹å§‹ï¼ˆãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€²æ—å—ä¿¡ï¼‰\n   */\n  connectToProgress(serverTaskId, uiTaskId = null) {\n    if (this.activeConnections.has(serverTaskId)) {\n      return;\n    }\n\n    const eventSource = new EventSource(`/api/progress/${serverTaskId}`);\n    this.activeConnections.set(serverTaskId, eventSource);\n\n    eventSource.onmessage = (event) => {\n      try {\n        const data = JSON.parse(event.data);\n        data.uiTaskId = uiTaskId; // UIç”¨ã‚¿ã‚¹ã‚¯IDã‚’è¿½åŠ \n        this.handleProgressUpdate(data);\n      } catch (error) {\n        console.error('SSE data parse error:', error);\n      }\n    };\n\n    eventSource.onerror = (error) => {\n      console.error('SSE connection error:', error);\n      this.disconnectProgress(serverTaskId);\n    };\n  }\n\n  /**\n   * é€²æ—æ›´æ–°å‡¦ç†\n   */\n  handleProgressUpdate(data) {\n    switch (data.type) {\n      case 'connected':\n        this.logDebug(`ğŸ”— Connected to progress stream: ${data.taskId}`);\n        break;\n\n      case 'progress':\n        if (data.percent !== undefined && data.uiTaskId) {\n          this.updateTaskCard(data.uiTaskId, 'progress', { percent: data.percent });\n        }\n        break;\n\n      case 'completed':\n        if (data.uiTaskId) {\n          this.updateTaskCard(data.uiTaskId, 'completed');\n        }\n        this.disconnectProgress(data.taskId);\n        break;\n\n      case 'error':\n        if (data.uiTaskId) {\n          this.updateTaskCard(data.uiTaskId, 'error');\n        }\n        this.addOutput(`âŒ ${data.message}`, 'error');\n        this.disconnectProgress(data.taskId);\n        break;\n    }\n  }\n\n  /**\n   * SSEæ¥ç¶šçµ‚äº†\n   */\n  disconnectProgress(taskId) {\n    const connection = this.activeConnections.get(taskId);\n    if (connection) {\n      connection.close();\n      this.activeConnections.delete(taskId);\n    }\n  }\n\n  /**\n   * å‡ºåŠ›ã‚¨ãƒªã‚¢ã‚’æœ€ä¸‹éƒ¨ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«\n   */\n  scrollToBottom() {\n    if (this.outputDiv) {\n      this.outputDiv.scrollTop = this.outputDiv.scrollHeight;\n    }\n  }\n\n  /**\n   * ãƒ¢ãƒ¼ãƒ‰åˆ¥ã‚³ãƒãƒ³ãƒ‰ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹\n   */\n  getModePrefix(mode) {\n    // ã‚µãƒ¼ãƒãƒ¼å´ã§ãƒ¢ãƒ¼ãƒ‰ã‚’åŒºåˆ¥ã™ã‚‹ãŸã‚ã®ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹\n    const prefixes = {\n      generate: '', // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ç”Ÿæˆãƒ¢ãƒ¼ãƒ‰\n      modify: '[å¤‰æ›´] ',\n      delete: '[å‰Šé™¤] '\n    };\n    return prefixes[mode] || '';\n  }\n\n  /**\n   * ã‚³ãƒãƒ³ãƒ‰ä¿å­˜ (Undo/Redoã‚·ã‚¹ãƒ†ãƒ )\n   */\n  saveCommandToHistory(commandData) {\n    // ç¾åœ¨ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä»¥é™ã®å±¥æ­´ã‚’å‰Šé™¤ï¼ˆæ–°ã—ã„ã‚³ãƒãƒ³ãƒ‰ãŒå®Ÿè¡Œã•ã‚ŒãŸãŸã‚ï¼‰\n    this.commandHistory = this.commandHistory.slice(0, this.currentHistoryIndex + 1);\n    \n    // æ–°ã—ã„ã‚³ãƒãƒ³ãƒ‰ã‚’å±¥æ­´ã«è¿½åŠ \n    this.commandHistory.push(commandData);\n    this.currentHistoryIndex = this.commandHistory.length - 1;\n    \n    // æœ€å¤§ã‚³ãƒãƒ³ãƒ‰ä¿å­˜æ•°ã‚’è¶…ãˆãŸå ´åˆã€å¤ã„ã‚³ãƒãƒ³ãƒ‰ã‚’å‰Šé™¤\n    if (this.commandHistory.length > this.maxHistorySize) {\n      this.commandHistory.shift();\n      this.currentHistoryIndex--;\n    }\n    \n    // ãƒœã‚¿ãƒ³çŠ¶æ…‹ã‚’æ›´æ–°\n    this.updateUndoRedoButtons();\n  }\n\n  /**\n   * Undoå®Ÿè¡Œ\n   */\n  undo() {\n    if (!this.canUndo()) {\n      this.addOutput('â†¶ Undoã§ãã‚‹æ“ä½œãŒã‚ã‚Šã¾ã›ã‚“', 'hint');\n      return;\n    }\n    \n    const command = this.commandHistory[this.currentHistoryIndex];\n    this.currentHistoryIndex--;\n    \n    // Undoã®é€†æ“ä½œã‚’å®Ÿè¡Œï¼ˆç°¡æ˜“å®Ÿè£…ï¼‰\n    if (command.mode === 'generate') {\n      this.addOutput(`â†¶ Undo: \"${command.command}\" ã®ç”Ÿæˆã‚’å–ã‚Šæ¶ˆã—ã¾ã—ãŸ`, 'system');\n      // å®Ÿéš›ã®ã‚·ãƒ¼ãƒ³ç®¡ç†ã§ã¯æœ€å¾Œã«ä½œæˆã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å‰Šé™¤\n      if (this.sceneManager && this.sceneManager.undoLastGenerate) {\n        this.sceneManager.undoLastGenerate();\n      }\n    } else if (command.mode === 'modify') {\n      this.addOutput(`â†¶ Undo: \"${command.command}\" ã®å¤‰æ›´ã‚’å–ã‚Šæ¶ˆã—ã¾ã—ãŸ`, 'system');\n      // å®Ÿéš›ã®ã‚·ãƒ¼ãƒ³ç®¡ç†ã§ã¯å‰ã®çŠ¶æ…‹ã«æˆ»ã™\n      if (this.sceneManager && this.sceneManager.undoLastModify) {\n        this.sceneManager.undoLastModify();\n      }\n    } else if (command.mode === 'delete') {\n      this.addOutput(`â†¶ Undo: \"${command.command}\" ã®å‰Šé™¤ã‚’å–ã‚Šæ¶ˆã—ã¾ã—ãŸ`, 'system');\n      // å®Ÿéš›ã®ã‚·ãƒ¼ãƒ³ç®¡ç†ã§ã¯å‰Šé™¤ã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å¾©å…ƒ\n      if (this.sceneManager && this.sceneManager.undoLastDelete) {\n        this.sceneManager.undoLastDelete();\n      }\n    }\n    \n    this.updateUndoRedoButtons();\n  }\n\n  /**\n   * Redoå®Ÿè¡Œ\n   */\n  redo() {\n    if (!this.canRedo()) {\n      this.addOutput('â†· Redoã§ãã‚‹æ“ä½œãŒã‚ã‚Šã¾ã›ã‚“', 'hint');\n      return;\n    }\n    \n    this.currentHistoryIndex++;\n    const command = this.commandHistory[this.currentHistoryIndex];\n    \n    // Redoã§ã‚³ãƒãƒ³ãƒ‰ã‚’å†å®Ÿè¡Œ\n    this.addOutput(`â†· Redo: \"${command.command}\" ã‚’å†å®Ÿè¡Œã—ã¾ã—ãŸ`, 'system');\n    \n    // å®Ÿéš›ã®ã‚·ãƒ¼ãƒ³ç®¡ç†ã§ã®Redoå‡¦ç†\n    if (this.sceneManager && this.sceneManager.redoCommand) {\n      this.sceneManager.redoCommand(command);\n    }\n    \n    this.updateUndoRedoButtons();\n  }\n\n  /**\n   * UndoãŒå¯èƒ½ã‹ãƒã‚§ãƒƒã‚¯\n   */\n  canUndo() {\n    return this.currentHistoryIndex >= 0;\n  }\n\n  /**\n   * RedoãŒå¯èƒ½ã‹ãƒã‚§ãƒƒã‚¯\n   */\n  canRedo() {\n    return this.currentHistoryIndex < this.commandHistory.length - 1;\n  }\n\n  /**\n   * Undo/Redoãƒœã‚¿ãƒ³ã®çŠ¶æ…‹æ›´æ–°\n   */\n  updateUndoRedoButtons() {\n    if (this.undoBtn) {\n      this.undoBtn.disabled = !this.canUndo();\n      this.undoBtn.style.opacity = this.canUndo() ? '1' : '0.4';\n      this.undoBtn.style.cursor = this.canUndo() ? 'pointer' : 'not-allowed';\n    }\n    \n    if (this.redoBtn) {\n      this.redoBtn.disabled = !this.canRedo();\n      this.redoBtn.style.opacity = this.canRedo() ? '1' : '0.4';\n      this.redoBtn.style.cursor = this.canRedo() ? 'pointer' : 'not-allowed';\n    }\n  }\n\n  /**\n   * ç¢ºèªä»˜ãå…¨ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå‰Šé™¤\n   */\n  async clearAllWithConfirmation() {\n    const confirmed = await this.showClearAllConfirmation();\n    if (confirmed) {\n      this.clearAll();\n    }\n  }\n\n  /**\n   * Clear Allç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°\n   */\n  async showClearAllConfirmation() {\n    return this.showConfirmationDialog({\n      icon: 'ğŸ§¹',\n      title: 'Clear All ã®ç¢ºèª',\n      message: 'ã™ã¹ã¦ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒå‰Šé™¤ã•ã‚Œã¾ã™ã€‚<br>ã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã™ã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚',\n      confirmText: 'Clear All å®Ÿè¡Œ',\n      cancelText: 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«',\n      confirmColor: '#6366f1'\n    });\n  }\n\n  /**\n   * ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚¯ãƒ­ãƒ¼ã‚ºã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³\n   */\n  closeModalWithAnimation(modal) {\n    const dialog = modal.querySelector('div:last-child');\n    dialog.style.transform = 'scale(0.9)';\n    dialog.style.opacity = '0';\n    modal.style.opacity = '0';\n    \n    setTimeout(() => {\n      if (modal.parentElement) {\n        document.body.removeChild(modal);\n      }\n    }, 200);\n  }\n\n  /**\n   * å…¨ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå‰Šé™¤\n   */\n  clearAll() {\n    if (this.sceneManager) {\n      this.sceneManager.clearAll();\n      this.addOutput('ğŸ§¹ å…¨ã¦ã®å®Ÿé¨“ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å‰Šé™¤ã—ã¾ã—ãŸ', 'system');\n    } else if (this.client) {\n      // ã‚µãƒ¼ãƒãƒ¼å´ã§ã®å‰Šé™¤ã¯æœªå®Ÿè£…\n      this.addOutput('âš ï¸ ã‚µãƒ¼ãƒãƒ¼å´å‰Šé™¤ã¯æœªå®Ÿè£…', 'error');\n    }\n  }\n\n  // showHistory() ãƒ¡ã‚½ãƒƒãƒ‰å®Œå…¨å‰Šé™¤æ¸ˆã¿\n\n  /**\n   * åˆ©ç”¨å¯èƒ½ãªã‚³ãƒãƒ³ãƒ‰ä¾‹ã‚’è¡¨ç¤º\n   */\n  showExamples() {\n    const examples = [\n      'å³ä¸Šã«ãƒ‰ãƒ©ã‚´ãƒ³ã‚’ä½œã£ã¦',\n      'ä¸­å¤®ã«å¤§ããªãƒ¦ãƒ‹ã‚³ãƒ¼ãƒ³ã‚’ç”Ÿæˆ',\n      'å·¦ä¸‹ã«å°ã•ãªæ¡œã‚’ä½œã£ã¦',\n      'ç©ºã«é³³å‡°ã‚’ä½œã£ã¦',\n      'åœ°é¢ã«ç¥ç¤¾ã‚’ä½œã£ã¦'\n    ];\n\n    this.addOutput('ğŸ’¡ ã‚³ãƒãƒ³ãƒ‰ä¾‹:', 'system');\n    examples.forEach(example => {\n      this.addOutput(`   \"${example}\"`, 'hint');\n    });\n  }\n\n  /**\n   * SceneManagerè¨­å®š\n   */\n  setSceneManager(sceneManager) {\n    this.sceneManager = sceneManager;\n    this.applyServiceSelectionToSceneManager();\n  }\n\n  /**\n   * Clientè¨­å®š\n   */\n  setClient(client) {\n    this.client = client;\n  }\n\n  /**\n   * è¨­å®šæ›´æ–°\n   */\n  updateConfig(newConfig) {\n    this.config = { ...this.config, ...newConfig };\n    // å¿…è¦ã«å¿œã˜ã¦UIã‚’æ›´æ–°\n    if (newConfig.activationKey) {\n      // æ–°ã—ã„ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰ã‚’åæ˜ ã™ã‚‹ãŸã‚ã€ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’å†è¨­å®š\n      this.bindEvents();\n    }\n  }\n\n  /**\n   * ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—\n   */\n  /**\n   * ã‚¹ã‚¿ã‚¤ãƒ«å†é©ç”¨\n   */\n  refreshStyles() {\n    // ãƒœãƒ‡ã‚£ã«ãƒ†ãƒ¼ãƒã‚¯ãƒ©ã‚¹ã‚’è¨­å®š\n    document.body.className = this.isWabiSabiMode ? 'wabisabi-mode' : (this.isDarkMode ? 'dark-mode' : 'light-mode');\n\n    // Generateãƒ¢ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’å†é©ç”¨\n    const generateBtn = this.container?.querySelector('[data-mode=\"generate\"]');\n    if (generateBtn) {\n      generateBtn.style.cssText = this.getModeButtonStyles(true, 'generate');\n    }\n    \n    // Executeãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’å†é©ç”¨\n    const executeBtn = this.container?.querySelector('#execute-btn');\n    if (executeBtn) {\n      executeBtn.style.cssText = this.getModernButtonStyles('primary');\n    }\n  }\n\n  /**\n   * ãƒ†ãƒ¼ãƒåˆ‡ã‚Šæ›¿ãˆ (light -> dark -> wabisabi -> light)\n   */\n  toggleTheme() {\n    const themeOrder = ['light', 'dark', 'wabisabi'];\n    const currentIndex = themeOrder.indexOf(this.currentTheme);\n    const nextIndex = (currentIndex + 1) % themeOrder.length;\n\n    this.currentTheme = themeOrder[nextIndex];\n    this.isDarkMode = this.currentTheme === 'dark';\n    this.isWabiSabiMode = this.currentTheme === 'wabisabi';\n\n    localStorage.setItem('live-command-theme', this.currentTheme);\n\n    // ã‚¢ã‚¤ã‚³ãƒ³ãƒœã‚¿ãƒ³æ›´æ–°\n    if (this.themeToggle) {\n      const getThemeIcon = () => {\n        const themeConfig = {\n          light: 'ğŸŒ™',\n          dark: 'ğŸµ',\n          wabisabi: 'â˜€ï¸'\n        };\n        return themeConfig[this.currentTheme] || 'ğŸŒ™';\n      };\n\n      const getThemeTitle = () => {\n        const titleConfig = {\n          light: 'ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆ',\n          dark: 'ä¾˜ã³å¯‚ã³ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆ',\n          wabisabi: 'ãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆ'\n        };\n        return titleConfig[this.currentTheme] || 'ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆ';\n      };\n\n      const getThemeIconWithFilter = () => {\n        const icon = getThemeIcon();\n        if (icon === 'â˜€ï¸') {\n          return `<span style=\"filter: saturate(1.2) brightness(1.1);\">${icon}</span>`;\n        } else if (icon === 'ğŸµ') {\n          return `<span style=\"filter: hue-rotate(80deg) saturate(1.1) brightness(1.0);\">${icon}</span>`;\n        } else {\n          return `<span style=\"filter: hue-rotate(240deg) saturate(0.8) brightness(1.1);\">${icon}</span>`;\n        }\n      };\n\n      this.themeToggle.innerHTML = getThemeIconWithFilter();\n      this.themeToggle.title = getThemeTitle();\n    }\n\n    // å…¨ã‚¹ã‚¿ã‚¤ãƒ«å†é©ç”¨\n    this.applyTheme();\n\n    // ãƒ†ãƒ¼ãƒåˆ‡ã‚Šæ›¿ãˆå®Œäº†ï¼ˆå±¥æ­´ã«ã¯å‡ºåŠ›ã—ãªã„ï¼‰\n  }\n\n  /**\n   * ãƒ†ãƒ¼ãƒé©ç”¨\n   */\n  applyTheme() {\n    // ãƒœãƒ‡ã‚£ã«ãƒ†ãƒ¼ãƒã‚¯ãƒ©ã‚¹ã‚’è¨­å®š\n    document.body.className = this.isDarkMode ? 'dark-mode' : 'light-mode';\n\n    // ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠï¼ˆdisplayçŠ¶æ…‹ã‚’ä¿æŒï¼‰\n    const currentDisplay = this.container.style.display;\n    const currentFlexDirection = this.container.style.flexDirection;\n    this.container.style.cssText = this.getContainerStyles();\n    this.container.style.display = currentDisplay || 'flex';\n    this.container.style.flexDirection = currentFlexDirection || 'column';\n\n    // ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ–ãƒ©ãƒ³ãƒ‰ãƒãƒƒã‚¸ã®ãƒ†ãƒ¼ãƒå†é©ç”¨\n    const brandBadge = this.container.querySelector('.floating-brand-badge');\n    if (brandBadge) {\n      brandBadge.style.background = this.isDarkMode \n        ? 'linear-gradient(135deg, rgba(99, 102, 241, 0.8), rgba(139, 92, 246, 0.7))'\n        : 'linear-gradient(135deg, rgba(99, 102, 241, 0.9), rgba(139, 92, 246, 0.8))';\n      brandBadge.style.border = `1px solid ${this.isDarkMode ? 'rgba(255, 255, 255, 0.2)' : 'rgba(255, 255, 255, 0.4)'}`;\n    }\n\n    // å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰\n    this.input.style.cssText = this.getInputStyles();\n\n    // ã‚¹ã‚¿ã‚¤ãƒ«é©ç”¨\n    this.output.style.cssText = this.getOutputStyles();\n\n    // ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ãƒ¢ãƒ¼ãƒ‰ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ã®2025å¹´ä»•æ§˜ãƒ†ãƒ¼ãƒå†é©ç”¨\n    if (this.radioModeContainer) {\n      this.radioModeContainer.style.background = this.isWabiSabiMode\n        ? 'linear-gradient(135deg, rgba(97, 97, 97, 0.7), rgba(66, 66, 66, 0.6))'\n        : (this.isDarkMode\n          ? 'linear-gradient(135deg, rgba(30, 27, 75, 0.3), rgba(15, 23, 42, 0.4))'\n          : 'linear-gradient(135deg, rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.1))');\n      this.radioModeContainer.style.borderColor = this.isWabiSabiMode\n        ? 'rgba(93, 64, 55, 0.4)'\n        : (this.isDarkMode\n          ? 'rgba(99, 102, 241, 0.15)'\n          : 'rgba(255, 255, 255, 0.25)');\n\n      // å„ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ«æ›´æ–°\n      Object.keys(this.radioModeButtons).forEach(key => {\n        const { button } = this.radioModeButtons[key];\n        if (this.currentMode !== key) {\n          button.style.color = this.isWabiSabiMode\n            ? 'rgba(245, 245, 245, 0.8)'\n            : (this.isDarkMode ? 'rgba(255, 255, 255, 0.7)' : 'rgba(55, 65, 81, 0.8)');\n          button.style.background = 'transparent';\n          button.style.border = '1px solid transparent';\n          button.style.boxShadow = 'none';\n        }\n      });\n\n      // ç¾åœ¨é¸æŠã•ã‚Œã¦ã„ã‚‹ãƒ¢ãƒ¼ãƒ‰ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚‚æ›´æ–°\n      this.selectMode(this.currentMode, false);\n    }\n\n    // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã®ãƒ†ãƒ¼ãƒå†é©ç”¨\n    if (this.clearBtn) {\n      this.clearBtn.style.cssText = this.getActionButtonStyles('secondary');\n    }\n    if (this.historyBtn) {\n      this.historyBtn.style.cssText = this.getActionButtonStyles('secondary');\n      this.historyBtn.style.opacity = '0.5';\n    }\n    if (this.themeToggle) {\n      const getThemeIcon = () => {\n        const themeConfig = {\n          light: 'ğŸŒ™', // ãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰æ™‚ã¯æœˆã‚’è¡¨ç¤ºï¼ˆæ¬¡ãŒãƒ€ãƒ¼ã‚¯ï¼‰\n          dark: 'ğŸµ',  // ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰æ™‚ã¯èŒ¶ã‚’è¡¨ç¤ºï¼ˆæ¬¡ãŒwabi-sabiï¼‰\n          wabisabi: 'â˜€ï¸' // wabi-sabiãƒ¢ãƒ¼ãƒ‰æ™‚ã¯å¤ªé™½ã‚’è¡¨ç¤ºï¼ˆæ¬¡ãŒãƒ©ã‚¤ãƒˆï¼‰\n        };\n        return themeConfig[this.currentTheme] || 'ğŸŒ™';\n      };\n      const getThemeTitle = () => {\n        const titleConfig = {\n          light: 'ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆ',\n          dark: 'ä¾˜ã³å¯‚ã³ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆ',\n          wabisabi: 'ãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆ'\n        };\n        return titleConfig[this.currentTheme] || 'ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆ';\n      };\n      const getThemeIconWithFilter = () => {\n        const icon = getThemeIcon();\n        // å¤ªé™½ã¯é»„è‰²ãã€ãŠèŒ¶ã¯ç·‘ç³»ã€æœˆã¯ç´«ç³»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼\n        if (icon === 'â˜€ï¸') {\n          return `<span style=\"filter: saturate(1.2) brightness(1.1);\">${icon}</span>`;\n        } else if (icon === 'ğŸµ') {\n          return `<span style=\"filter: hue-rotate(80deg) saturate(1.1) brightness(1.0);\">${icon}</span>`;\n        } else {\n          return `<span style=\"filter: hue-rotate(240deg) saturate(0.8) brightness(1.1);\">${icon}</span>`;\n        }\n      };\n      this.themeToggle.innerHTML = getThemeIconWithFilter();\n      this.themeToggle.title = getThemeTitle();\n      this.themeToggle.style.cssText = this.getActionButtonStyles('icon');\n    }\n    if (this.settingsButton) {\n      this.settingsButton.style.cssText = this.getActionButtonStyles('icon');\n    }\n\n    this.updateServiceSelectorTheme();\n\n    // é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³ã®ãƒ†ãƒ¼ãƒæ›´æ–°\n    const closeButton = this.container.querySelector('.close-button');\n    if (closeButton) {\n      closeButton.style.color = this.isWabiSabiMode ? '#F5F5F5' : (this.isDarkMode ? '#ffffff' : '#1f2937');\n      closeButton.style.background = this.isWabiSabiMode\n        ? 'rgba(245, 245, 245, 0.1)'\n        : (this.isDarkMode\n          ? 'rgba(255, 255, 255, 0.1)'\n          : 'rgba(0, 0, 0, 0.1)');\n    }\n\n    // ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚³ãƒ³ãƒ†ãƒŠã¨ã‚¿ã‚¹ã‚¯ã‚«ãƒ¼ãƒ‰ã®ãƒ†ãƒ¼ãƒæ›´æ–°\n    this.updateFloatingContainerTheme();\n\n    // æ—¢å­˜ã®å‡ºåŠ›ãƒ†ã‚­ã‚¹ãƒˆã®è‰²ã‚’æ›´æ–°\n    this.updateExistingTextColors();\n  }\n\n  /**\n   * ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚³ãƒ³ãƒ†ãƒŠã¨ã‚¿ã‚¹ã‚¯ã‚«ãƒ¼ãƒ‰ã®ãƒ†ãƒ¼ãƒæ›´æ–°\n   */\n  updateFloatingContainerTheme() {\n    if (!this.floatingContainer) return;\n\n    // ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚³ãƒ³ãƒ†ãƒŠã®è¡¨ç¤ºçŠ¶æ…‹ã‚’ä¿æŒ\n    const currentDisplay = this.floatingContainer.style.display;\n\n    // æ—¢å­˜ã®ã‚¿ã‚¹ã‚¯ã‚«ãƒ¼ãƒ‰ã®è‰²ã ã‘ã‚’ãƒ†ãƒ¼ãƒã«åˆã‚ã›ã¦æ›´æ–°ï¼ˆãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã¯ä¿æŒï¼‰\n    if (this.taskCards && this.taskCards.size > 0) {\n      this.taskCards.forEach((taskData, taskId) => {\n        const card = taskData.element;\n        if (card) {\n          // ãƒ†ãƒ¼ãƒé–¢é€£ã®è‰²ã®ã¿æ›´æ–°ï¼ˆä½ç½®ã‚„ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³çŠ¶æ…‹ã¯ä¿æŒï¼‰\n          // 2025å¹´Glassmorphismä»•æ§˜é©ç”¨\n          const glassmorphismDark = {\n            background: 'linear-gradient(135deg, rgba(15, 23, 42, 0.75), rgba(30, 27, 75, 0.7))',\n            border: '1px solid rgba(99, 102, 241, 0.25)',\n            color: '#ffffff'\n          };\n\n          const glassmorphismLight = {\n            background: 'linear-gradient(135deg, rgba(255, 255, 255, 0.35), rgba(255, 255, 255, 0.25))',\n            border: '1px solid rgba(255, 255, 255, 0.4)',\n            color: '#1f2937'\n          };\n\n          const theme = this.isDarkMode ? glassmorphismDark : glassmorphismLight;\n\n\n          card.style.setProperty('background', theme.background, 'important');\n          card.style.setProperty('border', theme.border, 'important');\n          card.style.setProperty('color', theme.color, 'important');\n        }\n      });\n    }\n\n    // ãƒ†ãƒ¼ãƒåˆ‡ã‚Šæ›¿ãˆæ™‚ã¯ä½ç½®ã¯å¤‰æ›´ã›ãšã€è¡¨ç¤ºçŠ¶æ…‹ã®ã¿å¾©å…ƒ\n    this.floatingContainer.style.display = currentDisplay;\n  }\n\n  /**\n   * æ—¢å­˜ã®ãƒ†ã‚­ã‚¹ãƒˆè‰²ã‚’ç¾åœ¨ã®ãƒ†ãƒ¼ãƒã«åˆã‚ã›ã¦æ›´æ–°\n   */\n  updateExistingTextColors() {\n    const colors = this.isDarkMode ? {\n      system: '#60a5fa',\n      command: '#93c5fd',\n      success: '#f472b6',\n      error: '#f87171',\n      processing: '#fbbf24',\n      info: '#d1d5db',\n      hint: '#d1d5db'\n    } : {\n      system: '#1e40af',\n      command: '#1d4ed8',\n      success: '#be185d',\n      error: '#dc2626',\n      processing: '#d97706',\n      info: '#7c3aed',\n      hint: '#374151'\n    };\n\n    const defaultTextColor = this.isDarkMode ? '#d1d5db' : '#374151';\n\n    // outputå†…ã®å…¨ã¦ã®divã®è‰²ã‚’æ›´æ–°\n    this.output.querySelectorAll('div').forEach(line => {\n      const text = line.textContent;\n      let type = 'default';\n      \n      // ãƒ†ã‚­ã‚¹ãƒˆã®å†…å®¹ã‹ã‚‰ã‚¿ã‚¤ãƒ—ã‚’åˆ¤å®š\n      if (text.includes('ğŸ“‹') || text.includes('ğŸ¨') || text.includes('ğŸ®') || text.includes('UIèµ·å‹•')) {\n        type = 'system';\n      } else if (text.startsWith('> ')) {\n        type = 'command';\n      } else if (text.includes('âœ…') || text.includes('â­') || text.includes('ç”Ÿæˆã—ã¾ã—ãŸ')) {\n        type = 'success';\n      } else if (text.includes('âŒ') || text.includes('ã‚¨ãƒ©ãƒ¼')) {\n        type = 'error';\n      } else if (text.includes('ä¸­...')) {\n        type = 'processing';\n      } else if (text.includes('ğŸ“') || text.includes('ä½¿ç”¨ãƒ¢ãƒ‡ãƒ«:') || text.includes('ä½ç½®:')) {\n        type = 'info';\n      } else if (text.includes('   ')) {\n        type = 'hint';\n      }\n\n      line.style.color = colors[type] || defaultTextColor;\n    });\n  }\n\n  /**\n   * Importã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹è¡¨ç¤º\n   */\n  showImportInterface() {\n    // éš ã—ãƒ•ã‚¡ã‚¤ãƒ«å…¥åŠ›ã‚’ä½œæˆï¼ˆImportãƒœã‚¿ãƒ³ã‹ã‚‰ç›´æ¥é¸æŠã§ãã‚‹ã®ã§ã€ãƒœã‚¿ãƒ³ã¯ä¸è¦ï¼‰\n    if (!this.fileInput) {\n      this.fileInput = document.createElement('input');\n      this.fileInput.type = 'file';\n      this.fileInput.accept = '.glb,.gltf,.jpg,.jpeg,.png,.mp4,.mov';\n      this.fileInput.style.display = 'none';\n      this.fileInput.onchange = (e) => this.handleFileSelection(e);\n      document.body.appendChild(this.fileInput);\n    }\n\n    // ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—æ©Ÿèƒ½ã‚’æœ‰åŠ¹åŒ–\n    this.enableDragAndDrop();\n  }\n\n  /**\n   * Importã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹éè¡¨ç¤º\n   */\n  hideImportInterface() {\n    if (this.fileSelectButton && this.fileSelectButton.parentNode) {\n      this.fileSelectButton.parentNode.removeChild(this.fileSelectButton);\n    }\n    this.disableDragAndDrop();\n  }\n\n  /**\n   * ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’é–‹ã\n   */\n  openFileSelector() {\n    if (this.fileInput) {\n      this.fileInput.click();\n    }\n  }\n\n  /**\n   * Importãƒœã‚¿ãƒ³ã‹ã‚‰ç›´æ¥ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠã‚’å®Ÿè¡Œ\n   */\n  triggerFileSelection() {\n    // ãƒ•ã‚¡ã‚¤ãƒ«å…¥åŠ›è¦ç´ ãŒå­˜åœ¨ã—ãªã„å ´åˆã¯ä½œæˆ\n    if (!this.fileInput) {\n      this.showImportInterface(); // æ—¢å­˜ã®ãƒ•ã‚¡ã‚¤ãƒ«å…¥åŠ›ä½œæˆå‡¦ç†ã‚’å‘¼ã³å‡ºã—\n    }\n\n    // ç›´æ¥ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’é–‹ã\n    this.openFileSelector();\n\n    // Import ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆï¼ˆUIåæ˜ ï¼‰\n    this.selectMode('import', true);\n  }\n\n  /**\n   * ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠå‡¦ç†\n   */\n  async handleFileSelection(event) {\n    const file = event.target.files[0];\n    if (!file) return;\n\n    try {\n      // ãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ã‚¤ãƒ—ã‚’åˆ¤å®š\n      const fileType = this.detectFileType(file.name);\n\n      // ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ­ãƒ¼ã‚«ãƒ«URLã¨ã—ã¦å‡¦ç†\n      const fileUrl = URL.createObjectURL(file);\n\n      // ãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±ã‚’ä¿å­˜\n      this.selectedFile = {\n        file: file,\n        url: fileUrl,\n        type: fileType,\n        name: file.name\n      };\n\n      this.selectMode('import', true);\n\n      // è‡ªå‹•çš„ã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã§å®Ÿè¡Œ\n      const defaultPrompt = `ä¸­å¤®ã«è¨­ç½® (${file.name})`;\n      this.input.value = defaultPrompt;\n\n      this.addOutput(`ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ: ${file.name} (${fileType})`, 'system');\n      this.addOutput(`ğŸš€ è‡ªå‹•ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰é–‹å§‹: ${defaultPrompt}`, 'system');\n\n      // è‡ªå‹•å®Ÿè¡Œï¼ˆå°‘ã—é…å»¶ã‚’å…¥ã‚Œã¦UXå‘ä¸Šï¼‰\n      setTimeout(() => {\n        this.executeCommand();\n      }, 500);\n\n    } catch (error) {\n      console.error('File selection error:', error);\n      this.addOutput(`âŒ ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');\n    }\n  }\n\n  /**\n   * ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—æ©Ÿèƒ½ã‚’æœ‰åŠ¹åŒ–\n   */\n  enableDragAndDrop() {\n    if (!this.input) return;\n\n    this.input.addEventListener('dragover', this.handleDragOver.bind(this));\n    this.input.addEventListener('drop', this.handleDrop.bind(this));\n    this.input.addEventListener('dragenter', this.handleDragEnter.bind(this));\n    this.input.addEventListener('dragleave', this.handleDragLeave.bind(this));\n  }\n\n  /**\n   * ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—æ©Ÿèƒ½ã‚’ç„¡åŠ¹åŒ–\n   */\n  disableDragAndDrop() {\n    if (!this.input) return;\n\n    this.input.removeEventListener('dragover', this.handleDragOver.bind(this));\n    this.input.removeEventListener('drop', this.handleDrop.bind(this));\n    this.input.removeEventListener('dragenter', this.handleDragEnter.bind(this));\n    this.input.removeEventListener('dragleave', this.handleDragLeave.bind(this));\n  }\n\n  /**\n   * ãƒ‰ãƒ©ãƒƒã‚°ã‚ªãƒ¼ãƒãƒ¼å‡¦ç†\n   */\n  handleDragOver(e) {\n    e.preventDefault();\n    this.input.style.background = this.isDarkMode ? 'rgba(236, 72, 153, 0.1)' : 'rgba(236, 72, 153, 0.05)';\n  }\n\n  /**\n   * ãƒ‰ãƒ©ãƒƒã‚°ã‚¨ãƒ³ã‚¿ãƒ¼å‡¦ç†\n   */\n  handleDragEnter(e) {\n    e.preventDefault();\n    this.input.style.background = this.isDarkMode ? 'rgba(236, 72, 153, 0.1)' : 'rgba(236, 72, 153, 0.05)';\n  }\n\n  /**\n   * ãƒ‰ãƒ©ãƒƒã‚°ãƒªãƒ¼ãƒ–å‡¦ç†\n   */\n  handleDragLeave(e) {\n    e.preventDefault();\n    this.input.style.background = '';\n  }\n\n  /**\n   * ãƒ‰ãƒ­ãƒƒãƒ—å‡¦ç†\n   */\n  async handleDrop(e) {\n    e.preventDefault();\n    this.input.style.background = '';\n\n    const files = Array.from(e.dataTransfer.files);\n    if (files.length === 0) return;\n\n    const file = files[0]; // æœ€åˆã®ãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿å‡¦ç†\n\n    // ãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ã‚¤ãƒ—ã‚’ãƒã‚§ãƒƒã‚¯\n    const fileType = this.detectFileType(file.name);\n    if (!fileType) {\n      this.addOutput('âŒ ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ãªã„ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã§ã™', 'error');\n      return;\n    }\n\n    // ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠå‡¦ç†ã¨åŒã˜æµã‚Œ\n    this.handleFileSelection({ target: { files: [file] } });\n  }\n\n  /**\n   * ãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ã‚¤ãƒ—åˆ¤å®š\n   */\n  detectFileType(fileName) {\n    const ext = fileName.toLowerCase().split('.').pop();\n\n    if (['glb', 'gltf'].includes(ext)) return '3d';\n    if (['jpg', 'jpeg', 'png', 'webp'].includes(ext)) return 'image';\n    if (['mp4', 'mov', 'webm'].includes(ext)) return 'video';\n\n    return null;\n  }\n\n  /**\n   * Importã‚³ãƒãƒ³ãƒ‰å‡¦ç†\n   */\n  async handleImportCommand(command) {\n    if (!this.selectedFile) {\n      throw new Error('ãƒ•ã‚¡ã‚¤ãƒ«ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“');\n    }\n\n    try {\n      // ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‹ã‚‰ä½ç½®æƒ…å ±ã‚’è§£æ\n      const position = this.sceneManager ? this.sceneManager.parsePosition(command) : { x: 0, y: 5, z: -10 };\n\n      let result;\n\n      switch (this.selectedFile.type) {\n        case '3d':\n          // 3Dãƒ¢ãƒ‡ãƒ«ã‚’èª­ã¿è¾¼ã¿\n          if (this.sceneManager) {\n            result = await this.sceneManager.load3DModel(this.selectedFile.url, {\n              position: position,\n              // scale: è‡ªå‹•èª¿æ•´ã«ä»»ã›ã‚‹\n            });\n          } else {\n            throw new Error('SceneManager ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“');\n          }\n          break;\n\n        case 'image':\n          // ç”»åƒã‚’ãƒ†ã‚¯ã‚¹ãƒãƒ£ãƒ—ãƒ¬ãƒ¼ãƒ³ã¨ã—ã¦é…ç½®\n          if (this.sceneManager) {\n            result = await this.sceneManager.loadImageFile(this.selectedFile.url, {\n              position: position,\n              fileName: this.selectedFile.name\n            });\n          } else {\n            throw new Error('SceneManager ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“');\n          }\n          break;\n\n        case 'video':\n          // å‹•ç”»ã‚’ãƒ“ãƒ‡ã‚ªãƒ†ã‚¯ã‚¹ãƒãƒ£ã¨ã—ã¦é…ç½®\n          if (this.sceneManager) {\n            result = await this.sceneManager.loadVideoFile(this.selectedFile.url, {\n              position: position,\n              fileName: this.selectedFile.name\n            });\n          } else {\n            throw new Error('SceneManager ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“');\n          }\n          break;\n\n        default:\n          throw new Error(`ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ãªã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ã‚¤ãƒ—: ${this.selectedFile.type}`);\n      }\n\n      // ãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±ã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—\n      const processedFileName = this.selectedFile?.name;\n      const importedType = this.selectedFile?.type;\n      const importedUrl = this.selectedFile?.url;\n\n      if (importedType !== 'video' && importedUrl) {\n        URL.revokeObjectURL(importedUrl);\n      }\n\n      this.selectedFile = null;\n      this.selectMode('generate', false);\n\n      return {\n        success: true,\n        message: `${processedFileName || 'ãƒ•ã‚¡ã‚¤ãƒ«'} ã‚’ ${position.x}, ${position.y}, ${position.z} ã«é…ç½®ã—ã¾ã—ãŸ`,\n        objectId: result.objectId\n      };\n\n    } catch (error) {\n      // ã‚¨ãƒ©ãƒ¼æ™‚ã‚‚ãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±ã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—\n      if (this.selectedFile?.url) {\n        URL.revokeObjectURL(this.selectedFile.url);\n      }\n      this.selectedFile = null;\n      this.selectMode('generate', false);\n      throw error;\n    }\n  }\n\n  /**\n   * å‰Šé™¤ãƒ¢ãƒ¼ãƒ‰ãŒé¸æŠã•ã‚ŒãŸæ™‚ã®å‡¦ç†\n   */\n  handleDeleteModeSelection() {\n    // SceneManagerã‹ã‚‰é¸æŠã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å–å¾—\n    const selectedObject = this.sceneManager?.selectedObject;\n    \n    if (selectedObject) {\n      // é¸æŠã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒã‚ã‚‹å ´åˆï¼šå‰Šé™¤ã‚³ãƒãƒ³ãƒ‰ã‚’ãƒãƒ£ãƒƒãƒˆæ¬„ã«å…¥åŠ›\n      const objectName = selectedObject.userData?.originalPrompt || selectedObject.name || 'é¸æŠã—ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ';\n      this.input.value = `${objectName}ã‚’å‰Šé™¤ â`;\n      this.input.focus();\n      \n      // ã‚«ãƒ¼ã‚½ãƒ«ã‚’æ–‡æœ«ã«ç§»å‹•ï¼ˆé¸æŠçŠ¶æ…‹ã‚’è§£é™¤ï¼‰\n      this.input.setSelectionRange(this.input.value.length, this.input.value.length);\n      \n      this.addOutput(`ğŸ¯ å‰Šé™¤å¯¾è±¡: ${objectName}`, 'system');\n    } else {\n      // é¸æŠã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒãªã„å ´åˆï¼š2025å¹´ãƒˆãƒ¬ãƒ³ãƒ‰ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã§æ³¨æ„å–šèµ·\n      this.input.value = '';\n      this.addOutput('â— å‰Šé™¤ã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’é¸æŠå¾Œã€å‰Šé™¤ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„', 'system');\n      \n      // 2025å¹´ãƒˆãƒ¬ãƒ³ãƒ‰ï¼šContext-Aware Attention Animation\n      this.triggerAttentionAnimation('delete');\n      \n      // DELETEãƒ¢ãƒ¼ãƒ‰ã‚’ç¶­æŒï¼ˆgenerateãƒ¢ãƒ¼ãƒ‰ã«æˆ»ã•ãªã„ï¼‰\n    }\n  }\n\n  /**\n   * ä¿®æ­£ãƒ¢ãƒ¼ãƒ‰ãŒé¸æŠã•ã‚ŒãŸæ™‚ã®å‡¦ç†\n   */\n  handleModifyModeSelection() {\n    // SceneManagerã‹ã‚‰é¸æŠã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å–å¾—\n    const selectedObject = this.sceneManager?.selectedObject;\n    \n    if (selectedObject) {\n      // é¸æŠã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒã‚ã‚‹å ´åˆï¼šä¿®æ­£ã‚³ãƒãƒ³ãƒ‰ã‚’ãƒãƒ£ãƒƒãƒˆæ¬„ã«å…¥åŠ›\n      const objectName = selectedObject.userData?.originalPrompt || selectedObject.name || 'é¸æŠã—ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ';\n      this.input.value = `${objectName}ã‚’`;\n      this.input.focus();\n      \n      // ã‚«ãƒ¼ã‚½ãƒ«ã‚’æ–‡æœ«ã«ç§»å‹•ï¼ˆé¸æŠçŠ¶æ…‹ã‚’è§£é™¤ï¼‰\n      this.input.setSelectionRange(this.input.value.length, this.input.value.length);\n      \n      this.addOutput(`ğŸ¯ ä¿®æ­£å¯¾è±¡: ${objectName}`, 'system');\n    } else {\n      // é¸æŠã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒãªã„å ´åˆï¼š2025å¹´ãƒˆãƒ¬ãƒ³ãƒ‰ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã§æ³¨æ„å–šèµ·\n      this.input.value = '';\n      this.addOutput('â— ä¿®æ­£ã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’é¸æŠå¾Œã€ä¿®æ­£ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„', 'system');\n      \n      // 2025å¹´ãƒˆãƒ¬ãƒ³ãƒ‰ï¼šContext-Aware Attention Animation\n      this.triggerAttentionAnimation('modify');\n      \n      // Modifyãƒ¢ãƒ¼ãƒ‰ã‚’ç¶­æŒï¼ˆgenerateãƒ¢ãƒ¼ãƒ‰ã«æˆ»ã•ãªã„ï¼‰\n    }\n  }\n\n  /**\n   * 2025å¹´ãƒˆãƒ¬ãƒ³ãƒ‰ï¼šContext-Aware Attention Animation\n   * ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæœªé¸æŠæ™‚ã®æ³¨æ„å–šèµ·ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³\n   */\n  triggerAttentionAnimation(mode) {\n    const chatOutput = this.chatOutput;\n    const inputField = this.input;\n    \n    // 2025å¹´ãƒˆãƒ¬ãƒ³ãƒ‰1: Micro-Shake Effectï¼ˆå¾®ç´°ãªéœ‡ãˆï¼‰\n    this.addMicroShakeEffect(chatOutput);\n    \n    // 2025å¹´ãƒˆãƒ¬ãƒ³ãƒ‰2: Context-Aware Glowï¼ˆçŠ¶æ³èªè­˜ã‚°ãƒ­ãƒ¼ï¼‰\n    this.addContextGlow(inputField, mode);\n    \n    // 2025å¹´ãƒˆãƒ¬ãƒ³ãƒ‰3: Emotional Pulseï¼ˆæ„Ÿæƒ…çš„ãƒ‘ãƒ«ã‚¹ï¼‰\n    this.addEmotionalPulse(chatOutput, mode);\n    \n    // 2025å¹´ãƒˆãƒ¬ãƒ³ãƒ‰4: 3D Depth Shadowï¼ˆç«‹ä½“çš„å½±åŠ¹æœï¼‰\n    this.add3DDepthEffect(chatOutput);\n  }\n\n  /**\n   * 2025å¹´ãƒˆãƒ¬ãƒ³ãƒ‰ï¼šMicro-Shake Effect\n   */\n  addMicroShakeEffect(element) {\n    element.style.animation = 'microShake2025 0.5s ease-in-out';\n    \n    // CSSã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å‹•çš„è¿½åŠ \n    this.ensureMicroShakeAnimation();\n    \n    // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å¾Œã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—\n    setTimeout(() => {\n      element.style.animation = '';\n    }, 500);\n  }\n\n  /**\n   * 2025å¹´ãƒˆãƒ¬ãƒ³ãƒ‰ï¼šContext-Aware Glow\n   */\n  addContextGlow(element, mode) {\n    const glowColor = mode === 'delete' ? 'rgba(239, 68, 68, 0.4)' : 'rgba(99, 102, 241, 0.4)';\n    \n    element.style.transition = 'all 0.3s ease';\n    element.style.boxShadow = `0 0 20px ${glowColor}, 0 0 40px ${glowColor}`;\n    \n    // 3ç§’å¾Œã«ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆ\n    setTimeout(() => {\n      element.style.boxShadow = '';\n    }, 3000);\n  }\n\n  /**\n   * 2025å¹´ãƒˆãƒ¬ãƒ³ãƒ‰ï¼šEmotional Pulse\n   */\n  addEmotionalPulse(element, mode) {\n    const pulseColor = mode === 'delete' ? '#ef4444' : '#6366f1';\n    \n    element.style.borderLeft = `4px solid ${pulseColor}`;\n    element.style.animation = 'emotionalPulse2025 2s ease-in-out infinite';\n    \n    // CSSã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å‹•çš„è¿½åŠ \n    this.ensureEmotionalPulseAnimation();\n    \n    // 6ç§’å¾Œã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³åœæ­¢\n    setTimeout(() => {\n      element.style.animation = '';\n      element.style.borderLeft = '';\n    }, 6000);\n  }\n\n  /**\n   * 2025å¹´ãƒˆãƒ¬ãƒ³ãƒ‰ï¼š3D Depth Effect\n   */\n  add3DDepthEffect(element) {\n    element.style.transform = 'translateZ(8px) rotateX(1deg)';\n    element.style.transition = 'transform 0.3s ease';\n    \n    // 2ç§’å¾Œã«å…ƒã«æˆ»ã™\n    setTimeout(() => {\n      element.style.transform = '';\n    }, 2000);\n  }\n\n  /**\n   * Micro-Shake CSSã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç¢ºä¿\n   */\n  ensureMicroShakeAnimation() {\n    if (document.getElementById('micro-shake-2025')) return;\n    \n    const style = document.createElement('style');\n    style.id = 'micro-shake-2025';\n    style.textContent = `\n      @keyframes microShake2025 {\n        0%, 100% { transform: translateX(0); }\n        10% { transform: translateX(-2px) rotateZ(-0.5deg); }\n        20% { transform: translateX(2px) rotateZ(0.5deg); }\n        30% { transform: translateX(-1px) rotateZ(-0.3deg); }\n        40% { transform: translateX(1px) rotateZ(0.3deg); }\n        50% { transform: translateX(-0.5px) rotateZ(-0.1deg); }\n        60% { transform: translateX(0.5px) rotateZ(0.1deg); }\n        70% { transform: translateX(0); }\n      }\n    `;\n    document.head.appendChild(style);\n  }\n\n  /**\n   * Emotional Pulse CSSã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç¢ºä¿\n   */\n  ensureEmotionalPulseAnimation() {\n    if (document.getElementById('emotional-pulse-2025')) return;\n    \n    const style = document.createElement('style');\n    style.id = 'emotional-pulse-2025';\n    style.textContent = `\n      @keyframes emotionalPulse2025 {\n        0% { \n          border-left-width: 4px;\n          filter: brightness(1);\n        }\n        50% { \n          border-left-width: 8px;\n          filter: brightness(1.2) saturate(1.1);\n        }\n        100% { \n          border-left-width: 4px;\n          filter: brightness(1);\n        }\n      }\n    `;\n    document.head.appendChild(style);\n  }\n\n  /**\n   * ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆæ™‚ã®å…¥åŠ›æ¬„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä¸Šæ›¸ãæ©Ÿèƒ½\n   * ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£å‘ä¸Šï¼šä»–ãƒ¢ãƒ¼ãƒ‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ–°ãƒ¢ãƒ¼ãƒ‰ã®åˆæœŸçŠ¶æ…‹ã«ã‚¯ãƒªã‚¢\n   */\n  clearInputOnModeSwitch(newMode) {\n    // ç¾åœ¨ã®å…¥åŠ›æ¬„ã«å†…å®¹ãŒã‚ã‚‹å ´åˆã®ã¿å‡¦ç†\n    if (this.input.value.trim()) {\n      // ä»¥å‰ã®ãƒ¢ãƒ¼ãƒ‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‹ã©ã†ã‹ã‚’åˆ¤å®š\n      const isPreviousModeMessage = this.isPreviousModeMessage(this.input.value, newMode);\n      \n      if (isPreviousModeMessage) {\n        // ä»¥å‰ã®ãƒ¢ãƒ¼ãƒ‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å ´åˆã€æ–°ãƒ¢ãƒ¼ãƒ‰ã®åˆæœŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ç½®ãæ›ãˆ\n        this.input.value = '';\n        this.addOutput(`ğŸ’« ${this.getModeDisplayName(newMode)}ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆã¾ã—ãŸ`, 'system');\n      }\n    }\n  }\n\n  /**\n   * å…¥åŠ›å†…å®¹ãŒä»¥å‰ã®ãƒ¢ãƒ¼ãƒ‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‹ã©ã†ã‹ã‚’åˆ¤å®š\n   */\n  isPreviousModeMessage(inputValue, currentMode) {\n    // Delete/Modifyãƒ¢ãƒ¼ãƒ‰ã®ç‰¹å¾´çš„ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ¤œå‡º\n    const deletePatterns = [\n      /.*ã‚’å‰Šé™¤$/,\n      /å‰Šé™¤$/\n    ];\n    \n    const modifyPatterns = [\n      /.*ã‚’$/,\n      /.*ã‚’å¤‰æ›´/,\n      /.*ã‚’ãƒ”ãƒ³ã‚¯/,\n      /.*ã‚’å¤§ãã/,\n      /.*ã‚’å°ã•ã/,\n      /.*ã‚’ç§»å‹•/,\n      /å›è»¢/,\n      /åè»¢/,\n      /ãƒŸãƒ©ãƒ¼/,\n      /å‚¾ã‘/,\n      /å‘ãã‚’å¤‰ãˆ/,\n      /.*ã‚’.*è‰²/,\n      /.*ã‚’.*ã‚µã‚¤ã‚º/\n    ];\n    \n    const importPatterns = [\n      /ãƒ•ã‚¡ã‚¤ãƒ«/,\n      /ç”»åƒ/,\n      /ã‚¤ãƒ³ãƒãƒ¼ãƒˆ/\n    ];\n\n    // ç¾åœ¨ã®ãƒ¢ãƒ¼ãƒ‰ã¨ç•°ãªã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ãƒãƒƒãƒã™ã‚‹å ´åˆã¯ä¸Šæ›¸ãå¯¾è±¡\n    switch (currentMode) {\n      case 'delete':\n        return modifyPatterns.some(pattern => pattern.test(inputValue)) ||\n               importPatterns.some(pattern => pattern.test(inputValue));\n               \n      case 'modify':\n        return deletePatterns.some(pattern => pattern.test(inputValue)) ||\n               importPatterns.some(pattern => pattern.test(inputValue));\n               \n      case 'import':\n        return deletePatterns.some(pattern => pattern.test(inputValue)) ||\n               modifyPatterns.some(pattern => pattern.test(inputValue));\n               \n      case 'generate':\n        return deletePatterns.some(pattern => pattern.test(inputValue)) ||\n               modifyPatterns.some(pattern => pattern.test(inputValue)) ||\n               importPatterns.some(pattern => pattern.test(inputValue));\n               \n      default:\n        return false;\n    }\n  }\n\n  /**\n   * ãƒ¢ãƒ¼ãƒ‰è¡¨ç¤ºåã‚’å–å¾—\n   */\n  getModeDisplayName(mode) {\n    const modeNames = {\n      'generate': 'ç”Ÿæˆ',\n      'import': 'ã‚¤ãƒ³ãƒãƒ¼ãƒˆ',\n      'modify': 'ä¿®æ­£',\n      'delete': 'å‰Šé™¤'\n    };\n    return modeNames[mode] || mode;\n  }\n\n  /**\n   * å¸¸æ™‚è¡¨ç¤ºãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒãƒ§ã‚³ã‚¢ã‚¤ã‚³ãƒ³ã‚’ä½œæˆ\n   */\n  createFloatingChocolateIcon() {\n    // æ—¢å­˜ã®ã‚¢ã‚¤ã‚³ãƒ³ãŒã‚ã‚Œã°å‰Šé™¤\n    if (this.floatingChocolateIcon) {\n      this.floatingChocolateIcon.remove();\n    }\n\n    this.floatingChocolateIcon = document.createElement('div');\n    this.floatingChocolateIcon.innerHTML = 'ğŸ«';\n    this.floatingChocolateIcon.title = 'ChocoDrop ã‚’é–‹ã (@ã‚­ãƒ¼ã§ã‚‚é–‹ã‘ã¾ã™)';\n    this.floatingChocolateIcon.style.cssText = `\n      position: fixed;\n      bottom: 20px;\n      right: 20px;\n      width: 48px;\n      height: 48px;\n      border-radius: 50%;\n      background: rgba(99, 102, 241, 0.15);\n      backdrop-filter: blur(16px);\n      -webkit-backdrop-filter: blur(16px);\n      border: 1px solid rgba(255, 255, 255, 0.2);\n      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.2), 0 2px 6px rgba(0, 0, 0, 0.05);\n      opacity: 0.8;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-size: 20px;\n      cursor: pointer;\n      z-index: 999;\n      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n      transform: scale(1);\n      filter: none;\n    `;\n\n    // ãƒ›ãƒãƒ¼åŠ¹æœ\n    this.floatingChocolateIcon.addEventListener('mouseover', () => {\n      this.floatingChocolateIcon.style.transform = 'scale(1.1) translateY(-2px)';\n      this.floatingChocolateIcon.style.boxShadow = '0 6px 16px rgba(99, 102, 241, 0.3), 0 3px 8px rgba(0, 0, 0, 0.1)';\n      this.floatingChocolateIcon.style.opacity = '1';\n      this.floatingChocolateIcon.style.filter = 'none';\n    });\n\n    this.floatingChocolateIcon.addEventListener('mouseout', () => {\n      this.floatingChocolateIcon.style.transform = 'scale(1) translateY(0)';\n      this.floatingChocolateIcon.style.boxShadow = '0 4px 12px rgba(99, 102, 241, 0.2), 0 2px 6px rgba(0, 0, 0, 0.05)';\n      this.floatingChocolateIcon.style.opacity = '0.8';\n      this.floatingChocolateIcon.style.filter = 'none';\n    });\n\n    // ã‚¯ãƒªãƒƒã‚¯ã§ ChocoDrop ã‚’é–‹ã\n    this.floatingChocolateIcon.addEventListener('click', () => {\n      if (this.isVisible) {\n        this.hide();\n      } else {\n        this.show();\n      }\n    });\n\n    // å³ã‚¯ãƒªãƒƒã‚¯ãƒ¡ãƒ‹ãƒ¥ãƒ¼\n    this.floatingChocolateIcon.addEventListener('contextmenu', (e) => {\n      e.preventDefault();\n      this.showFloatingIconContextMenu(e);\n    });\n\n    // DOM ã«è¿½åŠ \n    document.body.appendChild(this.floatingChocolateIcon);\n  }\n\n  /**\n   * ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¢ã‚¤ã‚³ãƒ³ã®å³ã‚¯ãƒªãƒƒã‚¯ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¡¨ç¤º\n   */\n  showFloatingIconContextMenu(event) {\n    // æ—¢å­˜ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒã‚ã‚Œã°å‰Šé™¤\n    const existingMenu = document.querySelector('.floating-icon-context-menu');\n    if (existingMenu) {\n      existingMenu.remove();\n    }\n\n    // ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ä½œæˆ\n    const menu = document.createElement('div');\n    menu.className = 'floating-icon-context-menu';\n    menu.style.cssText = `\n      position: fixed;\n      top: ${event.clientY}px;\n      left: ${event.clientX}px;\n      background: ${this.isDarkMode ? 'rgba(17, 24, 39, 0.85)' : 'rgba(255, 255, 255, 0.85)'};\n      backdrop-filter: blur(20px);\n      -webkit-backdrop-filter: blur(20px);\n      border: 1px solid ${this.isDarkMode ? 'rgba(129, 140, 248, 0.3)' : 'rgba(99, 102, 241, 0.2)'};\n      border-radius: 12px;\n      box-shadow: 0 8px 24px rgba(99, 102, 241, 0.2), 0 4px 12px rgba(0, 0, 0, 0.1);\n      padding: 8px 0;\n      min-width: 160px;\n      z-index: 2000;\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n      font-size: 14px;\n      color: ${this.isWabiSabiMode ? '#F5F5F5' : (this.isDarkMode ? '#ffffff' : '#1f2937')};\n    `;\n\n    // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚¢ã‚¤ãƒ†ãƒ 1: ãƒ•ã‚©ãƒ¼ãƒ ã‚’é–‹ã\n    const openFormItem = document.createElement('div');\n    openFormItem.innerHTML = 'ğŸ“„ ãƒ•ã‚©ãƒ¼ãƒ ã‚’é–‹ã';\n    openFormItem.style.cssText = `\n      padding: 8px 16px;\n      cursor: pointer;\n      transition: all 0.2s ease;\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      color: #6366f1;\n      text-shadow: 0 2px 4px rgba(99, 102, 241, 0.3);\n    `;\n\n    openFormItem.addEventListener('mouseover', () => {\n      openFormItem.style.background = this.isDarkMode ? 'rgba(99, 102, 241, 0.15)' : 'rgba(99, 102, 241, 0.1)';\n      openFormItem.style.textShadow = '0 2px 6px rgba(99, 102, 241, 0.5)';\n    });\n\n    openFormItem.addEventListener('mouseout', () => {\n      openFormItem.style.background = 'transparent';\n      openFormItem.style.textShadow = '0 2px 4px rgba(99, 102, 241, 0.3)';\n    });\n\n    openFormItem.addEventListener('click', () => {\n      menu.remove();\n      if (this.isVisible) {\n        this.hide();\n      } else {\n        this.show();\n      }\n    });\n\n    // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚¢ã‚¤ãƒ†ãƒ 2: ã‚¢ã‚¤ã‚³ãƒ³ã‚’éè¡¨ç¤º\n    const hideIconItem = document.createElement('div');\n    hideIconItem.innerHTML = 'âœ• ã‚¢ã‚¤ã‚³ãƒ³ã‚’éè¡¨ç¤º';\n    hideIconItem.style.cssText = `\n      padding: 8px 16px;\n      cursor: pointer;\n      transition: all 0.2s ease;\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      color: #6366f1;\n      text-shadow: 0 2px 4px rgba(99, 102, 241, 0.3);\n    `;\n\n    hideIconItem.addEventListener('mouseover', () => {\n      hideIconItem.style.background = this.isDarkMode ? 'rgba(99, 102, 241, 0.15)' : 'rgba(99, 102, 241, 0.1)';\n      hideIconItem.style.textShadow = '0 2px 6px rgba(99, 102, 241, 0.5)';\n    });\n\n    hideIconItem.addEventListener('mouseout', () => {\n      hideIconItem.style.background = 'transparent';\n      hideIconItem.style.textShadow = '0 2px 4px rgba(99, 102, 241, 0.3)';\n    });\n\n    hideIconItem.addEventListener('click', () => {\n      menu.remove();\n      this.hideFloatingIcon();\n    });\n\n    // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«è¿½åŠ \n    menu.appendChild(openFormItem);\n    menu.appendChild(hideIconItem);\n\n    // DOM ã«è¿½åŠ \n    document.body.appendChild(menu);\n\n    // ç”»é¢å¤–ã«å‡ºãªã„ã‚ˆã†ã«èª¿æ•´\n    const rect = menu.getBoundingClientRect();\n    if (rect.right > window.innerWidth) {\n      menu.style.left = `${event.clientX - rect.width}px`;\n    }\n    if (rect.bottom > window.innerHeight) {\n      menu.style.top = `${event.clientY - rect.height}px`;\n    }\n\n    // å¤–éƒ¨ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹\n    const closeMenu = (e) => {\n      if (!menu.contains(e.target)) {\n        menu.remove();\n        document.removeEventListener('click', closeMenu);\n      }\n    };\n\n    setTimeout(() => {\n      document.addEventListener('click', closeMenu);\n    }, 10);\n  }\n\n  /**\n   * ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¢ã‚¤ã‚³ãƒ³ã‚’éè¡¨ç¤ºã«ã™ã‚‹\n   */\n  hideFloatingIcon() {\n    if (this.floatingChocolateIcon) {\n      this.floatingChocolateIcon.style.display = 'none';\n    }\n  }\n\n  /**\n   * ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¢ã‚¤ã‚³ãƒ³ã‚’è¡¨ç¤ºã™ã‚‹\n   */\n  showFloatingIcon() {\n    if (this.floatingChocolateIcon) {\n      this.floatingChocolateIcon.style.display = 'flex';\n    }\n  }\n\n  dispose() {\n    // ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠé–¢é€£ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—\n    if (this.fileInput && this.fileInput.parentNode) {\n      this.fileInput.parentNode.removeChild(this.fileInput);\n    }\n    if (this.selectedFile && this.selectedFile.url) {\n      URL.revokeObjectURL(this.selectedFile.url);\n    }\n\n    // ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒãƒ§ã‚³ã‚¢ã‚¤ã‚³ãƒ³ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—\n    if (this.floatingChocolateIcon && this.floatingChocolateIcon.parentNode) {\n      this.floatingChocolateIcon.parentNode.removeChild(this.floatingChocolateIcon);\n    }\n\n    if (this.container && this.container.parentElement) {\n      this.container.parentElement.removeChild(this.container);\n    }\n  }\n\n  showOverlayTextarea() {\n    if (this.overlayTextarea) return;\n\n    this.isExpanded = true;\n    \n    // ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã‚’ä½œæˆ\n    this.overlayTextarea = document.createElement('textarea');\n    this.overlayTextarea.value = this.input.value;\n    this.overlayTextarea.placeholder = this.input.placeholder;\n    \n    // ãƒ•ã‚©ãƒ¼ãƒ ã®ä½ç½®ã¨ã‚µã‚¤ã‚ºã‚’å–å¾—\n    const containerRect = this.container.getBoundingClientRect();\n    \n    // ç”»é¢å¢ƒç•Œã‚’è€ƒæ…®ã—ãŸä½ç½®èª¿æ•´\n    const overlayHeight = 300;\n    const padding = 20;\n    \n    let top = containerRect.top + 60;\n    let left = containerRect.left;\n    let width = containerRect.width;\n    \n    // å³ç«¯ãŒã¯ã¿å‡ºã‚‹å ´åˆ\n    if (left + width > window.innerWidth - padding) {\n      left = window.innerWidth - width - padding;\n    }\n    \n    // å·¦ç«¯ãŒã¯ã¿å‡ºã‚‹å ´åˆ\n    if (left < padding) {\n      left = padding;\n      width = Math.min(width, window.innerWidth - 2 * padding);\n    }\n    \n    // ä¸‹ç«¯ãŒã¯ã¿å‡ºã‚‹å ´åˆ\n    if (top + overlayHeight > window.innerHeight - padding) {\n      top = Math.max(padding, window.innerHeight - overlayHeight - padding);\n    }\n\n    const overlayBackground = this.isWabiSabiMode\n      ? 'linear-gradient(135deg, rgba(97, 97, 97, 0.7), rgba(66, 66, 66, 0.6))'\n      : (this.isDarkMode\n        ? 'linear-gradient(135deg, rgba(30, 27, 75, 0.4), rgba(15, 23, 42, 0.5))'\n        : 'linear-gradient(135deg, rgba(255, 255, 255, 0.3), rgba(255, 255, 255, 0.2))');\n\n    const overlayBorder = this.isWabiSabiMode\n      ? '1px solid rgba(93, 64, 55, 0.5)'\n      : (this.isDarkMode\n        ? '1px solid rgba(99, 102, 241, 0.25)'\n        : '1px solid rgba(255, 255, 255, 0.5)');\n\n    const overlayInnerShadow = this.isWabiSabiMode\n      ? '0 4px 16px rgba(66, 66, 66, 0.3), inset 0 1px 0 rgba(189, 189, 189, 0.2)'\n      : (this.isDarkMode\n        ? '0 4px 16px rgba(15, 23, 42, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.08)'\n        : '0 4px 16px rgba(0, 0, 0, 0.08), inset 0 1px 0 rgba(255, 255, 255, 0.4)');\n\n    const overlayTextColor = this.isWabiSabiMode ? '#F5F5F5' : (this.isDarkMode ? '#ffffff' : '#1f2937');\n\n    // ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã®ã‚¹ã‚¿ã‚¤ãƒ«è¨­å®š\n    this.overlayTextarea.style.cssText = `\n      position: fixed;\n      top: ${top}px;\n      left: ${left}px;\n      width: ${width}px;\n      height: ${overlayHeight}px;\n      box-sizing: border-box;\n      background: ${overlayBackground};\n      backdrop-filter: blur(24px) saturate(180%);\n      border: ${overlayBorder};\n      box-shadow: ${overlayInnerShadow};\n      border-radius: 16px;\n      color: ${overlayTextColor};\n      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n      font-size: 14px;\n      line-height: 1.5;\n      padding: 20px;\n      resize: none;\n      outline: none;\n      z-index: 10000;\n      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);\n      opacity: 0;\n      transition: opacity 0.2s ease-out;\n    `;\n    \n    // ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«è¿½åŠ \n    document.body.appendChild(this.overlayTextarea);\n    \n    // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹\n    requestAnimationFrame(() => {\n      this.overlayTextarea.style.opacity = '1';\n    });\n    \n    // ãƒ•ã‚©ãƒ¼ã‚«ã‚¹è¨­å®š\n    this.overlayTextarea.focus();\n    \n    // å…¥åŠ›åŒæœŸ\n    this.overlayTextarea.addEventListener('input', (e) => {\n      this.input.value = e.target.value;\n    });\n    \n    // Escapeã‚­ãƒ¼ã§é–‰ã˜ã‚‹\n    this.overlayTextarea.addEventListener('keydown', (e) => {\n      if (e.key === 'Escape') {\n        this.hideOverlayTextarea();\n      }\n    });\n    \n    // å¤–å´ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹\n    this.overlayTextarea.addEventListener('blur', () => {\n      setTimeout(() => this.hideOverlayTextarea(), 100);\n    });\n  }\n  \n  hideOverlayTextarea() {\n    if (!this.overlayTextarea) return;\n    \n    this.isExpanded = false;\n    \n    // ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³\n    this.overlayTextarea.style.opacity = '0';\n    \n    setTimeout(() => {\n      if (this.overlayTextarea) {\n        document.body.removeChild(this.overlayTextarea);\n        this.overlayTextarea = null;\n      }\n    }, 200);\n  }\n  \n  hideOverlayTextarea() {\n    if (!this.overlayTextarea) return;\n    \n    this.isExpanded = false;\n    \n    // ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³\n    this.overlayTextarea.style.opacity = '0';\n    \n    setTimeout(() => {\n      if (this.overlayTextarea) {\n        document.body.removeChild(this.overlayTextarea);\n        this.overlayTextarea = null;\n      }\n    }, 200);\n  }\n}\n","const IMAGE_SERVICE_STORAGE_KEY = 'chocodrop-service-image';\nconst VIDEO_SERVICE_STORAGE_KEY = 'chocodrop-service-video';\nconst KEYWORD_HIGHLIGHT_COLOR = '#ff6ad5';\n\n/**\n * Command UI - Web interface for ChocoDrop System\n * Real-time natural language command interface for 3D scenes\n */\nexport class CommandUI {\n  constructor(options = {}) {\n    this.sceneManager = options.sceneManager || null;\n    this.client = options.client || null;\n    this.onControlsToggle = options.onControlsToggle || (() => {});\n    \n    this.isVisible = false;\n    this.container = null;\n    this.input = null;\n    this.output = null;\n    this.currentMode = 'generate';\n\n    // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€²æ—ç®¡ç†\n    this.activeConnections = new Map();\n    this.currentTaskId = null;\n    \n    // è¨­å®š\n    this.config = {\n      activationKey: options.activationKey || '@',\n      position: options.position || 'bottom-right',\n      width: options.width || 450,\n      maxHeight: options.maxHeight || 600,\n      theme: options.theme || 'dark',\n      showExamples: options.showExamples !== false,\n      autoScroll: options.autoScroll !== false,\n      enableDebugLogging: options.enableDebugLogging === true,\n      ...options.config\n    };\n\n    this.availableImageServices = [];\n    this.availableVideoServices = [];\n    this.selectedImageService = null;\n    this.selectedVideoService = null;\n    this.highlightOverlay = null;\n    this.inputDefaultStyles = null;\n    this.imageServiceSelect = null;\n    this.videoServiceSelect = null;\n    this.serviceSelectorContainer = null;\n    this.serviceSelectorStatus = null;\n    this.serviceSelectorContent = null;\n    this.serviceSelectorRetryButton = null;\n    this.serviceSelectorSaveButton = null;\n    this.serviceSelectorCancelButton = null;\n    this.serviceModalOverlay = null;\n    this.serviceModal = null;\n    this.servicesLoading = false;\n    this.isExpanded = false;\n    this.overlayTextarea = null;\n    this.pendingImageService = null;\n    this.pendingVideoService = null;\n    this.feedbackAutoClearTimer = null;\n    this.currentFeedback = null;\n\n    try {\n      const storedImage = localStorage.getItem(IMAGE_SERVICE_STORAGE_KEY);\n      const storedVideo = localStorage.getItem(VIDEO_SERVICE_STORAGE_KEY);\n      console.log('ğŸ” Debug localStorage read:', { storedImage, storedVideo, IMAGE_SERVICE_STORAGE_KEY, VIDEO_SERVICE_STORAGE_KEY });\n      if (storedImage) {\n        this.selectedImageService = storedImage;\n        console.log('âœ… Set selectedImageService:', this.selectedImageService);\n      }\n      if (storedVideo) {\n        this.selectedVideoService = storedVideo;\n        console.log('âœ… Set selectedVideoService:', this.selectedVideoService);\n      }\n      console.log('ğŸ” Final values:', { selectedImageService: this.selectedImageService, selectedVideoService: this.selectedVideoService });\n    } catch (error) {\n      console.warn('âš ï¸ Failed to load stored service selections:', error);\n    }\n\n    this.pendingImageService = this.selectedImageService;\n    this.pendingVideoService = this.selectedVideoService;\n\n    this.applyServiceSelectionToSceneManager();\n    console.log('ğŸ” After applyServiceSelectionToSceneManager - UI:', { selectedImageService: this.selectedImageService, selectedVideoService: this.selectedVideoService });\n    console.log('ğŸ” After applyServiceSelectionToSceneManager - SceneManager:', { selectedImageService: this.sceneManager?.selectedImageService, selectedVideoService: this.sceneManager?.selectedVideoService });\n\n    // ãƒ†ãƒ¼ãƒãƒ¢ãƒ¼ãƒ‰çŠ¶æ…‹ç®¡ç† (light, dark, wabisabi)\n    this.currentTheme = localStorage.getItem('live-command-theme') || 'light';\n    this.isDarkMode = this.currentTheme === 'dark';\n    this.isWabiSabiMode = this.currentTheme === 'wabisabi';\n    \n    // Undo/Redo ã‚·ã‚¹ãƒ†ãƒ \n    this.commandHistory = [];\n    this.currentHistoryIndex = -1;\n    this.maxHistorySize = 50; // æœ€å¤§ã‚³ãƒãƒ³ãƒ‰ä¿å­˜æ•°\n    \n    this.initUI();\n    this.bindEvents();\n\n    if (!this.client && this.sceneManager && this.sceneManager.client) {\n      this.client = this.sceneManager.client;\n    }\n\n    this.createServiceModal();\n    this.createFloatingChocolateIcon();\n\n    // DOMèª­ã¿è¾¼ã¿å®Œäº†å¾Œã«ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ç¢ºå®Ÿã«é©ç”¨\n    document.addEventListener('DOMContentLoaded', () => {\n      this.refreshStyles();\n    });\n\n    this.logDebug('ğŸ® CommandUI initialized');\n\n    if (!this.selectedImageService || !this.selectedVideoService) {\n      this.openServiceModal(true);\n    }\n  }\n\n  logDebug(...args) {\n    if (!this.config.enableDebugLogging) {\n      return;\n    }\n    console.log(...args);\n  }\n\n  /**\n   * UIè¦ç´ ã®ä½œæˆã¨é…ç½®\n   */\n  initUI() {\n    // ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ\n    this.container = document.createElement('div');\n    this.container.id = 'live-command-ui';\n    this.container.style.cssText = this.getContainerStyles();\n\n    // 2025å¹´ãƒˆãƒ¬ãƒ³ãƒ‰ï¼šProgressive Disclosureï¼ˆãƒ›ãƒãƒ¼æ™‚ã®ã¿ãƒ–ãƒ©ãƒ³ãƒ‰è¡¨ç¤ºï¼‰\n    const brandIndicator = document.createElement('div');\n    brandIndicator.className = 'progressive-brand-indicator';\n    brandIndicator.style.cssText = `\n      position: absolute;\n      top: -8px;\n      right: 8px;\n      width: 8px;\n      height: 8px;\n      background: linear-gradient(135deg, ${this.isWabiSabiMode ? '#8BC34A, #689F38' : '#6366f1, #8b5cf6'});\n      border-radius: 50%;\n      opacity: 0.7;\n      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n      z-index: 10;\n      cursor: pointer;\n    `;\n    \n    // Progressive Disclosure: ãƒ›ãƒãƒ¼/ã‚¯ãƒªãƒƒã‚¯ã§ãƒ–ãƒ©ãƒ³ãƒ‰åè¡¨ç¤º\n    const brandText = document.createElement('div');\n    brandText.className = 'progressive-brand-text';\n    brandText.style.cssText = `\n      position: absolute;\n      top: -35px;\n      right: -5px;\n      padding: 6px 12px;\n      background: rgba(255, 255, 255, 0.15);\n      border: 1px solid ${this.isDarkMode ? 'rgba(129, 140, 248, 0.3)' : 'rgba(99, 102, 241, 0.25)'};\n      border-radius: 12px;\n      box-shadow: 0 8px 24px rgba(99, 102, 241, 0.2), 0 4px 12px rgba(0, 0, 0, 0.1);\n      color: ${this.isDarkMode ? '#ffffff' : '#1f2937'};\n      font-size: 11px;\n      font-weight: 700;\n      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.4);\n      letter-spacing: 0.02em;\n      backdrop-filter: blur(20px);\n      -webkit-backdrop-filter: blur(20px);\n      opacity: 0;\n      transform: translateY(5px) scale(0.9);\n      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);\n      pointer-events: none;\n      z-index: 11;\n      white-space: nowrap;\n    `;\n    brandText.innerHTML = '<span style=\"filter: hue-rotate(240deg) saturate(0.8) brightness(1.1);\">ğŸ«</span> <span style=\"color: #6366f1;\">ChocoDrop</span>';\n    \n    // Progressive Disclosure ã‚¤ãƒ™ãƒ³ãƒˆ\n    brandIndicator.addEventListener('mouseenter', () => {\n      brandText.style.opacity = '1';\n      brandText.style.transform = 'translateY(0) scale(1)';\n      brandIndicator.style.transform = 'scale(1.2)';\n      brandIndicator.style.opacity = '1';\n    });\n    \n    brandIndicator.addEventListener('mouseleave', () => {\n      brandText.style.opacity = '0';\n      brandText.style.transform = 'translateY(5px) scale(0.9)';\n      brandIndicator.style.transform = 'scale(1)';\n      brandIndicator.style.opacity = '0.7';\n    });\n    \n    brandIndicator.appendChild(brandText);\n    this.container.appendChild(brandIndicator);\n\n    // å‡ºåŠ›ã‚¨ãƒªã‚¢ï¼ˆã‚¿ã‚¹ã‚¯ã‚«ãƒ¼ãƒ‰ã‚³ãƒ³ãƒ†ãƒŠï¼‰- éè¡¨ç¤ºã«å¤‰æ›´\n    this.output = document.createElement('div');\n    this.outputDiv = this.output; // ä¸¡æ–¹ã®å‚ç…§ã‚’ä¿æŒï¼ˆäº’æ›æ€§ã®ãŸã‚ï¼‰\n    this.output.id = 'command-output';\n    this.output.className = 'command-output';\n    this.output.style.cssText = this.getOutputStyles();\n    // ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚«ãƒ¼ãƒ‰ç”¨ã‚³ãƒ³ãƒ†ãƒŠ\n    this.floatingContainer = document.createElement('div');\n    this.floatingContainer.id = 'floating-cards-container';\n    this.floatingContainer.style.cssText = `\n      position: fixed;\n      bottom: var(--floating-bottom, 120px);\n      left: 50%;\n      transform: translateX(-50%);\n      z-index: 99999;\n      pointer-events: none;\n      display: none;\n      flex-direction: column;\n      gap: 8px;\n      width: 400px;\n      max-width: 90vw;\n      align-items: center;\n      justify-content: flex-start;\n    `;\n\n    // ã‚¿ã‚¹ã‚¯ã‚«ãƒ¼ãƒ‰ç®¡ç†ç”¨\n    this.taskCards = new Map();\n\n    // å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãƒ©ãƒƒãƒ‘ãƒ¼ï¼ˆå±•é–‹ãƒœã‚¿ãƒ³ç”¨ï¼‰\n    this.inputWrapper = document.createElement('div');\n    this.inputWrapper.style.cssText = `\n      position: relative;\n      width: 100%;\n      margin-bottom: 0;\n    `;\n\n    // Ultra-Simple å˜ä¸€å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆè‡ªå‹•ãƒªã‚µã‚¤ã‚ºå¯¾å¿œï¼‰\n    this.input = document.createElement('textarea');\n    this.input.rows = 1;\n    this.input.id = 'command-input';\n    this.input.placeholder = 'ã€Œå³ä¸Šã«ãƒ‰ãƒ©ã‚´ãƒ³ã‚’ã€ã€Œç¾ã—ã„æ¡œã®æ£®ã‚’ä¸­å¤®ã«ã€ãªã©... âœ¨';\n    this.input.style.cssText = this.getInputStyles();\n\n    // å±•é–‹ãƒœã‚¿ãƒ³ï¼ˆåˆæœŸçŠ¶æ…‹ã¯éè¡¨ç¤ºï¼‰\n    this.expandButton = document.createElement('div');\n    this.expandButton.innerHTML = 'â¤¢';\n    this.expandButton.title = 'ãƒ†ã‚­ã‚¹ãƒˆå…¨ä½“ã‚’è¡¨ç¤º';\n    this.expandButton.style.cssText = `\n      position: absolute;\n      bottom: 8px;\n      right: 8px;\n      width: 24px;\n      height: 24px;\n      display: none;\n      align-items: center;\n      justify-content: center;\n      background: ${this.isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)'};\n      border: 1px solid ${this.isDarkMode ? 'rgba(255, 255, 255, 0.2)' : 'rgba(0, 0, 0, 0.2)'};\n      border-radius: 6px;\n      color: ${this.isDarkMode ? '#ffffff' : '#1f2937'};\n      font-size: 16px;\n      cursor: pointer;\n      transition: all 0.2s ease;\n      z-index: 1;\n    `;\n\n    // å±•é–‹ãƒœã‚¿ãƒ³ã®ãƒ›ãƒãƒ¼åŠ¹æœ\n    this.expandButton.addEventListener('mouseenter', () => {\n      this.expandButton.style.background = this.isDarkMode ? 'rgba(255, 255, 255, 0.2)' : 'rgba(0, 0, 0, 0.2)';\n      this.expandButton.style.transform = 'scale(1.1)';\n    });\n\n    this.expandButton.addEventListener('mouseleave', () => {\n      this.expandButton.style.background = this.isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';\n      this.expandButton.style.transform = 'scale(1)';\n    });\n\n    // å±•é–‹ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯å‡¦ç†\n    this.expandButton.addEventListener('click', () => {\n      if (this.isExpanded) {\n        this.hideOverlayTextarea();\n      } else {\n        this.showOverlayTextarea();\n      }\n    });\n\n    // ãƒ©ãƒƒãƒ‘ãƒ¼ã«è¦ç´ ã‚’è¿½åŠ \n    this.inputWrapper.appendChild(this.input);\n    this.inputWrapper.appendChild(this.expandButton);\n\n    // æ—§ã‚³ãƒãƒ³ãƒ‰ã‚¿ã‚¤ãƒ—ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã¯å‰Šé™¤ï¼ˆãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³UIã«çµ±åˆï¼‰\n\n    // ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³é¢¨ãƒ¢ãƒ¼ãƒ‰ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼\n    const modeSelector = this.createRadioModeSelector();\n\n    // ãƒŸãƒ‹ãƒãƒ«ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³\n    const actionContainer = this.createMinimalActions();\n\n    // Ã—ã‚¯ãƒ­ãƒ¼ã‚ºãƒœã‚¿ãƒ³ã‚’ãƒ•ã‚©ãƒ¼ãƒ å³ä¸Šã«è¿½åŠ \n    const closeButton = document.createElement('div');\n    closeButton.innerHTML = 'Ã—';\n    closeButton.style.cssText = `\n      position: absolute;\n      top: 12px;\n      right: 12px;\n      width: 22px;\n      height: 22px;\n      border-radius: 50%;\n      background: ${this.isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)'};\n      color: ${this.isDarkMode ? '#ffffff' : '#1f2937'};\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      cursor: pointer;\n      font-size: 14px;\n      font-weight: normal;\n      transition: all 0.2s ease;\n      backdrop-filter: blur(8px);\n      z-index: 10;\n    `;\n\n    closeButton.addEventListener('mouseover', () => {\n      closeButton.style.background = this.isDarkMode ? 'rgba(255, 255, 255, 0.2)' : 'rgba(0, 0, 0, 0.2)';\n      closeButton.style.transform = 'scale(1.1)';\n    });\n\n    closeButton.addEventListener('mouseout', () => {\n      closeButton.style.background = this.isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';\n      closeButton.style.color = this.isDarkMode ? '#ffffff' : '#1f2937';\n      closeButton.style.transform = 'scale(1)';\n    });\n\n    closeButton.addEventListener('click', () => {\n      this.hide();\n    });\n\n    // çµ„ã¿ç«‹ã¦ï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼å‰Šé™¤ã€ãƒ–ãƒ©ãƒ³ãƒ‰ãƒãƒƒã‚¸ã¯æ—¢ã«è¿½åŠ æ¸ˆã¿ï¼‰\n    // this.container.appendChild(this.output); // å¤§ããªã‚¿ã‚¹ã‚¯è¡¨ç¤ºã‚¨ãƒªã‚¢ã‚’DOMã«è¿½åŠ ã—ãªã„\n    this.container.appendChild(closeButton);\n    this.container.appendChild(modeSelector);\n    this.container.appendChild(this.inputWrapper);\n    this.container.appendChild(actionContainer);\n\n    // ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚«ãƒ¼ãƒ‰ã‚³ãƒ³ãƒ†ãƒŠã‚’bodyã«ç›´æ¥è¿½åŠ \n    document.body.appendChild(this.floatingContainer);\n\n    // DOM ã«è¿½åŠ \n    document.body.appendChild(this.container);\n\n    // åˆå›ãƒ†ãƒ¼ãƒé©ç”¨\n    this.applyTheme();\n\n    // æ—¥æœ¬èªIMEå¯¾å¿œã®composition stateç®¡ç†\n    this.isComposing = false;\n    this.hasCompositionJustEnded = false;\n\n    // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å…¥åŠ›ç›£è¦–ã¨ã‚³ãƒãƒ³ãƒ‰æ¤œå‡ºï¼ˆIMEå¯¾å¿œï¼‰\n    this.input.addEventListener('input', () => {\n      // IMEå…¥åŠ›ä¸­ã¯ã‚³ãƒãƒ³ãƒ‰æ¤œå‡ºã‚’åœæ­¢\n      if (this.isComposing) {\n        return;\n      }\n      \n      // ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯è‡ªå‹•ã‚¯ãƒªã‚¢ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå…¥åŠ›ã‚’ä¿®æ­£ã—ã¦ã„ã‚‹ï¼‰\n      if (this.currentFeedback) {\n        this.clearInputFeedback();\n      }\n      \n      // è‡ªå‹•ãƒªã‚µã‚¤ã‚ºå‡¦ç†\n      this.autoResizeTextarea();\n      \n      // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒã‚¤ãƒ©ã‚¤ãƒˆé©ç”¨\n      this.applyKeywordHighlighting();\n      \n      this.detectCommandType();\n    });\n    \n    // æ—¥æœ¬èªIME composition events\n    this.input.addEventListener('compositionstart', () => {\n      this.isComposing = true;\n    });\n    \n    this.input.addEventListener('compositionend', () => {\n      this.isComposing = false;\n      \n      // Safariã®ã¿ãƒ•ãƒ©ã‚°è¨­å®šï¼ˆä»–ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯ä¸è¦ï¼‰\n      const isSafari = /Safari/.test(navigator.userAgent) && /Version/.test(navigator.userAgent);\n      if (isSafari) {\n        this.hasCompositionJustEnded = true;\n      }\n      \n      // ç¢ºå®šå¾Œã®ã‚³ãƒãƒ³ãƒ‰æ¤œå‡ºã‚’å®Ÿè¡Œ\n      setTimeout(() => {\n        this.autoResizeTextarea();\n        this.detectCommandType();\n      }, 10);\n    });\n    \n    // Safariåˆ¤å®š\n    const isSafari = /Safari/.test(navigator.userAgent) && /Version/.test(navigator.userAgent);\n    \n    // æ—¥æœ¬èªIMEå¯¾å¿œEnterã‚­ãƒ¼å‡¦ç†ï¼ˆSafariå¯¾å¿œç‰ˆï¼‰\n    this.input.addEventListener('keydown', (e) => {\n      if (e.key === 'Enter') {\n        // Safari: compositionendç›´å¾Œã®Enterã‚’ã‚¹ã‚­ãƒƒãƒ—\n        if (isSafari && this.hasCompositionJustEnded) {\n          this.hasCompositionJustEnded = false;\n          return;\n        }\n        \n        // ãã®ä»–ã®ãƒ–ãƒ©ã‚¦ã‚¶: isComposingãƒã‚§ãƒƒã‚¯\n        if (!isSafari && (e.isComposing || this.isComposing)) {\n          return;\n        }\n        \n\n\n        e.preventDefault();\n        this.executeCommand();\n      }\n    });\n    \n    // åˆæœŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸\n    if (this.config.showExamples) {\n      // èµ·å‹•ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‰Šé™¤\n      // èµ·å‹•æ™‚ã¯é™ã‹ã«å¾…æ©Ÿ\n    }\n  }\n\n  /**\n   * ãƒ¢ãƒ¼ãƒ‰ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ä½œæˆ\n   */\n  createMinimalActions() {\n    const container = document.createElement('div');\n    container.style.cssText = `\n      display: flex;\n      margin-top: 8px;\n      margin-bottom: 0 !important;\n      gap: 8px;\n      justify-content: space-between;\n      align-items: center;\n    `;\n\n    // å·¦å´: Clear All ãƒœã‚¿ãƒ³ï¼ˆæ‰¿èªæ¸ˆã¿ã®Layout Bãƒ‡ã‚¶ã‚¤ãƒ³ï¼‰\n    const leftSection = document.createElement('div');\n    leftSection.style.cssText = 'display: flex; gap: 8px; align-items: center;';\n\n    const clearBtn = document.createElement('button');\n    clearBtn.innerHTML = '<span style=\"filter: hue-rotate(240deg) saturate(0.7) brightness(0.9);\">ğŸ§¹</span> Clear All';\n    clearBtn.style.cssText = this.getActionButtonStyles('secondary');\n    clearBtn.addEventListener('click', () => this.clearAllWithConfirmation());\n\n    // å±¥æ­´ãƒœã‚¿ãƒ³ï¼ˆå°†æ¥å®Ÿè£…ç”¨ã‚¹ãƒšãƒ¼ã‚¹ç¢ºä¿ï¼‰- æµ·å¤–UIæ¨™æº–å¯¾å¿œï¼šåŒä¸€å¹…\n    const historyBtn = document.createElement('button');\n    historyBtn.innerHTML = '<span style=\"filter: hue-rotate(240deg) saturate(0.7) brightness(0.9);\">ğŸ“š</span> History';\n    historyBtn.style.cssText = this.getActionButtonStyles('secondary');\n    historyBtn.style.opacity = '0.5';\n    historyBtn.disabled = true;\n    historyBtn.title = 'å±¥æ­´æ©Ÿèƒ½ï¼ˆé–‹ç™ºä¸­ï¼‰';\n\n    leftSection.appendChild(clearBtn);\n    leftSection.appendChild(historyBtn);\n\n    // å³å´: ãƒ†ãƒ¼ãƒãƒˆã‚°ãƒ«ã¨è¨­å®šï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼ã‹ã‚‰ç§»å‹•ï¼‰\n    const rightSection = document.createElement('div');\n    rightSection.style.cssText = 'display: flex; gap: 6px; align-items: center;';\n\n    const themeToggle = document.createElement('button');\n    const getThemeIcon = () => {\n      const themeConfig = {\n        light: 'ğŸŒ™',\n        dark: 'ğŸµ',\n        wabisabi: 'â˜€ï¸'\n      };\n      return themeConfig[this.currentTheme] || 'ğŸŒ™';\n    };\n\n    const getThemeTitle = () => {\n      const titleConfig = {\n        light: 'ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆ',\n        dark: 'ä¾˜ã³å¯‚ã³ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆ',\n        wabisabi: 'ãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆ'\n      };\n      return titleConfig[this.currentTheme] || 'ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆ';\n    };\n\n    const getThemeIconWithFilter = () => {\n      const icon = getThemeIcon();\n      // å¤ªé™½ã¯é»„è‰²ãã€ãŠèŒ¶ã¯ç·‘ç³»ã€æœˆã¯ç´«ç³»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼\n      if (icon === 'â˜€ï¸') {\n        return `<span style=\"filter: saturate(1.2) brightness(1.1);\">${icon}</span>`;\n      } else if (icon === 'ğŸµ') {\n        return `<span style=\"filter: hue-rotate(80deg) saturate(1.1) brightness(1.0);\">${icon}</span>`;\n      } else {\n        return `<span style=\"filter: hue-rotate(240deg) saturate(0.8) brightness(1.1);\">${icon}</span>`;\n      }\n    };\n\n    themeToggle.innerHTML = getThemeIconWithFilter();\n    themeToggle.style.cssText = this.getActionButtonStyles('icon');\n    themeToggle.title = getThemeTitle();\n    themeToggle.addEventListener('click', () => this.toggleTheme());\n\n    const settingsButton = document.createElement('button');\n    settingsButton.innerHTML = '<span style=\"filter: hue-rotate(240deg) saturate(0.8) brightness(1.1);\">âš™ï¸</span>';\n    settingsButton.style.cssText = this.getActionButtonStyles('icon');\n    settingsButton.title = 'ã‚µãƒ¼ãƒ“ã‚¹è¨­å®šã‚’é–‹ã';\n    settingsButton.addEventListener('click', () => this.openServiceModal());\n\n    rightSection.appendChild(themeToggle);\n    rightSection.appendChild(settingsButton);\n\n    container.appendChild(leftSection);\n    container.appendChild(rightSection);\n\n    // å‚ç…§ã‚’ä¿æŒ\n    this.clearBtn = clearBtn;\n    this.historyBtn = historyBtn;\n    this.themeToggle = themeToggle;\n    this.settingsButton = settingsButton;\n\n    return container;\n  }\n\n  createServiceSelectorSection() {\n    this.serviceSelectorContainer = document.createElement('div');\n    this.serviceSelectorContainer.id = 'service-selector';\n    this.serviceSelectorContainer.style.cssText = `\n      margin-bottom: 16px;\n      padding: 12px;\n      border-radius: 12px;\n      border: 1px solid transparent;\n      transition: background 0.3s ease, border 0.3s ease;\n    `;\n\n    this.serviceSelectorStatus = document.createElement('div');\n    this.serviceSelectorStatus.textContent = 'ã‚µãƒ¼ãƒ“ã‚¹æƒ…å ±ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...';\n    this.serviceSelectorStatus.style.fontSize = '12px';\n    this.serviceSelectorStatus.style.opacity = '0.8';\n    this.serviceSelectorStatus.style.marginBottom = '8px';\n    this.serviceSelectorContainer.appendChild(this.serviceSelectorStatus);\n\n    this.serviceSelectorContent = document.createElement('div');\n    this.serviceSelectorContainer.appendChild(this.serviceSelectorContent);\n\n    this.updateServiceSelectorTheme();\n    return this.serviceSelectorContainer;\n  }\n\n  createServiceModal() {\n    if (this.serviceModalOverlay) {\n      this.serviceModalOverlay.remove();\n      this.serviceModalOverlay = null;\n      this.serviceModal = null;\n    }\n\n    this.serviceModalOverlay = document.createElement('div');\n    this.serviceModalOverlay.id = 'chocodrop-service-modal-overlay';\n    this.serviceModalOverlay.style.cssText = `\n      position: fixed;\n      inset: 0;\n      display: none;\n      align-items: center;\n      justify-content: center;\n      backdrop-filter: blur(18px);\n      -webkit-backdrop-filter: blur(18px);\n      z-index: 2000;\n      padding: 16px !important;\n      opacity: 0;\n      transition: opacity 0.2s ease;\n    `;\n\n    this.serviceModalOverlay.addEventListener('click', (event) => {\n      if (event.target === this.serviceModalOverlay) {\n        this.closeServiceModal();\n      }\n    });\n\n    this.serviceModal = document.createElement('div');\n    this.serviceModal.className = 'chocodrop-service-modal';\n    this.serviceModal.style.cssText = `\n      width: min(420px, 90vw);\n      border-radius: 24px;\n      padding: 26px 28px;\n      backdrop-filter: blur(20px);\n      -webkit-backdrop-filter: blur(20px);\n      border: 1px solid rgba(255, 255, 255, 0.2);\n      box-shadow: 0 20px 40px rgba(15, 23, 42, 0.35);\n      display: flex;\n      flex-direction: column;\n      gap: 18px;\n      max-height: 90vh;\n      overflow-y: auto;\n      position: relative;\n    `;\n\n    const title = document.createElement('h2');\n    title.textContent = 'ã‚µãƒ¼ãƒ“ã‚¹è¨­å®š';\n    title.style.cssText = `\n      margin: 0;\n      font-size: 18px;\n      font-weight: 700;\n      letter-spacing: 0.03em;\n    `;\n\n    const subtitle = document.createElement('p');\n    subtitle.textContent = 'åˆ©ç”¨ã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚';\n    subtitle.style.cssText = `\n      margin: 0;\n      font-size: 12px;\n      opacity: 0.75;\n    `;\n\n    const selector = this.createServiceSelectorSection();\n\n    const actionRow = document.createElement('div');\n    actionRow.style.cssText = `\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      gap: 16px;\n    `;\n\n    this.serviceSelectorRetryButton = document.createElement('button');\n    this.serviceSelectorRetryButton.textContent = 'å†èª­ã¿è¾¼ã¿';\n    this.serviceSelectorRetryButton.style.cssText = `\n      font-size: 11px;\n      padding: 6px 14px;\n      border-radius: 10px;\n      border: 1px solid transparent;\n      cursor: pointer;\n      display: none;\n      transition: all 0.2s ease;\n    `;\n    this.serviceSelectorRetryButton.addEventListener('click', () => this.initializeServiceSelector(true));\n\n    const actionButtons = document.createElement('div');\n    actionButtons.style.cssText = 'display: flex; gap: 8px;';\n\n    this.serviceSelectorCancelButton = document.createElement('button');\n    this.serviceSelectorCancelButton.textContent = 'Cancel';\n    this.serviceSelectorCancelButton.style.cssText = `\n      font-size: 12px;\n      padding: 8px 16px;\n      border-radius: 10px;\n      border: 1px solid rgba(255, 255, 255, 0.35);\n      background: transparent;\n      cursor: pointer;\n      transition: all 0.2s ease;\n    `;\n    this.serviceSelectorCancelButton.addEventListener('click', () => this.closeServiceModal());\n\n    this.serviceSelectorSaveButton = document.createElement('button');\n    this.serviceSelectorSaveButton.textContent = 'Save';\n    this.serviceSelectorSaveButton.style.cssText = `\n      font-size: 12px;\n      padding: 8px 18px;\n      border-radius: 10px;\n      border: none;\n      cursor: pointer;\n      background: linear-gradient(135deg, ${this.isWabiSabiMode ? '#8BC34A, #689F38' : '#6366f1, #8b5cf6'});\n      color: white;\n      font-weight: 600;\n      transition: all 0.2s ease;\n      box-shadow: 0 12px 24px rgba(99, 102, 241, 0.35);\n    `;\n    this.serviceSelectorSaveButton.addEventListener('click', () => this.handleServiceSave());\n\n    actionButtons.appendChild(this.serviceSelectorCancelButton);\n    actionButtons.appendChild(this.serviceSelectorSaveButton);\n\n    actionRow.appendChild(this.serviceSelectorRetryButton);\n    actionRow.appendChild(actionButtons);\n\n    this.serviceModal.appendChild(title);\n    this.serviceModal.appendChild(subtitle);\n    this.serviceModal.appendChild(selector);\n    this.serviceModal.appendChild(actionRow);\n\n    this.serviceModalOverlay.appendChild(this.serviceModal);\n    document.body.appendChild(this.serviceModalOverlay);\n\n    this.updateServiceSelectorTheme();\n    this.toggleServiceRetryButton(false);\n  }\n\n  openServiceModal(forceFetch = false) {\n    if (!this.serviceModalOverlay) {\n      this.createServiceModal();\n    }\n\n    this.serviceModalOverlay.style.display = 'flex';\n    requestAnimationFrame(() => {\n      if (this.serviceModalOverlay) {\n        this.serviceModalOverlay.style.opacity = '1';\n      }\n    });\n\n    this.resetPendingSelections();\n    this.initializeServiceSelector(forceFetch);\n  }\n\n  closeServiceModal() {\n    if (!this.serviceModalOverlay) {\n      return;\n    }\n\n    this.serviceModalOverlay.style.opacity = '0';\n    setTimeout(() => {\n      if (this.serviceModalOverlay) {\n        this.serviceModalOverlay.style.display = 'none';\n      }\n      this.resetPendingSelections();\n    }, 150);\n  }\n\n  async initializeServiceSelector(force = false) {\n    if (this.servicesLoading && !force) {\n      return;\n    }\n\n    if (!this.client || typeof this.client.getAvailableServices !== 'function') {\n      this.setServiceSelectorStatus('ã‚µãƒ¼ãƒ“ã‚¹æƒ…å ±ã‚’å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆåˆæœŸåŒ–å¾…ã¡ã§ã™ï¼‰ã€‚å³ä¸‹ã®ã€Œå†èª­ã¿è¾¼ã¿ã€ã§å†å–å¾—ã§ãã¾ã™ã€‚', 'error');\n      this.toggleServiceRetryButton(true);\n      this.setServiceButtonsEnabled(false);\n      return;\n    }\n\n    this.servicesLoading = true;\n    this.setServiceSelectorStatus('ã‚µãƒ¼ãƒ“ã‚¹æƒ…å ±ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...', 'info');\n    this.toggleServiceRetryButton(false);\n    this.setServiceButtonsEnabled(false);\n\n    try {\n      if (typeof this.client.ensureInitialized === 'function') {\n        await this.client.ensureInitialized();\n      }\n\n      const response = await this.client.getAvailableServices();\n      if (!response || response.success === false || !response.metadata) {\n        throw new Error(response?.error || 'ã‚µãƒ¼ãƒ“ã‚¹æƒ…å ±ãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ');\n      }\n\n      this.availableImageServices = Array.isArray(response.metadata?.image) ? response.metadata.image : [];\n      this.availableVideoServices = Array.isArray(response.metadata?.video) ? response.metadata.video : [];\n\n      this.selectedImageService = this.resolveServiceSelection(\n        'image',\n        this.availableImageServices,\n        response.default?.image\n      );\n\n      this.selectedVideoService = this.resolveServiceSelection(\n        'video',\n        this.availableVideoServices,\n        response.default?.video\n      );\n\n      this.pendingImageService = this.selectedImageService;\n      this.pendingVideoService = this.selectedVideoService;\n\n      this.populateServiceSelector();\n      this.applyServiceSelectionToSceneManager();\n      this.setServiceButtonsEnabled(true);\n    } catch (error) {\n      console.error('âŒ Failed to initialize service selector:', error);\n      this.setServiceSelectorStatus('ã‚µãƒ¼ãƒ“ã‚¹æƒ…å ±ã‚’å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚ã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ç¢ºèªã®ã†ãˆã€å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ã€‚', 'error');\n      this.toggleServiceRetryButton(true);\n      this.setServiceButtonsEnabled(false);\n    } finally {\n      this.servicesLoading = false;\n    }\n  }\n\n  setServiceSelectorStatus(message, type = 'info') {\n    if (!this.serviceSelectorStatus) {\n      return;\n    }\n    this.serviceSelectorStatus.textContent = message;\n    this.serviceSelectorStatus.dataset.statusType = type;\n    this.serviceSelectorStatus.classList.toggle('service-selector-helper', type !== 'error');\n    this.updateServiceSelectorTheme();\n  }\n\n  toggleServiceRetryButton(visible) {\n    if (!this.serviceSelectorRetryButton) {\n      return;\n    }\n    this.serviceSelectorRetryButton.style.display = visible ? 'inline-flex' : 'none';\n    this.updateServiceSelectorTheme();\n  }\n\n  resolveServiceSelection(type, services, defaultId) {\n    if (!services || services.length === 0) {\n      return null;\n    }\n\n    const storageKey = type === 'image' ? IMAGE_SERVICE_STORAGE_KEY : VIDEO_SERVICE_STORAGE_KEY;\n    let storedId = null;\n    try {\n      storedId = localStorage.getItem(storageKey);\n    } catch (error) {\n      console.warn('âš ï¸ Failed to access localStorage:', error);\n    }\n\n    const isStoredValid = storedId && services.some(service => service.id === storedId);\n    let resolvedId = isStoredValid ? storedId : null;\n\n    if (!resolvedId && defaultId && services.some(service => service.id === defaultId)) {\n      resolvedId = defaultId;\n    }\n\n    if (!resolvedId) {\n      resolvedId = services[0]?.id || null;\n    }\n\n    try {\n      if (resolvedId) {\n        localStorage.setItem(storageKey, resolvedId);\n      } else {\n        localStorage.removeItem(storageKey);\n      }\n    } catch (error) {\n      console.warn('âš ï¸ Failed to persist service selection:', error);\n    }\n\n    return resolvedId;\n  }\n\n  populateServiceSelector() {\n    if (!this.serviceSelectorContent) {\n      return;\n    }\n\n    this.serviceSelectorContent.innerHTML = '';\n\n    const hasImage = this.availableImageServices.length > 0;\n    const hasVideo = this.availableVideoServices.length > 0;\n\n    if (!hasImage && !hasVideo) {\n      this.setServiceSelectorStatus('åˆ©ç”¨å¯èƒ½ãªã‚µãƒ¼ãƒ“ã‚¹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚', 'error');\n      return;\n    }\n\n    this.setServiceSelectorStatus('åˆ©ç”¨ã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚', 'info');\n\n    if (hasImage) {\n      const imageRow = this.buildServiceRow('image', 'ç”»åƒ (T2I)', this.availableImageServices, this.pendingImageService || this.selectedImageService);\n      this.serviceSelectorContent.appendChild(imageRow);\n    }\n\n    if (hasVideo) {\n      const videoRow = this.buildServiceRow('video', 'å‹•ç”» (T2V)', this.availableVideoServices, this.pendingVideoService || this.selectedVideoService);\n      this.serviceSelectorContent.appendChild(videoRow);\n    }\n\n    this.updateServiceSelectorTheme();\n  }\n\n  buildServiceRow(type, labelText, services, selectedId) {\n    const row = document.createElement('div');\n    row.className = `service-row service-row-${type}`;\n    row.style.cssText = `\n      display: flex;\n      flex-direction: column;\n      gap: 6px;\n      margin-bottom: 12px;\n    `;\n\n    const label = document.createElement('label');\n    label.textContent = labelText;\n    label.style.fontSize = '13px';\n    label.style.fontWeight = '600';\n    row.appendChild(label);\n\n    const select = document.createElement('select');\n    select.dataset.serviceType = type;\n    select.style.fontFamily = 'inherit';\n    select.style.width = '100%';\n\n    services.forEach(service => {\n      const option = document.createElement('option');\n      option.value = service.id;\n      option.textContent = service.name || service.id;\n      if (service.description) {\n        option.title = service.description;\n      }\n      select.appendChild(option);\n    });\n\n    if (selectedId && services.some(service => service.id === selectedId)) {\n      select.value = selectedId;\n    }\n\n    select.addEventListener('change', (event) => {\n      this.onServiceSelectionChange(type, event.target.value);\n    });\n\n    row.appendChild(select);\n\n    const description = document.createElement('div');\n    description.className = 'service-description';\n    description.textContent = this.findServiceInfo(type, select.value)?.description || '';\n    description.style.fontSize = '11px';\n    description.style.opacity = '0.75';\n    description.style.lineHeight = '1.4';\n    description.style.minHeight = '14px';\n    row.appendChild(description);\n\n    select.addEventListener('change', () => {\n      description.textContent = this.findServiceInfo(type, select.value)?.description || '';\n    });\n\n    if (type === 'image') {\n      this.imageServiceSelect = select;\n    } else {\n      this.videoServiceSelect = select;\n    }\n\n    return row;\n  }\n\n  onServiceSelectionChange(type, serviceId) {\n    if (type === 'image') {\n      this.pendingImageService = serviceId;\n    } else {\n      this.pendingVideoService = serviceId;\n    }\n\n    const info = this.findServiceInfo(type, serviceId);\n    const description = type === 'image'\n      ? this.imageServiceSelect?.parentElement?.querySelector('.service-description')\n      : this.videoServiceSelect?.parentElement?.querySelector('.service-description');\n\n    if (description) {\n      description.textContent = info?.description || '';\n    }\n  }\n\n  handleServiceSave() {\n    const newImageId = this.pendingImageService || this.selectedImageService;\n    const newVideoId = this.pendingVideoService || this.selectedVideoService;\n\n    if (newImageId) {\n      try {\n        localStorage.setItem(IMAGE_SERVICE_STORAGE_KEY, newImageId);\n      } catch (error) {\n        console.warn('âš ï¸ Failed to persist image service selection:', error);\n      }\n      this.selectedImageService = newImageId;\n      this.sceneManager?.setImageService(newImageId);\n    }\n\n    if (newVideoId) {\n      try {\n        localStorage.setItem(VIDEO_SERVICE_STORAGE_KEY, newVideoId);\n      } catch (error) {\n        console.warn('âš ï¸ Failed to persist video service selection:', error);\n      }\n      this.selectedVideoService = newVideoId;\n      this.sceneManager?.setVideoService(newVideoId);\n    }\n\n    const imageInfo = this.findServiceInfo('image', newImageId);\n    const videoInfo = this.findServiceInfo('video', newVideoId);\n\n    if (imageInfo) {\n      this.addOutput(`ğŸ–¼ï¸ ç”»åƒã‚µãƒ¼ãƒ“ã‚¹ã‚’ã€Œ${imageInfo.name}ã€ã«è¨­å®šã—ã¾ã—ãŸ`, 'system');\n    }\n    if (videoInfo) {\n      this.addOutput(`ğŸ¬ å‹•ç”»ã‚µãƒ¼ãƒ“ã‚¹ã‚’ã€Œ${videoInfo.name}ã€ã«è¨­å®šã—ã¾ã—ãŸ`, 'system');\n    }\n\n    this.closeServiceModal();\n  }\n\n  setServiceButtonsEnabled(enabled) {\n    if (this.serviceSelectorSaveButton) {\n      this.serviceSelectorSaveButton.disabled = !enabled;\n      this.serviceSelectorSaveButton.style.opacity = enabled ? '1' : '0.6';\n      this.serviceSelectorSaveButton.style.cursor = enabled ? 'pointer' : 'not-allowed';\n    }\n  }\n\n  resetPendingSelections() {\n    this.pendingImageService = this.selectedImageService;\n    this.pendingVideoService = this.selectedVideoService;\n\n    if (this.imageServiceSelect && this.selectedImageService) {\n      this.imageServiceSelect.value = this.selectedImageService;\n    }\n    if (this.videoServiceSelect && this.selectedVideoService) {\n      this.videoServiceSelect.value = this.selectedVideoService;\n    }\n\n    if (this.serviceSelectorContent && this.serviceSelectorContent.childElementCount > 0) {\n      this.populateServiceSelector();\n    }\n  }\n\n  findServiceInfo(type, serviceId) {\n    const list = type === 'image' ? this.availableImageServices : this.availableVideoServices;\n    return list.find(service => service.id === serviceId) || null;\n  }\n\n  applyServiceSelectionToSceneManager() {\n    if (!this.sceneManager) {\n      return;\n    }\n    this.sceneManager.setImageService(this.selectedImageService);\n    this.sceneManager.setVideoService(this.selectedVideoService);\n  }\n\n  updateServiceSelectorTheme() {\n    if (this.serviceModalOverlay) {\n      this.serviceModalOverlay.style.background = this.isDarkMode\n        ? 'rgba(8, 11, 26, 0.55)'\n        : 'rgba(229, 231, 255, 0.45)';\n    }\n\n    if (this.serviceModal) {\n      this.serviceModal.style.background = this.isDarkMode\n        ? 'rgba(17, 24, 39, 0.15)'\n        : 'rgba(255, 255, 255, 0.15)';\n      this.serviceModal.style.border = this.isDarkMode\n        ? '1px solid rgba(129, 140, 248, 0.4)'\n        : '1px solid rgba(99, 102, 241, 0.25)';\n      this.serviceModal.style.color = this.isDarkMode ? '#e5e7ff' : '#1f2937';\n    }\n\n    if (this.serviceSelectorStatus) {\n      const type = this.serviceSelectorStatus.dataset?.statusType;\n      const statusColor = type === 'error'\n        ? (this.isDarkMode ? '#fca5a5' : '#b91c1c')\n        : (this.isDarkMode ? 'rgba(209, 213, 219, 0.8)' : 'rgba(55, 65, 81, 0.75)');\n      this.serviceSelectorStatus.style.color = statusColor;\n    }\n\n    if (this.serviceSelectorContainer) {\n      const labels = this.serviceSelectorContainer.querySelectorAll('label');\n      labels.forEach(label => {\n        label.style.color = this.isWabiSabiMode\n          ? '#5D4037'\n          : (this.isDarkMode ? 'rgba(255, 255, 255, 0.9)' : 'rgba(31, 41, 55, 0.9)');\n      });\n\n      const selects = this.serviceSelectorContainer.querySelectorAll('select');\n      selects.forEach(select => {\n        select.style.background = this.isWabiSabiMode\n          ? 'rgba(161, 136, 127, 0.15)'\n          : (this.isDarkMode ? 'rgba(99, 102, 241, 0.18)' : 'rgba(99, 102, 241, 0.12)');\n        select.style.border = this.isWabiSabiMode\n          ? '1px solid rgba(161, 136, 127, 0.4)'\n          : (this.isDarkMode ? '1px solid rgba(129, 140, 248, 0.45)' : '1px solid rgba(99, 102, 241, 0.45)');\n        select.style.color = this.isWabiSabiMode\n          ? '#5D4037'\n          : (this.isDarkMode ? '#ffffff' : '#1f2937');\n        select.style.padding = '10px 12px';\n        select.style.borderRadius = '10px';\n        select.style.fontSize = '13px';\n        select.style.outline = 'none';\n        select.style.boxShadow = this.isWabiSabiMode\n          ? '0 12px 24px rgba(93, 64, 55, 0.25)'\n          : (this.isDarkMode\n            ? '0 12px 28px rgba(15, 23, 42, 0.5)'\n            : '0 12px 24px rgba(99, 102, 241, 0.2)');\n      });\n\n      const descriptions = this.serviceSelectorContainer.querySelectorAll('.service-description');\n      descriptions.forEach(desc => {\n        desc.style.color = this.isWabiSabiMode\n          ? 'rgba(93, 64, 55, 0.7)'\n          : (this.isDarkMode ? 'rgba(209, 213, 219, 0.8)' : 'rgba(55, 65, 81, 0.7)');\n      });\n    }\n\n    if (this.serviceSelectorRetryButton) {\n      this.serviceSelectorRetryButton.style.background = this.isWabiSabiMode\n        ? 'rgba(161, 136, 127, 0.25)'\n        : (this.isDarkMode\n          ? 'rgba(129, 140, 248, 0.35)'\n          : 'rgba(99, 102, 241, 0.15)');\n      this.serviceSelectorRetryButton.style.border = this.isWabiSabiMode\n        ? '1px solid rgba(161, 136, 127, 0.5)'\n        : (this.isDarkMode\n          ? '1px solid rgba(129, 140, 248, 0.5)'\n          : '1px solid rgba(99, 102, 241, 0.45)');\n      this.serviceSelectorRetryButton.style.color = this.isWabiSabiMode\n        ? '#5D4037'\n        : (this.isDarkMode ? '#f9fafb' : '#1e1b4b');\n      this.serviceSelectorRetryButton.style.boxShadow = this.isWabiSabiMode\n        ? '0 0 8px rgba(161, 136, 127, 0.4)'\n        : (this.isDarkMode\n          ? '0 0 8px rgba(129, 140, 248, 0.45)'\n          : '0 0 8px rgba(99, 102, 241, 0.35)');\n    }\n\n    if (this.serviceSelectorCancelButton) {\n      this.serviceSelectorCancelButton.style.border = this.isWabiSabiMode\n        ? '1px solid rgba(161, 136, 127, 0.4)'\n        : (this.isDarkMode\n          ? '1px solid rgba(209, 213, 219, 0.3)'\n          : '1px solid rgba(148, 163, 184, 0.5)');\n      this.serviceSelectorCancelButton.style.color = this.isWabiSabiMode\n        ? 'rgba(93, 64, 55, 0.85)'\n        : (this.isDarkMode ? 'rgba(226, 232, 240, 0.85)' : 'rgba(30, 41, 59, 0.85)');\n    }\n\n    if (this.serviceSelectorSaveButton) {\n      this.serviceSelectorSaveButton.style.background = this.isWabiSabiMode\n        ? 'linear-gradient(135deg, #6D4C41, #5D4037)'\n        : (this.isDarkMode\n          ? 'linear-gradient(135deg, ' + (this.isWabiSabiMode ? '#8BC34A, #689F38' : '#6366f1, #8b5cf6') + ')'\n          : 'linear-gradient(135deg, #818cf8, #a855f7)');\n      this.serviceSelectorSaveButton.style.boxShadow = this.isWabiSabiMode\n        ? '0 16px 28px rgba(93, 64, 55, 0.35)'\n        : (this.isDarkMode\n          ? '0 16px 28px rgba(99, 102, 241, 0.4)'\n          : '0 16px 28px rgba(129, 140, 248, 0.35)');\n    }\n  }\n\n  /**\n   * ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³é¢¨ãƒ¢ãƒ¼ãƒ‰ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ä½œæˆ\n   */\n  createRadioModeSelector() {\n    const container = document.createElement('div');\n    container.className = 'radio-mode-selector';\n    container.style.cssText = `\n      display: grid;\n      grid-template-columns: repeat(4, 1fr);\n      gap: 8px;\n      margin-bottom: 12px;\n      padding: 12px;\n      background: ${this.isWabiSabiMode\n        ? 'linear-gradient(135deg, rgba(158, 158, 158, 0.25), rgba(189, 189, 189, 0.2))'\n        : (this.isDarkMode\n          ? 'linear-gradient(135deg, rgba(30, 27, 75, 0.3), rgba(15, 23, 42, 0.4))'\n          : 'linear-gradient(135deg, rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.1))')};\n      border: 1px solid ${this.isWabiSabiMode\n        ? 'rgba(141, 110, 99, 0.4)'\n        : (this.isDarkMode ? 'rgba(99, 102, 241, 0.15)' : 'rgba(255, 255, 255, 0.25)')};\n      border-radius: 16px;\n      backdrop-filter: blur(12px);\n      transition: all 0.3s ease;\n      position: relative;\n    `;\n\n    const modes = [\n      { value: 'generate', label: 'Generate', icon: 'âœ¨' },\n      { value: 'import', label: 'Import', icon: 'ğŸ“¥' },\n      { value: 'modify', label: 'Modify', icon: 'ğŸ”§' },\n      { value: 'delete', label: 'Delete', icon: 'ğŸ—‘ï¸' }\n    ];\n\n    this.radioModeButtons = {};\n\n    modes.forEach(mode => {\n      const button = document.createElement('div');\n      button.className = `mode-option ${mode.value}`;\n      button.style.cssText = `\n        display: flex;\n        flex-direction: column;\n        align-items: center;\n        gap: 4px;\n        padding: 10px 8px;\n        border-radius: 12px;\n        cursor: pointer;\n        transition: all 0.2s ease;\n        font-size: 11px;\n        font-weight: 600;\n        text-align: center;\n        color: ${this.isWabiSabiMode\n          ? '#F5F5F5'\n          : (this.isDarkMode ? 'rgba(255, 255, 255, 0.7)' : 'rgba(55, 65, 81, 0.8)')};\n        background: transparent;\n        border: 1px solid transparent;\n        position: relative;\n      `;\n\n      const icon = document.createElement('div');\n      icon.textContent = mode.icon;\n      icon.style.cssText = `\n        font-size: 16px;\n        margin-bottom: 2px;\n        filter: ${this.isDarkMode \n          ? 'hue-rotate(220deg) saturate(0.8) brightness(1.2)' \n          : 'hue-rotate(240deg) saturate(0.7) brightness(0.9)'};\n        transition: filter 0.2s ease;\n      `;\n\n      const label = document.createElement('span');\n      label.textContent = mode.label;\n\n      // AUTOãƒãƒƒã‚¸ã‚’ä½œæˆ\n      const autoBadge = document.createElement('div');\n      autoBadge.className = 'auto-badge';\n      autoBadge.textContent = 'AUTO';\n      autoBadge.style.cssText = `\n        position: absolute;\n        top: -4px;\n        right: -4px;\n        font-size: 7px;\n        font-weight: 700;\n        padding: 2px 4px;\n        background: linear-gradient(135deg, #10b981, #059669);\n        color: white;\n        border-radius: 6px;\n        opacity: 0;\n        transform: scale(0.8);\n        transition: all 0.2s ease;\n        display: none;\n      `;\n\n      button.appendChild(icon);\n      button.appendChild(label);\n      button.appendChild(autoBadge);\n\n      // ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ\n      button.addEventListener('click', () => {\n        if (mode.value === 'import') {\n          this.triggerFileSelection();\n        } else {\n          this.selectMode(mode.value, true); // trueã¯æ‰‹å‹•é¸æŠã‚’ç¤ºã™\n        }\n      });\n\n      this.radioModeButtons[mode.value] = { button, autoBadge };\n      container.appendChild(button);\n    });\n\n\n    this.radioModeContainer = container;\n    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§Generateã‚’é¸æŠ\n    this.selectMode('generate', false);\n\n    return container;\n  }\n\n  /**\n   * ãƒ¢ãƒ¼ãƒ‰é¸æŠï¼ˆãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³UIæ›´æ–°ï¼‰\n   */\n  selectMode(mode, isManual = false, detectedKeyword = null) {\n    this.currentMode = mode;\n\n    // å…¨ãƒœã‚¿ãƒ³ã‚’ãƒªã‚»ãƒƒãƒˆ\n    Object.keys(this.radioModeButtons).forEach(key => {\n      const { button, autoBadge } = this.radioModeButtons[key];\n      button.style.color = this.isWabiSabiMode\n        ? '#F5F5F5'\n        : (this.isDarkMode ? 'rgba(255, 255, 255, 0.7)' : 'rgba(55, 65, 81, 0.8)');\n      button.style.background = 'transparent';\n      button.style.border = '1px solid transparent';\n      button.style.transform = 'scale(1)';\n      button.style.boxShadow = 'none';\n      // AUTOãƒãƒƒã‚¸ã‚’éè¡¨ç¤º\n      autoBadge.style.display = 'none';\n      autoBadge.style.opacity = '0';\n    });\n\n    // é¸æŠã•ã‚ŒãŸãƒœã‚¿ãƒ³ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆï¼ˆ2025å¹´ä»•æ§˜ï¼‰\n    const { button, autoBadge } = this.radioModeButtons[mode];\n    \n    // 2025 Glassmorphismé¸æŠçŠ¶æ…‹\n    const selectedGlass = this.isWabiSabiMode\n      ? {\n          background: 'linear-gradient(135deg, rgba(109, 76, 65, 0.2), rgba(141, 110, 99, 0.15))',\n          border: '1px solid rgba(109, 76, 65, 0.4)',\n          boxShadow: '0 4px 16px rgba(109, 76, 65, 0.25), inset 0 1px 0 rgba(245, 245, 220, 0.15)',\n          color: '#F5F5F5'\n        }\n      : (this.isDarkMode\n        ? {\n            background: 'linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(139, 92, 246, 0.15))',\n            border: '1px solid rgba(99, 102, 241, 0.4)',\n            boxShadow: '0 4px 16px rgba(99, 102, 241, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.1)',\n            color: '#a5b4fc'\n          }\n        : {\n            background: 'linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.08))',\n            border: '1px solid rgba(99, 102, 241, 0.3)',\n            boxShadow: '0 4px 16px rgba(99, 102, 241, 0.15), inset 0 1px 0 rgba(255, 255, 255, 0.2)',\n            color: this.isWabiSabiMode ? '#8BC34A' : '#6366f1'\n          });\n\n    button.style.color = selectedGlass.color;\n    button.style.background = selectedGlass.background;\n    button.style.border = selectedGlass.border;\n    button.style.boxShadow = selectedGlass.boxShadow;\n    button.style.transform = 'scale(1.02)';\n\n    // AUTOãƒãƒƒã‚¸ã®è¡¨ç¤ºåˆ¶å¾¡\n    if (!isManual && detectedKeyword) {\n      // è‡ªå‹•åˆ‡ã‚Šæ›¿ãˆã®å ´åˆã¯AUTOãƒãƒƒã‚¸ã‚’è¡¨ç¤º\n      autoBadge.style.display = 'inline-block';\n      setTimeout(() => {\n        autoBadge.style.opacity = '1';\n        autoBadge.style.transform = 'scale(1)';\n      }, 100);\n      \n      // 3ç§’å¾Œã«ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆ\n      setTimeout(() => {\n        autoBadge.style.opacity = '0';\n        autoBadge.style.transform = 'scale(0.8)';\n        setTimeout(() => {\n          autoBadge.style.display = 'none';\n        }, 200);\n      }, 3000);\n    }\n\n    // ãƒ‘ãƒ«ã‚¹åŠ¹æœã‚’è¿½åŠ \n    if (!isManual && mode !== 'import') {\n      this.addPulseEffect(button);\n      this.addContainerGlow(mode);\n    } else if (mode === 'import') {\n      this.addContainerGlow(mode);\n    }\n\n    // ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼æ›´æ–°\n    this.input.placeholder = this.getPlaceholderForMode(mode);\n\n    // ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆæ™‚ã®å…¥åŠ›æ¬„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä¸Šæ›¸ãæ©Ÿèƒ½\n    if (isManual) {\n      this.clearInputOnModeSwitch(mode);\n    }\n\n    // Importãƒ¢ãƒ¼ãƒ‰å°‚ç”¨å‡¦ç†\n    if (mode === 'import' || this.selectedFile) {\n      this.showImportInterface();\n    } else {\n      this.hideImportInterface();\n    }\n\n    // Deleteãƒ¢ãƒ¼ãƒ‰å°‚ç”¨å‡¦ç†\n    if (mode === 'delete' && isManual) {\n      this.handleDeleteModeSelection();\n    }\n\n    // Modifyãƒ¢ãƒ¼ãƒ‰å°‚ç”¨å‡¦ç†\n    if (mode === 'modify' && isManual) {\n      this.handleModifyModeSelection();\n    }\n\n    // ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯è¡¨ç¤ºã—ãªã„ï¼ˆUIã§åˆ†ã‹ã‚‹ãŸã‚ï¼‰\n  }\n\n  /**\n   * ãƒ‘ãƒ«ã‚¹åŠ¹æœã‚’è¿½åŠ \n   */\n  addPulseEffect(element) {\n    // æ—¢å­˜ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒªã‚»ãƒƒãƒˆ\n    element.style.animation = 'none';\n    \n    // å°‘ã—é…ã‚‰ã›ã¦ã‹ã‚‰ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é©ç”¨ï¼ˆãƒªãƒ•ãƒ­ãƒ¼å¼·åˆ¶ï¼‰\n    setTimeout(() => {\n      element.style.animation = 'smartModePulse 0.6s ease-out';\n    }, 10);\n    \n    // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³çµ‚äº†å¾Œã«ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—\n    setTimeout(() => {\n      element.style.animation = '';\n    }, 610);\n    \n    // CSSã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å‹•çš„ã«è¿½åŠ ï¼ˆã¾ã å­˜åœ¨ã—ãªã„å ´åˆï¼‰\n    this.ensurePulseAnimation();\n  }\n\n  /**\n   * ãƒ‘ãƒ«ã‚¹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”¨CSSã‚’ç¢ºä¿\n   */\n  ensurePulseAnimation() {\n    if (document.getElementById('smart-mode-pulse-animation')) return;\n    \n    const style = document.createElement('style');\n    style.id = 'smart-mode-pulse-animation';\n    style.textContent = `\n      @keyframes smartModePulse {\n        0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(236, 72, 153, 0.7); }\n        70% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(236, 72, 153, 0); }\n        100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(236, 72, 153, 0); }\n      }\n    `;\n    document.head.appendChild(style);\n  }\n\n  /**\n   * ã‚³ãƒ³ãƒ†ãƒŠã‚°ãƒ­ãƒ¼åŠ¹æœ\n   */\n  addContainerGlow(mode) {\n    const container = this.radioModeContainer;\n    if (!container) return;\n\n    // ãƒ¢ãƒ¼ãƒ‰ã«å¿œã˜ã¦ã‚°ãƒ­ãƒ¼è‰²ã‚’è¨­å®š\n    const glowColors = this.isWabiSabiMode ? {\n      generate: 'rgba(139, 195, 74, 0.4)',\n      modify: 'rgba(139, 195, 74, 0.4)',\n      delete: 'rgba(139, 195, 74, 0.4)',\n      import: 'rgba(139, 195, 74, 0.4)'\n    } : {\n      generate: 'rgba(79, 70, 229, 0.4)',\n      modify: 'rgba(236, 72, 153, 0.4)',\n      delete: 'rgba(107, 114, 128, 0.3)',\n      import: 'rgba(59, 130, 246, 0.35)'\n    };\n\n    const glowColor = glowColors[mode] || glowColors.generate;\n\n    // ä¸€æ™‚çš„ã«ã‚°ãƒ­ãƒ¼åŠ¹æœã‚’é©ç”¨\n    container.style.boxShadow = `0 0 20px ${glowColor}, 0 0 40px ${glowColor}`;\n\n    const intensified = glowColor.replace('0.4', '0.6').replace('0.3', '0.5');\n    container.style.borderColor = intensified !== glowColor ? intensified : glowColor;\n    \n    // 1ç§’å¾Œã«ã‚°ãƒ­ãƒ¼åŠ¹æœã‚’é™¤å»\n    setTimeout(() => {\n      container.style.boxShadow = '';\n      container.style.borderColor = this.isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(255, 255, 255, 0.15)';\n    }, 1000);\n  }\n\n  getActionButtonStyles(variant = 'secondary') {\n    const baseStyles = `\n      border: none;\n      border-radius: 10px;\n      cursor: pointer;\n      transition: all 0.2s ease;\n      font-family: inherit;\n      outline: none;\n      font-weight: 500;\n      backdrop-filter: blur(8px);\n      -webkit-backdrop-filter: blur(8px);\n    `;\n\n    if (variant === 'secondary') {\n      // Clear All, History ãƒœã‚¿ãƒ³ç”¨ - ç¾ã—ã„é…ç½®ã¨çµ±ä¸€æ„Ÿ\n      return baseStyles + `\n        width: 90px;\n        height: 36px;\n        padding: 8px 12px;\n        font-size: 12px;\n        font-weight: 600;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        gap: 6px;\n        background: ${this.isWabiSabiMode\n          ? 'linear-gradient(135deg, rgba(141, 110, 99, 0.3), rgba(109, 76, 65, 0.2))'\n          : (this.isDarkMode\n            ? 'linear-gradient(135deg, rgba(55, 65, 81, 0.3), rgba(75, 85, 99, 0.2))'\n            : 'linear-gradient(135deg, rgba(255, 255, 255, 0.25), rgba(255, 255, 255, 0.15))')};\n        border: 1px solid ${this.isWabiSabiMode\n          ? 'rgba(93, 64, 55, 0.6)'\n          : (this.isDarkMode ? 'rgba(156, 163, 175, 0.2)' : 'rgba(255, 255, 255, 0.3)')};\n        color: ${this.isWabiSabiMode\n          ? '#F5F5F5'\n          : (this.isDarkMode ? '#d1d5db' : '#374151')};\n        text-align: center;\n        white-space: nowrap;\n      `;\n    } else if (variant === 'icon') {\n      // ãƒ†ãƒ¼ãƒãƒˆã‚°ãƒ«ã€è¨­å®šãƒœã‚¿ãƒ³ç”¨\n      return baseStyles + `\n        width: 32px;\n        height: 32px;\n        padding: 0;\n        font-size: 14px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        background: ${this.isDarkMode \n          ? 'linear-gradient(135deg, rgba(99, 102, 241, 0.15), rgba(139, 92, 246, 0.1))'\n          : 'linear-gradient(135deg, rgba(255, 255, 255, 0.3), rgba(255, 255, 255, 0.2))'};\n        border: 1px solid ${this.isDarkMode ? 'rgba(99, 102, 241, 0.2)' : 'rgba(255, 255, 255, 0.4)'};\n        color: ${this.isDarkMode ? '#a5b4fc' : '#6366f1'};\n      `;\n    }\n  }\n\n  /**\n   * ç ´å£Šçš„ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ç”¨ãƒœã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆèµ¤ç³»ã‚¬ãƒ©ã‚¹åŠ¹æœï¼‰\n   */\n  getDestructiveButtonStyles() {\n    return `\n      min-width: 50px;\n      height: 32px;\n      border: 1px solid ${this.isDarkMode ? 'rgba(220, 38, 127, 0.4)' : 'rgba(190, 24, 93, 0.35)'};\n      border-radius: 6px;\n      background: ${this.isDarkMode ? 'rgba(220, 38, 127, 0.3)' : 'rgba(190, 24, 93, 0.25)'};\n      color: ${this.isDarkMode ? '#fca5a5' : '#dc2626'};\n      cursor: pointer;\n      transition: all 0.2s ease;\n      font-family: inherit;\n      outline: none;\n      font-size: 11px;\n      font-weight: 500;\n      padding: 0 8px;\n      backdrop-filter: blur(10px);\n      -webkit-backdrop-filter: blur(10px);\n    `;\n  }\n\n  getCommandTypeIndicatorStyles() {\n    return `\n      padding: 4px 0;\n      margin-bottom: 0;\n      font-size: 11px;\n      font-weight: 400;\n      text-align: left;\n      color: ${this.isDarkMode ? 'rgba(255, 255, 255, 0.6)' : 'rgba(0, 0, 0, 0.6)'};\n      transition: all 0.3s ease;\n      border: none;\n      background: none;\n    `;\n  }\n\n  /**\n   * ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã®è‡ªå‹•ãƒªã‚µã‚¤ã‚ºå‡¦ç†ï¼ˆæœ€å¤§2è¡Œï¼‰\n   */\n  autoResizeTextarea() {\n    // é«˜ã•ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¦æ­£ç¢ºãª scrollHeight ã‚’å–å¾—\n    this.input.style.height = 'auto';\n    \n    // ç¾åœ¨ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã«åŸºã¥ã„ã¦é«˜ã•ã‚’è¨ˆç®—\n    const lineHeight = 22; // CSS ã§è¨­å®šã—ãŸ line-height\n    const padding = 28; // ä¸Šä¸‹ã®ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°åˆè¨ˆ (14px * 2)\n    const maxLines = 2;\n    const maxHeight = (lineHeight * maxLines) + padding;\n    \n    // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é«˜ã•ã«åŸºã¥ã„ã¦æ–°ã—ã„é«˜ã•ã‚’æ±ºå®š\n    const newHeight = Math.min(this.input.scrollHeight, maxHeight);\n    \n    // é«˜ã•ã‚’é©ç”¨\n    this.input.style.height = newHeight + 'px';\n    \n    // 2è¡Œã‚’è¶…ãˆã‚‹å ´åˆã¯ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’æœ‰åŠ¹åŒ–ã¨å±•é–‹ãƒœã‚¿ãƒ³è¡¨ç¤º\n    if (this.input.scrollHeight > maxHeight) {\n      this.input.style.overflowY = 'auto';\n      // å±•é–‹ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º\n      if (this.expandButton) {\n        this.expandButton.style.display = 'flex';\n      }\n    } else {\n      this.input.style.overflowY = 'hidden';\n      // å±•é–‹ãƒœã‚¿ãƒ³ã‚’éè¡¨ç¤º\n      if (this.expandButton) {\n        this.expandButton.style.display = 'none';\n      }\n    }\n  }\n\n  /**\n   * ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚³ãƒãƒ³ãƒ‰ã‚¿ã‚¤ãƒ—æ¤œå‡º\n   */\n  detectCommandType() {\n    const input = this.input.value.trim();\n    if (!input) {\n      this.selectMode('generate', false);\n      return;\n    }\n\n    const commandType = this.analyzeCommandType(input);\n\n    // Delete/Modifyã¯æ‰‹å‹•é¸æŠã‚’å„ªå…ˆã€è‡ªå‹•åˆ‡ã‚Šæ›¿ãˆã—ãªã„\n    if (this.currentMode === 'delete' || this.currentMode === 'modify') {\n      return; // ç¾åœ¨ã®ãƒ¢ãƒ¼ãƒ‰ã‚’ç¶­æŒ\n    }\n    // Generate/Importã®ã¿è‡ªå‹•åˆ‡ã‚Šæ›¿ãˆ\n    this.selectMode(commandType.type, false, commandType.detectedKeyword);\n  }\n\n  /**\n   * ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã‚³ãƒãƒ³ãƒ‰åˆ†æ\n   */\n  analyzeCommandType(text, hasSelectedObject) {\n    const trimmedText = text.trim();\n    \n    this.logDebug(`ğŸ” Analyzing command: \"${text}\"`);\n    this.logDebug(`ğŸ“‹ Selected object: ${hasSelectedObject ? 'Yes' : 'No'}`);\n    \n    // ç©ºã‚³ãƒãƒ³ãƒ‰\n    if (!trimmedText) {\n      return { type: 'empty', reason: 'ç©ºã®ã‚³ãƒãƒ³ãƒ‰' };\n    }\n\n    // ãƒ¡ãƒ‡ã‚£ã‚¢ã‚¿ã‚¤ãƒ—ã®æ¤œå‡º\n    const mediaInfo = this.detectMediaType(text);\n    \n    // 1. å‰Šé™¤ã‚³ãƒãƒ³ãƒ‰ã®æ¤œå‡ºï¼ˆæœ€å„ªå…ˆï¼‰\n    const deletePatterns = [\n      { pattern: /å‰Šé™¤/, keyword: 'å‰Šé™¤' },\n      { pattern: /æ¶ˆå»/, keyword: 'æ¶ˆå»' },\n      { pattern: /æ¶ˆã—ã¦/, keyword: 'æ¶ˆã—ã¦' },\n      { pattern: /æ¶ˆã™/, keyword: 'æ¶ˆã™' },\n      { pattern: /å–ã‚Šé™¤/, keyword: 'å–ã‚Šé™¤' },\n      { pattern: /é™¤å»/, keyword: 'é™¤å»' },\n      { pattern: /å‰Šé™¤ã—ã¦/, keyword: 'å‰Šé™¤ã—ã¦' },\n      { pattern: /delete/i, keyword: 'delete' },\n      { pattern: /remove/i, keyword: 'remove' },\n      { pattern: /clear/i, keyword: 'clear' },\n      { pattern: /erase/i, keyword: 'erase' }\n    ];\n    \n    for (const { pattern, keyword } of deletePatterns) {\n      if (pattern.test(text)) {\n        this.logDebug(`âœ… Delete pattern matched: ${keyword}`);\n        return {\n          type: 'delete',\n          confidence: 0.9,\n          reason: 'å‰Šé™¤ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’æ¤œå‡º',\n          mediaType: mediaInfo.type,\n          requiresConfirmation: true,\n          detectedKeyword: keyword,\n          needsTarget: true\n        };\n      }\n    }\n    \n    // 2. æ˜ç¢ºãªç”Ÿæˆã‚³ãƒãƒ³ãƒ‰ã®æ¤œå‡ºï¼ˆé¸æŠçŠ¶æ…‹ã«é–¢ä¿‚ãªãï¼‰\n    const generatePatterns = [\n      { pattern: /ä½œã£ã¦/, keyword: 'ä½œã£ã¦' },\n      { pattern: /ã¤ãã£ã¦/, keyword: 'ã¤ãã£ã¦' },\n      { pattern: /ç”Ÿæˆ/, keyword: 'ç”Ÿæˆ' },\n      { pattern: /ä½œæˆ/, keyword: 'ä½œæˆ' },\n      { pattern: /æã„ã¦/, keyword: 'æã„ã¦' },\n      { pattern: /æ›¸ã„ã¦/, keyword: 'æ›¸ã„ã¦' },\n      { pattern: /create/i, keyword: 'create' },\n      { pattern: /generate/i, keyword: 'generate' },\n      { pattern: /make/i, keyword: 'make' },\n      { pattern: /draw/i, keyword: 'draw' }\n    ];\n    \n    for (const { pattern, keyword } of generatePatterns) {\n      if (pattern.test(text)) {\n        this.logDebug(`âœ… Generate pattern matched: ${keyword}`);\n        return {\n          type: 'generate',\n          confidence: mediaInfo.confidence,\n          reason: 'ç”Ÿæˆã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’æ¤œå‡º',\n          mediaType: mediaInfo.type,\n          requiresConfirmation: false,\n          detectedKeyword: keyword,\n          needsTarget: false\n        };\n      }\n    }\n    \n    // 3. è‡ªç„¶è¨€èªã§ã®å¯¾è±¡æŒ‡å®šï¼ˆç¢ºå®Ÿã«modifyï¼‰\n    const targetPatterns = [\n      /ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ãŸ.*ã‚’/,\n      /é¸æŠã—ãŸ.*ã‚’/,\n      /ã“ã®.*ã‚’/,\n      /ãã®.*ã‚’/,\n      /ã‚ã®.*ã‚’/,\n      /[0-9]+ç•ªç›®.*ã‚’/,\n      /æœ€åˆ.*ã‚’/,\n      /åˆå›.*ã‚’/,\n      /ç”Ÿæˆã—ãŸ.*ã‚’/,\n      /ä½œã£ãŸ.*ã‚’/,\n      /.+ã®(ç”»åƒ|å†™çœŸ|ã‚¤ãƒ¡ãƒ¼ã‚¸|çµµ|ã‚¤ãƒ©ã‚¹ãƒˆ|ãƒ”ã‚¯ãƒãƒ£ãƒ¼)(ã‚’|ã«)/,\n      /.+ã®(å‹•ç”»|ãƒ“ãƒ‡ã‚ª|ãƒ ãƒ¼ãƒ“ãƒ¼|æ˜ åƒ|ã‚¯ãƒªãƒƒãƒ—)(ã‚’|ã«)/,\n      /(.+?)(ç”»åƒ|å†™çœŸ|ã‚¤ãƒ¡ãƒ¼ã‚¸|çµµ|ã‚¤ãƒ©ã‚¹ãƒˆ|ãƒ”ã‚¯ãƒãƒ£ãƒ¼)ã‚’.*(å¤‰ãˆã¦|å¤‰æ›´|ã«ã—ã¦|åŠ å·¥|ç·¨é›†|èª¿æ•´|å¡—ã‚Š|ä¸¦ã¹|ç§»å‹•|å›è»¢|åè»¢|æ•´åˆ—)/,\n      /(.+?)(å‹•ç”»|ãƒ“ãƒ‡ã‚ª|ãƒ ãƒ¼ãƒ“ãƒ¼|æ˜ åƒ|ã‚¯ãƒªãƒƒãƒ—)ã‚’.*(å¤‰ãˆã¦|å¤‰æ›´|ã«ã—ã¦|åŠ å·¥|ç·¨é›†|èª¿æ•´|å¡—ã‚Š|ä¸¦ã¹|ç§»å‹•|å›è»¢|åè»¢|æ•´åˆ—)/\n    ];\n\n    const explicitTargetMatched = targetPatterns.some(pattern => pattern.test(text));\n    if (explicitTargetMatched) {\n      this.logDebug('âœ… Target reference pattern matched');\n      return {\n        type: 'modify',\n        confidence: 0.9,\n        reason: 'å¯¾è±¡ã‚’æ˜ç¤ºçš„ã«æŒ‡å®š',\n        mediaType: mediaInfo.type,\n        requiresConfirmation: false,\n        needsTarget: true,\n        hasExplicitTarget: true\n      };\n    }\n\n    // 4. é¸æŠã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒã‚ã‚‹å ´åˆã®å‡¦ç†\n    if (hasSelectedObject && trimmedText) {\n      // æ–°è¦ä½œæˆæ„å›³ã§ãªã‘ã‚Œã°modify\n      if (!/ã®ç”»åƒ|ã®å‹•ç”»|ç”»åƒã‚’|å‹•ç”»ã‚’|ç”»åƒ$|å‹•ç”»$/.test(text)) {\n        this.logDebug(`âœ… Selected object + command = modify`);\n        return {\n          type: 'modify',\n          confidence: 0.8,\n          reason: 'é¸æŠã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¯¾ã™ã‚‹å¤‰æ›´',\n          mediaType: mediaInfo.type,\n          requiresConfirmation: false,\n          needsTarget: false  // æ—¢ã«é¸æŠæ¸ˆã¿\n        };\n      }\n    }\n\n    // 5. å¤‰æ›´ç³»ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒå«ã¾ã‚Œã‚‹å ´åˆï¼ˆå¯¾è±¡æœªé¸æŠã§ã‚‚modifyåˆ¤å®šï¼‰\n    const modificationIndicators = /(ã«ã—ã¦|ã«å¤‰ãˆã¦|ã¸å¤‰ãˆã¦|ã¸å¤‰æ›´|å¤‰ãˆã¦|å¤‰æ›´|èª¿æ•´|åŠ å·¥|ç·¨é›†|å¡—(ã£ã¦|ã‚Š)|æŸ“ã‚|å½©è‰²|å½©åº¦|æ˜ã‚‹ã|æš—ã|è–„ã|æ¿ƒã|ã¼ã‹ã—|ã‚·ãƒ£ãƒ¼ãƒ—|å·¦å³åè»¢|ä¸Šä¸‹åè»¢|åè»¢|å›è»¢|ç§»å‹•|ä¸¦ã¹|æ•´åˆ—|æƒãˆ|å¯„ã›ã¦|æ‹¡å¤§|ç¸®å°|å¤§ãã|å°ã•ã|ä¼¸ã°ã—ã¦|ç¸®ã‚ã¦|é«˜ã|ä½ã|è¿‘ã¥ã‘|é ã–ã‘|é€æ˜|åŠé€æ˜|ä¸é€æ˜|é€é|èƒŒæ™¯ã‚’é€é|èƒŒæ™¯é€é|èƒŒæ™¯ã‚’æ¶ˆ|èƒŒæ™¯æ¶ˆ|èƒŒæ™¯æŠœ|è¼ã‹ã›ã¦|å…‰ã‚‰ã›ã¦|æš—ãã—ã¦|ç„¼ãè¾¼ã¿|ç„¼ãä»˜ã‘|flip|rotate|move|align|scale|resize|tint|color|brighten|darken|adjust|edit|modify)/i;\n    const mediaReferenceIndicators = /(ç”»åƒ|å†™çœŸ|ã‚¤ãƒ¡ãƒ¼ã‚¸|çµµ|ã‚¤ãƒ©ã‚¹ãƒˆ|ãƒ”ã‚¯ãƒãƒ£ãƒ¼|ãƒ¡ãƒ‡ã‚£ã‚¢|ç´ æ|å‹•ç”»|ãƒ“ãƒ‡ã‚ª|ãƒ ãƒ¼ãƒ“ãƒ¼|æ˜ åƒ|ã‚¯ãƒªãƒƒãƒ—|ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ|ãƒ¢ãƒ‡ãƒ«)/i;\n\n    if (modificationIndicators.test(text)) {\n      this.logDebug('âœ… Modification indicators detected');\n      return {\n        type: 'modify',\n        confidence: 0.7,\n        reason: 'å¤‰æ›´ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’æ¤œå‡º',\n        mediaType: mediaInfo.type,\n        requiresConfirmation: false,\n        needsTarget: !hasSelectedObject,\n        hasExplicitTarget: explicitTargetMatched || mediaReferenceIndicators.test(text)\n      };\n    }\n\n    // 6. ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼ˆå®‰å…¨ãªç”Ÿæˆï¼‰\n    this.logDebug(`â„¹ï¸ Defaulting to generate mode`);\n    return {\n      type: 'generate',\n      confidence: mediaInfo.confidence,\n      reason: 'ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå‹•ä½œï¼ˆæ–°è¦ç”Ÿæˆï¼‰',\n      mediaType: mediaInfo.type,\n      requiresConfirmation: false,\n      needsTarget: false\n    };\n  }\n\n  /**\n   * Extract all command keywords from the analyzeCommandType patterns\n   * Returns an array of {pattern, keyword, type} objects\n   */\n  getAllCommandKeywords() {\n    const deletePatterns = [\n      { pattern: /å‰Šé™¤/, keyword: 'å‰Šé™¤', type: 'delete' },\n      { pattern: /æ¶ˆå»/, keyword: 'æ¶ˆå»', type: 'delete' },\n      { pattern: /æ¶ˆã—ã¦/, keyword: 'æ¶ˆã—ã¦', type: 'delete' },\n      { pattern: /æ¶ˆã™/, keyword: 'æ¶ˆã™', type: 'delete' },\n      { pattern: /å–ã‚Šé™¤/, keyword: 'å–ã‚Šé™¤', type: 'delete' },\n      { pattern: /é™¤å»/, keyword: 'é™¤å»', type: 'delete' },\n      { pattern: /å‰Šé™¤ã—ã¦/, keyword: 'å‰Šé™¤ã—ã¦', type: 'delete' },\n      { pattern: /delete/i, keyword: 'delete', type: 'delete' },\n      { pattern: /remove/i, keyword: 'remove', type: 'delete' },\n      { pattern: /clear/i, keyword: 'clear', type: 'delete' },\n      { pattern: /erase/i, keyword: 'erase', type: 'delete' }\n    ];\n    \n    const modifyPatterns = [\n      { pattern: /ç§»å‹•/, keyword: 'ç§»å‹•', type: 'modify' },\n      { pattern: /å‹•ã‹ã—ã¦/, keyword: 'å‹•ã‹ã—ã¦', type: 'modify' },\n      { pattern: /å¤‰æ›´/, keyword: 'å¤‰æ›´', type: 'modify' },\n      { pattern: /å¤‰ãˆã¦/, keyword: 'å¤‰ãˆã¦', type: 'modify' },\n      { pattern: /ä¿®æ­£/, keyword: 'ä¿®æ­£', type: 'modify' },\n      { pattern: /èª¿æ•´/, keyword: 'èª¿æ•´', type: 'modify' },\n      { pattern: /move/i, keyword: 'move', type: 'modify' },\n      { pattern: /change/i, keyword: 'change', type: 'modify' },\n      { pattern: /modify/i, keyword: 'modify', type: 'modify' },\n      { pattern: /edit/i, keyword: 'edit', type: 'modify' }\n    ];\n    \n    const generatePatterns = [\n      { pattern: /ä½œã£ã¦/, keyword: 'ä½œã£ã¦', type: 'generate' },\n      { pattern: /ç”Ÿæˆ/, keyword: 'ç”Ÿæˆ', type: 'generate' },\n      { pattern: /ä½œæˆ/, keyword: 'ä½œæˆ', type: 'generate' },\n      { pattern: /æã„ã¦/, keyword: 'æã„ã¦', type: 'generate' },\n      { pattern: /æ›¸ã„ã¦/, keyword: 'æ›¸ã„ã¦', type: 'generate' },\n      { pattern: /create/i, keyword: 'create', type: 'generate' },\n      { pattern: /generate/i, keyword: 'generate', type: 'generate' },\n      { pattern: /make/i, keyword: 'make', type: 'generate' },\n      { pattern: /draw/i, keyword: 'draw', type: 'generate' }\n    ];\n\n    return [...deletePatterns, ...modifyPatterns, ...generatePatterns];\n  }\n\n  /**\n   * Apply keyword highlighting to the input text\n   */\n  applyKeywordHighlighting() {\n    // TODO: ä¸€æ™‚çš„ã«ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒã‚¤ãƒ©ã‚¤ãƒˆæ©Ÿèƒ½ã‚’ç„¡åŠ¹åŒ–ï¼ˆãƒªãƒªãƒ¼ã‚¹å¾Œã«å†æ¤œè¨ï¼‰\n    return;\n\n    if (!this.input || this.isComposing) {\n      return;\n    }\n\n    const text = this.input.value;\n    if (!text.trim()) {\n      this.clearKeywordHighlighting();\n      return;\n    }\n\n    // Get all keyword patterns\n    const allKeywords = this.getAllCommandKeywords();\n    \n    // Find matches in the text\n    const matches = [];\n    for (const { pattern, keyword, type } of allKeywords) {\n      const match = text.match(pattern);\n      if (match) {\n        const startIndex = match.index;\n        const endIndex = startIndex + match[0].length;\n        matches.push({\n          start: startIndex,\n          end: endIndex,\n          keyword: match[0], // Use actual matched text\n          type: type\n        });\n      }\n    }\n\n    // Sort matches by position to avoid overlaps\n    matches.sort((a, b) => a.start - b.start);\n\n    // Apply highlighting if we have matches\n    if (matches.length > 0) {\n      this.createHighlightOverlay(text, matches);\n    } else {\n      this.clearKeywordHighlighting();\n    }\n  }\n\n  /**\n   * Create a highlighting overlay div that sits behind the textarea\n   */\n  createHighlightOverlay(text, matches) {\n    // Remove existing overlay\n    this.clearKeywordHighlighting();\n\n    // Create highlight overlay div\n    this.highlightOverlay = document.createElement('div');\n    this.highlightOverlay.className = 'keyword-highlight-overlay';\n    \n    // Copy textarea styles to overlay\n    const computedStyle = window.getComputedStyle(this.input);\n\n    if (!this.inputDefaultStyles) {\n      this.captureInputDefaultStyles();\n    }\n    this.highlightOverlay.style.cssText = `\n      position: absolute;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      pointer-events: none;\n      white-space: pre-wrap;\n      word-wrap: break-word;\n      overflow: hidden;\n      font-family: ${computedStyle.fontFamily};\n      font-size: ${computedStyle.fontSize};\n      font-weight: ${computedStyle.fontWeight};\n      line-height: ${computedStyle.lineHeight};\n      letter-spacing: ${computedStyle.letterSpacing};\n      padding: ${computedStyle.padding};\n      border: ${computedStyle.borderWidth} solid transparent;\n      margin: 0;\n      z-index: 1;\n      color: transparent;\n      background: transparent;\n    `;\n\n    // Build highlighted HTML\n    let highlightedHTML = '';\n    let lastIndex = 0;\n\n    for (const match of matches) {\n      // Add text before this match\n      highlightedHTML += this.escapeHtml(text.substring(lastIndex, match.start));\n      \n      // Add highlighted keyword\n      const color = this.getKeywordColor(match.type);\n      highlightedHTML += `<span style=\"color: ${color}; font-weight: 600; background: linear-gradient(135deg, ${color}22 0%, ${color}11 100%); border-radius: 3px; padding: 1px 2px;\">${this.escapeHtml(match.keyword)}</span>`;\n      \n      lastIndex = match.end;\n    }\n\n    // Add remaining text\n    highlightedHTML += this.escapeHtml(text.substring(lastIndex));\n\n    this.highlightOverlay.innerHTML = highlightedHTML;\n\n    // Make textarea background transparent so overlay shows through\n    this.input.style.background = 'transparent';\n    this.input.style.backgroundColor = 'transparent';\n    this.input.style.backgroundImage = 'none';\n    this.input.style.color = this.getInputTextColor();\n\n    // Insert overlay before textarea\n    this.inputWrapper.insertBefore(this.highlightOverlay, this.input);\n  }\n\n  /**\n   * Get the appropriate color for each keyword type\n   */\n  getKeywordColor(type) {\n    return KEYWORD_HIGHLIGHT_COLOR;\n  }\n\n  getInputTextColor() {\n    if (this.isWabiSabiMode) {\n      return '#F5F5F5';\n    }\n    return this.isDarkMode ? '#ffffff' : '#1f2937';\n  }\n\n  captureInputDefaultStyles() {\n    if (!this.input) {\n      return;\n    }\n    const computedStyle = window.getComputedStyle(this.input);\n    this.inputDefaultStyles = {\n      background: computedStyle.background,\n      backgroundImage: computedStyle.backgroundImage,\n      backgroundColor: computedStyle.backgroundColor,\n      color: computedStyle.color\n    };\n  }\n\n  /**\n   * Clear keyword highlighting\n   */\n  clearKeywordHighlighting() {\n    if (this.highlightOverlay) {\n      this.highlightOverlay.remove();\n      this.highlightOverlay = null;\n    }\n    \n    // Restore textarea background\n    if (this.input) {\n      if (this.inputDefaultStyles) {\n        this.input.style.background = this.inputDefaultStyles.background;\n        this.input.style.backgroundImage = this.inputDefaultStyles.backgroundImage;\n        this.input.style.backgroundColor = this.inputDefaultStyles.backgroundColor;\n        this.input.style.color = this.inputDefaultStyles.color;\n      } else {\n        this.input.style.background = '';\n        this.input.style.backgroundImage = '';\n        this.input.style.backgroundColor = '';\n        this.input.style.color = '';\n      }\n    }\n  }\n\n  /**\n   * Escape HTML characters\n   */\n  escapeHtml(text) {\n    const div = document.createElement('div');\n    div.textContent = text;\n    return div.innerHTML;\n  }\n\n  /**\n   * ãƒ¡ãƒ‡ã‚£ã‚¢ã‚¿ã‚¤ãƒ—æ¤œå‡ºï¼ˆç”»åƒ/å‹•ç”»ï¼‰\n   */\n  detectMediaType(text) {\n    const videoPatterns = [\n      /å‹•ç”»|ãƒ“ãƒ‡ã‚ª|æ˜ åƒ|ãƒ ãƒ¼ãƒ“ãƒ¼/,\n      /video|movie|clip/i\n    ];\n    \n    const imagePatterns = [\n      /ç”»åƒ|å†™çœŸ|çµµ|ã‚¤ãƒ©ã‚¹ãƒˆ|ã‚¤ãƒ¡ãƒ¼ã‚¸/,\n      /image|picture|photo|illustration/i\n    ];\n    \n    if (videoPatterns.some(pattern => pattern.test(text))) {\n      return {\n        type: 'video',\n        confidence: 0.8,\n        reason: 'å‹•ç”»ç”Ÿæˆã‚³ãƒãƒ³ãƒ‰'\n      };\n    }\n    \n    if (imagePatterns.some(pattern => pattern.test(text))) {\n      return {\n        type: 'image',\n        confidence: 0.8,\n        reason: 'ç”»åƒç”Ÿæˆã‚³ãƒãƒ³ãƒ‰'\n      };\n    }\n    \n    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ç”»åƒ\n    return {\n      type: 'image',\n      confidence: 0.6,\n      reason: 'ç”Ÿæˆã‚³ãƒãƒ³ãƒ‰ï¼ˆç”»åƒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰'\n    };\n  }\n\n  /**\n   * ã‚³ãƒãƒ³ãƒ‰ã‚¿ã‚¤ãƒ—ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼è¡¨ç¤º\n   */\n  showCommandTypeIndicator(commandInfo) {\n    const { type, confidence, reason } = commandInfo;\n    \n    const typeLabels = {\n      generate: 'ğŸ¨ ç”Ÿæˆãƒ¢ãƒ¼ãƒ‰',\n      modify: 'âœï¸ å¤‰æ›´ãƒ¢ãƒ¼ãƒ‰',\n      delete: 'ğŸ—‘ï¸ å‰Šé™¤ãƒ¢ãƒ¼ãƒ‰'\n    };\n    \n    const typeColors = {\n      generate: 'linear-gradient(135deg, #4f46e5, #4338ca)',\n      modify: 'linear-gradient(135deg, #ec4899, #be185d)',\n      delete: 'rgba(107, 114, 128, 0.15)'\n    };\n    \n    // Proactive UX: ä½ä¿¡é ¼åº¦æ™‚ã«ææ¡ˆè¡¨ç¤º\n    if (confidence < 0.7) {\n      this.showProactiveSuggestion(type, confidence);\n    } else {\n      this.hideProactiveSuggestion();\n    }\n    \n    // æ—§ã‚³ãƒãƒ³ãƒ‰ã‚¿ã‚¤ãƒ—ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã¯å‰Šé™¤ï¼ˆãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³UIã«çµ±åˆæ¸ˆã¿ï¼‰\n    // this.commandTypeIndicator.textContent = `â—¯ ${typeLabels[type].replace('ğŸ¨ ', '').replace('âœï¸ ', '').replace('ğŸ—‘ï¸ ', '')}`;\n    // this.commandTypeIndicator.style.display = 'block';\n    // this.commandTypeIndicator.style.cursor = 'default';\n    \n    // ã‚¹ãƒ¯ã‚¤ãƒ—ã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼å¯¾å¿œ\n    this.enableGestureControl();\n  }\n\n  /**\n   * Proactive UX: ä½ä¿¡é ¼åº¦æ™‚ã®ææ¡ˆè¡¨ç¤º\n   */\n  showProactiveSuggestion(detectedType, confidence) {\n    if (!this.proactiveSuggestion) {\n      this.proactiveSuggestion = document.createElement('div');\n      this.proactiveSuggestion.id = 'proactive-suggestion';\n      this.proactiveSuggestion.style.cssText = `\n        margin-bottom: 0;\n        padding: 10px;\n        background: rgba(255, 193, 7, 0.15);\n        border: 1px solid rgba(255, 193, 7, 0.3);\n        border-radius: 8px;\n        font-size: 12px;\n        color: #ffc107;\n        text-align: center;\n        cursor: pointer;\n        transition: all 0.2s ease;\n      `;\n      // æ—§ã‚³ãƒãƒ³ãƒ‰ã‚¿ã‚¤ãƒ—ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã¯å‰Šé™¤ï¼ˆãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³UIã«çµ±åˆæ¸ˆã¿ï¼‰\n      // ä»£ã‚ã‚Šã«å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å‰ã«æŒ¿å…¥\n      this.container.insertBefore(this.proactiveSuggestion, this.input);\n    }\n\n    const alternativeTypes = ['generate', 'modify', 'delete'].filter(t => t !== detectedType);\n    const suggestion = alternativeTypes[0]; // æœ€åˆã®ä»£æ›¿æ¡ˆ\n\n    const suggestionLabels = {\n      generate: 'ğŸ¨ ç”Ÿæˆ',\n      modify: 'âœï¸ å¤‰æ›´', \n      delete: 'ğŸ—‘ï¸ å‰Šé™¤'\n    };\n\n    this.proactiveSuggestion.innerHTML = `\n      ğŸ’¡ ã‚‚ã—ã‹ã—ã¦ã€Œ${suggestionLabels[suggestion]}ãƒ¢ãƒ¼ãƒ‰ã€ã§ã™ã‹ï¼Ÿ\n      <div style=\"margin-top: 4px; font-size: 10px; opacity: 0.8;\">\n        ã‚¯ãƒªãƒƒã‚¯ã§å¤‰æ›´ | ã‚¹ãƒ¯ã‚¤ãƒ—ã§é¸æŠ\n      </div>\n    `;\n    \n    this.proactiveSuggestion.style.display = 'block';\n    \n    // ã‚¯ãƒªãƒƒã‚¯ã§ææ¡ˆãƒ¢ãƒ¼ãƒ‰ã«å¤‰æ›´\n    this.proactiveSuggestion.onclick = () => {\n      this.currentMode = suggestion;\n      this.hideProactiveSuggestion();\n      this.updateIndicatorForMode(suggestion, 0.9);\n    };\n  }\n\n  /**\n   * Proactive UXææ¡ˆã‚’éè¡¨ç¤º\n   */\n  hideProactiveSuggestion() {\n    if (this.proactiveSuggestion) {\n      this.proactiveSuggestion.style.display = 'none';\n    }\n  }\n\n  /**\n   * æŒ‡å®šãƒ¢ãƒ¼ãƒ‰ã§ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼æ›´æ–°\n   */\n  updateIndicatorForMode(mode, confidence) {\n    const typeLabels = {\n      generate: 'ğŸ¨ ç”Ÿæˆãƒ¢ãƒ¼ãƒ‰',\n      modify: 'âœï¸ å¤‰æ›´ãƒ¢ãƒ¼ãƒ‰',\n      delete: 'ğŸ—‘ï¸ å‰Šé™¤ãƒ¢ãƒ¼ãƒ‰'\n    };\n    \n    const typeColors = {\n      generate: 'linear-gradient(135deg, #4f46e5, #4338ca)',\n      modify: 'linear-gradient(135deg, #ec4899, #be185d)',\n      delete: 'rgba(107, 114, 128, 0.15)'\n    };\n\n    // æ—§ã‚³ãƒãƒ³ãƒ‰ã‚¿ã‚¤ãƒ—ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã¯å‰Šé™¤ï¼ˆãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³UIã«çµ±åˆæ¸ˆã¿ï¼‰\n    // this.commandTypeIndicator.textContent = `â—¯ ${typeLabels[mode].replace('ğŸ¨ ', '').replace('âœï¸ ', '').replace('ğŸ—‘ï¸ ', '')}`;\n  }\n\n  /**\n   * ã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«æœ‰åŠ¹åŒ–\n   */\n  enableGestureControl() {\n    // æ—§ã‚¹ãƒ¯ã‚¤ãƒ—ã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼æ©Ÿèƒ½ã¯å‰Šé™¤ï¼ˆãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³UIã«çµ±åˆæ¸ˆã¿ï¼‰\n    // ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ã§ç›´æ¥ãƒ¢ãƒ¼ãƒ‰é¸æŠå¯èƒ½ã«ãªã£ãŸãŸã‚ã€ã‚¹ãƒ¯ã‚¤ãƒ—æ“ä½œã¯ä¸è¦\n    this.gestureEnabled = true;\n  }\n\n  /**\n   * ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ä½œæˆ\n   */\n  createActionButtons() {\n    const container = document.createElement('div');\n    container.style.cssText = `\n      display: flex;\n      margin-top: 8px;\n      gap: 8px;\n    `;\n\n    // å±¥æ­´ãƒœã‚¿ãƒ³å‰Šé™¤ - ã‚¿ã‚¹ã‚¯é€²è¡ŒçŠ¶æ³ã«ç½®ãæ›ãˆæ¸ˆã¿\n\n    // ã‚¯ãƒªã‚¢ã‚ªãƒ¼ãƒ«ãƒœã‚¿ãƒ³\n    const clearBtn = document.createElement('button');\n    clearBtn.innerHTML = 'ğŸ§¹ å…¨å‰Šé™¤';\n    clearBtn.style.cssText = this.getModernButtonStyles('danger');\n    clearBtn.addEventListener('click', () => this.clearAll());\n\n    // historyBtnå‰Šé™¤æ¸ˆã¿\n    container.appendChild(clearBtn);\n\n    return container;\n  }\n\n  /**\n   * ã‚¹ã‚¿ã‚¤ãƒ«å®šç¾©\n   */\n  getContainerStyles() {\n    const positions = {\n      'bottom-right': 'bottom: 20px; right: 20px;',\n      'bottom-left': 'bottom: 20px; left: 20px;',\n      'top-right': 'top: 20px; right: 20px;',\n      'top-left': 'top: 20px; left: 20px;',\n      'center': 'top: 50%; left: 50%; transform: translate(-50%, -50%);'\n    };\n\n    // 2025 Glassmorphismä»•æ§˜ï¼šãƒ€ãƒ¼ã‚¯ãƒ»ãƒ©ã‚¤ãƒˆä¸¡å¯¾å¿œ\n    const glassmorphismDark = {\n      background: 'linear-gradient(135deg, rgba(15, 23, 42, 0.7), rgba(30, 27, 75, 0.65))',\n      backdropFilter: 'blur(24px) saturate(180%)',\n      border: '1px solid rgba(99, 102, 241, 0.2)',\n      boxShadow: '0 8px 32px rgba(15, 23, 42, 0.4), 0 0 0 1px rgba(99, 102, 241, 0.1), inset 0 1px 0 rgba(255, 255, 255, 0.1)'\n    };\n\n    const glassmorphismLight = {\n      background: 'linear-gradient(135deg, rgba(255, 255, 255, 0.25), rgba(255, 255, 255, 0.15))',\n      backdropFilter: 'blur(24px) saturate(180%)',\n      border: '1px solid rgba(255, 255, 255, 0.4)',\n      boxShadow: '0 8px 32px rgba(0, 0, 0, 0.1), 0 0 0 1px rgba(255, 255, 255, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.3)'\n    };\n\n    // ä¾˜ã³å¯‚ã³ãƒ¢ãƒ¼ãƒ‰ - æ¯å±±æ°´ã®é™å¯‚ï¼šç‹¬è‡ªã®ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£\n    const glassmorphismWabiSabi = {\n      background: 'linear-gradient(135deg, rgba(97, 97, 97, 0.7), rgba(66, 66, 66, 0.6))',\n      backdropFilter: 'blur(20px) saturate(120%)',\n      border: '1px solid rgba(93, 64, 55, 0.5)',\n      boxShadow: '0 8px 32px rgba(33, 33, 33, 0.4), 0 0 0 1px rgba(93, 64, 55, 0.4), inset 0 1px 0 rgba(189, 189, 189, 0.15)'\n    };\n\n    const theme = this.isWabiSabiMode ? glassmorphismWabiSabi : (this.isDarkMode ? glassmorphismDark : glassmorphismLight);\n\n    return `\n      position: fixed;\n      ${positions[this.config.position] || positions['bottom-right']}\n      width: 320px;\n      max-height: ${this.config.maxHeight}px;\n      background: ${theme.background};\n      border: ${theme.border};\n      border-radius: 20px;\n      color: ${this.isDarkMode ? '#ffffff' : '#1f2937'};\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Inter', sans-serif;\n      font-size: 14px;\n      z-index: 1000;\n      padding: 16px !important;\n      box-shadow: ${theme.boxShadow};\n      backdrop-filter: ${theme.backdropFilter};\n      -webkit-backdrop-filter: ${theme.backdropFilter};\n      display: none;\n      flex-direction: column;\n      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n    `;\n  }\n\n  getHeaderStyles() {\n    // ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ã¨åŒã˜ç´«ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã§çµ±ä¸€\n    const gradientColors = 'linear-gradient(135deg, #4f46e5, #7c3aed)';\n\n    return `\n      margin-bottom: 20px;\n      text-align: center;\n      background: ${gradientColors};\n      -webkit-background-clip: text;\n      -webkit-text-fill-color: transparent;\n      background-clip: text;\n      font-weight: 800;\n      font-size: 18px;\n      border-bottom: 1px solid rgba(79, 70, 229, 0.2);\n      padding-bottom: 12px;\n    `;\n  }\n\n  getOutputStyles() {\n    // ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã®CSSã‚’æ³¨å…¥\n    this.addScrollbarStyles();\n\n    return `\n      height: 200px;\n      overflow-y: auto;\n      background: ${this.isDarkMode ? 'rgba(255, 255, 255, 0.05)' : 'rgba(255, 255, 255, 0.1)'};\n      border: 1px solid ${this.isDarkMode ? 'rgba(255, 255, 255, 0.15)' : 'rgba(255, 255, 255, 0.2)'};\n      border-radius: 12px;\n      padding: 12px;\n      margin-bottom: 16px;\n      font-size: 12px;\n      line-height: 1.4;\n      backdrop-filter: blur(8px);\n\n      /* ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒ« */\n      scrollbar-width: thin;\n      scrollbar-color: ${this.isDarkMode ? 'rgba(255, 255, 255, 0.3) rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.3) rgba(0, 0, 0, 0.1)'};\n    `;\n  }\n\n  /**\n   * ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã®ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ãƒšãƒ¼ã‚¸ã«æ³¨å…¥\n   */\n  addScrollbarStyles() {\n    if (document.getElementById('custom-scrollbar-styles')) return;\n\n    const style = document.createElement('style');\n    style.id = 'custom-scrollbar-styles';\n    style.textContent = `\n      .command-output::-webkit-scrollbar {\n        width: 8px;\n      }\n\n      .command-output::-webkit-scrollbar-track {\n        background: ${this.isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)'};\n        border-radius: 4px;\n      }\n\n      .command-output::-webkit-scrollbar-thumb {\n        background: ${this.isDarkMode ? 'rgba(255, 255, 255, 0.3)' : 'rgba(0, 0, 0, 0.3)'};\n        border-radius: 4px;\n        transition: background 0.2s ease;\n      }\n\n      .command-output::-webkit-scrollbar-thumb:hover {\n        background: ${this.isDarkMode ? 'rgba(255, 255, 255, 0.5)' : 'rgba(0, 0, 0, 0.5)'};\n      }\n\n      /* ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ç”¨ */\n      .dark-mode .command-output::-webkit-scrollbar-track {\n        background: rgba(255, 255, 255, 0.1);\n      }\n\n      .dark-mode .command-output::-webkit-scrollbar-thumb {\n        background: rgba(255, 255, 255, 0.3);\n      }\n\n      .dark-mode .command-output::-webkit-scrollbar-thumb:hover {\n        background: rgba(255, 255, 255, 0.5);\n      }\n\n      /* ãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰ç”¨ */\n      .light-mode .command-output::-webkit-scrollbar-track {\n        background: rgba(0, 0, 0, 0.1);\n      }\n\n      .light-mode .command-output::-webkit-scrollbar-thumb {\n        background: rgba(0, 0, 0, 0.3);\n      }\n\n      .light-mode .command-output::-webkit-scrollbar-thumb:hover {\n        background: rgba(0, 0, 0, 0.5);\n      }\n\n      @keyframes shimmer {\n        0% { background-position: -200% 0; }\n        100% { background-position: 200% 0; }\n      }\n\n      /* 2025å¹´ãƒˆãƒ¬ãƒ³ãƒ‰: å¾®ç´°ãªæµ®éŠæ„Ÿã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */\n      @keyframes gentleFloat {\n        0%, 100% { \n          transform: translateY(0px) scale(1);\n        }\n        25% { \n          transform: translateY(-2px) scale(1.005);\n        }\n        50% { \n          transform: translateY(-1px) scale(1.002);\n        }\n        75% { \n          transform: translateY(-3px) scale(1.008);\n        }\n      }\n\n      /* ã‚¿ã‚¹ã‚¯ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ³ãƒ†ãƒŠã®ãƒ›ãƒãƒ¼åŠ¹æœ */\n      .task-status-container:hover .progress-bar {\n        box-shadow: 0 0 20px rgba(255,123,71,0.6) !important;\n        transform: scaleY(1.1);\n      }\n\n      /* ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã®å¾®ç´°ãªã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */\n      .progress-bar {\n        position: relative;\n      }\n\n      .progress-bar::after {\n        content: '';\n        position: absolute;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        background: linear-gradient(90deg, \n          transparent, \n          rgba(255,255,255,0.4), \n          transparent);\n        animation: progress-shine 2s ease-in-out infinite;\n      }\n\n      @keyframes progress-shine {\n        0% { transform: translateX(-100%); }\n        100% { transform: translateX(100%); }\n      }\n    `;\n\n    document.head.appendChild(style);\n  }\n\n  getInputStyles() {\n    // 2025 Glassmorphismä»•æ§˜ï¼šå…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰\n    const glassmorphismDark = {\n      background: 'linear-gradient(135deg, rgba(30, 27, 75, 0.4), rgba(15, 23, 42, 0.5))',\n      border: '1px solid rgba(99, 102, 241, 0.25)',\n      boxShadow: '0 4px 16px rgba(15, 23, 42, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.08)'\n    };\n\n    const glassmorphismLight = {\n      background: 'linear-gradient(135deg, rgba(255, 255, 255, 0.3), rgba(255, 255, 255, 0.2))',\n      border: '1px solid rgba(255, 255, 255, 0.5)',\n      boxShadow: '0 4px 16px rgba(0, 0, 0, 0.08), inset 0 1px 0 rgba(255, 255, 255, 0.4)'\n    };\n\n    const glassmorphismWabiSabi = {\n      background: 'linear-gradient(135deg, rgba(97, 97, 97, 0.4), rgba(66, 66, 66, 0.3))',\n      border: '1px solid rgba(97, 97, 97, 0.5)',\n      boxShadow: '0 4px 16px rgba(66, 66, 66, 0.3), inset 0 1px 0 rgba(189, 189, 189, 0.2)'\n    };\n\n    const theme = this.isWabiSabiMode ? glassmorphismWabiSabi : (this.isDarkMode ? glassmorphismDark : glassmorphismLight);\n\n    return `\n      width: 100%;\n      padding: 14px 16px;\n      background: ${theme.background};\n      border: ${theme.border};\n      border-radius: 14px;\n      color: ${this.isWabiSabiMode ? '#F5F5F5' : (this.isDarkMode ? '#ffffff' : '#1f2937')};\n      font-size: 14px;\n      outline: none;\n      box-sizing: border-box;\n      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n      font-family: inherit;\n      backdrop-filter: blur(16px);\n      -webkit-backdrop-filter: blur(16px);\n      box-shadow: ${theme.boxShadow};\n      placeholder-color: ${this.isDarkMode ? 'rgba(255, 255, 255, 0.5)' : 'rgba(55, 65, 81, 0.6)'};\n      resize: none;\n      overflow-y: hidden;\n      min-height: 22px;\n      max-height: 66px;\n      line-height: 22px;\n    `;\n  }\n\n  getModernButtonStyles(type) {\n    const styles = {\n      primary: this.isWabiSabiMode ? `\n        background: linear-gradient(135deg, #8D6E63, #6D4C41);\n        box-shadow: 0 4px 12px rgba(85, 139, 47, 0.4), inset 0 1px 0 rgba(184, 158, 135, 0.15);\n        width: 100%;\n        padding: 16px;\n        font-size: 14px;\n        font-weight: 600;\n      ` : `\n        background: linear-gradient(135deg, #4f46e5, #4338ca);\n        width: 100%;\n        padding: 16px;\n        font-size: 14px;\n        font-weight: 600;\n      `,\n      secondary: this.isWabiSabiMode ? `\n        background: rgba(158, 158, 158, 0.2);\n        border: 1px solid rgba(141, 110, 99, 0.4);\n        flex: 1;\n        padding: 12px;\n        font-size: 13px;\n        font-weight: 500;\n        backdrop-filter: blur(8px);\n        color: #F5F5F5;\n      ` : `\n        background: rgba(255, 255, 255, 0.08);\n        border: 1px solid rgba(255, 255, 255, 0.2);\n        flex: 1;\n        padding: 12px;\n        font-size: 13px;\n        font-weight: 500;\n        backdrop-filter: blur(8px);\n      `,\n      danger: this.isWabiSabiMode ? `\n        background: rgba(141, 110, 99, 0.3);\n        border: 1px solid rgba(93, 64, 55, 0.5);\n        flex: 1;\n        padding: 12px;\n        font-size: 13px;\n        font-weight: 500;\n        backdrop-filter: blur(8px);\n        color: #F5F5F5;\n      ` : `\n        background: rgba(255, 59, 48, 0.15);\n        border: 1px solid rgba(255, 59, 48, 0.3);\n        flex: 1;\n        padding: 12px;\n        font-size: 13px;\n        font-weight: 500;\n        backdrop-filter: blur(8px);\n        color: #ff453a;\n      `\n    };\n\n    return `\n      border: none;\n      border-radius: 12px;\n      color: white;\n      cursor: pointer;\n      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);\n      font-family: inherit;\n      outline: none;\n      ${styles[type]}\n    `;\n  }\n\n  getModeButtonStyles(isActive, mode) {\n    // ãƒ¢ãƒ¼ãƒ‰ã‚«ãƒ©ãƒ¼è¨­å®š\n    const modeColors = {\n      generate: 'linear-gradient(135deg, #22c55e, #16a34a)',  // Green - ãƒãƒ£ãƒƒãƒˆæ¬„ã¨åŒã˜ç·‘è‰²\n      modify: 'linear-gradient(135deg, #22c55e, #16a34a)',    // Green - ãƒãƒ£ãƒƒãƒˆæ¬„ã¨åŒã˜ç·‘è‰²\n      delete: 'linear-gradient(135deg, #22c55e, #16a34a)'     // Green - ãƒãƒ£ãƒƒãƒˆæ¬„ã¨åŒã˜ç·‘è‰²\n    };\n    \n    return `\n      flex: 1;\n      padding: 12px 16px;\n      border: none;\n      border-radius: 8px;\n      color: ${isActive ? 'white' : 'rgba(255, 255, 255, 0.7)'};\n      background: ${isActive ? modeColors[mode] : 'transparent'};\n      font-size: 13px;\n      font-weight: 600;\n      cursor: pointer;\n      transition: all 0.2s ease;\n      font-family: inherit;\n      outline: none;\n    `;\n  }\n\n  /**\n   * ã‚¤ãƒ™ãƒ³ãƒˆãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°\n   */\n  bindEvents() {\n    // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ\n    document.addEventListener('keydown', (e) => {\n      // è¨­å®šã•ã‚ŒãŸã‚­ãƒ¼ã§UIè¡¨ç¤ºåˆ‡æ›¿\n      if (e.key === this.config.activationKey) {\n        e.preventDefault();\n        this.toggle();\n        return;\n      }\n      \n      // Enterã‚­ãƒ¼å‡¦ç†ã¯initUI()å†…ã§è¡Œã†ãŸã‚ã€ã“ã“ã§ã¯å‡¦ç†ã—ãªã„\n      // ï¼ˆIMEå¯¾å¿œã®ãŸã‚ï¼‰\n      \n      // Escapeã§éè¡¨ç¤º\n      if (this.isVisible && e.key === 'Escape') {\n        this.hide();\n      }\n      \n      // Ctrl+Z/Ctrl+Y ã§Undo/Redo\n      if (this.isVisible && e.ctrlKey) {\n        if (e.key === 'z' && !e.shiftKey) {\n          e.preventDefault();\n          this.undo();\n        } else if (e.key === 'y' || (e.key === 'z' && e.shiftKey)) {\n          e.preventDefault();\n          this.redo();\n        }\n      }\n    });\n\n    // å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ã‚¹ã‚¿ã‚¤ãƒ«èª¿æ•´\n    this.input.addEventListener('focus', () => {\n      if (this.isWabiSabiMode) {\n        this.input.style.borderColor = '#8BC34A';\n        this.input.style.boxShadow = '0 0 5px rgba(139, 195, 74, 0.5)';\n      } else {\n        this.input.style.borderColor = '#74b9ff';\n        this.input.style.boxShadow = '0 0 5px rgba(116, 185, 255, 0.5)';\n      }\n    });\n\n    this.input.addEventListener('blur', () => {\n      if (this.isWabiSabiMode) {\n        this.input.style.borderColor = '#8D6E63';\n        this.input.style.boxShadow = 'none';\n      } else {\n        this.input.style.borderColor = '#4a90e2';\n        this.input.style.boxShadow = 'none';\n      }\n    });\n  }\n\n  /**\n   * UIè¡¨ç¤º/éè¡¨ç¤ºåˆ‡æ›¿\n   */\n  toggle() {\n    if (this.isVisible) {\n      this.hide();\n    } else {\n      this.show();\n    }\n  }\n\n  /**\n   * UIè¡¨ç¤º\n   */\n  show() {\n    this.container.style.display = 'flex';\n    this.container.style.flexDirection = 'column';\n    this.floatingContainer.style.display = 'flex';\n\n    // UIãƒ•ã‚©ãƒ¼ãƒ ã®ä½ç½®ã«åˆã‚ã›ã¦é…ç½®ï¼ˆå°‘ã—é…å»¶ã—ã¦æ­£ç¢ºãªä½ç½®ã‚’å–å¾—ï¼‰\n    setTimeout(() => {\n      const containerRect = this.container.getBoundingClientRect();\n      this.floatingContainer.style.left = containerRect.left + 'px';\n      this.floatingContainer.style.top = (containerRect.top - 80) + 'px';\n      this.floatingContainer.style.width = containerRect.width + 'px';\n      this.floatingContainer.style.transform = 'none';\n    }, 50);\n\n    this.isVisible = true;\n    this.input.focus();\n\n    // ãƒ•ã‚©ãƒ¼ãƒ è¡¨ç¤ºä¸­ã¯ãƒãƒ§ã‚³ã‚¢ã‚¤ã‚³ãƒ³ã‚’éš ã™\n    if (this.floatingChocolateIcon) {\n      this.floatingChocolateIcon.style.opacity = '0';\n      this.floatingChocolateIcon.style.pointerEvents = 'none';\n    }\n\n    // ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚’ç„¡åŠ¹åŒ–\n    this.onControlsToggle(true);\n    // ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«åœæ­¢æ™‚ã‚‚é™ã‹ã«\n  }\n\n  /**\n   * UIéè¡¨ç¤º\n   */\n  hide() {\n    this.container.style.display = 'none';\n    this.floatingContainer.style.display = 'none';\n    this.isVisible = false;\n\n    // ãƒ•ã‚©ãƒ¼ãƒ éè¡¨ç¤ºæ™‚ã¯ãƒãƒ§ã‚³ã‚¢ã‚¤ã‚³ãƒ³ã‚’å†è¡¨ç¤º\n    if (this.floatingChocolateIcon) {\n      this.floatingChocolateIcon.style.opacity = '0.8';\n      this.floatingChocolateIcon.style.pointerEvents = 'auto';\n    }\n\n    // ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚’å†æœ‰åŠ¹åŒ–\n    this.onControlsToggle(false);\n    this.logDebug('ğŸ® ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚’å†é–‹');\n  }\n\n  /**\n   * ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ\n   */\n  switchMode(mode) {\n    if (this.currentMode === mode) return;\n    \n    this.currentMode = mode;\n    \n    // ãƒ¢ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ«æ›´æ–°\n    this.container.querySelectorAll('[data-mode]').forEach(btn => {\n      const isActive = btn.dataset.mode === mode;\n      btn.style.cssText = this.getModeButtonStyles(isActive, btn.dataset.mode);\n    });\n    \n    // å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼æ›´æ–°\n    this.input.placeholder = this.getPlaceholderForMode(mode);\n    \n    // å®Ÿè¡Œãƒœã‚¿ãƒ³ã®ãƒ©ãƒ™ãƒ«ã¨è‰²æ›´æ–°\n    const executeBtn = this.container.querySelector('#execute-btn');\n    const labels = {\n      generate: 'ğŸ¨ Generate Object',\n      modify: 'âœï¸ Apply Changes', \n      delete: 'ğŸ—‘ï¸ Delete Objects'\n    };\n    \n    const buttonColors = {\n      generate: 'linear-gradient(135deg, #5b21b6, #4c1d95)',\n      modify: 'linear-gradient(135deg, #ec4899, #be185d)', \n      delete: 'rgba(107, 114, 128, 0.15)'\n    };\n    \n    executeBtn.innerHTML = `<span>${labels[mode]}</span>`;\n    executeBtn.style.background = buttonColors[mode];\n    \n    // ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆé€šçŸ¥ã¯ä¸è¦ï¼ˆãƒœã‚¿ãƒ³ã§åˆ†ã‹ã‚‹ãŸã‚ï¼‰\n  }\n  \n  /**\n   * ãƒ¢ãƒ¼ãƒ‰åˆ¥ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼\n   */\n  getPlaceholderForMode(mode) {\n    const placeholders = {\n      generate: 'ã€ŒçŒ«ã®ç”»åƒã‚’ä½œã£ã¦ã€ã¨è©±ã—ã‹ã‘ã¦ â âœ¨',\n      import: 'ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ â ğŸ“',\n      modify: 'é¸æŠå¾Œã€Œãƒ”ãƒ³ã‚¯ã«å¤‰æ›´ã€ã¨ä¼ãˆã¦ â âœï¸',\n      delete: 'é¸æŠå¾Œã€ã‚³ãƒãƒ³ãƒ‰ã‚’ãã®ã¾ã¾é€ã£ã¦ â ğŸ—‘ï¸'\n    };\n    return placeholders[mode] || placeholders.generate;\n  }\n\n  /**\n   * ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ\n   */\n  async executeCommand() {\n    const command = this.input.value.trim();\n    if (!command) return;\n\n    // äº‹å‰ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆ2025å¹´UXæ”¹å–„ï¼‰\n    const preValidation = await this.preValidateCommand(command);\n    if (!preValidation.canExecute) {\n      // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å¤±æ•—æ™‚ã¯ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯è¡¨ç¤ºã—ã¦çµ‚äº†\n      return;\n    }\n\n    await this.proceedWithExecution(command, preValidation.commandType);\n  }\n\n  /**\n   * å‰Šé™¤ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°\n   */\n  async showConfirmationDialog(options) {\n    const {\n      icon = 'ğŸ—‘ï¸',\n      title = 'ç¢ºèª',\n      message = 'ã“ã®æ“ä½œã‚’å®Ÿè¡Œã—ã¾ã™ã‹ï¼Ÿ',\n      confirmText = 'å®Ÿè¡Œ',\n      cancelText = 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«',\n      confirmColor = '#ef4444'\n    } = options;\n\n    return new Promise((resolve) => {\n      const modal = document.createElement('div');\n      modal.style.cssText = `\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background: rgba(15, 23, 42, 0.6);\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        z-index: 2000;\n        backdrop-filter: blur(24px) saturate(180%);\n        -webkit-backdrop-filter: blur(24px) saturate(180%);\n      `;\n\n      const dialog = document.createElement('div');\n      dialog.style.cssText = `\n        background: ${this.isWabiSabiMode\n          ? 'linear-gradient(135deg, rgba(239, 235, 233, 0.4), rgba(215, 204, 200, 0.3))'\n          : (this.isDarkMode\n            ? 'linear-gradient(135deg, rgba(15, 23, 42, 0.85), rgba(30, 27, 75, 0.8))'\n            : 'linear-gradient(135deg, rgba(255, 255, 255, 0.4), rgba(255, 255, 255, 0.3))')};\n        border: 1px solid ${this.isWabiSabiMode\n          ? 'rgba(161, 136, 127, 0.4)'\n          : (this.isDarkMode ? 'rgba(99, 102, 241, 0.3)' : 'rgba(255, 255, 255, 0.5)')};\n        border-radius: 20px;\n        padding: 32px;\n        max-width: 420px;\n        text-align: center;\n        color: ${this.isWabiSabiMode\n          ? '#5D4037'\n          : (this.isDarkMode ? '#ffffff' : '#1f2937')};\n        font-family: inherit;\n        backdrop-filter: blur(24px) saturate(180%);\n        -webkit-backdrop-filter: blur(24px) saturate(180%);\n        box-shadow: ${this.isWabiSabiMode\n          ? '0 8px 32px rgba(93, 64, 55, 0.2), 0 0 0 1px rgba(161, 136, 127, 0.2)'\n          : (this.isDarkMode\n            ? '0 8px 32px rgba(15, 23, 42, 0.4), 0 0 0 1px rgba(99, 102, 241, 0.1)'\n            : '0 8px 32px rgba(0, 0, 0, 0.1), 0 0 0 1px rgba(255, 255, 255, 0.2)')};\n        transform: scale(0.9);\n        opacity: 0;\n        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);\n      `;\n\n      dialog.innerHTML = `\n        <div style=\"font-size: 56px; margin-bottom: 20px;\">${icon}</div>\n        <h3 style=\"margin: 0 0 16px 0; color: ${this.isDarkMode ? '#a5b4fc' : '#6366f1'}; font-size: 20px; font-weight: 700; letter-spacing: 0.02em;\">\n          ${title}\n        </h3>\n        <p style=\"margin: 0 0 28px 0; color: ${this.isDarkMode ? '#d1d5db' : '#6b7280'}; line-height: 1.6; font-size: 16px;\">\n          ${message}\n        </p>\n        <div style=\"display: flex; gap: 8px; justify-content: center;\">\n          <button id=\"cancel-btn\" style=\"\n            padding: 14px 24px;\n            background: ${this.isDarkMode \n              ? 'linear-gradient(135deg, rgba(55, 65, 81, 0.3), rgba(75, 85, 99, 0.2))'\n              : 'linear-gradient(135deg, rgba(255, 255, 255, 0.25), rgba(255, 255, 255, 0.15))'};\n            border: 1px solid ${this.isDarkMode ? 'rgba(156, 163, 175, 0.2)' : 'rgba(255, 255, 255, 0.3)'};\n            border-radius: 12px;\n            color: ${this.isDarkMode ? '#d1d5db' : '#374151'};\n            cursor: pointer;\n            font-family: inherit;\n            font-size: 14px;\n            font-weight: 600;\n            transition: all 0.2s ease;\n            backdrop-filter: blur(16px);\n            -webkit-backdrop-filter: blur(16px);\n          \">${cancelText}</button>\n          <button id=\"confirm-btn\" style=\"\n            padding: 14px 24px;\n            background: ${confirmColor === (this.isWabiSabiMode ? '#8BC34A' : '#6366f1') \n              ? 'linear-gradient(135deg, ' + (this.isWabiSabiMode ? '#8BC34A, #689F38' : '#6366f1, #8b5cf6') + ')' \n              : confirmColor === '#ef4444'\n              ? 'linear-gradient(135deg, #ef4444, #dc2626)'\n              : 'linear-gradient(135deg, #ff7b47, #f97316)'};\n            border: none;\n            border-radius: 12px;\n            color: white;\n            cursor: pointer;\n            font-family: inherit;\n            font-size: 14px;\n            font-weight: 700;\n            transition: all 0.2s ease;\n            box-shadow: 0 4px 16px ${confirmColor === (this.isWabiSabiMode ? '#8BC34A' : '#6366f1') \n              ? 'rgba(99, 102, 241, 0.3)' \n              : confirmColor === '#ef4444' \n              ? 'rgba(239, 68, 68, 0.3)' \n              : 'rgba(255, 123, 71, 0.3)'};\n            backdrop-filter: blur(8px);\n            -webkit-backdrop-filter: blur(8px);\n          \">${confirmText}</button>\n        </div>\n      `;\n\n      modal.appendChild(dialog);\n      document.body.appendChild(modal);\n\n      // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹\n      requestAnimationFrame(() => {\n        modal.style.opacity = '1';\n        dialog.style.transform = 'scale(1)';\n        dialog.style.opacity = '1';\n      });\n\n      // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼\n      dialog.querySelector('#cancel-btn').onclick = () => {\n        this.closeModalWithAnimation(modal);\n        resolve(false);\n      };\n\n      dialog.querySelector('#confirm-btn').onclick = () => {\n        this.closeModalWithAnimation(modal);\n        resolve(true);\n      };\n\n      // ESCã‚­ãƒ¼ã§ã‚­ãƒ£ãƒ³ã‚»ãƒ«\n      const escHandler = (e) => {\n        if (e.key === 'Escape') {\n          this.closeModalWithAnimation(modal);\n          document.removeEventListener('keydown', escHandler);\n          resolve(false);\n        }\n      };\n      document.addEventListener('keydown', escHandler);\n\n      // ãƒ¢ãƒ¼ãƒ€ãƒ«èƒŒæ™¯ã‚¯ãƒªãƒƒã‚¯ã§ã‚­ãƒ£ãƒ³ã‚»ãƒ«\n      modal.onclick = (e) => {\n        if (e.target === modal) {\n          this.closeModalWithAnimation(modal);\n          resolve(false);\n        }\n      };\n    });\n  }\n\n  async showDeleteConfirmation(command) {\n    return this.showConfirmationDialog({\n      icon: 'ğŸ—‘ï¸',\n      title: 'å‰Šé™¤ã®ç¢ºèª',\n      message: `ã€Œ${command}ã€ã‚’å®Ÿè¡Œã—ã¾ã™ã‹ï¼Ÿ<br>ã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã™ã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚`,\n      confirmText: 'å‰Šé™¤å®Ÿè¡Œ',\n      cancelText: 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«',\n      confirmColor: '#ff7b47'\n    });\n  }\n\n  /**\n   * å‡ºåŠ›ã‚¨ãƒªã‚¢ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¿½åŠ \n   */\n  /**\n   * ã‚¿ã‚¹ã‚¯ã‚«ãƒ¼ãƒ‰è¿½åŠ ï¼ˆå¾“æ¥ã®addOutputã‚’ç½®ãæ›ãˆï¼‰\n   */\n  addOutput(message, type = 'default', options = {}) {\n    // ã‚¿ã‚¹ã‚¯ã‚«ãƒ¼ãƒ‰å½¢å¼ã§å‡¦ç†\n    if (type === 'task' || type === 'progress') {\n      return this.addTaskCard(message, options);\n    }\n\n    // ã‚¨ãƒ©ãƒ¼ã¨ã‚·ã‚¹ãƒ†ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã¿è¡¨ç¤º\n    if (type === 'error' || type === 'system') {\n      this.addSystemMessage(message, type);\n    }\n  }\n\n  /**\n   * ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¿ã‚¹ã‚¯ã‚«ãƒ¼ãƒ‰è¿½åŠ \n   */\n  addTaskCard(taskInfo, options = {}) {\n    if (!this.taskCards) this.taskCards = new Map();\n\n    const taskId = options.taskId || `task_${Date.now()}_${Math.random().toString(36).substr(2, 5)}`;\n    const status = options.status || 'pending';\n    const prompt = taskInfo.prompt || taskInfo.command || taskInfo;\n\n    // ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚«ãƒ¼ãƒ‰ä½œæˆ\n    const card = document.createElement('div');\n    card.className = 'floating-task-card';\n    card.setAttribute('data-task-id', taskId);\n\n    // 2025å¹´ãƒˆãƒ¬ãƒ³ãƒ‰: å¾…æ©Ÿä¸­ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³åŠ¹æœ\n    if (status === 'pending' || status === 'processing' || status === 'progress') {\n      card.classList.add('chocodrop-shimmer', 'chocodrop-float');\n    }\n\n    // iOS 26 Liquid Glass + 2026å¹´ãƒˆãƒ¬ãƒ³ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ«\n    card.style.cssText = this.getFloatingCardStyles(status);\n    // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”¨åˆæœŸçŠ¶æ…‹ï¼ˆéè¡¨ç¤ºï¼‰- å¼·åˆ¶è¨­å®š\n    card.style.setProperty('opacity', '0', 'important');\n    card.style.setProperty('transform', 'translateY(20px) scale(0.95)', 'important');\n    card.style.setProperty('filter', 'blur(4px)', 'important');\n\n    const iconMap = {\n      pending: 'â³',\n      processing: 'ğŸ¨',\n      progress: 'âš¡',\n      completed: 'âœ…',\n      error: 'âŒ'\n    };\n\n    const statusText = {\n      pending: 'å¾…æ©Ÿä¸­',\n      processing: 'ç”Ÿæˆä¸­',\n      progress: 'é€²è¡Œä¸­',\n      completed: 'å®Œäº†',\n      error: 'ã‚¨ãƒ©ãƒ¼'\n    };\n\n    // æ¸©ã‹ã¿ã®ã‚ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º\n    const friendlyMessage = this.getFriendlyMessage(status, prompt, options.errorMessage);\n    card.innerHTML = `\n      <span style=\"font-size: 14px;\">${iconMap[status]}</span>\n      <span style=\"font-size: 13px; margin-left: 6px;\">${friendlyMessage}</span>\n    `;\n\n    // ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚³ãƒ³ãƒ†ãƒŠã«è¿½åŠ ï¼ˆæœ€æ–°ãŒä¸Šã«æ¥ã‚‹ã‚ˆã†ã«ï¼‰\n    this.floatingContainer.insertBefore(card, this.floatingContainer.firstChild);\n    \n    // ã‚«ãƒ¼ãƒ‰è¡¨ç¤ºåˆ¶é™ã‚’é©ç”¨ï¼ˆæœ€æ–°3å€‹ã¾ã§è¡¨ç¤ºï¼‰\n    this.updateCardDisplayLimit();\n\n    this.taskCards.set(taskId, {\n      element: card,\n      status: status,\n      prompt: prompt,\n      originalPrompt: prompt, // å…ƒã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ\n      startTime: Date.now(),\n      endTime: null,\n      error: null,\n      contentType: 'image', // 'image', 'video', etc.\n      model: null,\n      settings: null\n    });\n\n    // ã‚«ãƒ¼ãƒ‰è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ«ç”¨ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼\n    this.addCardDetailEvents(card, taskId);\n    \n    // å…¥å ´ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³\n    this.animateCardEntrance(card);\n    \n    // 2025å¹´ãƒˆãƒ¬ãƒ³ãƒ‰: ã‚·ãƒãƒ¼ã‚¨ãƒ•ã‚§ã‚¯ãƒˆCSSç¢ºä¿\n    this.ensureShimmerStyles();\n    \n    return taskId;\n  }\n\n  /**\n   * 2025å¹´ãƒˆãƒ¬ãƒ³ãƒ‰: ã‚·ãƒãƒ¼ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚¹ã‚¿ã‚¤ãƒ«ã‚’ç¢ºä¿\n   */\n  ensureShimmerStyles() {\n    if (document.querySelector('#chocodrop-shimmer-styles')) return;\n    \n    const styleSheet = document.createElement('style');\n    styleSheet.id = 'chocodrop-shimmer-styles';\n    styleSheet.textContent = `\n      /* 2025å¹´ãƒˆãƒ¬ãƒ³ãƒ‰: ã‚·ãƒãƒ¼ã‚¨ãƒ•ã‚§ã‚¯ãƒˆï¼ˆå¼·åŒ–ç‰ˆï¼‰ */\n      .chocodrop-shimmer {\n        position: relative;\n        overflow: hidden;\n      }\n      \n      .chocodrop-shimmer::before {\n        content: '';\n        position: absolute;\n        top: 0;\n        left: -100%;\n        width: 100%;\n        height: 100%;\n        background: linear-gradient(\n          90deg,\n          transparent,\n          ${this.isDarkMode ? 'rgba(255, 255, 255, 0.5)' : 'rgba(255, 255, 255, 0.7)'},\n          transparent\n        );\n        animation: shimmer 1.5s infinite;\n        pointer-events: none;\n        z-index: 1;\n      }\n      \n      .chocodrop-shimmer > * {\n        position: relative;\n        z-index: 2;\n      }\n      \n      /* 2025å¹´ãƒˆãƒ¬ãƒ³ãƒ‰: å¾®ç´°ãªæµ®éŠæ„Ÿ */\n      .chocodrop-float {\n        animation: gentleFloat 4s ease-in-out infinite;\n      }\n      \n      /* å¾…æ©Ÿä¸­ã®ç‰¹åˆ¥ãªãƒ‘ãƒ«ã‚¹åŠ¹æœï¼ˆå¼·åŒ–ç‰ˆï¼‰ */\n      .chocodrop-shimmer.floating-task-card {\n        animation: gentleFloat 4s ease-in-out infinite, subtlePulse 3s ease-in-out infinite;\n      }\n      \n      @keyframes subtlePulse {\n        0%, 100% { \n          box-shadow: 0 8px 32px rgba(15, 23, 42, 0.3), 0 0 0 1px rgba(99, 102, 241, 0.1);\n        }\n        50% { \n          box-shadow: 0 12px 40px rgba(15, 23, 42, 0.5), 0 0 0 1px rgba(99, 102, 241, 0.3);\n        }\n      }\n    `;\n    \n    document.head.appendChild(styleSheet);\n  }\n\n  /**\n   * ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¿ã‚¹ã‚¯ã‚«ãƒ¼ãƒ‰æ›´æ–°\n   */\n  updateTaskCard(taskId, status, options = {}) {\n    if (!this.taskCards || !this.taskCards.has(taskId)) return;\n\n    const taskData = this.taskCards.get(taskId);\n    const card = taskData.element;\n\n    // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°\n    taskData.status = status;\n\n    // ã‚¨ãƒ©ãƒ¼æƒ…å ±ã‚’ä¿å­˜\n    if (status === 'error' && options.errorMessage) {\n      taskData.error = options.errorMessage;\n    }\n\n    // 2025å¹´ãƒˆãƒ¬ãƒ³ãƒ‰: ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³çŠ¶æ…‹ç®¡ç†\n    if (status === 'pending' || status === 'processing' || status === 'progress') {\n      // å¾…æ©Ÿä¸­ãƒ»å‡¦ç†ä¸­: ã‚·ãƒãƒ¼ã‚¨ãƒ•ã‚§ã‚¯ãƒˆè¿½åŠ \n      card.classList.add('chocodrop-shimmer', 'chocodrop-float');\n    } else {\n      // å®Œäº†ãƒ»ã‚¨ãƒ©ãƒ¼: ã‚·ãƒãƒ¼ã‚¨ãƒ•ã‚§ã‚¯ãƒˆå‰Šé™¤\n      card.classList.remove('chocodrop-shimmer', 'chocodrop-float');\n    }\n\n    const iconMap = {\n      pending: 'â³',\n      processing: 'ğŸ¨',\n      progress: 'âš¡',\n      completed: 'âœ…',\n      error: 'âŒ'\n    };\n\n    // æ¸©ã‹ã¿ã®ã‚ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ›´æ–°ï¼ˆã‚¨ãƒ©ãƒ¼æ™‚ã¯ç†ç”±ã‚‚å«ã‚ã‚‹ï¼‰\n    const friendlyMessage = this.getFriendlyMessage(status, taskData.prompt, taskData.error);\n    card.innerHTML = `\n      <span style=\"font-size: 14px;\">${iconMap[status]}</span>\n      <span style=\"font-size: 13px; margin-left: 6px;\">${friendlyMessage}</span>\n    `;\n\n    // ã‚¹ã‚¿ã‚¤ãƒ«æ›´æ–°ï¼ˆå®Œäº†çŠ¶æ…‹ã«å¿œã˜ã¦ï¼‰\n    card.style.cssText = this.getFloatingCardStyles(status);\n\n    // å®Œäº†æ™‚ã®è‡ªå‹•æ¶ˆå»ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³\n    if (status === 'completed') {\n      this.animateCardSuccess(card, taskId);\n    } else if (status === 'error') {\n      this.animateCardError(card, taskId);\n    }\n  }\n\n  /**\n   * ã‚·ã‚¹ãƒ†ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º\n   */\n  addSystemMessage(message, type) {\n    const entry = document.createElement('div');\n    entry.className = `system-message ${type}`;\n    entry.style.cssText = `\n      padding: 8px 12px;\n      margin: 4px 0;\n      border-radius: 8px;\n      font-size: 12px;\n      line-height: 1.4;\n      animation: slideIn 0.3s ease-out;\n      background: ${type === 'error' ? 'rgba(239, 68, 68, 0.1)' : 'rgba(107, 114, 128, 0.1)'};\n      border: 1px solid ${type === 'error' ? 'rgba(239, 68, 68, 0.3)' : 'rgba(107, 114, 128, 0.3)'};\n      color: ${type === 'error' ? '#fca5a5' : (this.isDarkMode ? '#d1d5db' : '#6b7280')};\n    `;\n    entry.textContent = message;\n    this.outputDiv.appendChild(entry);\n    this.scrollToBottom();\n  }\n\n  /**\n   * å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ç›´ä¸‹ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯è¡¨ç¤ºï¼ˆ2025å¹´ãƒˆãƒ¬ãƒ³ãƒ‰æº–æ‹ ï¼‰\n   */\n  showInputFeedback(message, type = 'error', options = {}) {\n    if (type === 'success') {\n      return;\n    }\n\n    if (type === 'error') {\n      this.addOutput(`âš ï¸ ${message}`, 'error');\n    } else {\n      this.addOutput(`ğŸ’¡ ${message}`, 'system');\n    }\n\n    if (!this.feedbackOverlay) {\n      const overlay = document.createElement('div');\n      overlay.className = 'input-feedback-overlay';\n      overlay.style.cssText = `\n        position: absolute;\n        left: 16px;\n        right: 16px;\n        bottom: 12px;\n        z-index: 1200;\n        pointer-events: auto;\n        display: flex;\n        gap: 8px;\n        align-items: center;\n        padding: 12px 16px;\n        border-radius: 12px;\n        backdrop-filter: blur(10px);\n        -webkit-backdrop-filter: blur(10px);\n        transition: opacity 180ms ease, transform 180ms ease;\n        opacity: 0;\n        transform: translateY(8px);\n      `;\n      this.container.appendChild(overlay);\n      this.feedbackOverlay = overlay;\n    }\n\n    const overlay = this.feedbackOverlay;\n    overlay.innerHTML = '';\n\n    const isError = type === 'error';\n    const background = isError\n      ? (this.isDarkMode ? 'rgba(239, 68, 68, 0.28)' : 'rgba(239, 68, 68, 0.18)')\n      : (this.isDarkMode ? 'rgba(59, 130, 246, 0.25)' : 'rgba(59, 130, 246, 0.18)');\n    const border = isError\n      ? '1px solid rgba(239, 68, 68, 0.45)'\n      : '1px solid rgba(59, 130, 246, 0.35)';\n    const color = isError\n      ? (this.isDarkMode ? '#fca5a5' : '#b91c1c')\n      : (this.isDarkMode ? '#bfdbfe' : '#1d4ed8');\n\n    overlay.style.background = background;\n    overlay.style.border = border;\n    overlay.style.color = color;\n\n    const messageSpan = document.createElement('span');\n    messageSpan.textContent = message;\n    messageSpan.style.flex = '1';\n    overlay.appendChild(messageSpan);\n\n    if (options.actions && Array.isArray(options.actions) && options.actions.length > 0) {\n      const actionsContainer = document.createElement('div');\n      actionsContainer.style.cssText = `\n        display: flex;\n        gap: 8px;\n      `;\n\n      options.actions.forEach(action => {\n        const button = document.createElement('button');\n        button.type = 'button';\n        button.textContent = action.label;\n        button.style.cssText = `\n          padding: 6px 12px;\n          border-radius: 999px;\n          border: none;\n          cursor: pointer;\n          background: ${isError ? 'rgba(239, 68, 68, 0.28)' : 'rgba(59, 130, 246, 0.25)'};\n          color: inherit;\n          font-size: 11px;\n          transition: background 0.2s ease;\n        `;\n        button.addEventListener('mouseenter', () => {\n          button.style.background = isError ? 'rgba(239, 68, 68, 0.38)' : 'rgba(59, 130, 246, 0.35)';\n        });\n        button.addEventListener('mouseleave', () => {\n          button.style.background = isError ? 'rgba(239, 68, 68, 0.28)' : 'rgba(59, 130, 246, 0.25)';\n        });\n        button.addEventListener('click', () => {\n          if (typeof action.onClick === 'function') {\n            action.onClick();\n          }\n        });\n        actionsContainer.appendChild(button);\n      });\n\n      overlay.appendChild(actionsContainer);\n    }\n\n    if (this.feedbackAutoClearTimer) {\n      clearTimeout(this.feedbackAutoClearTimer);\n      this.feedbackAutoClearTimer = null;\n    }\n\n    overlay.style.pointerEvents = 'auto';\n    overlay.style.opacity = '1';\n    overlay.style.transform = 'translateY(0)';\n\n    this.currentFeedback = overlay;\n\n    if (type === 'info') {\n      this.feedbackAutoClearTimer = setTimeout(() => this.clearInputFeedback(), options.duration || 3000);\n    }\n  }\n\n  /**\n   * å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’ã‚¯ãƒªã‚¢\n   */\n  clearInputFeedback() {\n    if (this.feedbackAutoClearTimer) {\n      clearTimeout(this.feedbackAutoClearTimer);\n      this.feedbackAutoClearTimer = null;\n    }\n\n    if (this.currentFeedback) {\n      const element = this.currentFeedback;\n      element.style.pointerEvents = 'none';\n      element.style.opacity = '0';\n      element.style.transform = 'translateY(8px)';\n      this.currentFeedback = null;\n      setTimeout(() => {\n        element.innerHTML = '';\n      }, 180);\n    }\n  }\n\n  /**\n   * ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ç”¨CSSã‚¹ã‚¿ã‚¤ãƒ«ã‚’ç¢ºä¿\n   */\n  ensureFeedbackStyles() {\n    if (document.getElementById('feedback-styles')) return;\n    \n    const style = document.createElement('style');\n    style.id = 'feedback-styles';\n    style.textContent = `\n      @keyframes feedbackSlideIn {\n        from {\n          opacity: 0;\n          transform: translateY(-10px);\n        }\n        to {\n          opacity: 1;\n          transform: translateY(0);\n        }\n      }\n      \n      @keyframes feedbackSlideOut {\n        from {\n          opacity: 1;\n          transform: translateY(0);\n        }\n        to {\n          opacity: 0;\n          transform: translateY(-10px);\n        }\n      }\n    `;\n    document.head.appendChild(style);\n  }\n\n  /**\n   * ã‚³ãƒãƒ³ãƒ‰äº‹å‰ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆé€ä¿¡å‰ãƒã‚§ãƒƒã‚¯ï¼‰\n   */\n  async preValidateCommand(command) {\n    // 1. ã‚³ãƒãƒ³ãƒ‰ã‚¿ã‚¤ãƒ—åˆ¤å®š\n    const hasSelectedObject = this.sceneManager?.selectedObject || this.selectedFile;\n    const commandType = this.analyzeCommandType(command, hasSelectedObject);\n\n    if (this.selectedFile) {\n      commandType.type = 'import';\n      commandType.mediaType = this.selectedFile.type === 'video' ? 'video' : 'image';\n      commandType.needsTarget = false;\n      commandType.requiresConfirmation = false;\n      commandType.hasExplicitTarget = true;\n      commandType.detectedKeyword = commandType.detectedKeyword || 'import';\n    }\n\n    // æœ€æ–°ã®è§£æçµæœã‚’UIãƒ¢ãƒ¼ãƒ‰ã¸åæ˜ ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›å„ªå…ˆï¼‰\n    if (commandType.type && this.selectMode && commandType.type !== this.currentMode) {\n      this.selectMode(commandType.type, false, commandType.detectedKeyword || null);\n    }\n\n    // 2. ç©ºã‚³ãƒãƒ³ãƒ‰ã®å ´åˆ\n    if (commandType.type === 'empty') {\n      this.showInputFeedback('ğŸ’¡ ä½•ã‚’ã—ã¾ã—ã‚‡ã†ã‹ï¼Ÿã‚³ãƒãƒ³ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'info');\n      return { canExecute: false, reason: 'empty_command' };\n    }\n    \n    // 3. å¯¾è±¡ãŒå¿…è¦ãªã‚³ãƒãƒ³ãƒ‰ã®äº‹å‰ãƒã‚§ãƒƒã‚¯\n    if (commandType.needsTarget && !hasSelectedObject) {\n      const canAttemptSearch = !!this.sceneManager && (commandType.hasExplicitTarget || commandType.type === 'modify');\n      \n      // ã¾ãšè‡ªç„¶è¨€èªã§å¯¾è±¡ã‚’æ¢ã—ã¦ã¿ã‚‹\n      if (canAttemptSearch) {\n        this.logDebug('ğŸ” Searching for explicitly mentioned target...');\n        try {\n          const foundTarget = await this.sceneManager?.findObjectByKeyword(command);\n          if (foundTarget) {\n            // å¯¾è±¡ã‚’ç™ºè¦‹ï¼é¸æŠã—ã¦ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³è¡¨ç¤º\n            this.sceneManager.selectObject(foundTarget);\n            this.showInputFeedback(`âœ¨ ã€Œ${foundTarget.name || foundTarget.userData?.originalPrompt || 'ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ'}ã€ã‚’è¦‹ã¤ã‘ã¾ã—ãŸï¼`, 'success');\n            // 1ç§’å¾…ã£ã¦ã‹ã‚‰å®Ÿè¡Œç¶™ç¶š\n            setTimeout(() => this.executeCommandAfterValidation(command, commandType), 1000);\n            return { canExecute: false, reason: 'target_found_waiting' };\n          } else {\n            // å¯¾è±¡ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆ\n            this.showInputFeedback(\n              'ğŸ” æŒ‡å®šã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“',\n              'error',\n              {\n                actions: [\n                  {\n                    label: 'é¸æŠã™ã‚‹',\n                    onClick: () => {\n                      this.clearInputFeedback();\n                      this.showInputFeedback('ğŸ‘† 3Dã‚·ãƒ¼ãƒ³å†…ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚¯ãƒªãƒƒã‚¯ã§é¸æŠã—ã¦ãã ã•ã„', 'info');\n                    }\n                  },\n                  {\n                    label: 'æ–°è¦ä½œæˆã«å¤‰æ›´',\n                    onClick: () => {\n                      // ã‚³ãƒãƒ³ãƒ‰ã‚’ç”Ÿæˆãƒ¢ãƒ¼ãƒ‰å‘ã‘ã«å¤‰æ›\n                      const newCommand = this.convertToGenerateCommand(command);\n                      this.input.value = newCommand;\n                      this.clearInputFeedback();\n                      this.showInputFeedback('âœï¸ ã‚³ãƒãƒ³ãƒ‰ã‚’æ–°è¦ä½œæˆç”¨ã«å¤‰æ›´ã—ã¾ã—ãŸ', 'success');\n                    }\n                  }\n                ]\n              }\n            );\n            return { canExecute: false, reason: 'target_not_found' };\n          }\n        } catch (error) {\n          this.logDebug('âŒ Error searching for target:', error);\n          this.showInputFeedback('âš ï¸ å¯¾è±¡ã®æ¤œç´¢ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ', 'error');\n          return { canExecute: false, reason: 'search_error' };\n        }\n      } else {\n        // ä¸€èˆ¬çš„ãªã€Œå¯¾è±¡ãŒå¿…è¦ã€ã‚¨ãƒ©ãƒ¼\n        this.showInputFeedback(\n          'ğŸ¯ æ“ä½œå¯¾è±¡ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“',\n          'error',\n          {\n            actions: [\n              {\n                label: 'é¸æŠã™ã‚‹',\n                onClick: () => {\n                  this.clearInputFeedback();\n                  this.showInputFeedback('ğŸ‘† 3Dã‚·ãƒ¼ãƒ³å†…ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚¯ãƒªãƒƒã‚¯ã§é¸æŠã—ã¦ãã ã•ã„', 'info');\n                }\n              },\n              {\n                label: 'ãƒ’ãƒ³ãƒˆ',\n                onClick: () => {\n                  this.clearInputFeedback();\n                  this.showInputFeedback('ğŸ’¡ ã€Œã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ãŸçŒ«ã‚’ã€ã€Œé¸æŠã—ãŸç”»åƒã‚’ã€ã®ã‚ˆã†ã«å¯¾è±¡ã‚’æ˜ç¤ºã—ã¦ã¿ã¦ãã ã•ã„', 'info');\n                }\n              }\n            ]\n          }\n        );\n        return { canExecute: false, reason: 'no_target_selected' };\n      }\n    }\n    \n    // 4. ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æˆåŠŸ\n    return { canExecute: true, commandType };\n  }\n\n  /**\n   * ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å¾Œã®ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ\n   */\n  async executeCommandAfterValidation(command, commandType) {\n    // æ—¢å­˜ã®executeCommandãƒ­ã‚¸ãƒƒã‚¯ã‚’ç¶™ç¶š\n    // ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’ã‚¯ãƒªã‚¢ã—ã¦ã‹ã‚‰å®Ÿè¡Œ\n    this.clearInputFeedback();\n    \n    // å…ƒã®executeCommandã®ç¶šãã‚’å®Ÿè¡Œ\n    await this.proceedWithExecution(command, commandType);\n  }\n\n  async proceedWithExecution(command, commandType) {\n    const hasSelectedObject = this.sceneManager?.selectedObject || this.selectedFile;\n    if (!commandType) {\n      commandType = this.analyzeCommandType(command, hasSelectedObject);\n    }\n\n    if (this.selectedFile) {\n      if (this.currentMode !== 'import') {\n        this.selectMode('import', false);\n      }\n      this.currentMode = 'import';\n    } else {\n      this.currentMode = commandType.type;\n    }\n\n    if (commandType.requiresConfirmation) {\n      const confirmed = await this.showDeleteConfirmation(command);\n      if (!confirmed) {\n        this.addOutput('âŒ å‰Šé™¤ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã—ãŸ', 'system');\n        return;\n      }\n    }\n\n    this.input.value = '';\n    this.clearInputFeedback();\n    this.hideProactiveSuggestion();\n\n    const taskId = this.addTaskCard(command, { status: 'processing' });\n\n    this.saveCommandToHistory({\n      command: command,\n      mode: this.currentMode,\n      mediaType: commandType.mediaType,\n      timestamp: Date.now()\n    });\n\n    let result;\n\n    try {\n      const modePrefix = this.getModePrefix(this.currentMode);\n      const fullCommand = `${modePrefix}${command}`;\n\n      this.logDebug('ğŸ” Current mode check:', this.currentMode);\n      if (this.currentMode === 'import') {\n        this.logDebug('ğŸ“ Import mode detected - bypassing SceneManager');\n        if (!this.selectedFile) {\n          throw new Error('ãƒ•ã‚¡ã‚¤ãƒ«ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ã¾ãšãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');\n        }\n        result = await this.handleImportCommand(command);\n      } else if (this.sceneManager) {\n        result = await this.sceneManager.executeCommand(fullCommand);\n      } else if (this.client) {\n        if (this.currentMode === 'generate') {\n          if (commandType.mediaType === 'video') {\n            result = await this.client.generateVideo(command, {\n              model: this.selectedVideoService || undefined\n            });\n          } else {\n            result = await this.client.generateImage(command, {\n              service: this.selectedImageService || undefined\n            });\n          }\n        } else if (this.currentMode === 'modify') {\n          const selectedObject = this.sceneManager?.selectedObject;\n          if (!selectedObject) {\n            throw new Error('å¤‰æ›´ã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ã¾ãšå¯¾è±¡ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');\n          }\n          result = await this.client.modifySelectedObject(selectedObject, command);\n        } else if (this.currentMode === 'delete') {\n          const selectedObject = this.sceneManager?.selectedObject;\n          if (!selectedObject && !this.sceneManager?.getSelectedObjects()?.length) {\n            this.addOutput('âš ï¸ å‰Šé™¤ã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ã¾ãš3Dã‚·ãƒ¼ãƒ³å†…ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚¯ãƒªãƒƒã‚¯ã§é¸æŠã—ã¦ã‹ã‚‰ã€å†åº¦Deleteãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚', 'system');\n            return;\n          }\n          const confirmMessage = `æœ¬å½“ã«ã€Œ${command}ã€ã‚’å®Ÿè¡Œã—ã¾ã™ã‹ï¼Ÿ\n\nã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚`;\n          if (!confirm(confirmMessage)) {\n            this.addOutput('âŒ å‰Šé™¤ãŒã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã¾ã—ãŸ', 'system');\n            return;\n          }\n          result = await this.client.deleteObjects(command);\n        } else {\n          result = await this.client.executeCommand(fullCommand);\n        }\n      } else {\n        throw new Error('SceneManager ã¾ãŸã¯ Client ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“');\n      }\n\n      if (result && result.taskId) {\n        this.connectToProgress(result.taskId, taskId);\n        this.currentTaskId = result.taskId;\n      }\n\n      if (taskId) {\n        this.updateTaskCard(taskId, 'completed');\n      }\n\n      if (result.modelName) {\n        // ãƒ¢ãƒ‡ãƒ«æƒ…å ±ãŒã‚ã‚‹å ´åˆã¯ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤ºç”¨ã«ä¿æŒï¼ˆå¿…è¦ã«å¿œã˜ã¦æ‹¡å¼µï¼‰\n      }\n\n      if (result.objectId) {\n        // ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ ID ã®æç¤ºã¯å°†æ¥ã®UIæ›´æ–°ã§å¯¾å¿œ\n      }\n\n      if (result.position) {\n        // ä½ç½®æƒ…å ±ã¯ãƒ‡ãƒãƒƒã‚°è¡¨ç¤ºã®ã¿ï¼ˆç¾çŠ¶ã¯æœªä½¿ç”¨ï¼‰\n      }\n\n      if (commandType.mediaType) {\n        // ãƒ¡ãƒ‡ã‚£ã‚¢ã‚¿ã‚¤ãƒ—åˆ¥ã®è¿½åŠ å‡¦ç†ãŒå¿…è¦ã«ãªã£ãŸå ´åˆã«å‚™ãˆãŸãƒ•ãƒƒã‚¯\n      }\n    } catch (error) {\n      const errorMessages = {\n        generate: `âŒ ${commandType.mediaType === 'video' ? 'å‹•ç”»' : 'ç”»åƒ'}ç”Ÿæˆã‚¨ãƒ©ãƒ¼`,\n        modify: 'âŒ å¤‰æ›´ã‚¨ãƒ©ãƒ¼',\n        delete: 'âŒ å‰Šé™¤ã‚¨ãƒ©ãƒ¼'\n      };\n\n      if (taskId) {\n        this.updateTaskCard(taskId, 'error', { errorMessage: error.message });\n      }\n\n      this.addOutput(`${errorMessages[this.currentMode]}: ${error.message}`, 'error');\n      console.error('Command execution error:', error);\n    }\n\n    if (this.sceneManager && this.sceneManager.selectedObject) {\n      if (this.currentMode === 'modify' || this.currentMode === 'delete') {\n        setTimeout(() => {\n          this.sceneManager.deselectObject();\n        }, 500);\n      }\n    }\n\n    if (this.config.autoScroll) {\n      this.scrollToBottom();\n    }\n  }\n\n  /**\n   * ã‚³ãƒãƒ³ãƒ‰ã‚’ç”Ÿæˆãƒ¢ãƒ¼ãƒ‰å‘ã‘ã«å¤‰æ›\n   */\n  convertToGenerateCommand(command) {\n    // ã€ŒçŒ«ã‚’å¤§ããã€â†’ã€Œå¤§ããªçŒ«ã®ç”»åƒã‚’ä½œã£ã¦ã€ã®ã‚ˆã†ãªå¤‰æ›\n    const patterns = [\n      { from: /(.+)ã‚’å¤§ãã/, to: 'å¤§ããª$1ã®ç”»åƒã‚’ä½œã£ã¦' },\n      { from: /(.+)ã‚’å°ã•ã/, to: 'å°ã•ãª$1ã®ç”»åƒã‚’ä½œã£ã¦' },\n      { from: /(.+)ã‚’(.+)ã«/, to: '$2ã®$1ã®ç”»åƒã‚’ä½œã£ã¦' },\n      { from: /(.+)ã‚’(.+)ã/, to: '$2ã„$1ã®ç”»åƒã‚’ä½œã£ã¦' }\n    ];\n    \n    for (const { from, to } of patterns) {\n      if (from.test(command)) {\n        return command.replace(from, to);\n      }\n    }\n    \n    // ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒã—ãªã„å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ\n    return `${command}ã®ç”»åƒã‚’ä½œã£ã¦`;\n  }\n\n  /**\n   * ã‚¿ã‚¹ã‚¯ã‚«ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ«å–å¾—\n   */\n  getTaskCardStyles(status) {\n    const baseStyles = `\n      background: ${this.isDarkMode ? 'rgba(255, 255, 255, 0.08)' : 'rgba(255, 255, 255, 0.15)'};\n      border: 1px solid ${this.isDarkMode ? 'rgba(255, 255, 255, 0.15)' : 'rgba(255, 255, 255, 0.25)'};\n      border-radius: 12px;\n      padding: 16px;\n      margin-bottom: 12px;\n      backdrop-filter: blur(12px);\n      transition: all 0.3s ease;\n      animation: slideInUp 0.3s ease-out;\n    `;\n\n    const statusBorders = {\n      pending: 'rgba(167, 139, 250, 0.3)',     // è–„ç´«\n      processing: 'rgba(192, 132, 252, 0.5)',  // ç´«ï¼ˆå¼·èª¿ï¼‰\n      progress: 'rgba(236, 72, 153, 0.4)',     // ãƒ”ãƒ³ã‚¯\n      completed: 'rgba(167, 139, 250, 0.4)',   // ç´«\n      error: 'rgba(239, 68, 68, 0.4)'          // èµ¤\n    };\n\n    return baseStyles + `border-left: 3px solid ${statusBorders[status] || statusBorders.pending};`;\n  }\n\n  /**\n   * ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚«ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆiOS 26 Liquid Glass + 2026å¹´ãƒˆãƒ¬ãƒ³ãƒ‰ï¼‰\n   */\n  getFloatingCardStyles(status) {\n    // 2025å¹´Glassmorphismä»•æ§˜ï¼šãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¿ã‚¹ã‚¯ã‚«ãƒ¼ãƒ‰\n    const glassmorphismDark = {\n      background: 'linear-gradient(135deg, rgba(15, 23, 42, 0.75), rgba(30, 27, 75, 0.7))',\n      border: '1px solid rgba(99, 102, 241, 0.25)',\n      boxShadow: '0 8px 32px rgba(15, 23, 42, 0.3), 0 0 0 1px rgba(99, 102, 241, 0.1)',\n      color: '#ffffff'\n    };\n\n    const glassmorphismLight = {\n      background: 'linear-gradient(135deg, rgba(255, 255, 255, 0.35), rgba(255, 255, 255, 0.25))',\n      border: '1px solid rgba(255, 255, 255, 0.4)',\n      boxShadow: '0 8px 32px rgba(0, 0, 0, 0.08), 0 0 0 1px rgba(255, 255, 255, 0.2)',\n      color: '#1f2937'\n    };\n\n    const theme = this.isDarkMode ? glassmorphismDark : glassmorphismLight;\n    \n    // 2025å¹´ãƒˆãƒ¬ãƒ³ãƒ‰: å¾…æ©Ÿä¸­ã®ã‚·ãƒãƒ¼ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ\n    const shimmerEffect = (status === 'pending' || status === 'processing' || status === 'progress') ? `\n      position: relative;\n      overflow: hidden;\n      &::before {\n        content: '';\n        position: absolute;\n        top: 0;\n        left: -100%;\n        width: 100%;\n        height: 100%;\n        background: linear-gradient(\n          90deg,\n          transparent,\n          ${this.isDarkMode ? 'rgba(255, 255, 255, 0.2)' : 'rgba(255, 255, 255, 0.4)'},\n          transparent\n        );\n        animation: shimmer 2s infinite;\n      }\n    ` : '';\n\n    // 2025å¹´ãƒˆãƒ¬ãƒ³ãƒ‰: å¾®ç´°ãªæµ®éŠæ„Ÿ\n    const floatingAnimation = (status === 'pending' || status === 'processing' || status === 'progress') ? `\n      animation: gentleFloat 4s ease-in-out infinite, shimmer 2s infinite;\n    ` : '';\n\n    return `\n      height: 36px;\n      padding: 0 18px;\n      display: inline-flex;\n      align-items: center;\n      gap: 8px;\n      background: ${theme.background};\n      backdrop-filter: blur(24px) saturate(180%);\n      -webkit-backdrop-filter: blur(24px) saturate(180%);\n      border: ${theme.border};\n      border-radius: 18px;\n      color: ${theme.color};\n      pointer-events: auto;\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Inter', sans-serif;\n      font-weight: 600;\n      font-size: 13px;\n      letter-spacing: 0.01em;\n      box-shadow: ${theme.boxShadow};\n      transform: translateY(10px);\n      opacity: 0;\n      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n      ${shimmerEffect}\n      ${floatingAnimation}\n      position: relative;\n      overflow: hidden;\n    `;\n  }\n\n  /**\n   * ã‚«ãƒ¼ãƒ‰è¡¨ç¤ºåˆ¶é™ã‚’é©ç”¨ï¼ˆæœ€å¤§3å€‹ã¾ã§è¡¨ç¤ºã€ãã‚Œä»¥ä¸Šã¯ã€Œ+ Nã€ã§è¡¨ç¤ºï¼‰\n   */\n  updateCardDisplayLimit() {\n    const maxVisibleCards = 3;\n    const allCards = Array.from(this.floatingContainer.children).filter(child => \n      !child.classList.contains('overflow-counter')\n    );\n    \n    // æ—¢å­˜ã®ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚’å‰Šé™¤\n    const existingCounter = this.floatingContainer.querySelector('.overflow-counter');\n    if (existingCounter) {\n      existingCounter.remove();\n    }\n    \n    if (allCards.length <= maxVisibleCards) {\n      // ã‚«ãƒ¼ãƒ‰ãŒ3å€‹ä»¥ä¸‹ã®å ´åˆã€ã™ã¹ã¦è¡¨ç¤º\n      allCards.forEach(card => {\n        card.style.display = 'flex';\n      });\n    } else {\n      // ã‚«ãƒ¼ãƒ‰ãŒ4å€‹ä»¥ä¸Šã®å ´åˆã€æœ€æ–°3å€‹ã®ã¿è¡¨ç¤ºã—ã€æ®‹ã‚Šã¯ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼è¡¨ç¤º\n      const visibleCards = allCards.slice(0, maxVisibleCards); // æœ€åˆã®3å€‹ï¼ˆæœ€æ–°ï¼‰\n      const hiddenCount = allCards.length - maxVisibleCards;\n      \n      // å¤ã„ã‚«ãƒ¼ãƒ‰ã‚’éè¡¨ç¤º\n      allCards.forEach((card, index) => {\n        if (index < maxVisibleCards) {\n          card.style.display = 'flex';\n        } else {\n          card.style.display = 'none';\n        }\n      });\n      \n      // ã€Œ+ Nã€ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚’ä½œæˆ\n      const counter = document.createElement('div');\n      counter.className = 'overflow-counter';\n      // ãƒ†ãƒ¼ãƒã«å¿œã˜ãŸã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ«\n      const counterBaseColor = this.isDarkMode ? 'rgba(255, 255, 255, 0.08)' : 'rgba(0, 0, 0, 0.12)';\n      const counterBorderColor = this.isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.15)';\n      const counterTextColor = this.isDarkMode ? 'rgba(255, 255, 255, 0.7)' : 'rgba(0, 0, 0, 0.6)';\n      \n      counter.style.cssText = `\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        padding: 8px 12px;\n        margin: 4px 0;\n        background: ${counterBaseColor};\n        backdrop-filter: blur(20px);\n        border-radius: 12px;\n        border: 1px solid ${counterBorderColor};\n        font-size: 12px;\n        color: ${counterTextColor};\n        font-weight: 500;\n        min-height: 32px;\n        transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);\n        cursor: pointer;\n      `;\n      counter.innerHTML = `+ ${hiddenCount}`;\n      \n      // ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚’æœ€å¾Œã«æŒ¿å…¥ï¼ˆæœ€ä¸‹éƒ¨ã«é…ç½®ï¼‰\n      this.floatingContainer.appendChild(counter);\n      \n      // ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã®ãƒ›ãƒãƒ¼åŠ¹æœï¼ˆãƒ†ãƒ¼ãƒå¯¾å¿œï¼‰\n      const counterHoverColor = this.isDarkMode ? 'rgba(255, 255, 255, 0.12)' : 'rgba(0, 0, 0, 0.18)';\n      \n      counter.addEventListener('mouseenter', () => {\n        counter.style.background = counterHoverColor;\n        counter.style.transform = 'scale(1.05)';\n      });\n      \n      counter.addEventListener('mouseleave', () => {\n        counter.style.background = counterBaseColor;\n        counter.style.transform = 'scale(1)';\n      });\n    }\n  }\n\n  /**\n   * ã‚«ãƒ¼ãƒ‰ã«è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ«ç”¨ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ \n   */\n  addCardDetailEvents(card, taskId) {\n    // ã‚¿ãƒƒãƒãƒ‡ãƒã‚¤ã‚¹æ¤œå‡º\n    const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;\n    \n    if (isTouchDevice) {\n      // ãƒ¢ãƒã‚¤ãƒ«/ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆ: ã‚¿ãƒƒãƒ—ã§è©³ç´°è¡¨ç¤º\n      card.addEventListener('click', (e) => {\n        e.preventDefault();\n        e.stopPropagation();\n        this.showTaskDetailModal(taskId);\n      });\n    } else {\n      // ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—: ãƒ›ãƒãƒ¼ã§è©³ç´°è¡¨ç¤º\n      let hoverTimeout;\n      \n      card.addEventListener('mouseenter', () => {\n        hoverTimeout = setTimeout(() => {\n          this.showTaskDetailModal(taskId);\n        }, 800); // 0.8ç§’ãƒ›ãƒãƒ¼ã§è¡¨ç¤º\n      });\n      \n      card.addEventListener('mouseleave', () => {\n        if (hoverTimeout) {\n          clearTimeout(hoverTimeout);\n        }\n      });\n      \n      // ã‚¯ãƒªãƒƒã‚¯ã§ã‚‚è¡¨ç¤ºï¼ˆãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã§ã‚‚ä½¿ã„ã‚„ã™ãï¼‰\n      card.addEventListener('click', (e) => {\n        e.preventDefault();\n        e.stopPropagation();\n        this.showTaskDetailModal(taskId);\n      });\n    }\n  }\n\n  /**\n   * ã‚¿ã‚¹ã‚¯è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º\n   */\n  showTaskDetailModal(taskId) {\n    const taskData = this.taskCards.get(taskId);\n    if (!taskData) return;\n    \n    // æ—¢å­˜ã®ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’å‰Šé™¤\n    const existingModal = document.querySelector('.task-detail-modal');\n    if (existingModal) {\n      existingModal.remove();\n    }\n    \n    // ãƒ¢ãƒ¼ãƒ€ãƒ«ä½œæˆ\n    const modal = this.createTaskDetailModal(taskData);\n    document.body.appendChild(modal);\n    \n    // å…¥å ´ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³\n    requestAnimationFrame(() => {\n      modal.style.opacity = '1';\n      modal.querySelector('.modal-content').style.transform = 'translateY(0) scale(1)';\n    });\n  }\n\n  /**\n   * ã‚¿ã‚¹ã‚¯è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ«ã®HTMLè¦ç´ ã‚’ä½œæˆ\n   */\n  createTaskDetailModal(taskData) {\n    const modal = document.createElement('div');\n    modal.className = 'task-detail-modal';\n    \n    // ãƒ†ãƒ¼ãƒã«å¿œã˜ãŸã‚¹ã‚¿ã‚¤ãƒ«\n    const overlayColor = this.isDarkMode ? 'rgba(0, 0, 0, 0.6)' : 'rgba(0, 0, 0, 0.4)';\n    const modalBg = this.isDarkMode ? 'rgba(20, 20, 20, 0.95)' : 'rgba(255, 255, 255, 0.95)';\n    const modalBorder = this.isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';\n    const textColor = this.isDarkMode ? 'rgba(255, 255, 255, 0.9)' : 'rgba(0, 0, 0, 0.9)';\n    const labelColor = this.isDarkMode ? 'rgba(255, 255, 255, 0.6)' : 'rgba(0, 0, 0, 0.6)';\n    \n    modal.style.cssText = `\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      background: ${overlayColor};\n      backdrop-filter: blur(10px);\n      z-index: 100000;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      opacity: 0;\n      transition: opacity 0.3s cubic-bezier(0.16, 1, 0.3, 1);\n      cursor: pointer;\n    `;\n    \n    // å®Ÿè¡Œæ™‚é–“è¨ˆç®—\n    const duration = taskData.endTime \n      ? ((taskData.endTime - taskData.startTime) / 1000).toFixed(1)\n      : ((Date.now() - taskData.startTime) / 1000).toFixed(1);\n    \n    // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º\n    const statusText = taskData.status === 'pending' ? 'å¾…æ©Ÿä¸­' \n                    : taskData.status === 'in-progress' ? 'å®Ÿè¡Œä¸­' \n                    : taskData.status === 'completed' ? 'å®Œäº†' \n                    : 'ã‚¨ãƒ©ãƒ¼';\n    \n    const modalContent = document.createElement('div');\n    modalContent.className = 'modal-content';\n    modalContent.style.cssText = `\n      background: ${modalBg};\n      backdrop-filter: blur(30px);\n      border: 1px solid ${modalBorder};\n      border-radius: 16px;\n      padding: 16px !important;\n      max-width: 400px;\n      width: 90%;\n      max-height: 80vh;\n      overflow-y: auto;\n      transform: translateY(20px) scale(0.95);\n      transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);\n      cursor: default;\n      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n    `;\n    \n    modalContent.innerHTML = `\n      <div style=\"display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px;\">\n        <h3 style=\"margin: 0; color: ${textColor}; font-size: 18px; font-weight: 600;\">ã‚¿ã‚¹ã‚¯è©³ç´°</h3>\n        <button class=\"close-btn\" style=\"\n          background: none;\n          border: none;\n          font-size: 24px;\n          color: ${labelColor};\n          cursor: pointer;\n          padding: 0;\n          line-height: 1;\n          transition: color 0.2s;\n        \">Ã—</button>\n      </div>\n      \n      <div style=\"space-y: 16px;\">\n        <div>\n          <div style=\"color: ${labelColor}; font-size: 12px; font-weight: 500; margin-bottom: 0;\">ğŸ“ å…ƒã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ</div>\n          <div style=\"color: ${textColor}; font-size: 14px; line-height: 1.4;\">${taskData.originalPrompt}</div>\n        </div>\n        \n        <div>\n          <div style=\"color: ${labelColor}; font-size: 12px; font-weight: 500; margin-bottom: 0;\">ğŸ“Š ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</div>\n          <div style=\"color: ${textColor}; font-size: 14px;\">${statusText}</div>\n        </div>\n        \n        <div>\n          <div style=\"color: ${labelColor}; font-size: 12px; font-weight: 500; margin-bottom: 0;\">â±ï¸ å®Ÿè¡Œæ™‚é–“</div>\n          <div style=\"color: ${textColor}; font-size: 14px;\">${duration}ç§’</div>\n        </div>\n        \n        ${taskData.error ? `\n        <div>\n          <div style=\"color: ${labelColor}; font-size: 12px; font-weight: 500; margin-bottom: 0;\">âŒ ã‚¨ãƒ©ãƒ¼è©³ç´°</div>\n          <div style=\"color: #ef4444; font-size: 14px; line-height: 1.4;\">${taskData.error}</div>\n        </div>\n        ` : ''}\n        \n        <div>\n          <div style=\"color: ${labelColor}; font-size: 12px; font-weight: 500; margin-bottom: 0;\">ğŸ¨ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¿ã‚¤ãƒ—</div>\n          <div style=\"color: ${textColor}; font-size: 14px;\">${taskData.contentType || 'ç”»åƒ'}</div>\n        </div>\n      </div>\n    `;\n    \n    // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼\n    modalContent.addEventListener('click', (e) => {\n      e.stopPropagation();\n    });\n    \n    const closeBtn = modalContent.querySelector('.close-btn');\n    closeBtn.addEventListener('click', () => {\n      this.closeTaskDetailModal(modal);\n    });\n    \n    closeBtn.addEventListener('mouseenter', () => {\n      closeBtn.style.color = textColor;\n    });\n    \n    closeBtn.addEventListener('mouseleave', () => {\n      closeBtn.style.color = labelColor;\n    });\n    \n    modal.addEventListener('click', () => {\n      this.closeTaskDetailModal(modal);\n    });\n    \n    modal.appendChild(modalContent);\n    return modal;\n  }\n\n  /**\n   * ã‚¿ã‚¹ã‚¯è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹\n   */\n  closeTaskDetailModal(modal) {\n    modal.style.opacity = '0';\n    modal.querySelector('.modal-content').style.transform = 'translateY(20px) scale(0.95)';\n    \n    setTimeout(() => {\n      if (modal.parentNode) {\n        modal.parentNode.removeChild(modal);\n      }\n    }, 300);\n  }\n\n  /**\n   * ã‚«ãƒ¼ãƒ‰å…¥å ´ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆ2026å¹´ãƒˆãƒ¬ãƒ³ãƒ‰ + iOS 26 Liquid Glassï¼‰\n   */\n  animateCardEntrance(card) {\n    // iOS 26 Liquid Glass å…¥å ´ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ\n    card.style.transform = 'translateY(20px) scale(0.95)';\n    card.style.opacity = '0';\n    card.style.filter = 'blur(4px)';\n\n    requestAnimationFrame(() => {\n      card.style.transition = 'all 0.6s cubic-bezier(0.16, 1, 0.3, 1)';\n      card.style.transform = 'translateY(0) scale(1)';\n      card.style.opacity = '1';\n      card.style.filter = 'blur(0px)';\n\n      // 2026å¹´ãƒˆãƒ¬ãƒ³ãƒ‰: å¾®ç´°ãªå…‰ã‚‹åŠ¹æœ\n      card.style.boxShadow = '0 4px 20px rgba(255, 255, 255, 0.1), 0 0 40px rgba(255, 255, 255, 0.05)';\n    });\n  }\n\n  /**\n   * æˆåŠŸæ™‚ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ + è‡ªå‹•æ¶ˆå»ï¼ˆiOS 26 Liquid Glassï¼‰\n   */\n  animateCardSuccess(card, taskId) {\n    // iOS 26 Liquid Glass æˆåŠŸã‚¨ãƒ•ã‚§ã‚¯ãƒˆ\n    card.style.transition = 'all 0.3s cubic-bezier(0.16, 1, 0.3, 1)';\n    card.style.borderColor = 'rgba(76, 175, 80, 0.6)';\n    card.style.transform = 'scale(1.08)';\n    card.style.boxShadow = '0 8px 32px rgba(76, 175, 80, 0.4), 0 0 60px rgba(76, 175, 80, 0.2)';\n    card.style.filter = 'brightness(1.1) saturate(1.2)';\n\n    // 2026å¹´ãƒˆãƒ¬ãƒ³ãƒ‰: æµä½“çš„ãªæˆ»ã‚Šã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³\n    setTimeout(() => {\n      card.style.transform = 'scale(1.02)';\n      card.style.filter = 'brightness(1.05) saturate(1.1)';\n    }, 150);\n\n    // Liquid Glassé¢¨ã®ã‚¹ãƒ ãƒ¼ã‚ºãªãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆï¼ˆ2ç§’å¾Œã«è‡ªå‹•å‰Šé™¤ï¼‰\n    setTimeout(() => {\n      this.animateCardExit(card, taskId);\n    }, 2000);\n  }\n\n  /**\n   * ã‚¨ãƒ©ãƒ¼æ™‚ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆ2026å¹´ãƒˆãƒ¬ãƒ³ãƒ‰ UXï¼‰\n   */\n  animateCardError(card, taskId) {\n    // iOS 26 Liquid Glass ã‚¨ãƒ©ãƒ¼ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ\n    card.style.transition = 'all 0.3s cubic-bezier(0.16, 1, 0.3, 1)';\n    card.style.borderColor = 'rgba(244, 67, 54, 0.7)';\n    card.style.boxShadow = '0 8px 32px rgba(244, 67, 54, 0.3), 0 0 60px rgba(244, 67, 54, 0.15)';\n    card.style.filter = 'saturate(1.3) brightness(1.1)';\n\n    // 2026å¹´ãƒˆãƒ¬ãƒ³ãƒ‰: ã‚ˆã‚Šè‡ªç„¶ãªpulseã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆshakeã‚ˆã‚Šæ´—ç·´ï¼‰\n    card.style.animation = 'errorPulse 0.6s cubic-bezier(0.16, 1, 0.3, 1) 2';\n\n    // UXæ”¹å–„: ã‚¨ãƒ©ãƒ¼å†…å®¹ã‚’è¡¨ç¤ºã™ã‚‹ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—é¢¨UI\n    this.addErrorTooltip(card, taskId);\n\n    // ã‚¨ãƒ©ãƒ¼ã¯æ‰‹å‹•ã§æ¶ˆã™ã¾ã§è¡¨ç¤ºç¶™ç¶šï¼ˆã‚¯ãƒªãƒƒã‚¯ã§æ¶ˆå»ï¼‰\n    card.style.cursor = 'pointer';\n    card.onclick = () => this.animateCardExit(card, taskId);\n\n    // 5ç§’å¾Œã«è‡ªå‹•ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆï¼ˆUXæ”¹å–„ï¼‰\n    setTimeout(() => {\n      if (this.taskCards.has(taskId)) {\n        this.animateCardExit(card, taskId);\n      }\n    }, 5000);\n  }\n\n  /**\n   * ã‚¨ãƒ©ãƒ¼æ™‚ã®ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—è¡¨ç¤ºï¼ˆUXæ”¹å–„ï¼‰\n   */\n  addErrorTooltip(card, taskId) {\n    const taskData = this.taskCards.get(taskId);\n    if (!taskData || !taskData.error) return;\n\n    // ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—è¦ç´ ä½œæˆ\n    const tooltip = document.createElement('div');\n    tooltip.style.cssText = `\n      position: absolute;\n      bottom: 100%;\n      left: 50%;\n      transform: translateX(-50%);\n      background: rgba(244, 67, 54, 0.95);\n      color: white;\n      padding: 8px 12px;\n      border-radius: 8px;\n      font-size: 11px;\n      white-space: nowrap;\n      pointer-events: none;\n      z-index: 1001;\n      backdrop-filter: blur(10px);\n      margin-bottom: 0;\n      opacity: 0;\n      transition: opacity 0.3s ease;\n    `;\n    tooltip.textContent = taskData.error;\n\n    card.style.position = 'relative';\n    card.appendChild(tooltip);\n\n    // ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³\n    requestAnimationFrame(() => {\n      tooltip.style.opacity = '1';\n    });\n\n    // 3ç§’å¾Œã«ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆ\n    setTimeout(() => {\n      if (tooltip.parentNode) {\n        tooltip.style.opacity = '0';\n        setTimeout(() => {\n          if (tooltip.parentNode) {\n            tooltip.parentNode.removeChild(tooltip);\n          }\n        }, 300);\n      }\n    }, 3000);\n  }\n\n  /**\n   * ã‚«ãƒ¼ãƒ‰é€€å ´ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆ2026å¹´ãƒˆãƒ¬ãƒ³ãƒ‰ + iOS 26 Liquid Glassï¼‰\n   */\n  animateCardExit(card, taskId) {\n    // iOS 26 Liquid Glass é€€å ´ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ - 2026å¹´ãƒˆãƒ¬ãƒ³ãƒ‰ã®ã€Œã‚¹ãƒƒã¨æ¶ˆãˆã‚‹ã€\n    card.style.transition = 'all 0.28s cubic-bezier(0.4, 0, 0.2, 1)';\n    card.style.transform = 'translateY(-12px) scale(0.92)';\n    card.style.opacity = '0';\n    card.style.filter = 'blur(6px) brightness(1.2)';\n\n    // 2026å¹´ãƒˆãƒ¬ãƒ³ãƒ‰: æ¶ˆå»æ™‚ã®å¾®ç´°ãªå…‰ã®æ‹¡æ•£åŠ¹æœ\n    card.style.boxShadow = '0 0 40px rgba(255, 255, 255, 0.3), 0 0 80px rgba(255, 255, 255, 0.1)';\n\n    setTimeout(() => {\n      if (card.parentNode) {\n        card.parentNode.removeChild(card);\n      }\n      this.taskCards.delete(taskId);\n      // ã‚«ãƒ¼ãƒ‰å‰Šé™¤å¾Œã«è¡¨ç¤ºåˆ¶é™ã‚’å†é©ç”¨\n      this.updateCardDisplayLimit();\n    }, 280);\n  }\n\n  /**\n   * ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¡¨ç¾ã‚¹ã‚¿ã‚¤ãƒ«ã‚’è‡ªç„¶ã«æ„ŸçŸ¥\n   */\n  getResponseType(prompt) {\n    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¡¨ç¾ã‚¹ã‚¿ã‚¤ãƒ«ã‚’è‡ªç„¶ã«æ„ŸçŸ¥\n    if (/ã¡ã‚‡ã“ã£ã¨|ã¡ã‚‡ã“ã‚“|å°‘ã—|è»½ã/.test(prompt) || prompt.length < 15) {\n      return 'casual';\n    }\n    if (/ç¾ã—ã„|å¹»æƒ³|ç´ æ•µ|é­”æ³•|ä¸–ç•Œ|ç¶ºéº—/.test(prompt)) {\n      return 'magical';\n    }\n    return 'balanced'; // 80%ãŒã“ã“ã«è©²å½“\n  }\n\n  /**\n   * æ¸©ã‹ã¿ã®ã‚ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç”Ÿæˆï¼ˆãƒãƒ¼ã‚±ææ¡ˆãƒ™ãƒ¼ã‚¹ï¼‰\n   */\n  getFriendlyMessage(status, prompt, errorMessage = null) {\n    const shortPrompt = prompt.length > 15 ? prompt.substring(0, 15) + '...' : prompt;\n\n    // è‡ªç„¶ãªå¿œç­”ã‚·ã‚¹ãƒ†ãƒ é©ç”¨\n    const responseType = this.getResponseType(prompt);\n\n    switch (status) {\n      case 'pending':\n        return responseType === 'casual' ? 'ã¡ã‚‡ã“ã£ã¨æº–å‚™ä¸­ã§ã™...' :\n               responseType === 'magical' ? 'é­”æ³•ã‚’ã‹ã‘ã‚ˆã†ã¨ã—ã¦ã„ã¾ã™...' :\n               'ã¡ã‚‡ã“ã£ã¨é­”æ³•ã®æº–å‚™ä¸­...';\n      case 'processing':\n      case 'in-progress':\n      case 'progress':\n        // Modify mode specific messages for processing\n        if (this.currentMode === 'modify') {\n          return responseType === 'casual' ? 'ã¡ã‚‡ã“ã£ã¨èª¿æ•´ä¸­ã§ã™...' :\n                 responseType === 'magical' ? 'ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’å¤‰åŒ–ã•ã›ã¦ã„ã¾ã™...' :\n                 'ã¡ã‚‡ã“ã‚“ã¨ç·¨é›†ä¸­ã§ã™...';\n        }\n        return responseType === 'casual' ? 'ã¡ã‚‡ã“ã‚“ã¨é…ç½®ä¸­ã§ã™...' :\n               responseType === 'magical' ? 'ã‚ãªãŸã®æƒ³ã„ã‚’å½¢ã«ã—ã¦ã„ã¾ã™...' :\n               'ã¡ã‚‡ã“ã£ã¨é­”æ³•ã‚’ã‹ã‘ã¦ã„ã¾ã™...';\n      case 'completed':\n        // Delete mode specific messages\n        if (this.currentMode === 'delete') {\n          return responseType === 'casual' ? 'ã¡ã‚‡ã“ã£ã¨å‰Šé™¤ã—ã¾ã—ãŸï¼' :\n                 responseType === 'magical' ? 'ã™ã£ãã‚Šã¨ç‰‡ä»˜ãã¾ã—ãŸï¼' :\n                 'ã¡ã‚‡ã“ã‚“ã¨å‰Šé™¤å®Œäº†ï¼ã™ã£ãã‚Šã§ã™ã­ï¼';\n        }\n        // Modify mode specific messages\n        if (this.currentMode === 'modify') {\n          return responseType === 'casual' ? 'ã¡ã‚‡ã“ã£ã¨èª¿æ•´ã—ã¾ã—ãŸï¼' :\n                 responseType === 'magical' ? 'ç´ æ•µã«å¤‰èº«ã—ã¾ã—ãŸï¼' :\n                 'ã¡ã‚‡ã“ã‚“ã¨ç·¨é›†å®Œäº†ï¼ã„ã„æ„Ÿã˜ã§ã™ã­ï¼';\n        }\n        // Default completion messages for other modes\n        return responseType === 'casual' ? 'ã¡ã‚‡ã“ã£ã¨ãƒ‰ãƒ­ãƒƒãƒ—ã—ã¾ã—ãŸï¼' :\n               responseType === 'magical' ? 'ç´ æ•µãªä¸–ç•ŒãŒå®Œæˆã—ã¾ã—ãŸï¼' :\n               'ã¡ã‚‡ã“ã‚“ã¨é…ç½®å®Œäº†ï¼ç´ æ•µã§ã™ã­ï¼';\n      case 'error':\n        // ã‚¨ãƒ©ãƒ¼ç†ç”±ãŒã‚ã‚Œã°å«ã‚ã‚‹\n        if (errorMessage) {\n          const shortError = errorMessage.length > 30 ? errorMessage.substring(0, 30) + '...' : errorMessage;\n          return `âŒ ${shortError}`;\n        }\n        return responseType === 'casual' ? 'ãŠã£ã¨ã€ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ' :\n               responseType === 'magical' ? 'ç”³ã—è¨³ã”ã–ã„ã¾ã›ã‚“ã€å‡¦ç†ã«å¤±æ•—ã—ã¾ã—ãŸ' :\n               'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„';\n      default:\n        return shortPrompt;\n    }\n  }\n\n  /**\n   * ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è‰²å–å¾—\n   */\n  getStatusColor(status) {\n    // ãƒã‚ªãƒ³ãƒ‘ãƒ¼ãƒ—ãƒ«/ãƒ”ãƒ³ã‚¯ç³»ã§çµ±ä¸€ï¼ˆ2025ãƒˆãƒ¬ãƒ³ãƒ‰ï¼‰\n    const colors = {\n      pending: this.isDarkMode ? '#a78bfa' : '#7c3aed',        // è–„ç´«\n      processing: this.isDarkMode ? '#c084fc' : '#9333ea',     // ç´«ï¼ˆç”Ÿæˆä¸­ï¼‰\n      progress: this.isDarkMode ? '#ec4899' : '#be185d',       // ãƒ”ãƒ³ã‚¯\n      completed: this.isDarkMode ? '#a78bfa' : '#7c3aed',      // ç´«ï¼ˆå®Œäº†ã‚‚çµ±ä¸€ï¼‰\n      error: this.isDarkMode ? '#f87171' : '#dc2626'           // èµ¤ï¼ˆã‚¨ãƒ©ãƒ¼ã®ã¿ï¼‰\n    };\n    return colors[status] || colors.pending;\n  }\n\n  /**\n   * ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ä½œæˆï¼ˆãƒ‘ãƒ¼ã‚»ãƒ³ãƒˆè¡¨ç¤ºãªã—ï¼‰\n   */\n  createStatusIndicator(status) {\n    if (status === 'processing' || status === 'progress') {\n      return `\n        <div class=\"status-indicator\" style=\"\n          background: ${this.isDarkMode ? 'rgba(255, 255, 255, 0.08)' : 'rgba(0, 0, 0, 0.08)'};\n          border-radius: 8px;\n          height: 4px;\n          overflow: hidden;\n          margin-top: 8px;\n          position: relative;\n        \">\n          <div class=\"status-pulse\" style=\"\n            background: linear-gradient(90deg, transparent, ${this.isWabiSabiMode ? '#8BC34A, #689F38' : '#6366f1, #8b5cf6'}, transparent);\n            height: 100%;\n            width: 30%;\n            border-radius: 8px;\n            animation: statusPulse 1.8s ease-in-out infinite;\n          \"></div>\n        </div>\n        <div style=\"display: flex; align-items: center; gap: 4px; margin-top: 8px;\">\n          <div class=\"status-dots\" style=\"font-size: 10px; color: ${this.isDarkMode ? '#c084fc' : '#9333ea'};\">\n            å‡¦ç†ä¸­<span style=\"animation: dots 1.5s infinite;\">...</span>\n          </div>\n        </div>\n      `;\n    }\n    return '';\n  }\n\n  /**\n   * ã‚¿ã‚¹ã‚¯å®Œäº†ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³\n   */\n  animateTaskCompletion(card) {\n    // æ§ãˆã‚ãªã‚µã‚¯ã‚»ã‚¹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³\n    card.style.animation = 'taskComplete 0.8s ease-out';\n\n    // å¾®å¦™ãªãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«åŠ¹æœã‚’è¿½åŠ ï¼ˆæ§ãˆã‚ï¼‰\n    this.addSubtleParticleEffect(card);\n\n    setTimeout(() => {\n      card.style.animation = '';\n    }, 800);\n\n    this.ensureTaskAnimations();\n  }\n\n  /**\n   * æ§ãˆã‚ãªãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«åŠ¹æœ\n   */\n  addSubtleParticleEffect(card) {\n    const particles = 3; // å°‘ãªã„æ•°ã®ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«\n    const rect = card.getBoundingClientRect();\n\n    for (let i = 0; i < particles; i++) {\n      const particle = document.createElement('div');\n      particle.style.cssText = `\n        position: fixed;\n        width: 4px;\n        height: 4px;\n        background: linear-gradient(45deg, #a78bfa, #c084fc);\n        border-radius: 50%;\n        pointer-events: none;\n        z-index: 9999;\n        left: ${rect.right - 20}px;\n        top: ${rect.top + 10}px;\n        opacity: 0.8;\n        transform: scale(0);\n        animation: subtleParticle 1.2s ease-out forwards;\n      `;\n\n      // ãƒ©ãƒ³ãƒ€ãƒ ãªæ–¹å‘ã«å°‘ã—ç§»å‹•\n      const angle = (i / particles) * Math.PI * 2;\n      const distance = 15; // æ§ãˆã‚ãªè·é›¢\n      particle.style.setProperty('--move-x', `${Math.cos(angle) * distance}px`);\n      particle.style.setProperty('--move-y', `${Math.sin(angle) * distance}px`);\n\n      document.body.appendChild(particle);\n\n      // è‡ªå‹•å‰Šé™¤\n      setTimeout(() => particle.remove(), 1200);\n    }\n  }\n\n  /**\n   * ã‚¿ã‚¹ã‚¯ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”¨CSSç¢ºä¿\n   */\n  ensureTaskAnimations() {\n    if (document.getElementById('task-animations')) return;\n\n    const style = document.createElement('style');\n    style.id = 'task-animations';\n    style.textContent = `\n      @keyframes slideInUp {\n        from { opacity: 0; transform: translateY(20px); }\n        to { opacity: 1; transform: translateY(0); }\n      }\n\n      @keyframes taskComplete {\n        0% {\n          transform: scale(1);\n          border-left-color: rgba(192, 132, 252, 0.5);\n        }\n        30% {\n          transform: scale(1.01);\n          background: rgba(167, 139, 250, 0.08);\n          border-left-color: rgba(167, 139, 250, 0.6);\n        }\n        60% {\n          background: rgba(167, 139, 250, 0.05);\n        }\n        100% {\n          transform: scale(1);\n          background: rgba(167, 139, 250, 0.02);\n          border-left-color: rgba(167, 139, 250, 0.4);\n        }\n      }\n\n      @keyframes subtleParticle {\n        0% {\n          transform: scale(0) translate(0, 0);\n          opacity: 0.8;\n        }\n        20% {\n          transform: scale(1) translate(0, 0);\n          opacity: 1;\n        }\n        100% {\n          transform: scale(0.3) translate(var(--move-x, 0), var(--move-y, 0));\n          opacity: 0;\n        }\n      }\n\n      @keyframes shimmer {\n        0% { transform: translateX(-100%); }\n        100% { transform: translateX(100%); }\n      }\n\n      @keyframes slideIn {\n        from { opacity: 0; transform: translateX(-20px); }\n        to { opacity: 1; transform: translateX(0); }\n      }\n\n      @keyframes statusPulse {\n        0% { transform: translateX(-100%); }\n        50% { transform: translateX(300%); }\n        100% { transform: translateX(-100%); }\n      }\n\n      @keyframes dots {\n        0%, 20% { opacity: 0; }\n        50% { opacity: 1; }\n        100% { opacity: 0; }\n      }\n\n      @keyframes errorPulse {\n        0% {\n          transform: scale(1);\n          filter: saturate(1.3) brightness(1.1);\n        }\n        50% {\n          transform: scale(1.03);\n          filter: saturate(1.5) brightness(1.2);\n          box-shadow: 0 12px 40px rgba(244, 67, 54, 0.4), 0 0 80px rgba(244, 67, 54, 0.2);\n        }\n        100% {\n          transform: scale(1);\n          filter: saturate(1.3) brightness(1.1);\n        }\n      }\n    `;\n    document.head.appendChild(style);\n  }\n\n  /**\n   * ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ä»˜ãã‚¿ã‚¹ã‚¯ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤ºï¼ˆäº’æ›æ€§ã®ãŸã‚ï¼‰\n   */\n  addTaskStatus(message, percent = 0, taskId = null) {\n    const id = taskId || `task_${Date.now()}`;\n    return this.addTaskCard(message, {\n      percent: Math.min(Math.max(percent, 0), 100),\n      taskId: id,\n      status: percent > 0 ? 'progress' : 'pending'\n    });\n  }\n\n  /**\n   * ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹æ›´æ–°\n   */\n  updateTaskProgress(taskId, percent, newMessage = null) {\n    const existingTask = this.output.querySelector(`[data-task-id=\"${taskId}\"]`);\n    if (existingTask && newMessage) {\n      // æ—¢å­˜ã‚¿ã‚¹ã‚¯ã‚’æ›´æ–°\n      this.addOutput(newMessage, 'progress', { \n        percent: Math.min(Math.max(percent, 0), 100),\n        taskId\n      });\n    }\n  }\n\n  /**\n   * ã‚¿ã‚¹ã‚¯å®Œäº†ï¼ˆãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼å‰Šé™¤ï¼‰\n   */\n  completeTask(taskId) {\n    const existingTask = this.output.querySelector(`[data-task-id=\"${taskId}\"]`);\n    if (existingTask) {\n      // å®Œäº†ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³\n      existingTask.style.transition = 'opacity 0.5s ease, transform 0.5s ease';\n      existingTask.style.opacity = '0';\n      existingTask.style.transform = 'translateX(20px)';\n      \n      setTimeout(() => {\n        if (existingTask.parentNode) {\n          existingTask.remove();\n        }\n      }, 500);\n    }\n  }\n\n  /**\n   * SSEæ¥ç¶šé–‹å§‹ï¼ˆãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€²æ—å—ä¿¡ï¼‰\n   */\n  connectToProgress(serverTaskId, uiTaskId = null) {\n    if (this.activeConnections.has(serverTaskId)) {\n      return;\n    }\n\n    const eventSource = new EventSource(`/api/progress/${serverTaskId}`);\n    this.activeConnections.set(serverTaskId, eventSource);\n\n    eventSource.onmessage = (event) => {\n      try {\n        const data = JSON.parse(event.data);\n        data.uiTaskId = uiTaskId; // UIç”¨ã‚¿ã‚¹ã‚¯IDã‚’è¿½åŠ \n        this.handleProgressUpdate(data);\n      } catch (error) {\n        console.error('SSE data parse error:', error);\n      }\n    };\n\n    eventSource.onerror = (error) => {\n      console.error('SSE connection error:', error);\n      this.disconnectProgress(serverTaskId);\n    };\n  }\n\n  /**\n   * é€²æ—æ›´æ–°å‡¦ç†\n   */\n  handleProgressUpdate(data) {\n    switch (data.type) {\n      case 'connected':\n        this.logDebug(`ğŸ”— Connected to progress stream: ${data.taskId}`);\n        break;\n\n      case 'progress':\n        if (data.percent !== undefined && data.uiTaskId) {\n          this.updateTaskCard(data.uiTaskId, 'progress', { percent: data.percent });\n        }\n        break;\n\n      case 'completed':\n        if (data.uiTaskId) {\n          this.updateTaskCard(data.uiTaskId, 'completed');\n        }\n        this.disconnectProgress(data.taskId);\n        break;\n\n      case 'error':\n        if (data.uiTaskId) {\n          this.updateTaskCard(data.uiTaskId, 'error', { errorMessage: data.message });\n        }\n        this.addOutput(`âŒ ${data.message}`, 'error');\n        this.disconnectProgress(data.taskId);\n        break;\n    }\n  }\n\n  /**\n   * SSEæ¥ç¶šçµ‚äº†\n   */\n  disconnectProgress(taskId) {\n    const connection = this.activeConnections.get(taskId);\n    if (connection) {\n      connection.close();\n      this.activeConnections.delete(taskId);\n    }\n  }\n\n  /**\n   * å‡ºåŠ›ã‚¨ãƒªã‚¢ã‚’æœ€ä¸‹éƒ¨ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«\n   */\n  scrollToBottom() {\n    if (this.outputDiv) {\n      this.outputDiv.scrollTop = this.outputDiv.scrollHeight;\n    }\n  }\n\n  /**\n   * ãƒ¢ãƒ¼ãƒ‰åˆ¥ã‚³ãƒãƒ³ãƒ‰ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹\n   */\n  getModePrefix(mode) {\n    // ã‚µãƒ¼ãƒãƒ¼å´ã§ãƒ¢ãƒ¼ãƒ‰ã‚’åŒºåˆ¥ã™ã‚‹ãŸã‚ã®ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹\n    const prefixes = {\n      generate: '', // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ç”Ÿæˆãƒ¢ãƒ¼ãƒ‰\n      modify: '[å¤‰æ›´] ',\n      delete: '[å‰Šé™¤] '\n    };\n    return prefixes[mode] || '';\n  }\n\n  /**\n   * ã‚³ãƒãƒ³ãƒ‰ä¿å­˜ (Undo/Redoã‚·ã‚¹ãƒ†ãƒ )\n   */\n  saveCommandToHistory(commandData) {\n    // ç¾åœ¨ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä»¥é™ã®å±¥æ­´ã‚’å‰Šé™¤ï¼ˆæ–°ã—ã„ã‚³ãƒãƒ³ãƒ‰ãŒå®Ÿè¡Œã•ã‚ŒãŸãŸã‚ï¼‰\n    this.commandHistory = this.commandHistory.slice(0, this.currentHistoryIndex + 1);\n    \n    // æ–°ã—ã„ã‚³ãƒãƒ³ãƒ‰ã‚’å±¥æ­´ã«è¿½åŠ \n    this.commandHistory.push(commandData);\n    this.currentHistoryIndex = this.commandHistory.length - 1;\n    \n    // æœ€å¤§ã‚³ãƒãƒ³ãƒ‰ä¿å­˜æ•°ã‚’è¶…ãˆãŸå ´åˆã€å¤ã„ã‚³ãƒãƒ³ãƒ‰ã‚’å‰Šé™¤\n    if (this.commandHistory.length > this.maxHistorySize) {\n      this.commandHistory.shift();\n      this.currentHistoryIndex--;\n    }\n    \n    // ãƒœã‚¿ãƒ³çŠ¶æ…‹ã‚’æ›´æ–°\n    this.updateUndoRedoButtons();\n  }\n\n  /**\n   * Undoå®Ÿè¡Œ\n   */\n  undo() {\n    if (!this.canUndo()) {\n      this.addOutput('â†¶ Undoã§ãã‚‹æ“ä½œãŒã‚ã‚Šã¾ã›ã‚“', 'hint');\n      return;\n    }\n    \n    const command = this.commandHistory[this.currentHistoryIndex];\n    this.currentHistoryIndex--;\n    \n    // Undoã®é€†æ“ä½œã‚’å®Ÿè¡Œï¼ˆç°¡æ˜“å®Ÿè£…ï¼‰\n    if (command.mode === 'generate') {\n      this.addOutput(`â†¶ Undo: \"${command.command}\" ã®ç”Ÿæˆã‚’å–ã‚Šæ¶ˆã—ã¾ã—ãŸ`, 'system');\n      // å®Ÿéš›ã®ã‚·ãƒ¼ãƒ³ç®¡ç†ã§ã¯æœ€å¾Œã«ä½œæˆã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å‰Šé™¤\n      if (this.sceneManager && this.sceneManager.undoLastGenerate) {\n        this.sceneManager.undoLastGenerate();\n      }\n    } else if (command.mode === 'modify') {\n      this.addOutput(`â†¶ Undo: \"${command.command}\" ã®å¤‰æ›´ã‚’å–ã‚Šæ¶ˆã—ã¾ã—ãŸ`, 'system');\n      // å®Ÿéš›ã®ã‚·ãƒ¼ãƒ³ç®¡ç†ã§ã¯å‰ã®çŠ¶æ…‹ã«æˆ»ã™\n      if (this.sceneManager && this.sceneManager.undoLastModify) {\n        this.sceneManager.undoLastModify();\n      }\n    } else if (command.mode === 'delete') {\n      this.addOutput(`â†¶ Undo: \"${command.command}\" ã®å‰Šé™¤ã‚’å–ã‚Šæ¶ˆã—ã¾ã—ãŸ`, 'system');\n      // å®Ÿéš›ã®ã‚·ãƒ¼ãƒ³ç®¡ç†ã§ã¯å‰Šé™¤ã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å¾©å…ƒ\n      if (this.sceneManager && this.sceneManager.undoLastDelete) {\n        this.sceneManager.undoLastDelete();\n      }\n    }\n    \n    this.updateUndoRedoButtons();\n  }\n\n  /**\n   * Redoå®Ÿè¡Œ\n   */\n  redo() {\n    if (!this.canRedo()) {\n      this.addOutput('â†· Redoã§ãã‚‹æ“ä½œãŒã‚ã‚Šã¾ã›ã‚“', 'hint');\n      return;\n    }\n    \n    this.currentHistoryIndex++;\n    const command = this.commandHistory[this.currentHistoryIndex];\n    \n    // Redoã§ã‚³ãƒãƒ³ãƒ‰ã‚’å†å®Ÿè¡Œ\n    this.addOutput(`â†· Redo: \"${command.command}\" ã‚’å†å®Ÿè¡Œã—ã¾ã—ãŸ`, 'system');\n    \n    // å®Ÿéš›ã®ã‚·ãƒ¼ãƒ³ç®¡ç†ã§ã®Redoå‡¦ç†\n    if (this.sceneManager && this.sceneManager.redoCommand) {\n      this.sceneManager.redoCommand(command);\n    }\n    \n    this.updateUndoRedoButtons();\n  }\n\n  /**\n   * UndoãŒå¯èƒ½ã‹ãƒã‚§ãƒƒã‚¯\n   */\n  canUndo() {\n    return this.currentHistoryIndex >= 0;\n  }\n\n  /**\n   * RedoãŒå¯èƒ½ã‹ãƒã‚§ãƒƒã‚¯\n   */\n  canRedo() {\n    return this.currentHistoryIndex < this.commandHistory.length - 1;\n  }\n\n  /**\n   * Undo/Redoãƒœã‚¿ãƒ³ã®çŠ¶æ…‹æ›´æ–°\n   */\n  updateUndoRedoButtons() {\n    if (this.undoBtn) {\n      this.undoBtn.disabled = !this.canUndo();\n      this.undoBtn.style.opacity = this.canUndo() ? '1' : '0.4';\n      this.undoBtn.style.cursor = this.canUndo() ? 'pointer' : 'not-allowed';\n    }\n    \n    if (this.redoBtn) {\n      this.redoBtn.disabled = !this.canRedo();\n      this.redoBtn.style.opacity = this.canRedo() ? '1' : '0.4';\n      this.redoBtn.style.cursor = this.canRedo() ? 'pointer' : 'not-allowed';\n    }\n  }\n\n  /**\n   * ç¢ºèªä»˜ãå…¨ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå‰Šé™¤\n   */\n  async clearAllWithConfirmation() {\n    const confirmed = await this.showClearAllConfirmation();\n    if (confirmed) {\n      this.clearAll();\n    }\n  }\n\n  /**\n   * Clear Allç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°\n   */\n  async showClearAllConfirmation() {\n    return this.showConfirmationDialog({\n      icon: 'ğŸ§¹',\n      title: 'Clear All ã®ç¢ºèª',\n      message: 'ã™ã¹ã¦ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒå‰Šé™¤ã•ã‚Œã¾ã™ã€‚<br>ã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã™ã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚',\n      confirmText: 'Clear All å®Ÿè¡Œ',\n      cancelText: 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«',\n      confirmColor: this.isWabiSabiMode ? '#8BC34A' : '#6366f1'\n    });\n  }\n\n  /**\n   * ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚¯ãƒ­ãƒ¼ã‚ºã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³\n   */\n  closeModalWithAnimation(modal) {\n    const dialog = modal.querySelector('div:last-child');\n    dialog.style.transform = 'scale(0.9)';\n    dialog.style.opacity = '0';\n    modal.style.opacity = '0';\n    \n    setTimeout(() => {\n      if (modal.parentElement) {\n        document.body.removeChild(modal);\n      }\n    }, 200);\n  }\n\n  /**\n   * å…¨ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå‰Šé™¤\n   */\n  clearAll() {\n    if (this.sceneManager) {\n      this.sceneManager.clearAll();\n      this.addOutput('ğŸ§¹ å…¨ã¦ã®å®Ÿé¨“ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å‰Šé™¤ã—ã¾ã—ãŸ', 'system');\n    } else if (this.client) {\n      // ã‚µãƒ¼ãƒãƒ¼å´ã§ã®å‰Šé™¤ã¯æœªå®Ÿè£…\n      this.addOutput('âš ï¸ ã‚µãƒ¼ãƒãƒ¼å´å‰Šé™¤ã¯æœªå®Ÿè£…', 'error');\n    }\n  }\n\n  // showHistory() ãƒ¡ã‚½ãƒƒãƒ‰å®Œå…¨å‰Šé™¤æ¸ˆã¿\n\n  /**\n   * åˆ©ç”¨å¯èƒ½ãªã‚³ãƒãƒ³ãƒ‰ä¾‹ã‚’è¡¨ç¤º\n   */\n  showExamples() {\n    const examples = [\n      'å³ä¸Šã«ãƒ‰ãƒ©ã‚´ãƒ³ã‚’ä½œã£ã¦',\n      'ä¸­å¤®ã«å¤§ããªãƒ¦ãƒ‹ã‚³ãƒ¼ãƒ³ã‚’ç”Ÿæˆ',\n      'å·¦ä¸‹ã«å°ã•ãªæ¡œã‚’ä½œã£ã¦',\n      'ç©ºã«é³³å‡°ã‚’ä½œã£ã¦',\n      'åœ°é¢ã«ç¥ç¤¾ã‚’ä½œã£ã¦'\n    ];\n\n    this.addOutput('ğŸ’¡ ã‚³ãƒãƒ³ãƒ‰ä¾‹:', 'system');\n    examples.forEach(example => {\n      this.addOutput(`   \"${example}\"`, 'hint');\n    });\n  }\n\n  /**\n   * SceneManagerè¨­å®š\n   */\n  setSceneManager(sceneManager) {\n    this.sceneManager = sceneManager;\n    this.applyServiceSelectionToSceneManager();\n  }\n\n  /**\n   * Clientè¨­å®š\n   */\n  setClient(client) {\n    this.client = client;\n  }\n\n  /**\n   * è¨­å®šæ›´æ–°\n   */\n  updateConfig(newConfig) {\n    this.config = { ...this.config, ...newConfig };\n    // å¿…è¦ã«å¿œã˜ã¦UIã‚’æ›´æ–°\n    if (newConfig.activationKey) {\n      // æ–°ã—ã„ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰ã‚’åæ˜ ã™ã‚‹ãŸã‚ã€ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’å†è¨­å®š\n      this.bindEvents();\n    }\n  }\n\n  /**\n   * ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—\n   */\n  /**\n   * ã‚¹ã‚¿ã‚¤ãƒ«å†é©ç”¨\n   */\n  refreshStyles() {\n    // Generateãƒ¢ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’å†é©ç”¨\n    const generateBtn = this.container?.querySelector('[data-mode=\"generate\"]');\n    if (generateBtn) {\n      generateBtn.style.cssText = this.getModeButtonStyles(true, 'generate');\n    }\n\n    // Executeãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’å†é©ç”¨\n    const executeBtn = this.container?.querySelector('#execute-btn');\n    if (executeBtn) {\n      executeBtn.style.cssText = this.getModernButtonStyles('primary');\n    }\n\n    // ã‚µãƒ¼ãƒ“ã‚¹ãƒ¢ãƒ¼ãƒ€ãƒ«ã®èƒŒæ™¯ã¨ã‚¹ã‚¿ã‚¤ãƒ«ã‚’æ›´æ–°\n    if (this.serviceModal) {\n      this.updateServiceModalStyles();\n    }\n\n    // ã‚µãƒ¼ãƒ“ã‚¹ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ãƒ†ãƒ¼ãƒæ›´æ–°\n    this.updateServiceSelectorTheme();\n  }\n\n  updateServiceModalStyles() {\n    if (!this.serviceModal) return;\n\n    // ãƒ¢ãƒ¼ãƒ€ãƒ«ã®èƒŒæ™¯ã¨ãƒœãƒ¼ãƒ€ãƒ¼ã‚’æ›´æ–°ï¼ˆæ¯å±±æ°´ã®é™å¯‚ï¼‰\n    this.serviceModal.style.background = this.isWabiSabiMode\n      ? 'linear-gradient(135deg, rgba(158, 158, 158, 0.4), rgba(189, 189, 189, 0.35))'\n      : (this.isDarkMode\n        ? 'linear-gradient(135deg, rgba(15, 23, 42, 0.85), rgba(30, 27, 75, 0.8))'\n        : 'linear-gradient(135deg, rgba(255, 255, 255, 0.4), rgba(255, 255, 255, 0.3))');\n\n    this.serviceModal.style.border = this.isWabiSabiMode\n      ? '1px solid rgba(141, 110, 99, 0.4)'\n      : (this.isDarkMode\n        ? '1px solid rgba(99, 102, 241, 0.3)'\n        : '1px solid rgba(255, 255, 255, 0.5)');\n\n    this.serviceModal.style.color = this.isWabiSabiMode\n      ? '#424242'\n      : (this.isDarkMode ? '#ffffff' : '#1f2937');\n\n    this.serviceModal.style.boxShadow = this.isWabiSabiMode\n      ? '0 20px 40px rgba(93, 64, 55, 0.35)'\n      : '0 20px 40px rgba(15, 23, 42, 0.35)';\n  }\n\n  /**\n   * ãƒ†ãƒ¼ãƒåˆ‡ã‚Šæ›¿ãˆ\n   */\n  toggleTheme() {\n    // 3æ®µéšã‚µã‚¤ã‚¯ãƒ«: light â†’ dark â†’ wabisabi â†’ light\n    switch (this.currentTheme) {\n      case 'light':\n        this.currentTheme = 'dark';\n        break;\n      case 'dark':\n        this.currentTheme = 'wabisabi';\n        break;\n      case 'wabisabi':\n        this.currentTheme = 'light';\n        break;\n      default:\n        this.currentTheme = 'light';\n    }\n\n    // çŠ¶æ…‹æ›´æ–°\n    this.isDarkMode = this.currentTheme === 'dark';\n    this.isWabiSabiMode = this.currentTheme === 'wabisabi';\n    localStorage.setItem('live-command-theme', this.currentTheme);\n\n    // ã‚¢ã‚¤ã‚³ãƒ³ãƒœã‚¿ãƒ³æ›´æ–°\n    if (this.themeToggle) {\n      const themeConfig = {\n        light: { icon: 'ğŸŒ™', title: 'ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆ' },\n        dark: { icon: 'ğŸµ', title: 'ä¾˜ã³å¯‚ã³ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆ' },\n        wabisabi: { icon: 'â˜€ï¸', title: 'ãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆ' }\n      };\n\n      const config = themeConfig[this.currentTheme];\n      // å¤ªé™½ã¯é»„è‰²ãã€ãŠèŒ¶ã¯ç·‘ç³»ã€æœˆã¯ç´«ç³»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼\n      if (config.icon === 'â˜€ï¸') {\n        this.themeToggle.innerHTML = `<span style=\"filter: saturate(1.2) brightness(1.1);\">${config.icon}</span>`;\n      } else if (config.icon === 'ğŸµ') {\n        this.themeToggle.innerHTML = `<span style=\"filter: hue-rotate(80deg) saturate(1.1) brightness(1.0);\">${config.icon}</span>`;\n      } else {\n        this.themeToggle.innerHTML = `<span style=\"filter: hue-rotate(240deg) saturate(0.8) brightness(1.1);\">${config.icon}</span>`;\n      }\n      this.themeToggle.title = config.title;\n    }\n\n    // å…¨ã‚¹ã‚¿ã‚¤ãƒ«å†é©ç”¨\n    this.applyTheme();\n\n    // ãƒ†ãƒ¼ãƒåˆ‡ã‚Šæ›¿ãˆå®Œäº†ï¼ˆå±¥æ­´ã«ã¯å‡ºåŠ›ã—ãªã„ï¼‰\n  }\n\n  /**\n   * ãƒ†ãƒ¼ãƒé©ç”¨\n   */\n  applyTheme() {\n    // ãƒœãƒ‡ã‚£ã«ãƒ†ãƒ¼ãƒã‚¯ãƒ©ã‚¹ã‚’è¨­å®š\n    document.body.className = this.isWabiSabiMode ? 'wabisabi-mode' : (this.isDarkMode ? 'dark-mode' : 'light-mode');\n\n    // ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠï¼ˆdisplayçŠ¶æ…‹ã‚’ä¿æŒï¼‰\n    const currentDisplay = this.container.style.display;\n    const currentFlexDirection = this.container.style.flexDirection;\n    this.container.style.cssText = this.getContainerStyles();\n    this.container.style.display = currentDisplay || 'flex';\n    this.container.style.flexDirection = currentFlexDirection || 'column';\n\n    // ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ–ãƒ©ãƒ³ãƒ‰ãƒãƒƒã‚¸ã®ãƒ†ãƒ¼ãƒå†é©ç”¨\n    const brandBadge = this.container.querySelector('.floating-brand-badge');\n    if (brandBadge) {\n      brandBadge.style.background = this.isDarkMode \n        ? 'linear-gradient(135deg, rgba(99, 102, 241, 0.8), rgba(139, 92, 246, 0.7))'\n        : 'linear-gradient(135deg, rgba(99, 102, 241, 0.9), rgba(139, 92, 246, 0.8))';\n      brandBadge.style.border = `1px solid ${this.isDarkMode ? 'rgba(255, 255, 255, 0.2)' : 'rgba(255, 255, 255, 0.4)'}`;\n    }\n\n    // å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰\n    const hadHighlight = !!this.highlightOverlay;\n    this.inputDefaultStyles = null;\n    this.clearKeywordHighlighting();\n    this.input.style.cssText = this.getInputStyles();\n    this.captureInputDefaultStyles();\n    if (hadHighlight || (this.input && this.input.value.trim())) {\n      this.applyKeywordHighlighting();\n    }\n\n    // ã‚¹ã‚¿ã‚¤ãƒ«é©ç”¨\n    this.output.style.cssText = this.getOutputStyles();\n\n    // ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ãƒ¢ãƒ¼ãƒ‰ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ã®2025å¹´ä»•æ§˜ãƒ†ãƒ¼ãƒå†é©ç”¨\n    if (this.radioModeContainer) {\n      this.radioModeContainer.style.background = this.isWabiSabiMode\n        ? 'linear-gradient(135deg, rgba(97, 97, 97, 0.7), rgba(66, 66, 66, 0.6))'\n        : (this.isDarkMode\n          ? 'linear-gradient(135deg, rgba(30, 27, 75, 0.3), rgba(15, 23, 42, 0.4))'\n          : 'linear-gradient(135deg, rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.1))');\n      this.radioModeContainer.style.borderColor = this.isWabiSabiMode\n        ? 'rgba(93, 64, 55, 0.4)'\n        : (this.isDarkMode\n          ? 'rgba(99, 102, 241, 0.15)'\n          : 'rgba(255, 255, 255, 0.25)');\n\n      // å„ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ«æ›´æ–°\n      Object.keys(this.radioModeButtons).forEach(key => {\n        const { button } = this.radioModeButtons[key];\n        if (this.currentMode !== key) {\n          button.style.color = this.isWabiSabiMode\n            ? 'rgba(245, 245, 245, 0.8)'\n            : (this.isDarkMode ? 'rgba(255, 255, 255, 0.7)' : 'rgba(55, 65, 81, 0.8)');\n          button.style.background = 'transparent';\n          button.style.border = '1px solid transparent';\n          button.style.boxShadow = 'none';\n        }\n      });\n\n      // ç¾åœ¨é¸æŠã•ã‚Œã¦ã„ã‚‹ãƒ¢ãƒ¼ãƒ‰ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚‚æ›´æ–°\n      this.selectMode(this.currentMode, false);\n    }\n\n    // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã®ãƒ†ãƒ¼ãƒå†é©ç”¨\n    if (this.clearBtn) {\n      this.clearBtn.style.cssText = this.getActionButtonStyles('secondary');\n    }\n    if (this.historyBtn) {\n      this.historyBtn.style.cssText = this.getActionButtonStyles('secondary');\n      this.historyBtn.style.opacity = '0.5';\n    }\n    if (this.themeToggle) {\n      const themeConfig = {\n        light: { icon: 'ğŸŒ™', title: 'ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆ' },\n        dark: { icon: 'ğŸµ', title: 'ä¾˜ã³å¯‚ã³ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆ' },\n        wabisabi: { icon: 'â˜€ï¸', title: 'ãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆ' }\n      };\n      const config = themeConfig[this.currentTheme] || themeConfig.light;\n      // å¤ªé™½ã¯é»„è‰²ãã€ãŠèŒ¶ã¯ç·‘ç³»ã€æœˆã¯ç´«ç³»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼\n      if (config.icon === 'â˜€ï¸') {\n        this.themeToggle.innerHTML = `<span style=\"filter: saturate(1.2) brightness(1.1);\">${config.icon}</span>`;\n      } else if (config.icon === 'ğŸµ') {\n        this.themeToggle.innerHTML = `<span style=\"filter: hue-rotate(80deg) saturate(1.1) brightness(1.0);\">${config.icon}</span>`;\n      } else {\n        this.themeToggle.innerHTML = `<span style=\"filter: hue-rotate(240deg) saturate(0.8) brightness(1.1);\">${config.icon}</span>`;\n      }\n      this.themeToggle.title = config.title;\n      this.themeToggle.style.cssText = this.getActionButtonStyles('icon');\n    }\n    if (this.settingsButton) {\n      this.settingsButton.style.cssText = this.getActionButtonStyles('icon');\n    }\n\n    this.updateServiceSelectorTheme();\n\n    // é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³ã®ãƒ†ãƒ¼ãƒæ›´æ–°\n    const closeButton = this.container.querySelector('.close-button');\n    if (closeButton) {\n      closeButton.style.color = this.isDarkMode ? '#ffffff' : '#1f2937';\n      closeButton.style.background = this.isDarkMode \n        ? 'rgba(255, 255, 255, 0.1)' \n        : 'rgba(0, 0, 0, 0.1)';\n    }\n\n    // ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚³ãƒ³ãƒ†ãƒŠã¨ã‚¿ã‚¹ã‚¯ã‚«ãƒ¼ãƒ‰ã®ãƒ†ãƒ¼ãƒæ›´æ–°\n    this.updateFloatingContainerTheme();\n\n    // æ—¢å­˜ã®å‡ºåŠ›ãƒ†ã‚­ã‚¹ãƒˆã®è‰²ã‚’æ›´æ–°\n    this.updateExistingTextColors();\n  }\n\n  /**\n   * ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚³ãƒ³ãƒ†ãƒŠã¨ã‚¿ã‚¹ã‚¯ã‚«ãƒ¼ãƒ‰ã®ãƒ†ãƒ¼ãƒæ›´æ–°\n   */\n  updateFloatingContainerTheme() {\n    if (!this.floatingContainer) return;\n\n    // ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚³ãƒ³ãƒ†ãƒŠã®è¡¨ç¤ºçŠ¶æ…‹ã‚’ä¿æŒ\n    const currentDisplay = this.floatingContainer.style.display;\n\n    // æ—¢å­˜ã®ã‚¿ã‚¹ã‚¯ã‚«ãƒ¼ãƒ‰ã®è‰²ã ã‘ã‚’ãƒ†ãƒ¼ãƒã«åˆã‚ã›ã¦æ›´æ–°ï¼ˆãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã¯ä¿æŒï¼‰\n    if (this.taskCards && this.taskCards.size > 0) {\n      this.taskCards.forEach((taskData, taskId) => {\n        const card = taskData.element;\n        if (card) {\n          // ãƒ†ãƒ¼ãƒé–¢é€£ã®è‰²ã®ã¿æ›´æ–°ï¼ˆä½ç½®ã‚„ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³çŠ¶æ…‹ã¯ä¿æŒï¼‰\n          // 2025å¹´Glassmorphismä»•æ§˜é©ç”¨\n          const glassmorphismDark = {\n            background: 'linear-gradient(135deg, rgba(15, 23, 42, 0.75), rgba(30, 27, 75, 0.7))',\n            border: '1px solid rgba(99, 102, 241, 0.25)',\n            color: '#ffffff'\n          };\n\n          const glassmorphismLight = {\n            background: 'linear-gradient(135deg, rgba(255, 255, 255, 0.35), rgba(255, 255, 255, 0.25))',\n            border: '1px solid rgba(255, 255, 255, 0.4)',\n            color: '#1f2937'\n          };\n\n          const theme = this.isDarkMode ? glassmorphismDark : glassmorphismLight;\n\n\n          card.style.setProperty('background', theme.background, 'important');\n          card.style.setProperty('border', theme.border, 'important');\n          card.style.setProperty('color', theme.color, 'important');\n        }\n      });\n    }\n\n    // ãƒ†ãƒ¼ãƒåˆ‡ã‚Šæ›¿ãˆæ™‚ã¯ä½ç½®ã¯å¤‰æ›´ã›ãšã€è¡¨ç¤ºçŠ¶æ…‹ã®ã¿å¾©å…ƒ\n    this.floatingContainer.style.display = currentDisplay;\n  }\n\n  /**\n   * æ—¢å­˜ã®ãƒ†ã‚­ã‚¹ãƒˆè‰²ã‚’ç¾åœ¨ã®ãƒ†ãƒ¼ãƒã«åˆã‚ã›ã¦æ›´æ–°\n   */\n  updateExistingTextColors() {\n    const colors = this.isDarkMode ? {\n      system: '#60a5fa',\n      command: '#93c5fd',\n      success: '#f472b6',\n      error: '#f87171',\n      processing: '#fbbf24',\n      info: '#d1d5db',\n      hint: '#d1d5db'\n    } : {\n      system: '#1e40af',\n      command: '#1d4ed8',\n      success: '#be185d',\n      error: '#dc2626',\n      processing: '#d97706',\n      info: '#7c3aed',\n      hint: '#374151'\n    };\n\n    const defaultTextColor = this.isDarkMode ? '#d1d5db' : '#374151';\n\n    // outputå†…ã®å…¨ã¦ã®divã®è‰²ã‚’æ›´æ–°\n    this.output.querySelectorAll('div').forEach(line => {\n      const text = line.textContent;\n      let type = 'default';\n      \n      // ãƒ†ã‚­ã‚¹ãƒˆã®å†…å®¹ã‹ã‚‰ã‚¿ã‚¤ãƒ—ã‚’åˆ¤å®š\n      if (text.includes('ğŸ“‹') || text.includes('ğŸ¨') || text.includes('ğŸ®') || text.includes('UIèµ·å‹•')) {\n        type = 'system';\n      } else if (text.startsWith('> ')) {\n        type = 'command';\n      } else if (text.includes('âœ…') || text.includes('â­') || text.includes('ç”Ÿæˆã—ã¾ã—ãŸ')) {\n        type = 'success';\n      } else if (text.includes('âŒ') || text.includes('ã‚¨ãƒ©ãƒ¼')) {\n        type = 'error';\n      } else if (text.includes('ä¸­...')) {\n        type = 'processing';\n      } else if (text.includes('ğŸ“') || text.includes('ä½¿ç”¨ãƒ¢ãƒ‡ãƒ«:') || text.includes('ä½ç½®:')) {\n        type = 'info';\n      } else if (text.includes('   ')) {\n        type = 'hint';\n      }\n\n      line.style.color = colors[type] || defaultTextColor;\n    });\n  }\n\n  /**\n   * Importã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹è¡¨ç¤º\n   */\n  showImportInterface() {\n    // éš ã—ãƒ•ã‚¡ã‚¤ãƒ«å…¥åŠ›ã‚’ä½œæˆï¼ˆImportãƒœã‚¿ãƒ³ã‹ã‚‰ç›´æ¥é¸æŠã§ãã‚‹ã®ã§ã€ãƒœã‚¿ãƒ³ã¯ä¸è¦ï¼‰\n    if (!this.fileInput) {\n      this.fileInput = document.createElement('input');\n      this.fileInput.type = 'file';\n      this.fileInput.accept = '.glb,.gltf,.jpg,.jpeg,.png,.mp4,.mov';\n      this.fileInput.style.display = 'none';\n      this.fileInput.onchange = (e) => this.handleFileSelection(e);\n      document.body.appendChild(this.fileInput);\n    }\n\n    // ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—æ©Ÿèƒ½ã‚’æœ‰åŠ¹åŒ–\n    this.enableDragAndDrop();\n  }\n\n  /**\n   * Importã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹éè¡¨ç¤º\n   */\n  hideImportInterface() {\n    if (this.fileSelectButton && this.fileSelectButton.parentNode) {\n      this.fileSelectButton.parentNode.removeChild(this.fileSelectButton);\n    }\n    this.disableDragAndDrop();\n  }\n\n  /**\n   * ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’é–‹ã\n   */\n  openFileSelector() {\n    if (this.fileInput) {\n      this.fileInput.click();\n    }\n  }\n\n  /**\n   * Importãƒœã‚¿ãƒ³ã‹ã‚‰ç›´æ¥ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠã‚’å®Ÿè¡Œ\n   */\n  triggerFileSelection() {\n    // ãƒ•ã‚¡ã‚¤ãƒ«å…¥åŠ›è¦ç´ ãŒå­˜åœ¨ã—ãªã„å ´åˆã¯ä½œæˆ\n    if (!this.fileInput) {\n      this.showImportInterface(); // æ—¢å­˜ã®ãƒ•ã‚¡ã‚¤ãƒ«å…¥åŠ›ä½œæˆå‡¦ç†ã‚’å‘¼ã³å‡ºã—\n    }\n\n    // ç›´æ¥ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’é–‹ã\n    this.openFileSelector();\n\n    // Import ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆï¼ˆUIåæ˜ ï¼‰\n    this.selectMode('import', true);\n  }\n\n  /**\n   * ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠå‡¦ç†\n   */\n  async handleFileSelection(event) {\n    const file = event.target.files[0];\n    if (!file) return;\n\n    try {\n      // å‰å›ã®ObjectURLã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ï¼ˆãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯é˜²æ­¢ï¼‰\n      if (this.selectedFile && this.selectedFile.url) {\n        URL.revokeObjectURL(this.selectedFile.url);\n      }\n\n      // ãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ã‚¤ãƒ—ã‚’åˆ¤å®š\n      const fileType = this.detectFileType(file.name);\n\n      // ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ­ãƒ¼ã‚«ãƒ«URLã¨ã—ã¦å‡¦ç†\n      const fileUrl = URL.createObjectURL(file);\n\n      // ãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±ã‚’ä¿å­˜\n      this.selectedFile = {\n        file: file,\n        url: fileUrl,\n        type: fileType,\n        name: file.name\n      };\n\n      this.selectMode('import', true);\n\n      // è‡ªå‹•çš„ã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã§å®Ÿè¡Œ\n      const defaultPrompt = `ä¸­å¤®ã«è¨­ç½® (${file.name})`;\n      this.input.value = defaultPrompt;\n\n      this.addOutput(`ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ: ${file.name} (${fileType})`, 'system');\n      this.addOutput(`ğŸš€ è‡ªå‹•ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰é–‹å§‹: ${defaultPrompt}`, 'system');\n\n      // è‡ªå‹•å®Ÿè¡Œï¼ˆå°‘ã—é…å»¶ã‚’å…¥ã‚Œã¦UXå‘ä¸Šï¼‰\n      setTimeout(() => {\n        this.executeCommand();\n      }, 500);\n\n    } catch (error) {\n      console.error('File selection error:', error);\n      this.addOutput(`âŒ ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');\n    } finally {\n      // IMPORTANT: ãƒ•ã‚¡ã‚¤ãƒ«å…¥åŠ›ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¦åŒã˜ãƒ•ã‚¡ã‚¤ãƒ«ã®å†é¸æŠã‚’å¯èƒ½ã«ã™ã‚‹\n      if (event.target) {\n        event.target.value = '';\n      }\n    }\n  }\n\n  /**\n   * ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—æ©Ÿèƒ½ã‚’æœ‰åŠ¹åŒ–\n   */\n  enableDragAndDrop() {\n    if (!this.input) return;\n\n    this.input.addEventListener('dragover', this.handleDragOver.bind(this));\n    this.input.addEventListener('drop', this.handleDrop.bind(this));\n    this.input.addEventListener('dragenter', this.handleDragEnter.bind(this));\n    this.input.addEventListener('dragleave', this.handleDragLeave.bind(this));\n  }\n\n  /**\n   * ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—æ©Ÿèƒ½ã‚’ç„¡åŠ¹åŒ–\n   */\n  disableDragAndDrop() {\n    if (!this.input) return;\n\n    this.input.removeEventListener('dragover', this.handleDragOver.bind(this));\n    this.input.removeEventListener('drop', this.handleDrop.bind(this));\n    this.input.removeEventListener('dragenter', this.handleDragEnter.bind(this));\n    this.input.removeEventListener('dragleave', this.handleDragLeave.bind(this));\n  }\n\n  /**\n   * ãƒ‰ãƒ©ãƒƒã‚°ã‚ªãƒ¼ãƒãƒ¼å‡¦ç†\n   */\n  handleDragOver(e) {\n    e.preventDefault();\n    this.input.style.background = this.isDarkMode ? 'rgba(236, 72, 153, 0.1)' : 'rgba(236, 72, 153, 0.05)';\n  }\n\n  /**\n   * ãƒ‰ãƒ©ãƒƒã‚°ã‚¨ãƒ³ã‚¿ãƒ¼å‡¦ç†\n   */\n  handleDragEnter(e) {\n    e.preventDefault();\n    this.input.style.background = this.isDarkMode ? 'rgba(236, 72, 153, 0.1)' : 'rgba(236, 72, 153, 0.05)';\n  }\n\n  /**\n   * ãƒ‰ãƒ©ãƒƒã‚°ãƒªãƒ¼ãƒ–å‡¦ç†\n   */\n  handleDragLeave(e) {\n    e.preventDefault();\n    this.input.style.background = '';\n  }\n\n  /**\n   * ãƒ‰ãƒ­ãƒƒãƒ—å‡¦ç†\n   */\n  async handleDrop(e) {\n    e.preventDefault();\n    this.input.style.background = '';\n\n    const files = Array.from(e.dataTransfer.files);\n    if (files.length === 0) return;\n\n    const file = files[0]; // æœ€åˆã®ãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿å‡¦ç†\n\n    // ãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ã‚¤ãƒ—ã‚’ãƒã‚§ãƒƒã‚¯\n    const fileType = this.detectFileType(file.name);\n    if (!fileType) {\n      this.addOutput('âŒ ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ãªã„ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã§ã™', 'error');\n      return;\n    }\n\n    // ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠå‡¦ç†ã¨åŒã˜æµã‚Œ\n    this.handleFileSelection({ target: { files: [file] } });\n  }\n\n  /**\n   * ãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ã‚¤ãƒ—åˆ¤å®š\n   */\n  detectFileType(fileName) {\n    const ext = fileName.toLowerCase().split('.').pop();\n\n    if (['glb', 'gltf'].includes(ext)) return '3d';\n    if (['jpg', 'jpeg', 'png', 'webp'].includes(ext)) return 'image';\n    if (['mp4', 'mov', 'webm'].includes(ext)) return 'video';\n\n    return null;\n  }\n\n  /**\n   * Importã‚³ãƒãƒ³ãƒ‰å‡¦ç†\n   */\n  async handleImportCommand(command) {\n    if (!this.selectedFile) {\n      throw new Error('ãƒ•ã‚¡ã‚¤ãƒ«ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“');\n    }\n\n    try {\n      // ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‹ã‚‰ä½ç½®æƒ…å ±ã‚’è§£æ\n      const position = this.sceneManager ? this.sceneManager.parsePosition(command) : { x: 0, y: 5, z: -10 };\n\n      let result;\n\n      switch (this.selectedFile.type) {\n        case '3d':\n          // 3Dãƒ¢ãƒ‡ãƒ«ã‚’èª­ã¿è¾¼ã¿\n          if (this.sceneManager) {\n            result = await this.sceneManager.load3DModel(this.selectedFile.url, {\n              position: position,\n              // scale: è‡ªå‹•èª¿æ•´ã«ä»»ã›ã‚‹\n            });\n          } else {\n            throw new Error('SceneManager ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“');\n          }\n          break;\n\n        case 'image':\n          // ç”»åƒã‚’ãƒ†ã‚¯ã‚¹ãƒãƒ£ãƒ—ãƒ¬ãƒ¼ãƒ³ã¨ã—ã¦é…ç½®\n          if (this.sceneManager) {\n            result = await this.sceneManager.loadImageFile(this.selectedFile.url, {\n              position: position,\n              fileName: this.selectedFile.name\n            });\n          } else {\n            throw new Error('SceneManager ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“');\n          }\n          break;\n\n        case 'video':\n          // å‹•ç”»ã‚’ãƒ“ãƒ‡ã‚ªãƒ†ã‚¯ã‚¹ãƒãƒ£ã¨ã—ã¦é…ç½®\n          if (this.sceneManager) {\n            result = await this.sceneManager.loadVideoFile(this.selectedFile.url, {\n              position: position,\n              fileName: this.selectedFile.name\n            });\n          } else {\n            throw new Error('SceneManager ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“');\n          }\n          break;\n\n        default:\n          throw new Error(`ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ãªã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ã‚¤ãƒ—: ${this.selectedFile.type}`);\n      }\n\n      // ãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±ã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—\n      const processedFileName = this.selectedFile?.name;\n      const importedType = this.selectedFile?.type;\n      const importedUrl = this.selectedFile?.url;\n\n      if (importedType !== 'video' && importedUrl) {\n        URL.revokeObjectURL(importedUrl);\n      }\n\n      this.selectedFile = null;\n      this.selectMode('generate', false);\n\n      return {\n        success: true,\n        message: `${processedFileName || 'ãƒ•ã‚¡ã‚¤ãƒ«'} ã‚’ ${position.x}, ${position.y}, ${position.z} ã«é…ç½®ã—ã¾ã—ãŸ`,\n        objectId: result.objectId\n      };\n\n    } catch (error) {\n      // ã‚¨ãƒ©ãƒ¼æ™‚ã‚‚ãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±ã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—\n      if (this.selectedFile?.url) {\n        URL.revokeObjectURL(this.selectedFile.url);\n      }\n      this.selectedFile = null;\n      this.selectMode('generate', false);\n      throw error;\n    }\n  }\n\n  /**\n   * å‰Šé™¤ãƒ¢ãƒ¼ãƒ‰ãŒé¸æŠã•ã‚ŒãŸæ™‚ã®å‡¦ç†\n   */\n  handleDeleteModeSelection() {\n    // SceneManagerã‹ã‚‰é¸æŠã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å–å¾—\n    const selectedObject = this.sceneManager?.selectedObject;\n    \n    if (selectedObject) {\n      // é¸æŠã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒã‚ã‚‹å ´åˆï¼šå‰Šé™¤ã‚³ãƒãƒ³ãƒ‰ã‚’ãƒãƒ£ãƒƒãƒˆæ¬„ã«å…¥åŠ›\n      const objectName = selectedObject.userData?.originalPrompt || selectedObject.name || 'é¸æŠã—ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ';\n      this.input.value = `${objectName}ã‚’å‰Šé™¤ â`;\n      this.input.focus();\n      \n      // ã‚«ãƒ¼ã‚½ãƒ«ã‚’æ–‡æœ«ã«ç§»å‹•ï¼ˆé¸æŠçŠ¶æ…‹ã‚’è§£é™¤ï¼‰\n      this.input.setSelectionRange(this.input.value.length, this.input.value.length);\n      \n      this.addOutput(`ğŸ¯ å‰Šé™¤å¯¾è±¡: ${objectName}`, 'system');\n    } else {\n      // é¸æŠã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒãªã„å ´åˆï¼š2025å¹´ãƒˆãƒ¬ãƒ³ãƒ‰ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã§æ³¨æ„å–šèµ·\n      this.input.value = '';\n      this.addOutput('â— å‰Šé™¤ã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’é¸æŠå¾Œã€å‰Šé™¤ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„', 'system');\n      \n      // 2025å¹´ãƒˆãƒ¬ãƒ³ãƒ‰ï¼šContext-Aware Attention Animation\n      this.triggerAttentionAnimation('delete');\n      \n      // DELETEãƒ¢ãƒ¼ãƒ‰ã‚’ç¶­æŒï¼ˆgenerateãƒ¢ãƒ¼ãƒ‰ã«æˆ»ã•ãªã„ï¼‰\n    }\n  }\n\n  /**\n   * ä¿®æ­£ãƒ¢ãƒ¼ãƒ‰ãŒé¸æŠã•ã‚ŒãŸæ™‚ã®å‡¦ç†\n   */\n  handleModifyModeSelection() {\n    // SceneManagerã‹ã‚‰é¸æŠã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å–å¾—\n    const selectedObject = this.sceneManager?.selectedObject;\n    \n    if (selectedObject) {\n      // é¸æŠã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒã‚ã‚‹å ´åˆï¼šä¿®æ­£ã‚³ãƒãƒ³ãƒ‰ã‚’ãƒãƒ£ãƒƒãƒˆæ¬„ã«å…¥åŠ›\n      const objectName = selectedObject.userData?.originalPrompt || selectedObject.name || 'é¸æŠã—ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ';\n      this.input.value = `${objectName}ã‚’`;\n      this.input.focus();\n      \n      // ã‚«ãƒ¼ã‚½ãƒ«ã‚’æ–‡æœ«ã«ç§»å‹•ï¼ˆé¸æŠçŠ¶æ…‹ã‚’è§£é™¤ï¼‰\n      this.input.setSelectionRange(this.input.value.length, this.input.value.length);\n      \n      this.addOutput(`ğŸ¯ ä¿®æ­£å¯¾è±¡: ${objectName}`, 'system');\n    } else {\n      // é¸æŠã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒãªã„å ´åˆï¼š2025å¹´ãƒˆãƒ¬ãƒ³ãƒ‰ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã§æ³¨æ„å–šèµ·\n      this.input.value = '';\n      this.addOutput('â— ä¿®æ­£ã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’é¸æŠå¾Œã€ä¿®æ­£ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„', 'system');\n      \n      // 2025å¹´ãƒˆãƒ¬ãƒ³ãƒ‰ï¼šContext-Aware Attention Animation\n      this.triggerAttentionAnimation('modify');\n      \n      // Modifyãƒ¢ãƒ¼ãƒ‰ã‚’ç¶­æŒï¼ˆgenerateãƒ¢ãƒ¼ãƒ‰ã«æˆ»ã•ãªã„ï¼‰\n    }\n  }\n\n  /**\n   * 2025å¹´ãƒˆãƒ¬ãƒ³ãƒ‰ï¼šContext-Aware Attention Animation\n   * ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæœªé¸æŠæ™‚ã®æ³¨æ„å–šèµ·ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³\n   */\n  triggerAttentionAnimation(mode) {\n    const chatOutput = this.chatOutput;\n    const inputField = this.input;\n    \n    // 2025å¹´ãƒˆãƒ¬ãƒ³ãƒ‰1: Micro-Shake Effectï¼ˆå¾®ç´°ãªéœ‡ãˆï¼‰\n    this.addMicroShakeEffect(chatOutput);\n    \n    // 2025å¹´ãƒˆãƒ¬ãƒ³ãƒ‰2: Context-Aware Glowï¼ˆçŠ¶æ³èªè­˜ã‚°ãƒ­ãƒ¼ï¼‰\n    this.addContextGlow(inputField, mode);\n    \n    // 2025å¹´ãƒˆãƒ¬ãƒ³ãƒ‰3: Emotional Pulseï¼ˆæ„Ÿæƒ…çš„ãƒ‘ãƒ«ã‚¹ï¼‰\n    this.addEmotionalPulse(chatOutput, mode);\n    \n    // 2025å¹´ãƒˆãƒ¬ãƒ³ãƒ‰4: 3D Depth Shadowï¼ˆç«‹ä½“çš„å½±åŠ¹æœï¼‰\n    this.add3DDepthEffect(chatOutput);\n  }\n\n  /**\n   * 2025å¹´ãƒˆãƒ¬ãƒ³ãƒ‰ï¼šMicro-Shake Effect\n   */\n  addMicroShakeEffect(element) {\n    element.style.animation = 'microShake2025 0.5s ease-in-out';\n    \n    // CSSã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å‹•çš„è¿½åŠ \n    this.ensureMicroShakeAnimation();\n    \n    // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å¾Œã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—\n    setTimeout(() => {\n      element.style.animation = '';\n    }, 500);\n  }\n\n  /**\n   * 2025å¹´ãƒˆãƒ¬ãƒ³ãƒ‰ï¼šContext-Aware Glow\n   */\n  addContextGlow(element, mode) {\n    const glowColor = mode === 'delete' ? 'rgba(239, 68, 68, 0.4)' : 'rgba(99, 102, 241, 0.4)';\n    \n    element.style.transition = 'all 0.3s ease';\n    element.style.boxShadow = `0 0 20px ${glowColor}, 0 0 40px ${glowColor}`;\n    \n    // 3ç§’å¾Œã«ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆ\n    setTimeout(() => {\n      element.style.boxShadow = '';\n    }, 3000);\n  }\n\n  /**\n   * 2025å¹´ãƒˆãƒ¬ãƒ³ãƒ‰ï¼šEmotional Pulse\n   */\n  addEmotionalPulse(element, mode) {\n    const pulseColor = mode === 'delete' ? '#ef4444' : (this.isWabiSabiMode ? '#8BC34A' : '#6366f1');\n    \n    element.style.borderLeft = `4px solid ${pulseColor}`;\n    element.style.animation = 'emotionalPulse2025 2s ease-in-out infinite';\n    \n    // CSSã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å‹•çš„è¿½åŠ \n    this.ensureEmotionalPulseAnimation();\n    \n    // 6ç§’å¾Œã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³åœæ­¢\n    setTimeout(() => {\n      element.style.animation = '';\n      element.style.borderLeft = '';\n    }, 6000);\n  }\n\n  /**\n   * 2025å¹´ãƒˆãƒ¬ãƒ³ãƒ‰ï¼š3D Depth Effect\n   */\n  add3DDepthEffect(element) {\n    element.style.transform = 'translateZ(8px) rotateX(1deg)';\n    element.style.transition = 'transform 0.3s ease';\n    \n    // 2ç§’å¾Œã«å…ƒã«æˆ»ã™\n    setTimeout(() => {\n      element.style.transform = '';\n    }, 2000);\n  }\n\n  /**\n   * Micro-Shake CSSã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç¢ºä¿\n   */\n  ensureMicroShakeAnimation() {\n    if (document.getElementById('micro-shake-2025')) return;\n    \n    const style = document.createElement('style');\n    style.id = 'micro-shake-2025';\n    style.textContent = `\n      @keyframes microShake2025 {\n        0%, 100% { transform: translateX(0); }\n        10% { transform: translateX(-2px) rotateZ(-0.5deg); }\n        20% { transform: translateX(2px) rotateZ(0.5deg); }\n        30% { transform: translateX(-1px) rotateZ(-0.3deg); }\n        40% { transform: translateX(1px) rotateZ(0.3deg); }\n        50% { transform: translateX(-0.5px) rotateZ(-0.1deg); }\n        60% { transform: translateX(0.5px) rotateZ(0.1deg); }\n        70% { transform: translateX(0); }\n      }\n    `;\n    document.head.appendChild(style);\n  }\n\n  /**\n   * Emotional Pulse CSSã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç¢ºä¿\n   */\n  ensureEmotionalPulseAnimation() {\n    if (document.getElementById('emotional-pulse-2025')) return;\n    \n    const style = document.createElement('style');\n    style.id = 'emotional-pulse-2025';\n    style.textContent = `\n      @keyframes emotionalPulse2025 {\n        0% { \n          border-left-width: 4px;\n          filter: brightness(1);\n        }\n        50% { \n          border-left-width: 8px;\n          filter: brightness(1.2) saturate(1.1);\n        }\n        100% { \n          border-left-width: 4px;\n          filter: brightness(1);\n        }\n      }\n    `;\n    document.head.appendChild(style);\n  }\n\n  /**\n   * ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆæ™‚ã®å…¥åŠ›æ¬„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä¸Šæ›¸ãæ©Ÿèƒ½\n   * ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£å‘ä¸Šï¼šä»–ãƒ¢ãƒ¼ãƒ‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ–°ãƒ¢ãƒ¼ãƒ‰ã®åˆæœŸçŠ¶æ…‹ã«ã‚¯ãƒªã‚¢\n   */\n  clearInputOnModeSwitch(newMode) {\n    // ç¾åœ¨ã®å…¥åŠ›æ¬„ã«å†…å®¹ãŒã‚ã‚‹å ´åˆã®ã¿å‡¦ç†\n    if (this.input.value.trim()) {\n      // ä»¥å‰ã®ãƒ¢ãƒ¼ãƒ‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‹ã©ã†ã‹ã‚’åˆ¤å®š\n      const isPreviousModeMessage = this.isPreviousModeMessage(this.input.value, newMode);\n      \n      if (isPreviousModeMessage) {\n        // ä»¥å‰ã®ãƒ¢ãƒ¼ãƒ‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å ´åˆã€æ–°ãƒ¢ãƒ¼ãƒ‰ã®åˆæœŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ç½®ãæ›ãˆ\n        this.input.value = '';\n        this.addOutput(`ğŸ’« ${this.getModeDisplayName(newMode)}ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆã¾ã—ãŸ`, 'system');\n      }\n    }\n  }\n\n  /**\n   * å…¥åŠ›å†…å®¹ãŒä»¥å‰ã®ãƒ¢ãƒ¼ãƒ‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‹ã©ã†ã‹ã‚’åˆ¤å®š\n   */\n  isPreviousModeMessage(inputValue, currentMode) {\n    // Delete/Modifyãƒ¢ãƒ¼ãƒ‰ã®ç‰¹å¾´çš„ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ¤œå‡º\n    const deletePatterns = [\n      /.*ã‚’å‰Šé™¤$/,\n      /å‰Šé™¤$/\n    ];\n    \n    const modifyPatterns = [\n      /.*ã‚’$/,\n      /.*ã‚’å¤‰æ›´/,\n      /.*ã‚’ãƒ”ãƒ³ã‚¯/,\n      /.*ã‚’å¤§ãã/,\n      /.*ã‚’å°ã•ã/,\n      /.*ã‚’ç§»å‹•/,\n      /å›è»¢/,\n      /åè»¢/,\n      /ãƒŸãƒ©ãƒ¼/,\n      /å‚¾ã‘/,\n      /å‘ãã‚’å¤‰ãˆ/,\n      /.*ã‚’.*è‰²/,\n      /.*ã‚’.*ã‚µã‚¤ã‚º/\n    ];\n    \n    const importPatterns = [\n      /ãƒ•ã‚¡ã‚¤ãƒ«/,\n      /ç”»åƒ/,\n      /ã‚¤ãƒ³ãƒãƒ¼ãƒˆ/\n    ];\n\n    // ç¾åœ¨ã®ãƒ¢ãƒ¼ãƒ‰ã¨ç•°ãªã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ãƒãƒƒãƒã™ã‚‹å ´åˆã¯ä¸Šæ›¸ãå¯¾è±¡\n    switch (currentMode) {\n      case 'delete':\n        return modifyPatterns.some(pattern => pattern.test(inputValue)) ||\n               importPatterns.some(pattern => pattern.test(inputValue));\n               \n      case 'modify':\n        return deletePatterns.some(pattern => pattern.test(inputValue)) ||\n               importPatterns.some(pattern => pattern.test(inputValue));\n               \n      case 'import':\n        return deletePatterns.some(pattern => pattern.test(inputValue)) ||\n               modifyPatterns.some(pattern => pattern.test(inputValue));\n               \n      case 'generate':\n        return deletePatterns.some(pattern => pattern.test(inputValue)) ||\n               modifyPatterns.some(pattern => pattern.test(inputValue)) ||\n               importPatterns.some(pattern => pattern.test(inputValue));\n               \n      default:\n        return false;\n    }\n  }\n\n  /**\n   * ãƒ¢ãƒ¼ãƒ‰è¡¨ç¤ºåã‚’å–å¾—\n   */\n  getModeDisplayName(mode) {\n    const modeNames = {\n      'generate': 'ç”Ÿæˆ',\n      'import': 'ã‚¤ãƒ³ãƒãƒ¼ãƒˆ',\n      'modify': 'ä¿®æ­£',\n      'delete': 'å‰Šé™¤'\n    };\n    return modeNames[mode] || mode;\n  }\n\n  /**\n   * å¸¸æ™‚è¡¨ç¤ºãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒãƒ§ã‚³ã‚¢ã‚¤ã‚³ãƒ³ã‚’ä½œæˆ\n   */\n  createFloatingChocolateIcon() {\n    // æ—¢å­˜ã®ã‚¢ã‚¤ã‚³ãƒ³ãŒã‚ã‚Œã°å‰Šé™¤\n    if (this.floatingChocolateIcon) {\n      this.floatingChocolateIcon.remove();\n    }\n\n    this.floatingChocolateIcon = document.createElement('div');\n    this.floatingChocolateIcon.innerHTML = 'ğŸ«';\n    this.floatingChocolateIcon.title = 'ChocoDrop ã‚’é–‹ã (@ã‚­ãƒ¼ã§ã‚‚é–‹ã‘ã¾ã™)';\n    this.floatingChocolateIcon.style.cssText = `\n      position: fixed;\n      bottom: 20px;\n      right: 20px;\n      width: 48px;\n      height: 48px;\n      border-radius: 50%;\n      background: rgba(99, 102, 241, 0.15);\n      backdrop-filter: blur(16px);\n      -webkit-backdrop-filter: blur(16px);\n      border: 1px solid rgba(255, 255, 255, 0.2);\n      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.2), 0 2px 6px rgba(0, 0, 0, 0.05);\n      opacity: 0.8;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-size: 20px;\n      cursor: pointer;\n      z-index: 999;\n      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n      transform: scale(1);\n      filter: none;\n    `;\n\n    // ãƒ›ãƒãƒ¼åŠ¹æœ\n    this.floatingChocolateIcon.addEventListener('mouseover', () => {\n      this.floatingChocolateIcon.style.transform = 'scale(1.1) translateY(-2px)';\n      this.floatingChocolateIcon.style.boxShadow = '0 6px 16px rgba(99, 102, 241, 0.3), 0 3px 8px rgba(0, 0, 0, 0.1)';\n      this.floatingChocolateIcon.style.opacity = '1';\n      this.floatingChocolateIcon.style.filter = 'none';\n    });\n\n    this.floatingChocolateIcon.addEventListener('mouseout', () => {\n      this.floatingChocolateIcon.style.transform = 'scale(1) translateY(0)';\n      this.floatingChocolateIcon.style.boxShadow = '0 4px 12px rgba(99, 102, 241, 0.2), 0 2px 6px rgba(0, 0, 0, 0.05)';\n      this.floatingChocolateIcon.style.opacity = '0.8';\n      this.floatingChocolateIcon.style.filter = 'none';\n    });\n\n    // ã‚¯ãƒªãƒƒã‚¯ã§ ChocoDrop ã‚’é–‹ã\n    this.floatingChocolateIcon.addEventListener('click', () => {\n      if (this.isVisible) {\n        this.hide();\n      } else {\n        this.show();\n      }\n    });\n\n    // å³ã‚¯ãƒªãƒƒã‚¯ãƒ¡ãƒ‹ãƒ¥ãƒ¼\n    this.floatingChocolateIcon.addEventListener('contextmenu', (e) => {\n      e.preventDefault();\n      this.showFloatingIconContextMenu(e);\n    });\n\n    // DOM ã«è¿½åŠ \n    document.body.appendChild(this.floatingChocolateIcon);\n  }\n\n  /**\n   * ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¢ã‚¤ã‚³ãƒ³ã®å³ã‚¯ãƒªãƒƒã‚¯ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¡¨ç¤º\n   */\n  showFloatingIconContextMenu(event) {\n    // æ—¢å­˜ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒã‚ã‚Œã°å‰Šé™¤\n    const existingMenu = document.querySelector('.floating-icon-context-menu');\n    if (existingMenu) {\n      existingMenu.remove();\n    }\n\n    // ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ä½œæˆ\n    const menu = document.createElement('div');\n    menu.className = 'floating-icon-context-menu';\n    menu.style.cssText = `\n      position: fixed;\n      top: ${event.clientY}px;\n      left: ${event.clientX}px;\n      background: ${this.isWabiSabiMode\n        ? 'rgba(239, 235, 233, 0.9)'\n        : (this.isDarkMode ? 'rgba(17, 24, 39, 0.85)' : 'rgba(255, 255, 255, 0.85)')};\n      backdrop-filter: blur(20px);\n      -webkit-backdrop-filter: blur(20px);\n      border: 1px solid ${this.isWabiSabiMode\n        ? 'rgba(161, 136, 127, 0.4)'\n        : (this.isDarkMode ? 'rgba(129, 140, 248, 0.3)' : 'rgba(99, 102, 241, 0.2)')};\n      border-radius: 12px;\n      box-shadow: ${this.isWabiSabiMode\n        ? '0 8px 24px rgba(93, 64, 55, 0.2), 0 4px 12px rgba(0, 0, 0, 0.1)'\n        : '0 8px 24px rgba(99, 102, 241, 0.2), 0 4px 12px rgba(0, 0, 0, 0.1)'};\n      padding: 8px 0;\n      min-width: 160px;\n      z-index: 2000;\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n      font-size: 14px;\n      color: ${this.isWabiSabiMode\n        ? '#5D4037'\n        : (this.isDarkMode ? '#ffffff' : '#1f2937')};\n    `;\n\n    // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚¢ã‚¤ãƒ†ãƒ 1: ãƒ•ã‚©ãƒ¼ãƒ ã‚’é–‹ã\n    const openFormItem = document.createElement('div');\n    openFormItem.innerHTML = 'ğŸ“„ ãƒ•ã‚©ãƒ¼ãƒ ã‚’é–‹ã';\n    openFormItem.style.cssText = `\n      padding: 8px 16px;\n      cursor: pointer;\n      transition: all 0.2s ease;\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      color: ${this.isWabiSabiMode ? '#8D6E63' : '#6366f1'};\n      text-shadow: ${this.isWabiSabiMode\n        ? '0 2px 4px rgba(141, 110, 99, 0.3)'\n        : '0 2px 4px rgba(99, 102, 241, 0.3)'};\n    `;\n\n    openFormItem.addEventListener('mouseover', () => {\n      openFormItem.style.background = this.isWabiSabiMode\n        ? 'rgba(161, 136, 127, 0.15)'\n        : (this.isDarkMode ? 'rgba(99, 102, 241, 0.15)' : 'rgba(99, 102, 241, 0.1)');\n      openFormItem.style.textShadow = this.isWabiSabiMode\n        ? '0 2px 6px rgba(141, 110, 99, 0.5)'\n        : '0 2px 6px rgba(99, 102, 241, 0.5)';\n    });\n\n    openFormItem.addEventListener('mouseout', () => {\n      openFormItem.style.background = 'transparent';\n      openFormItem.style.textShadow = this.isWabiSabiMode\n        ? '0 2px 4px rgba(141, 110, 99, 0.3)'\n        : '0 2px 4px rgba(99, 102, 241, 0.3)';\n    });\n\n    openFormItem.addEventListener('click', () => {\n      menu.remove();\n      if (this.isVisible) {\n        this.hide();\n      } else {\n        this.show();\n      }\n    });\n\n    // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚¢ã‚¤ãƒ†ãƒ 2: ã‚¢ã‚¤ã‚³ãƒ³ã‚’éè¡¨ç¤º\n    const hideIconItem = document.createElement('div');\n    hideIconItem.innerHTML = 'âœ• ã‚¢ã‚¤ã‚³ãƒ³ã‚’éè¡¨ç¤º';\n    hideIconItem.style.cssText = `\n      padding: 8px 16px;\n      cursor: pointer;\n      transition: all 0.2s ease;\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      color: ${this.isWabiSabiMode ? '#8D6E63' : '#6366f1'};\n      text-shadow: ${this.isWabiSabiMode\n        ? '0 2px 4px rgba(141, 110, 99, 0.3)'\n        : '0 2px 4px rgba(99, 102, 241, 0.3)'};\n    `;\n\n    hideIconItem.addEventListener('mouseover', () => {\n      hideIconItem.style.background = this.isWabiSabiMode\n        ? 'rgba(161, 136, 127, 0.15)'\n        : (this.isDarkMode ? 'rgba(99, 102, 241, 0.15)' : 'rgba(99, 102, 241, 0.1)');\n      hideIconItem.style.textShadow = this.isWabiSabiMode\n        ? '0 2px 6px rgba(141, 110, 99, 0.5)'\n        : '0 2px 6px rgba(99, 102, 241, 0.5)';\n    });\n\n    hideIconItem.addEventListener('mouseout', () => {\n      hideIconItem.style.background = 'transparent';\n      hideIconItem.style.textShadow = this.isWabiSabiMode\n        ? '0 2px 4px rgba(141, 110, 99, 0.3)'\n        : '0 2px 4px rgba(99, 102, 241, 0.3)';\n    });\n\n    hideIconItem.addEventListener('click', () => {\n      menu.remove();\n      this.hideFloatingIcon();\n    });\n\n    // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«è¿½åŠ \n    menu.appendChild(openFormItem);\n    menu.appendChild(hideIconItem);\n\n    // DOM ã«è¿½åŠ \n    document.body.appendChild(menu);\n\n    // ç”»é¢å¤–ã«å‡ºãªã„ã‚ˆã†ã«èª¿æ•´\n    const rect = menu.getBoundingClientRect();\n    if (rect.right > window.innerWidth) {\n      menu.style.left = `${event.clientX - rect.width}px`;\n    }\n    if (rect.bottom > window.innerHeight) {\n      menu.style.top = `${event.clientY - rect.height}px`;\n    }\n\n    // å¤–éƒ¨ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹\n    const closeMenu = (e) => {\n      if (!menu.contains(e.target)) {\n        menu.remove();\n        document.removeEventListener('click', closeMenu);\n      }\n    };\n\n    setTimeout(() => {\n      document.addEventListener('click', closeMenu);\n    }, 10);\n  }\n\n  /**\n   * ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¢ã‚¤ã‚³ãƒ³ã‚’éè¡¨ç¤ºã«ã™ã‚‹\n   */\n  hideFloatingIcon() {\n    if (this.floatingChocolateIcon) {\n      this.floatingChocolateIcon.style.display = 'none';\n    }\n  }\n\n  /**\n   * ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¢ã‚¤ã‚³ãƒ³ã‚’è¡¨ç¤ºã™ã‚‹\n   */\n  showFloatingIcon() {\n    if (this.floatingChocolateIcon) {\n      this.floatingChocolateIcon.style.display = 'flex';\n    }\n  }\n\n  dispose() {\n    // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒã‚¤ãƒ©ã‚¤ãƒˆã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—\n    this.clearKeywordHighlighting();\n\n    // ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠé–¢é€£ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—\n    if (this.fileInput && this.fileInput.parentNode) {\n      this.fileInput.parentNode.removeChild(this.fileInput);\n    }\n    if (this.selectedFile && this.selectedFile.url) {\n      URL.revokeObjectURL(this.selectedFile.url);\n    }\n\n    // ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒãƒ§ã‚³ã‚¢ã‚¤ã‚³ãƒ³ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—\n    if (this.floatingChocolateIcon && this.floatingChocolateIcon.parentNode) {\n      this.floatingChocolateIcon.parentNode.removeChild(this.floatingChocolateIcon);\n    }\n\n    if (this.container && this.container.parentElement) {\n      this.container.parentElement.removeChild(this.container);\n    }\n  }\n\n  showOverlayTextarea() {\n    if (this.overlayTextarea) return;\n\n    this.isExpanded = true;\n    \n    // ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã‚’ä½œæˆ\n    this.overlayTextarea = document.createElement('textarea');\n    this.overlayTextarea.value = this.input.value;\n    this.overlayTextarea.placeholder = this.input.placeholder;\n    \n    // ãƒ•ã‚©ãƒ¼ãƒ ã®ä½ç½®ã¨ã‚µã‚¤ã‚ºã‚’å–å¾—\n    const containerRect = this.container.getBoundingClientRect();\n    \n    // ç”»é¢å¢ƒç•Œã‚’è€ƒæ…®ã—ãŸä½ç½®èª¿æ•´\n    const overlayHeight = 300;\n    const padding = 20;\n    \n    let top = containerRect.top + 60;\n    let left = containerRect.left;\n    let width = containerRect.width;\n    \n    // å³ç«¯ãŒã¯ã¿å‡ºã‚‹å ´åˆ\n    if (left + width > window.innerWidth - padding) {\n      left = window.innerWidth - width - padding;\n    }\n    \n    // å·¦ç«¯ãŒã¯ã¿å‡ºã‚‹å ´åˆ\n    if (left < padding) {\n      left = padding;\n      width = Math.min(width, window.innerWidth - 2 * padding);\n    }\n    \n    // ä¸‹ç«¯ãŒã¯ã¿å‡ºã‚‹å ´åˆ\n    if (top + overlayHeight > window.innerHeight - padding) {\n      top = Math.max(padding, window.innerHeight - overlayHeight - padding);\n    }\n\n    const overlayBackground = this.isWabiSabiMode\n      ? 'linear-gradient(135deg, rgba(97, 97, 97, 0.7), rgba(66, 66, 66, 0.6))'\n      : (this.isDarkMode\n        ? 'linear-gradient(135deg, rgba(30, 27, 75, 0.4), rgba(15, 23, 42, 0.5))'\n        : 'linear-gradient(135deg, rgba(255, 255, 255, 0.3), rgba(255, 255, 255, 0.2))');\n\n    const overlayBorder = this.isWabiSabiMode\n      ? '1px solid rgba(93, 64, 55, 0.5)'\n      : (this.isDarkMode\n        ? '1px solid rgba(99, 102, 241, 0.25)'\n        : '1px solid rgba(255, 255, 255, 0.5)');\n\n    const overlayInnerShadow = this.isWabiSabiMode\n      ? '0 4px 16px rgba(66, 66, 66, 0.3), inset 0 1px 0 rgba(189, 189, 189, 0.2)'\n      : (this.isDarkMode\n        ? '0 4px 16px rgba(15, 23, 42, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.08)'\n        : '0 4px 16px rgba(0, 0, 0, 0.08), inset 0 1px 0 rgba(255, 255, 255, 0.4)');\n\n    const overlayTextColor = this.getInputTextColor();\n\n    // ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã®ã‚¹ã‚¿ã‚¤ãƒ«è¨­å®š\n    this.overlayTextarea.style.cssText = `\n      position: fixed;\n      top: ${top}px;\n      left: ${left}px;\n      width: ${width}px;\n      height: ${overlayHeight}px;\n      box-sizing: border-box;\n      background: ${overlayBackground};\n      backdrop-filter: blur(24px) saturate(180%);\n      border: ${overlayBorder};\n      box-shadow: ${overlayInnerShadow};\n      border-radius: 16px;\n      color: ${overlayTextColor};\n      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n      font-size: 14px;\n      line-height: 1.5;\n      padding: 20px;\n      resize: none;\n      outline: none;\n      z-index: 10000;\n      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);\n      opacity: 0;\n      transition: opacity 0.2s ease-out;\n    `;\n    \n    // ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«è¿½åŠ \n    document.body.appendChild(this.overlayTextarea);\n    \n    // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹\n    requestAnimationFrame(() => {\n      this.overlayTextarea.style.opacity = '1';\n    });\n    \n    // ãƒ•ã‚©ãƒ¼ã‚«ã‚¹è¨­å®š\n    this.overlayTextarea.focus();\n    \n    // å…¥åŠ›åŒæœŸ\n    this.overlayTextarea.addEventListener('input', (e) => {\n      this.input.value = e.target.value;\n    });\n    \n    // Escapeã‚­ãƒ¼ã§é–‰ã˜ã‚‹\n    this.overlayTextarea.addEventListener('keydown', (e) => {\n      if (e.key === 'Escape') {\n        this.hideOverlayTextarea();\n      }\n    });\n    \n    // å¤–å´ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹\n    this.overlayTextarea.addEventListener('blur', () => {\n      setTimeout(() => this.hideOverlayTextarea(), 100);\n    });\n  }\n  \n  hideOverlayTextarea() {\n    if (!this.overlayTextarea) return;\n    \n    this.isExpanded = false;\n    \n    // ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³\n    this.overlayTextarea.style.opacity = '0';\n    \n    setTimeout(() => {\n      if (this.overlayTextarea) {\n        document.body.removeChild(this.overlayTextarea);\n        this.overlayTextarea = null;\n      }\n    }, 200);\n  }\n  \n  hideOverlayTextarea() {\n    if (!this.overlayTextarea) return;\n    \n    this.isExpanded = false;\n    \n    // ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³\n    this.overlayTextarea.style.opacity = '0';\n    \n    setTimeout(() => {\n      if (this.overlayTextarea) {\n        document.body.removeChild(this.overlayTextarea);\n        this.overlayTextarea = null;\n      }\n    }, 200);\n  }\n}\n","import { ChocoDropClient, ChocoDroClient, LiveCommandClient } from './LiveCommandClient.js';\nimport { SceneManager } from './SceneManager.js';\nimport { CommandUI } from './CommandUI.js';\n\n/**\n * ChocoDrop ãƒ¯ãƒ³ã‚¹ãƒ†ãƒƒãƒ—åˆæœŸåŒ–ãƒ˜ãƒ«ãƒ‘ãƒ¼\n * å…±æœ‰ãƒ•ã‚©ãƒ«ãƒ€ã‹ã‚‰è¤‡æ•°ã® Three.js ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¸ä½¿ã„å›ã™ã“ã¨ã‚’æƒ³å®š\n *\n * @param {THREE.Scene} scene - æ—¢å­˜ Three.js ã‚·ãƒ¼ãƒ³\n * @param {Object} options - åˆæœŸåŒ–ã‚ªãƒ—ã‚·ãƒ§ãƒ³\n * @param {THREE.Camera} [options.camera] - ç›¸å¯¾é…ç½®è¨ˆç®—ã«ä½¿ç”¨ã™ã‚‹ã‚«ãƒ¡ãƒ©\n * @param {THREE.WebGLRenderer} [options.renderer] - ãƒã‚¦ã‚¹æ“ä½œã‚’æœ‰åŠ¹åŒ–ã™ã‚‹å ´åˆã«ä½¿ç”¨\n * @param {string} [options.serverUrl] - ChocoDrop ã‚µãƒ¼ãƒãƒ¼ã®æ˜ç¤ºçš„ URL\n * @param {ChocoDropClient} [options.client] - æ—¢å­˜ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’æ³¨å…¥ã™ã‚‹å ´åˆï¼ˆæ—§ LiveCommandClientï¼‰\n * @param {Function} [options.onControlsToggle] - UI é–‹é–‰æ™‚ã«å‘¼ã°ã‚Œã‚‹ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯\n * @param {Object} [options.sceneOptions] - SceneManager ã¸æ¸¡ã™è¿½åŠ ã‚ªãƒ—ã‚·ãƒ§ãƒ³\n * @param {Object} [options.uiOptions] - CommandUI ã¸æ¸¡ã™è¿½åŠ ã‚ªãƒ—ã‚·ãƒ§ãƒ³\n * @returns {Object} - åˆæœŸåŒ–æ¸ˆã¿ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆç¾¤ã¨ dispose ãƒ˜ãƒ«ãƒ‘ãƒ¼\n */\nexport function createChocoDrop(scene, options = {}) {\n  if (!scene) {\n    throw new Error('THREE.Scene ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒå¿…è¦ã§ã™');\n  }\n\n  const {\n    camera = null,\n    renderer = null,\n    serverUrl = null,\n    client = null,\n    onControlsToggle = () => {},\n    sceneOptions = {},\n    uiOptions = {}\n  } = options;\n\n  const resolvedServerUrl = serverUrl || sceneOptions.serverUrl || null;\n  const chocoDropClient = client || new ChocoDropClient(resolvedServerUrl);\n\n  const sceneManager = new SceneManager(scene, {\n    camera,\n    renderer,\n    serverUrl: resolvedServerUrl,\n    client: chocoDropClient,\n    ...sceneOptions\n  });\n\n  const commandUI = new CommandUI({\n    sceneManager,\n    client: chocoDropClient,\n    onControlsToggle,\n    ...uiOptions\n  });\n\n  return {\n    client: chocoDropClient,\n    sceneManager,\n    ui: commandUI,\n    dispose() {\n      commandUI.dispose?.();\n      sceneManager.dispose?.();\n    }\n  };\n}\n\n// æ—§APIåã®äº’æ›ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ\nexport const createChocoDro = createChocoDrop;\nexport const createLiveCommand = createChocoDrop;\n","import { ChocoDropClient, ChocoDroClient, LiveCommandClient } from '../LiveCommandClient.js';\nimport { SceneManager } from '../SceneManager.js';\nimport { CommandUIDemo } from './CommandUIDemo.js';\nimport { createChocoDrop, createChocoDro, createLiveCommand } from '../bootstrap.js';\n\n/**\n * Demo version bootstrap function\n * Creates ChocoDrop instance with CommandUIDemo (restricted functionality)\n */\nfunction createChocoDropDemo(scene, options = {}) {\n  if (!scene) {\n    throw new Error('THREE.Scene ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒå¿…è¦ã§ã™');\n  }\n\n  const {\n    camera = null,\n    renderer = null,\n    serverUrl = null,\n    client = null,\n    onControlsToggle = () => {},\n    sceneOptions = {},\n    uiOptions = {},\n    ...otherSceneOptions\n  } = options;\n\n  const resolvedServerUrl = serverUrl || sceneOptions.serverUrl || null;\n  const chocoDropClient = client || new ChocoDropClient(resolvedServerUrl);\n\n  // æ—§APIã¨ã®äº’æ›ã®ãŸã‚ã€ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ã«æ¸¡ã•ã‚ŒãŸè¿½åŠ ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚‚SceneManagerã¸ä¼æ¬ã•ã›ã‚‹\n  const mergedSceneOptions = {\n    ...sceneOptions,\n    ...otherSceneOptions\n  };\n\n  const sceneManager = new SceneManager(scene, {\n    camera,\n    renderer,\n    serverUrl: resolvedServerUrl,\n    client: chocoDropClient,\n    ...mergedSceneOptions\n  });\n\n  // Use CommandUIDemo instead of CommandUI\n  const commandUI = new CommandUIDemo({\n    sceneManager,\n    client: chocoDropClient,\n    onControlsToggle,\n    ...uiOptions\n  });\n\n  sceneManager.ui = commandUI;\n  commandUI.setSceneManager(sceneManager);\n\n  return {\n    sceneManager,\n    ui: commandUI,\n    client: chocoDropClient,\n    dispose: () => {\n      if (commandUI) commandUI.dispose();\n      if (sceneManager) sceneManager.dispose();\n    }\n  };\n}\n\n// Export everything for demo UMD\nexport {\n  ChocoDropClient,\n  ChocoDroClient,\n  LiveCommandClient,\n  SceneManager,\n  CommandUIDemo,\n  createChocoDropDemo,\n  createChocoDropDemo as createChocoDrop,  // Alias for compatibility\n  createChocoDro,\n  createLiveCommand\n};\n\n// Default export for convenience\nexport default {\n  ChocoDropClient,\n  ChocoDroClient,\n  LiveCommandClient,\n  SceneManager,\n  CommandUI: CommandUIDemo, // Alias for demo\n  CommandUIDemo,\n  createChocoDrop: createChocoDropDemo, // Use demo version\n  createChocoDro,\n  createLiveCommand\n};\n"],"names":["ChocoDropClient","constructor","serverUrl","this","initialized","initPromise","console","log","initializeWithConfig","baseUrl","window","location","protocol","hostname","port","response","fetch","ok","config","json","detectServerUrl","error","warn","currentPort","ensureInitialized","Error","generateImage","prompt","options","payload","width","height","service","method","headers","body","JSON","stringify","status","result","generateVideo","safeDefaults","resolution","enable_safety_checker","enable_prompt_expansion","duration","aspect_ratio","model","seed","negative_prompt","frames_per_second","guidance_scale","executeCommand","command","getAvailableServices","LiveCommandClient","ChocoDroClient","TRANSLATION_DICTIONARY","createObjectKeywords","keywords","japanese","english","Object","entries","includes","push","translateKeyword","matchKeywordWithFilename","keyword","filename","lowerFilename","toLowerCase","jp","aliases","alias","englishKeyword","module","exports","SceneManager","scene","camera","renderer","labelRenderer","client","experimentGroup","THREE","Group","name","add","commandHistory","spawnedObjects","Map","objectCounter","selectedObject","selectedImageService","selectedVideoService","audioControls","audioControlUpdateInterval","audioControlUpdateListener","clock","Clock","raycaster","Raycaster","mouse","Vector2","lastHoveredObject","showLocationIndicator","indicatorDuration","defaultObjectScale","enableObjectSelection","enableMouseInteraction","enableDebugLogging","setupClickEvents","globalThis","sceneManager","setupObjectDragging","debugSceneInfo","position","x","toFixed","y","z","rotation","Math","PI","fov","near","far","children","length","getObjectByName","size","forEach","obj","id","worldPos","Vector3","getWorldPosition","userData","type","visible","scale","box","Box3","setFromObject","getSize","center","getCenter","meshCount","traverse","child","isMesh","distance","distanceTo","selectObject","object","deselectObject","createModernSelectionIndicator","commandUI","objectInfo","addOutput","modelName","currentMode","objectName","originalPrompt","input","value","focus","setSelectionRange","existingIndicator","remove","indicatorGroup","adjustedSize","geometry","parameters","shape","Shape","moveTo","lineTo","points","getPoints","geometryLine","BufferGeometry","setFromPoints","adaptiveColor","getAdaptiveSelectionColor","materialLine","LineBasicMaterial","color","linewidth","transparent","opacity","line","Line","set","edgesGeometry","EdgesGeometry","BoxGeometry","edgesMaterial","edges","LineSegments","copy","addResizeHandles","parentObject","handleSize","handleGeometry","handleMaterial","MeshBasicMaterial","depthTest","depthWrite","handleHoverMaterial","getAdaptiveHoverColor","corner","pos","index","handle","Mesh","clone","isResizeHandle","handleIndex","defaultMaterial","material","hoverMaterial","renderOrder","onHover","setScalar","document","style","cursor","onHoverExit","updateSelectionIndicatorScale","indicator","dispose","Array","isArray","canvas","domElement","isDragging","dragObject","dragOffset","mouseStart","dragMode","originalScale","addEventListener","event","button","rect","getBoundingClientRect","clientX","left","clientY","top","setFromCamera","intersects","intersectObjects","resizeHandleInfo","isRotateHandle","source","showDeleteConfirmation","then","confirmed","removeObject","catch","point","sub","handleHoverEffects","deltaX","deltaY","scaleMultiplier","abs","newScale","max","min","cameraRight","cameraUp","getWorldDirection","setFromMatrixColumn","matrixWorld","normalize","moveScale","worldMove","multiplyScalar","preventDefault","scaleFactor","emissive","setHex","setTimeout","activeEl","activeElement","tagName","isContentEditable","rotationStep","rotated","key","newRotationX","newRotationXDown","cameraDirection","targetPoint","lookAt","angles","timestamp","Date","now","parsed","parseCommand","dispatchCommand","message","startsWith","actualCommand","replace","parseObjectModificationCommand","trim","parseDeleteCommand","cmd","naturalLanguagePattern","parseNaturalLanguageCommand","isAnimationForVideo","some","parsePosition","parseSize","fileType","getObjectKeywords","normalizeTargetPhrase","phrase","referentialPattern","test","trailingPatterns","pattern","englishLeadingPattern","isReferentialCommand","getObjectSourceType","getRecentObjects","objects","from","values","importContext","generatedContext","candidates","filter","sort","a","b","aTime","lastModified","createdAt","findRecentObjectByContext","normalizedTarget","objectKeywords","candidate","matchesObjectName","extractTextTokens","text","split","map","token","buildObjectKeywordHints","fileName","baseType","Set","baseName","Boolean","findObjectByKeyword","normalizedCommand","importOrderMatch","match","orderNumber","parseInt","findImportedObjectByOrder","sourceMatch","sourceType","isImported","findObjectBySourceAndName","recentObject","findObjectByName","importedObjects","importOrder","matchingObjects","foundObject","childSource","sourceLabel","target","targetLower","keywordLower","aliasLower","promptLower","parseImageGenerationCommand","particles","particle","parts","colorMap","colorName","colorValue","effects","parseEffects","parseFloat","movement","parsePositionFromPrompt","degreeMatch","flip","requiresSelection","effectKeywords","intensity","metalness","roughness","animation","speed","amplitude","axis","colors","presetEffects","presetName","presetEffectList","chromaRequested","requiresChromaKey","chromaConfig","detectChromaKeyConfig","canApplyChroma","effect","threshold","smoothing","toString","showInputFeedback","term","detectChromaKeyColor","hexMatch","colorKeywords","tokens","entry","applyEffects","targetObject","applied","applyOpacityEffect","applyGlowEffect","applyMaterialEffect","applyAnimationEffect","applyCosmicEffect","applyWatercolorEffect","applyChromaKeyEffect","needsUpdate","ensureEmissiveSupport","Color","emissiveIntensity","fallbackColor","originalColor","lerp","undefined","animations","startAnimationLoop","animationId","uuid","has","delete","animationData","startTime","originalPosition","originalRotation","useColorFallback","cosmicAnimationId","cosmicData","cosmicType","getCosmicSpeed","colorIndex","originalEmissive","originalEmissiveIntensity","texture","isChromaKeyMaterial","uniforms","keyColor","shaderMaterial","ShaderMaterial","vertexShader","fragmentShader","side","DoubleSide","toneMapped","watercolorAnimationId","watercolorData","artType","getWatercolorSpeed","originalOpacity","animationLoopRunning","animate","updateAnimations","requestAnimationFrame","currentTime","elapsed","updateFloatAnimation","updatePulseAnimation","updateSpinAnimation","updateSparkleAnimation","updateRainbowAnimation","updateGlitchAnimation","updateCosmicAnimation","updateWatercolorAnimation","yOffset","sin","rotationAmount","hue","setHSL","random","offset","colorCycleSpeed","numColors","colorProgress","currentColorIndex","floor","nextColorIndex","lerpFactor","currentColor","nextColor","blendedColor","intensityMultiplier","cos","opacityMultiplier","getAutoEffectsFromPrompt","lowerPrompt","applyRecognitionFeedback","stopRecognitionFeedback","feedbackAnimationId","movePatterns","regex","RegExp","direction","targetObjectName","requiresObjectSearch","colorPatterns","colorKey","rotationPatterns","flipPatterns","effectPatterns","effectName","distanceMatch","executeImageGeneration","executeVideoGeneration","executeObjectModification","executeNaturalObjectModification","executeDelete","executeFileImport","executeObjectSelection","fallbackSizes","imageResult","lastError","i","dimensions","success","loader","TextureLoader","imageUrl","localPath","pop","loadAsync","colorSpace","SRGBColorSpace","createFallbackTexture","baseSize","imageWidth","image","naturalWidth","data","aspectRatio","naturalHeight","planeWidth","planeHeight","PlaneGeometry","plane","alphaTest","finalPosition","calculateCameraRelativePosition","alignPlaneToCamera","objectId","createLocationIndicator","videoResult","videoTexture","video","videoUrl","createElement","src","crossOrigin","loop","muted","playsInline","VideoTexture","play","createFallbackVideoTexture","requestedWidth","metadata","requestedHeight","planeAspect","videoElement","createAudioControl","fallbackVideoTexture","loadImageFile","fileUrl","loadVideoFile","autoplay","preload","Promise","resolve","reject","videoWidth","videoHeight","once","load","playError","objectUrl","targetObjects","findObjectsByName","selectObjectFromMultiple","modified","currentPos","newPos","modifications","searchName","results","searchLower","originalCommand","ordinalPatterns","matchedText","currentScale","newRotation","degrees","currentOpacity","currentScaleX","updateAllAudioControlPositions","clearAll","targetByKeyword","deleteReason","deletedObjectId","display","accept","appendChild","onchange","async","file","files","URL","createObjectURL","removeChild","oncancel","click","getSpawnedObjects","modal","cssText","container","title","textContent","objectList","item","time","toLocaleTimeString","innerHTML","round","onmouseover","borderColor","background","onmouseout","onclick","selectedObjectId","cancelBtn","ctx","getContext","hashString","gradient","createLinearGradient","addColorStop","fillStyle","fillRect","font","textAlign","fillText","slice","CanvasTexture","animationFrame","icons","iconIndex","str","hash","charCodeAt","get","pause","removeAttribute","revokeObjectURL","cleanupCallbacks","cb","mat","keys","getCommandHistory","relativePosition","SphereGeometry","indicatorPos","parent","cameraPos","crossVectors","cameraUpActual","logDebug","forward","negate","up","applyQuaternion","quaternion","dot","right","orientation","Matrix4","makeBasis","setFromRotationMatrix","setCamera","updateConfig","newConfig","setImageService","serviceId","getImageService","setVideoService","getVideoService","videoObject","audioButton","className","tooltip","createTooltip","volumeSlider","sliderContainer","slider","head","e","volume","createVolumeSlider","isSliderVisible","transform","buttonRect","stopPropagation","pointerEvents","querySelector","contains","audioControlElement","updateAudioControlPosition","hideSlider","passive","setInterval","onDocumentClick","removeEventListener","parentNode","clearInterval","vector","project","offsetX","offsetY","toggleVideoAudio","initializeLabelRenderer","loadAndInitializeCSS2DRenderer","ensureCSS2DRenderer","css2dInitPromise","CSS2DRenderer","setupCSS2DRenderer","import","CSS2DObject","setSize","innerWidth","innerHeight","addLabelRendererResizeHandler","labelRendererResizeHandler","updateRenderer","render","args","backgroundColor","bgColor","r","g","isColor","pow","getLuminance","IMAGE_SERVICE_STORAGE_KEY","VIDEO_SERVICE_STORAGE_KEY","CommandUIDemo","onControlsToggle","isVisible","output","activeConnections","currentTaskId","activationKey","maxHeight","theme","showExamples","autoScroll","availableImageServices","availableVideoServices","imageServiceSelect","videoServiceSelect","serviceSelectorContainer","serviceSelectorStatus","serviceSelectorContent","serviceSelectorRetryButton","serviceSelectorSaveButton","serviceSelectorCancelButton","serviceModalOverlay","serviceModal","servicesLoading","isExpanded","overlayTextarea","pendingImageService","pendingVideoService","storedImage","localStorage","getItem","storedVideo","applyServiceSelectionToSceneManager","currentTheme","isDarkMode","isWabiSabiMode","currentHistoryIndex","maxHistorySize","initUI","bindEvents","createServiceModal","createFloatingChocolateIcon","refreshStyles","openServiceModal","showDemoMessage","showCompactToast","existingToast","getElementById","buttonContainer","radioModeContainer","toast","getContainerStyles","brandIndicator","brandText","outputDiv","getOutputStyles","floatingContainer","taskCards","inputWrapper","rows","placeholder","getInputStyles","expandButton","hideOverlayTextarea","showOverlayTextarea","modeSelector","createRadioModeSelector","actionContainer","createMinimalActions","closeButton","hide","applyTheme","isComposing","hasCompositionJustEnded","autoResizeTextarea","detectCommandType","navigator","userAgent","isSafari","leftSection","clearBtn","getActionButtonStyles","clearAllWithConfirmation","historyBtn","disabled","rightSection","themeToggle","getThemeIcon","light","dark","wabisabi","icon","getThemeIconWithFilter","getThemeTitle","toggleTheme","settingsButton","createServiceSelectorSection","fontSize","marginBottom","updateServiceSelectorTheme","closeServiceModal","subtitle","selector","actionRow","initializeServiceSelector","actionButtons","handleServiceSave","toggleServiceRetryButton","forceFetch","resetPendingSelections","force","setServiceSelectorStatus","setServiceButtonsEnabled","resolveServiceSelection","default","populateServiceSelector","dataset","statusType","classList","toggle","services","defaultId","storageKey","storedId","resolvedId","setItem","removeItem","hasImage","hasVideo","imageRow","buildServiceRow","videoRow","labelText","selectedId","row","label","fontWeight","select","serviceType","fontFamily","option","description","onServiceSelectionChange","findServiceInfo","lineHeight","minHeight","info","parentElement","newImageId","newVideoId","imageInfo","videoInfo","enabled","childElementCount","find","border","statusColor","querySelectorAll","padding","borderRadius","outline","boxShadow","desc","radioModeButtons","mode","autoBadge","triggerFileSelection","selectMode","isManual","detectedKeyword","selectedGlass","addPulseEffect","addContainerGlow","getPlaceholderForMode","clearInputOnModeSwitch","selectedFile","showImportInterface","hideImportInterface","handleDeleteModeSelection","handleModifyModeSelection","element","ensurePulseAnimation","glowColor","generate","modify","variant","baseStyles","getDestructiveButtonStyles","getCommandTypeIndicatorStyles","newHeight","scrollHeight","overflowY","commandType","analyzeCommandType","mediaInfo","detectMediaType","deletePatterns","modifyPatterns","generatePatterns","confidence","reason","mediaType","requiresConfirmation","showCommandTypeIndicator","commandInfo","showProactiveSuggestion","hideProactiveSuggestion","enableGestureControl","detectedType","proactiveSuggestion","insertBefore","suggestion","t","updateIndicatorForMode","gestureEnabled","createActionButtons","getModernButtonStyles","positions","backdropFilter","getHeaderStyles","addScrollbarStyles","primary","secondary","danger","getModeButtonStyles","isActive","ctrlKey","shiftKey","redo","undo","show","flexDirection","containerRect","floatingChocolateIcon","switchMode","btn","executeBtn","placeholders","handleDemoOrientationCommand","normalized","wantsVerticalFlip","wantsHorizontalFlip","wantsRotateRight","wantsRotateLeft","wantsRotateBack","handled","operations","currentX","currentY","join","taskId","addTaskCard","saveCommandToHistory","fullCommand","getModePrefix","handleImportCommand","orientationResult","modifySelectedObject","getSelectedObjects","confirmMessage","confirm","deleteObjects","connectToProgress","updateTaskCard","errorMessages","scrollToBottom","showConfirmationDialog","confirmText","cancelText","confirmColor","dialog","closeModalWithAnimation","escHandler","addSystemMessage","taskInfo","substr","card","setAttribute","getFloatingCardStyles","setProperty","friendlyMessage","getFriendlyMessage","pending","processing","progress","completed","updateCardDisplayLimit","endTime","contentType","settings","addCardDetailEvents","animateCardEntrance","taskData","animateCardSuccess","animateCardError","getTaskCardStyles","statusBorders","allCards","existingCounter","hiddenCount","counter","counterBaseColor","counterBorderColor","counterTextColor","firstChild","counterHoverColor","maxTouchPoints","showTaskDetailModal","hoverTimeout","clearTimeout","existingModal","createTaskDetailModal","overlayColor","modalBg","modalBorder","textColor","labelColor","statusText","modalContent","closeBtn","closeTaskDetailModal","transition","animateCardExit","addErrorTooltip","getResponseType","errorMessage","shortPrompt","substring","responseType","getStatusColor","createStatusIndicator","animateTaskCompletion","addSubtleParticleEffect","ensureTaskAnimations","angle","addTaskStatus","percent","updateTaskProgress","newMessage","completeTask","existingTask","serverTaskId","uiTaskId","eventSource","EventSource","onmessage","parse","handleProgressUpdate","onerror","disconnectProgress","connection","close","scrollTop","commandData","shift","updateUndoRedoButtons","canUndo","undoLastGenerate","undoLastModify","undoLastDelete","canRedo","redoCommand","undoBtn","redoBtn","showClearAllConfirmation","example","setSceneManager","setClient","generateBtn","themeOrder","nextIndex","indexOf","currentDisplay","currentFlexDirection","brandBadge","updateFloatingContainerTheme","updateExistingTextColors","glassmorphismDark","glassmorphismLight","system","hint","defaultTextColor","fileInput","handleFileSelection","enableDragAndDrop","fileSelectButton","disableDragAndDrop","openFileSelector","detectFileType","url","defaultPrompt","handleDragOver","bind","handleDrop","handleDragEnter","handleDragLeave","dataTransfer","ext","load3DModel","processedFileName","importedType","importedUrl","triggerAttentionAnimation","chatOutput","inputField","addMicroShakeEffect","addContextGlow","addEmotionalPulse","add3DDepthEffect","ensureMicroShakeAnimation","pulseColor","borderLeft","ensureEmotionalPulseAnimation","newMode","isPreviousModeMessage","getModeDisplayName","inputValue","importPatterns","showFloatingIconContextMenu","existingMenu","menu","openFormItem","textShadow","hideIconItem","hideFloatingIcon","bottom","closeMenu","showFloatingIcon","overlayBackground","overlayBorder","overlayInnerShadow","overlayTextColor","CommandUI","highlightOverlay","inputDefaultStyles","feedbackAutoClearTimer","currentFeedback","clearInputFeedback","applyKeywordHighlighting","glowColors","intensified","hasSelectedObject","trimmedText","needsTarget","explicitTargetMatched","hasExplicitTarget","mediaReferenceIndicators","getAllCommandKeywords","createHighlightOverlay","matches","clearKeywordHighlighting","computedStyle","getComputedStyle","captureInputDefaultStyles","letterSpacing","borderWidth","highlightedHTML","lastIndex","escapeHtml","start","getKeywordColor","end","backgroundImage","getInputTextColor","div","preValidation","preValidateCommand","canExecute","proceedWithExecution","ensureShimmerStyles","styleSheet","feedbackOverlay","overlay","isError","messageSpan","flex","actions","actionsContainer","action","onClick","ensureFeedbackStyles","foundTarget","executeCommandAfterValidation","newCommand","convertToGenerateCommand","patterns","to","shimmerEffect","updateServiceModalStyles","hadHighlight","themeConfig","createChocoDrop","sceneOptions","uiOptions","resolvedServerUrl","chocoDropClient","ui","createChocoDro","createLiveCommand","createChocoDropDemo","otherSceneOptions","mergedSceneOptions"],"mappings":"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"}